/* wiki-client - 0.31.0-rc.6 - Mon, 25 Nov 2024 20:29:26 GMT */
(()=>{var Ze=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var F=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ar=F((pt,sr)=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.default=Os;function Os(t){return function(...e){if(t===null)throw new Error("Callback was already called.");var n=t;t=null,n.apply(this,e)}}sr.exports=pt.default});var Ht=F(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.fallback=cr;ke.wrap=lr;var Ms=ke.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,Fs=ke.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,qs=ke.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function cr(t){setTimeout(t,0)}function lr(t){return(e,...n)=>t(()=>e(...n))}var et;Ms?et=queueMicrotask:Fs?et=setImmediate:qs?et=process.nextTick:et=cr;ke.default=lr(et)});var dr=F((mt,fr)=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var Gt=class{constructor(){this.head=this.tail=null,this.length=0}removeLink(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e}empty(){for(;this.head;)this.shift();return this}insertAfter(e,n){n.prev=e,n.next=e.next,e.next?e.next.prev=n:this.tail=n,e.next=n,this.length+=1}insertBefore(e,n){n.prev=e.prev,n.next=e,e.prev?e.prev.next=n:this.head=n,e.prev=n,this.length+=1}unshift(e){this.head?this.insertBefore(this.head,e):ur(this,e)}push(e){this.tail?this.insertAfter(this.tail,e):ur(this,e)}shift(){return this.head&&this.removeLink(this.head)}pop(){return this.tail&&this.removeLink(this.tail)}toArray(){return[...this]}*[Symbol.iterator](){for(var e=this.head;e;)yield e.data,e=e.next}remove(e){for(var n=this.head;n;){var{next:r}=n;e(n)&&this.removeLink(n),n=r}return this}};mt.default=Gt;function ur(t,e){t.length=1,t.head=t.tail=e}fr.exports=mt.default});var gr=F((vt,hr)=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.default=function(t){return function(...e){var n=e.pop();return t.call(this,e,n)}};hr.exports=vt.default});var wr=F((yt,yr)=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.default=Ws;var js=gr(),Ns=vr(js),zs=Ht(),Us=vr(zs),Bs=wt();function vr(t){return t&&t.__esModule?t:{default:t}}function Ws(t){return(0,Bs.isAsync)(t)?function(...e){let n=e.pop(),r=t.apply(this,e);return pr(r,n)}:(0,Ns.default)(function(e,n){var r;try{r=t.apply(this,e)}catch(o){return n(o)}if(r&&typeof r.then=="function")return pr(r,n);n(null,r)})}function pr(t,e){return t.then(n=>{mr(e,null,n)},n=>{mr(e,n&&(n instanceof Error||n.message)?n:new Error(n))})}function mr(t,e,n){try{t(e,n)}catch(r){(0,Us.default)(o=>{throw o},r)}}yr.exports=yt.default});var wt=F(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.isAsyncIterable=ye.isAsyncGenerator=ye.isAsync=void 0;var Ks=wr(),Vs=Js(Ks);function Js(t){return t&&t.__esModule?t:{default:t}}function br(t){return t[Symbol.toStringTag]==="AsyncFunction"}function Ys(t){return t[Symbol.toStringTag]==="AsyncGenerator"}function Hs(t){return typeof t[Symbol.asyncIterator]=="function"}function Gs(t){if(typeof t!="function")throw new Error("expected a function");return br(t)?(0,Vs.default)(t):t}ye.default=Gs;ye.isAsync=br;ye.isAsyncGenerator=Ys;ye.isAsyncIterable=Hs});var xr=F(($t,$r)=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.default=oa;var Qs=ar(),Xs=bt(Qs),Zs=Ht(),Qt=bt(Zs),ea=dr(),ta=bt(ea),na=wt(),ra=bt(na);function bt(t){return t&&t.__esModule?t:{default:t}}function oa(t,e,n){if(e==null)e=1;else if(e===0)throw new RangeError("Concurrency must not be zero");var r=(0,ra.default)(t),o=0,s=[];let c={error:[],drain:[],saturated:[],unsaturated:[],empty:[]};function d(C,P){c[C].push(P)}function f(C,P){let j=(...W)=>{i(C,j),P(...W)};c[C].push(j)}function i(C,P){if(!C)return Object.keys(c).forEach(j=>c[j]=[]);if(!P)return c[C]=[];c[C]=c[C].filter(j=>j!==P)}function u(C,...P){c[C].forEach(j=>j(...P))}var p=!1;function h(C,P,j,W){if(W!=null&&typeof W!="function")throw new Error("task callback must be a function");R.started=!0;var S,O;function M(H,...Q){if(H)return j?O(H):S();if(Q.length<=1)return S(Q[0]);S(Q)}var B=R._createTaskItem(C,j?M:W||M);if(P?R._tasks.unshift(B):R._tasks.push(B),p||(p=!0,(0,Qt.default)(()=>{p=!1,R.process()})),j||!W)return new Promise((H,Q)=>{S=H,O=Q})}function m(C){return function(P,...j){o-=1;for(var W=0,S=C.length;W<S;W++){var O=C[W],M=s.indexOf(O);M===0?s.shift():M>0&&s.splice(M,1),O.callback(P,...j),P!=null&&u("error",P,O.data)}o<=R.concurrency-R.buffer&&u("unsaturated"),R.idle()&&u("drain"),R.process()}}function x(C){return C.length===0&&R.idle()?((0,Qt.default)(()=>u("drain")),!0):!1}let T=C=>P=>{if(!P)return new Promise((j,W)=>{f(C,(S,O)=>{if(S)return W(S);j(O)})});i(C),d(C,P)};var D=!1,R={_tasks:new ta.default,_createTaskItem(C,P){return{data:C,callback:P}},*[Symbol.iterator](){yield*R._tasks[Symbol.iterator]()},concurrency:e,payload:n,buffer:e/4,started:!1,paused:!1,push(C,P){return Array.isArray(C)?x(C)?void 0:C.map(j=>h(j,!1,!1,P)):h(C,!1,!1,P)},pushAsync(C,P){return Array.isArray(C)?x(C)?void 0:C.map(j=>h(j,!1,!0,P)):h(C,!1,!0,P)},kill(){i(),R._tasks.empty()},unshift(C,P){return Array.isArray(C)?x(C)?void 0:C.map(j=>h(j,!0,!1,P)):h(C,!0,!1,P)},unshiftAsync(C,P){return Array.isArray(C)?x(C)?void 0:C.map(j=>h(j,!0,!0,P)):h(C,!0,!0,P)},remove(C){R._tasks.remove(C)},process(){if(!D){for(D=!0;!R.paused&&o<R.concurrency&&R._tasks.length;){var C=[],P=[],j=R._tasks.length;R.payload&&(j=Math.min(j,R.payload));for(var W=0;W<j;W++){var S=R._tasks.shift();C.push(S),s.push(S),P.push(S.data)}o+=1,R._tasks.length===0&&u("empty"),o===R.concurrency&&u("saturated");var O=(0,Xs.default)(m(C));r(P,O)}D=!1}},length(){return R._tasks.length},running(){return o},workersList(){return s},idle(){return R._tasks.length+o===0},pause(){R.paused=!0},resume(){R.paused!==!1&&(R.paused=!1,(0,Qt.default)(R.process))}};return Object.defineProperties(R,{saturated:{writable:!1,value:T("saturated")},unsaturated:{writable:!1,value:T("unsaturated")},empty:{writable:!1,value:T("empty")},drain:{writable:!1,value:T("drain")},error:{writable:!1,value:T("error")}}),R}$r.exports=$t.default});var kr=F((xt,Sr)=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.default=function(t,e){var n=(0,ca.default)(t);return(0,sa.default)((r,o)=>{n(r[0],o)},e,1)};var ia=xr(),sa=_r(ia),aa=wt(),ca=_r(aa);function _r(t){return t&&t.__esModule?t:{default:t}}Sr.exports=xt.default});var Er=F((Ir,Xt)=>{(function(t){if(typeof Ir=="object"&&typeof Xt<"u")Xt.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.localforage=t()}})(function(){var t,e,n;return function r(o,s,c){function d(u,p){if(!s[u]){if(!o[u]){var h=typeof Ze=="function"&&Ze;if(!p&&h)return h(u,!0);if(f)return f(u,!0);var m=new Error("Cannot find module '"+u+"'");throw m.code="MODULE_NOT_FOUND",m}var x=s[u]={exports:{}};o[u][0].call(x.exports,function(T){var D=o[u][1][T];return d(D||T)},x,x.exports,r,o,s,c)}return s[u].exports}for(var f=typeof Ze=="function"&&Ze,i=0;i<c.length;i++)d(c[i]);return d}({1:[function(r,o,s){(function(c){"use strict";var d=c.MutationObserver||c.WebKitMutationObserver,f;if(d){var i=0,u=new d(T),p=c.document.createTextNode("");u.observe(p,{characterData:!0}),f=function(){p.data=i=++i%2}}else if(!c.setImmediate&&typeof c.MessageChannel<"u"){var h=new c.MessageChannel;h.port1.onmessage=T,f=function(){h.port2.postMessage(0)}}else"document"in c&&"onreadystatechange"in c.document.createElement("script")?f=function(){var R=c.document.createElement("script");R.onreadystatechange=function(){T(),R.onreadystatechange=null,R.parentNode.removeChild(R),R=null},c.document.documentElement.appendChild(R)}:f=function(){setTimeout(T,0)};var m,x=[];function T(){m=!0;for(var R,C,P=x.length;P;){for(C=x,x=[],R=-1;++R<P;)C[R]();P=x.length}m=!1}o.exports=D;function D(R){x.push(R)===1&&!m&&f()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,o,s){"use strict";var c=r(1);function d(){}var f={},i=["REJECTED"],u=["FULFILLED"],p=["PENDING"];o.exports=h;function h(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,S!==d&&D(this,S)}h.prototype.catch=function(S){return this.then(null,S)},h.prototype.then=function(S,O){if(typeof S!="function"&&this.state===u||typeof O!="function"&&this.state===i)return this;var M=new this.constructor(d);if(this.state!==p){var B=this.state===u?S:O;x(M,B,this.outcome)}else this.queue.push(new m(M,S,O));return M};function m(S,O,M){this.promise=S,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof M=="function"&&(this.onRejected=M,this.callRejected=this.otherCallRejected)}m.prototype.callFulfilled=function(S){f.resolve(this.promise,S)},m.prototype.otherCallFulfilled=function(S){x(this.promise,this.onFulfilled,S)},m.prototype.callRejected=function(S){f.reject(this.promise,S)},m.prototype.otherCallRejected=function(S){x(this.promise,this.onRejected,S)};function x(S,O,M){c(function(){var B;try{B=O(M)}catch(H){return f.reject(S,H)}B===S?f.reject(S,new TypeError("Cannot resolve promise with itself")):f.resolve(S,B)})}f.resolve=function(S,O){var M=R(T,O);if(M.status==="error")return f.reject(S,M.value);var B=M.value;if(B)D(S,B);else{S.state=u,S.outcome=O;for(var H=-1,Q=S.queue.length;++H<Q;)S.queue[H].callFulfilled(O)}return S},f.reject=function(S,O){S.state=i,S.outcome=O;for(var M=-1,B=S.queue.length;++M<B;)S.queue[M].callRejected(O);return S};function T(S){var O=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof O=="function")return function(){O.apply(S,arguments)}}function D(S,O){var M=!1;function B(ce){M||(M=!0,f.reject(S,ce))}function H(ce){M||(M=!0,f.resolve(S,ce))}function Q(){O(H,B)}var ae=R(Q);ae.status==="error"&&B(ae.value)}function R(S,O){var M={};try{M.value=S(O),M.status="success"}catch(B){M.status="error",M.value=B}return M}h.resolve=C;function C(S){return S instanceof this?S:f.resolve(new this(d),S)}h.reject=P;function P(S){var O=new this(d);return f.reject(O,S)}h.all=j;function j(S){var O=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var M=S.length,B=!1;if(!M)return this.resolve([]);for(var H=new Array(M),Q=0,ae=-1,ce=new this(d);++ae<M;)ge(S[ae],ae);return ce;function ge(L,q){O.resolve(L).then(X,function(J){B||(B=!0,f.reject(ce,J))});function X(J){H[q]=J,++Q===M&&!B&&(B=!0,f.resolve(ce,H))}}}h.race=W;function W(S){var O=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var M=S.length,B=!1;if(!M)return this.resolve([]);for(var H=-1,Q=new this(d);++H<M;)ae(S[H]);return Q;function ae(ce){O.resolve(ce).then(function(ge){B||(B=!0,f.resolve(Q,ge))},function(ge){B||(B=!0,f.reject(Q,ge))})}}},{1:1}],3:[function(r,o,s){(function(c){"use strict";typeof c.Promise!="function"&&(c.Promise=r(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,o,s){"use strict";var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function d(a,g){if(!(a instanceof g))throw new TypeError("Cannot call a class as a function")}function f(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var i=f();function u(){try{if(!i||!i.open)return!1;var a=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),g=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!a||g)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function p(a,g){a=a||[],g=g||{};try{return new Blob(a,g)}catch(v){if(v.name!=="TypeError")throw v;for(var l=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,y=new l,w=0;w<a.length;w+=1)y.append(a[w]);return y.getBlob(g.type)}}typeof Promise>"u"&&r(3);var h=Promise;function m(a,g){g&&a.then(function(l){g(null,l)},function(l){g(l)})}function x(a,g,l){typeof g=="function"&&a.then(g),typeof l=="function"&&a.catch(l)}function T(a){return typeof a!="string"&&(console.warn(a+" used as a key, but it is not a string."),a=String(a)),a}function D(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var R="local-forage-detect-blob-support",C=void 0,P={},j=Object.prototype.toString,W="readonly",S="readwrite";function O(a){for(var g=a.length,l=new ArrayBuffer(g),y=new Uint8Array(l),w=0;w<g;w++)y[w]=a.charCodeAt(w);return l}function M(a){return new h(function(g){var l=a.transaction(R,S),y=p([""]);l.objectStore(R).put(y,"key"),l.onabort=function(w){w.preventDefault(),w.stopPropagation(),g(!1)},l.oncomplete=function(){var w=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);g(v||!w||parseInt(w[1],10)>=43)}}).catch(function(){return!1})}function B(a){return typeof C=="boolean"?h.resolve(C):M(a).then(function(g){return C=g,C})}function H(a){var g=P[a.name],l={};l.promise=new h(function(y,w){l.resolve=y,l.reject=w}),g.deferredOperations.push(l),g.dbReady?g.dbReady=g.dbReady.then(function(){return l.promise}):g.dbReady=l.promise}function Q(a){var g=P[a.name],l=g.deferredOperations.pop();if(l)return l.resolve(),l.promise}function ae(a,g){var l=P[a.name],y=l.deferredOperations.pop();if(y)return y.reject(g),y.promise}function ce(a,g){return new h(function(l,y){if(P[a.name]=P[a.name]||pe(),a.db)if(g)H(a),a.db.close();else return l(a.db);var w=[a.name];g&&w.push(a.version);var v=i.open.apply(i,w);g&&(v.onupgradeneeded=function(b){var _=v.result;try{_.createObjectStore(a.storeName),b.oldVersion<=1&&_.createObjectStore(R)}catch(k){if(k.name==="ConstraintError")console.warn('The database "'+a.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+a.storeName+'" already exists.');else throw k}}),v.onerror=function(b){b.preventDefault(),y(v.error)},v.onsuccess=function(){var b=v.result;b.onversionchange=function(_){_.target.close()},l(b),Q(a)}})}function ge(a){return ce(a,!1)}function L(a){return ce(a,!0)}function q(a,g){if(!a.db)return!0;var l=!a.db.objectStoreNames.contains(a.storeName),y=a.version<a.db.version,w=a.version>a.db.version;if(y&&(a.version!==g&&console.warn('The database "'+a.name+`" can't be downgraded from version `+a.db.version+" to version "+a.version+"."),a.version=a.db.version),w||l){if(l){var v=a.db.version+1;v>a.version&&(a.version=v)}return!0}return!1}function X(a){return new h(function(g,l){var y=new FileReader;y.onerror=l,y.onloadend=function(w){var v=btoa(w.target.result||"");g({__local_forage_encoded_blob:!0,data:v,type:a.type})},y.readAsBinaryString(a)})}function J(a){var g=O(atob(a.data));return p([g],{type:a.type})}function ne(a){return a&&a.__local_forage_encoded_blob}function Be(a){var g=this,l=g._initReady().then(function(){var y=P[g._dbInfo.name];if(y&&y.dbReady)return y.dbReady});return x(l,a,a),l}function We(a){H(a);for(var g=P[a.name],l=g.forages,y=0;y<l.length;y++){var w=l[y];w._dbInfo.db&&(w._dbInfo.db.close(),w._dbInfo.db=null)}return a.db=null,ge(a).then(function(v){return a.db=v,q(a)?L(a):v}).then(function(v){a.db=g.db=v;for(var b=0;b<l.length;b++)l[b]._dbInfo.db=v}).catch(function(v){throw ae(a,v),v})}function ie(a,g,l,y){y===void 0&&(y=1);try{var w=a.db.transaction(a.storeName,g);l(null,w)}catch(v){if(y>0&&(!a.db||v.name==="InvalidStateError"||v.name==="NotFoundError"))return h.resolve().then(function(){if(!a.db||v.name==="NotFoundError"&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),L(a)}).then(function(){return We(a).then(function(){ie(a,g,l,y-1)})}).catch(l);l(v)}}function pe(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function qi(a){var g=this,l={db:null};if(a)for(var y in a)l[y]=a[y];var w=P[l.name];w||(w=pe(),P[l.name]=w),w.forages.push(g),g._initReady||(g._initReady=g.ready,g.ready=Be);var v=[];function b(){return h.resolve()}for(var _=0;_<w.forages.length;_++){var k=w.forages[_];k!==g&&v.push(k._initReady().catch(b))}var I=w.forages.slice(0);return h.all(v).then(function(){return l.db=w.db,ge(l)}).then(function(E){return l.db=E,q(l,g._defaultConfig.version)?L(l):E}).then(function(E){l.db=w.db=E,g._dbInfo=l;for(var A=0;A<I.length;A++){var N=I[A];N!==g&&(N._dbInfo.db=l.db,N._dbInfo.version=l.version)}})}function ji(a,g){var l=this;a=T(a);var y=new h(function(w,v){l.ready().then(function(){ie(l._dbInfo,W,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=k.get(a);I.onsuccess=function(){var E=I.result;E===void 0&&(E=null),ne(E)&&(E=J(E)),w(E)},I.onerror=function(){v(I.error)}}catch(E){v(E)}})}).catch(v)});return m(y,g),y}function Ni(a,g){var l=this,y=new h(function(w,v){l.ready().then(function(){ie(l._dbInfo,W,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=k.openCursor(),E=1;I.onsuccess=function(){var A=I.result;if(A){var N=A.value;ne(N)&&(N=J(N));var K=a(N,A.key,E++);K!==void 0?w(K):A.continue()}else w()},I.onerror=function(){v(I.error)}}catch(A){v(A)}})}).catch(v)});return m(y,g),y}function zi(a,g,l){var y=this;a=T(a);var w=new h(function(v,b){var _;y.ready().then(function(){return _=y._dbInfo,j.call(g)==="[object Blob]"?B(_.db).then(function(k){return k?g:X(g)}):g}).then(function(k){ie(y._dbInfo,S,function(I,E){if(I)return b(I);try{var A=E.objectStore(y._dbInfo.storeName);k===null&&(k=void 0);var N=A.put(k,a);E.oncomplete=function(){k===void 0&&(k=null),v(k)},E.onabort=E.onerror=function(){var K=N.error?N.error:N.transaction.error;b(K)}}catch(K){b(K)}})}).catch(b)});return m(w,l),w}function Ui(a,g){var l=this;a=T(a);var y=new h(function(w,v){l.ready().then(function(){ie(l._dbInfo,S,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=k.delete(a);_.oncomplete=function(){w()},_.onerror=function(){v(I.error)},_.onabort=function(){var E=I.error?I.error:I.transaction.error;v(E)}}catch(E){v(E)}})}).catch(v)});return m(y,g),y}function Bi(a){var g=this,l=new h(function(y,w){g.ready().then(function(){ie(g._dbInfo,S,function(v,b){if(v)return w(v);try{var _=b.objectStore(g._dbInfo.storeName),k=_.clear();b.oncomplete=function(){y()},b.onabort=b.onerror=function(){var I=k.error?k.error:k.transaction.error;w(I)}}catch(I){w(I)}})}).catch(w)});return m(l,a),l}function Wi(a){var g=this,l=new h(function(y,w){g.ready().then(function(){ie(g._dbInfo,W,function(v,b){if(v)return w(v);try{var _=b.objectStore(g._dbInfo.storeName),k=_.count();k.onsuccess=function(){y(k.result)},k.onerror=function(){w(k.error)}}catch(I){w(I)}})}).catch(w)});return m(l,a),l}function Ki(a,g){var l=this,y=new h(function(w,v){if(a<0){w(null);return}l.ready().then(function(){ie(l._dbInfo,W,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=!1,E=k.openKeyCursor();E.onsuccess=function(){var A=E.result;if(!A){w(null);return}a===0||I?w(A.key):(I=!0,A.advance(a))},E.onerror=function(){v(E.error)}}catch(A){v(A)}})}).catch(v)});return m(y,g),y}function Vi(a){var g=this,l=new h(function(y,w){g.ready().then(function(){ie(g._dbInfo,W,function(v,b){if(v)return w(v);try{var _=b.objectStore(g._dbInfo.storeName),k=_.openKeyCursor(),I=[];k.onsuccess=function(){var E=k.result;if(!E){y(I);return}I.push(E.key),E.continue()},k.onerror=function(){w(k.error)}}catch(E){w(E)}})}).catch(w)});return m(l,a),l}function Ji(a,g){g=D.apply(this,arguments);var l=this.config();a=typeof a!="function"&&a||{},a.name||(a.name=a.name||l.name,a.storeName=a.storeName||l.storeName);var y=this,w;if(!a.name)w=h.reject("Invalid arguments");else{var v=a.name===l.name&&y._dbInfo.db,b=v?h.resolve(y._dbInfo.db):ge(a).then(function(_){var k=P[a.name],I=k.forages;k.db=_;for(var E=0;E<I.length;E++)I[E]._dbInfo.db=_;return _});a.storeName?w=b.then(function(_){if(_.objectStoreNames.contains(a.storeName)){var k=_.version+1;H(a);var I=P[a.name],E=I.forages;_.close();for(var A=0;A<E.length;A++){var N=E[A];N._dbInfo.db=null,N._dbInfo.version=k}var K=new h(function(V,ee){var Z=i.open(a.name,k);Z.onerror=function(ue){var Xe=Z.result;Xe.close(),ee(ue)},Z.onupgradeneeded=function(){var ue=Z.result;ue.deleteObjectStore(a.storeName)},Z.onsuccess=function(){var ue=Z.result;ue.close(),V(ue)}});return K.then(function(V){I.db=V;for(var ee=0;ee<E.length;ee++){var Z=E[ee];Z._dbInfo.db=V,Q(Z._dbInfo)}}).catch(function(V){throw(ae(a,V)||h.resolve()).catch(function(){}),V})}}):w=b.then(function(_){H(a);var k=P[a.name],I=k.forages;_.close();for(var E=0;E<I.length;E++){var A=I[E];A._dbInfo.db=null}var N=new h(function(K,V){var ee=i.deleteDatabase(a.name);ee.onerror=function(){var Z=ee.result;Z&&Z.close(),V(ee.error)},ee.onblocked=function(){console.warn('dropInstance blocked for database "'+a.name+'" until all open connections are closed')},ee.onsuccess=function(){var Z=ee.result;Z&&Z.close(),K(Z)}});return N.then(function(K){k.db=K;for(var V=0;V<I.length;V++){var ee=I[V];Q(ee._dbInfo)}}).catch(function(K){throw(ae(a,K)||h.resolve()).catch(function(){}),K})})}return m(w,g),w}var Yi={_driver:"asyncStorage",_initStorage:qi,_support:u(),iterate:Ni,getItem:ji,setItem:zi,removeItem:Ui,clear:Bi,length:Wi,key:Ki,keys:Vi,dropInstance:Ji};function Hi(){return typeof openDatabase=="function"}var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Gi="~~local_forage_type~",zn=/^~~local_forage_type~([^~]+)~/,ht="__lfsc__:",Nt=ht.length,zt="arbf",Ut="blob",Un="si08",Bn="ui08",Wn="uic8",Kn="si16",Vn="si32",Jn="ur16",Yn="ui32",Hn="fl32",Gn="fl64",Qn=Nt+zt.length,Xn=Object.prototype.toString;function Zn(a){var g=a.length*.75,l=a.length,y,w=0,v,b,_,k;a[a.length-1]==="="&&(g--,a[a.length-2]==="="&&g--);var I=new ArrayBuffer(g),E=new Uint8Array(I);for(y=0;y<l;y+=4)v=_e.indexOf(a[y]),b=_e.indexOf(a[y+1]),_=_e.indexOf(a[y+2]),k=_e.indexOf(a[y+3]),E[w++]=v<<2|b>>4,E[w++]=(b&15)<<4|_>>2,E[w++]=(_&3)<<6|k&63;return I}function Bt(a){var g=new Uint8Array(a),l="",y;for(y=0;y<g.length;y+=3)l+=_e[g[y]>>2],l+=_e[(g[y]&3)<<4|g[y+1]>>4],l+=_e[(g[y+1]&15)<<2|g[y+2]>>6],l+=_e[g[y+2]&63];return g.length%3===2?l=l.substring(0,l.length-1)+"=":g.length%3===1&&(l=l.substring(0,l.length-2)+"=="),l}function Qi(a,g){var l="";if(a&&(l=Xn.call(a)),a&&(l==="[object ArrayBuffer]"||a.buffer&&Xn.call(a.buffer)==="[object ArrayBuffer]")){var y,w=ht;a instanceof ArrayBuffer?(y=a,w+=zt):(y=a.buffer,l==="[object Int8Array]"?w+=Un:l==="[object Uint8Array]"?w+=Bn:l==="[object Uint8ClampedArray]"?w+=Wn:l==="[object Int16Array]"?w+=Kn:l==="[object Uint16Array]"?w+=Jn:l==="[object Int32Array]"?w+=Vn:l==="[object Uint32Array]"?w+=Yn:l==="[object Float32Array]"?w+=Hn:l==="[object Float64Array]"?w+=Gn:g(new Error("Failed to get type for BinaryArray"))),g(w+Bt(y))}else if(l==="[object Blob]"){var v=new FileReader;v.onload=function(){var b=Gi+a.type+"~"+Bt(this.result);g(ht+Ut+b)},v.readAsArrayBuffer(a)}else try{g(JSON.stringify(a))}catch(b){console.error("Couldn't convert value into a JSON string: ",a),g(null,b)}}function Xi(a){if(a.substring(0,Nt)!==ht)return JSON.parse(a);var g=a.substring(Qn),l=a.substring(Nt,Qn),y;if(l===Ut&&zn.test(g)){var w=g.match(zn);y=w[1],g=g.substring(w[0].length)}var v=Zn(g);switch(l){case zt:return v;case Ut:return p([v],{type:y});case Un:return new Int8Array(v);case Bn:return new Uint8Array(v);case Wn:return new Uint8ClampedArray(v);case Kn:return new Int16Array(v);case Jn:return new Uint16Array(v);case Vn:return new Int32Array(v);case Yn:return new Uint32Array(v);case Hn:return new Float32Array(v);case Gn:return new Float64Array(v);default:throw new Error("Unkown type: "+l)}}var Wt={serialize:Qi,deserialize:Xi,stringToBuffer:Zn,bufferToString:Bt};function er(a,g,l,y){a.executeSql("CREATE TABLE IF NOT EXISTS "+g.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],l,y)}function Zi(a){var g=this,l={db:null};if(a)for(var y in a)l[y]=typeof a[y]!="string"?a[y].toString():a[y];var w=new h(function(v,b){try{l.db=openDatabase(l.name,String(l.version),l.description,l.size)}catch(_){return b(_)}l.db.transaction(function(_){er(_,l,function(){g._dbInfo=l,v()},function(k,I){b(I)})},b)});return l.serializer=Wt,w}function Se(a,g,l,y,w,v){a.executeSql(l,y,w,function(b,_){_.code===_.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[g.storeName],function(k,I){I.rows.length?v(k,_):er(k,g,function(){k.executeSql(l,y,w,v)},v)},v):v(b,_)},v)}function es(a,g){var l=this;a=T(a);var y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){Se(_,b,"SELECT * FROM "+b.storeName+" WHERE key = ? LIMIT 1",[a],function(k,I){var E=I.rows.length?I.rows.item(0).value:null;E&&(E=b.serializer.deserialize(E)),w(E)},function(k,I){v(I)})})}).catch(v)});return m(y,g),y}function ts(a,g){var l=this,y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){Se(_,b,"SELECT * FROM "+b.storeName,[],function(k,I){for(var E=I.rows,A=E.length,N=0;N<A;N++){var K=E.item(N),V=K.value;if(V&&(V=b.serializer.deserialize(V)),V=a(V,K.key,N+1),V!==void 0){w(V);return}}w()},function(k,I){v(I)})})}).catch(v)});return m(y,g),y}function tr(a,g,l,y){var w=this;a=T(a);var v=new h(function(b,_){w.ready().then(function(){g===void 0&&(g=null);var k=g,I=w._dbInfo;I.serializer.serialize(g,function(E,A){A?_(A):I.db.transaction(function(N){Se(N,I,"INSERT OR REPLACE INTO "+I.storeName+" (key, value) VALUES (?, ?)",[a,E],function(){b(k)},function(K,V){_(V)})},function(N){if(N.code===N.QUOTA_ERR){if(y>0){b(tr.apply(w,[a,k,l,y-1]));return}_(N)}})})}).catch(_)});return m(v,l),v}function ns(a,g,l){return tr.apply(this,[a,g,l,1])}function rs(a,g){var l=this;a=T(a);var y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){Se(_,b,"DELETE FROM "+b.storeName+" WHERE key = ?",[a],function(){w()},function(k,I){v(I)})})}).catch(v)});return m(y,g),y}function os(a){var g=this,l=new h(function(y,w){g.ready().then(function(){var v=g._dbInfo;v.db.transaction(function(b){Se(b,v,"DELETE FROM "+v.storeName,[],function(){y()},function(_,k){w(k)})})}).catch(w)});return m(l,a),l}function is(a){var g=this,l=new h(function(y,w){g.ready().then(function(){var v=g._dbInfo;v.db.transaction(function(b){Se(b,v,"SELECT COUNT(key) as c FROM "+v.storeName,[],function(_,k){var I=k.rows.item(0).c;y(I)},function(_,k){w(k)})})}).catch(w)});return m(l,a),l}function ss(a,g){var l=this,y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){Se(_,b,"SELECT key FROM "+b.storeName+" WHERE id = ? LIMIT 1",[a+1],function(k,I){var E=I.rows.length?I.rows.item(0).key:null;w(E)},function(k,I){v(I)})})}).catch(v)});return m(y,g),y}function as(a){var g=this,l=new h(function(y,w){g.ready().then(function(){var v=g._dbInfo;v.db.transaction(function(b){Se(b,v,"SELECT key FROM "+v.storeName,[],function(_,k){for(var I=[],E=0;E<k.rows.length;E++)I.push(k.rows.item(E).key);y(I)},function(_,k){w(k)})})}).catch(w)});return m(l,a),l}function cs(a){return new h(function(g,l){a.transaction(function(y){y.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(w,v){for(var b=[],_=0;_<v.rows.length;_++)b.push(v.rows.item(_).name);g({db:a,storeNames:b})},function(w,v){l(v)})},function(y){l(y)})})}function ls(a,g){g=D.apply(this,arguments);var l=this.config();a=typeof a!="function"&&a||{},a.name||(a.name=a.name||l.name,a.storeName=a.storeName||l.storeName);var y=this,w;return a.name?w=new h(function(v){var b;a.name===l.name?b=y._dbInfo.db:b=openDatabase(a.name,"","",0),a.storeName?v({db:b,storeNames:[a.storeName]}):v(cs(b))}).then(function(v){return new h(function(b,_){v.db.transaction(function(k){function I(K){return new h(function(V,ee){k.executeSql("DROP TABLE IF EXISTS "+K,[],function(){V()},function(Z,ue){ee(ue)})})}for(var E=[],A=0,N=v.storeNames.length;A<N;A++)E.push(I(v.storeNames[A]));h.all(E).then(function(){b()}).catch(function(K){_(K)})},function(k){_(k)})})}):w=h.reject("Invalid arguments"),m(w,g),w}var us={_driver:"webSQLStorage",_initStorage:Zi,_support:Hi(),iterate:ts,getItem:es,setItem:ns,removeItem:rs,clear:os,length:is,key:ss,keys:as,dropInstance:ls};function fs(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function nr(a,g){var l=a.name+"/";return a.storeName!==g.storeName&&(l+=a.storeName+"/"),l}function ds(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch{return!0}}function hs(){return!ds()||localStorage.length>0}function gs(a){var g=this,l={};if(a)for(var y in a)l[y]=a[y];return l.keyPrefix=nr(a,g._defaultConfig),hs()?(g._dbInfo=l,l.serializer=Wt,h.resolve()):h.reject()}function ps(a){var g=this,l=g.ready().then(function(){for(var y=g._dbInfo.keyPrefix,w=localStorage.length-1;w>=0;w--){var v=localStorage.key(w);v.indexOf(y)===0&&localStorage.removeItem(v)}});return m(l,a),l}function ms(a,g){var l=this;a=T(a);var y=l.ready().then(function(){var w=l._dbInfo,v=localStorage.getItem(w.keyPrefix+a);return v&&(v=w.serializer.deserialize(v)),v});return m(y,g),y}function vs(a,g){var l=this,y=l.ready().then(function(){for(var w=l._dbInfo,v=w.keyPrefix,b=v.length,_=localStorage.length,k=1,I=0;I<_;I++){var E=localStorage.key(I);if(E.indexOf(v)===0){var A=localStorage.getItem(E);if(A&&(A=w.serializer.deserialize(A)),A=a(A,E.substring(b),k++),A!==void 0)return A}}});return m(y,g),y}function ys(a,g){var l=this,y=l.ready().then(function(){var w=l._dbInfo,v;try{v=localStorage.key(a)}catch{v=null}return v&&(v=v.substring(w.keyPrefix.length)),v});return m(y,g),y}function ws(a){var g=this,l=g.ready().then(function(){for(var y=g._dbInfo,w=localStorage.length,v=[],b=0;b<w;b++){var _=localStorage.key(b);_.indexOf(y.keyPrefix)===0&&v.push(_.substring(y.keyPrefix.length))}return v});return m(l,a),l}function bs(a){var g=this,l=g.keys().then(function(y){return y.length});return m(l,a),l}function $s(a,g){var l=this;a=T(a);var y=l.ready().then(function(){var w=l._dbInfo;localStorage.removeItem(w.keyPrefix+a)});return m(y,g),y}function xs(a,g,l){var y=this;a=T(a);var w=y.ready().then(function(){g===void 0&&(g=null);var v=g;return new h(function(b,_){var k=y._dbInfo;k.serializer.serialize(g,function(I,E){if(E)_(E);else try{localStorage.setItem(k.keyPrefix+a,I),b(v)}catch(A){(A.name==="QuotaExceededError"||A.name==="NS_ERROR_DOM_QUOTA_REACHED")&&_(A),_(A)}})})});return m(w,l),w}function _s(a,g){if(g=D.apply(this,arguments),a=typeof a!="function"&&a||{},!a.name){var l=this.config();a.name=a.name||l.name,a.storeName=a.storeName||l.storeName}var y=this,w;return a.name?w=new h(function(v){a.storeName?v(nr(a,y._defaultConfig)):v(a.name+"/")}).then(function(v){for(var b=localStorage.length-1;b>=0;b--){var _=localStorage.key(b);_.indexOf(v)===0&&localStorage.removeItem(_)}}):w=h.reject("Invalid arguments"),m(w,g),w}var Ss={_driver:"localStorageWrapper",_initStorage:gs,_support:fs(),iterate:vs,getItem:ms,setItem:xs,removeItem:$s,clear:ps,length:bs,key:ys,keys:ws,dropInstance:_s},ks=function(g,l){return g===l||typeof g=="number"&&typeof l=="number"&&isNaN(g)&&isNaN(l)},Is=function(g,l){for(var y=g.length,w=0;w<y;){if(ks(g[w],l))return!0;w++}return!1},rr=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},Qe={},or={},Ke={INDEXEDDB:Yi,WEBSQL:us,LOCALSTORAGE:Ss},Es=[Ke.INDEXEDDB._driver,Ke.WEBSQL._driver,Ke.LOCALSTORAGE._driver],gt=["dropInstance"],Kt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(gt),Ts={description:"",driver:Es.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Cs(a,g){a[g]=function(){var l=arguments;return a.ready().then(function(){return a[g].apply(a,l)})}}function Vt(){for(var a=1;a<arguments.length;a++){var g=arguments[a];if(g)for(var l in g)g.hasOwnProperty(l)&&(rr(g[l])?arguments[0][l]=g[l].slice():arguments[0][l]=g[l])}return arguments[0]}var Rs=function(){function a(g){d(this,a);for(var l in Ke)if(Ke.hasOwnProperty(l)){var y=Ke[l],w=y._driver;this[l]=w,Qe[w]||this.defineDriver(y)}this._defaultConfig=Vt({},Ts),this._config=Vt({},this._defaultConfig,g),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(l){if((typeof l>"u"?"undefined":c(l))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var y in l){if(y==="storeName"&&(l[y]=l[y].replace(/\W/g,"_")),y==="version"&&typeof l[y]!="number")return new Error("Database version must be a number.");this._config[y]=l[y]}return"driver"in l&&l.driver?this.setDriver(this._config.driver):!0}else return typeof l=="string"?this._config[l]:this._config},a.prototype.defineDriver=function(l,y,w){var v=new h(function(b,_){try{var k=l._driver,I=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!l._driver){_(I);return}for(var E=Kt.concat("_initStorage"),A=0,N=E.length;A<N;A++){var K=E[A],V=!Is(gt,K);if((V||l[K])&&typeof l[K]!="function"){_(I);return}}var ee=function(){for(var Xe=function(Ls){return function(){var Ds=new Error("Method "+Ls+" is not implemented by the current driver"),ir=h.reject(Ds);return m(ir,arguments[arguments.length-1]),ir}},Jt=0,Ps=gt.length;Jt<Ps;Jt++){var Yt=gt[Jt];l[Yt]||(l[Yt]=Xe(Yt))}};ee();var Z=function(Xe){Qe[k]&&console.info("Redefining LocalForage driver: "+k),Qe[k]=l,or[k]=Xe,b()};"_support"in l?l._support&&typeof l._support=="function"?l._support().then(Z,_):Z(!!l._support):Z(!0)}catch(ue){_(ue)}});return x(v,y,w),v},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(l,y,w){var v=Qe[l]?h.resolve(Qe[l]):h.reject(new Error("Driver not found."));return x(v,y,w),v},a.prototype.getSerializer=function(l){var y=h.resolve(Wt);return x(y,l),y},a.prototype.ready=function(l){var y=this,w=y._driverSet.then(function(){return y._ready===null&&(y._ready=y._initDriver()),y._ready});return x(w,l,l),w},a.prototype.setDriver=function(l,y,w){var v=this;rr(l)||(l=[l]);var b=this._getSupportedDrivers(l);function _(){v._config.driver=v.driver()}function k(A){return v._extend(A),_(),v._ready=v._initStorage(v._config),v._ready}function I(A){return function(){var N=0;function K(){for(;N<A.length;){var V=A[N];return N++,v._dbInfo=null,v._ready=null,v.getDriver(V).then(k).catch(K)}_();var ee=new Error("No available storage method found.");return v._driverSet=h.reject(ee),v._driverSet}return K()}}var E=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=E.then(function(){var A=b[0];return v._dbInfo=null,v._ready=null,v.getDriver(A).then(function(N){v._driver=N._driver,_(),v._wrapLibraryMethodsWithReady(),v._initDriver=I(b)})}).catch(function(){_();var A=new Error("No available storage method found.");return v._driverSet=h.reject(A),v._driverSet}),x(this._driverSet,y,w),this._driverSet},a.prototype.supports=function(l){return!!or[l]},a.prototype._extend=function(l){Vt(this,l)},a.prototype._getSupportedDrivers=function(l){for(var y=[],w=0,v=l.length;w<v;w++){var b=l[w];this.supports(b)&&y.push(b)}return y},a.prototype._wrapLibraryMethodsWithReady=function(){for(var l=0,y=Kt.length;l<y;l++)Cs(this,Kt[l])},a.prototype.createInstance=function(l){return new a(l)},a}(),As=new Rs;o.exports=As},{3:3}]},{},[4])(4)})});var Ar=F((mu,Rr)=>{var Ae,la=kr(),Tr=Er();Rr.exports=Ae={};var z={},we={},fe={},ua=3e3,fa=8;console.log("siteAdapter: loading data");var nt=Tr.createInstance({name:"routes"});nt.iterate(function(t,e){z[e]=t}).then(()=>console.log("siteAdapter: data loaded")).catch(t=>console.log("siteAdapter: error loading data ",t));var en=Tr.createInstance({name:"withCredentials"});en.iterate(function(t,e){we[e]=t}).then(()=>console.log("siteAdapter: withCredentials data loaded")).catch(t=>console.log("siteAdapter: error loading withCredentials data ",t));var Zt=function(t,e,n){let r=new Promise(function(s,c){let d=setTimeout(function(){clearTimeout(d),c()},ua)}),o=new Promise((s,c)=>$.ajax({type:"GET",url:t,success(){s()},error(){c()}}));Promise.race([r,o]).then(()=>e()).catch(()=>n())},Cr=la(function(t,e){let n,{site:r}=t;return z[r]&&e(z[r]),r.split(".").at(-1).split(":")[0]==="localhost"?n=`http://${r}/favicon.png`:n=`//${r}/favicon.png`,Zt(n,function(){z[r]=n.slice(0,-12),e(n.slice(0,-12))},function(){switch(location.protocol){case"http:":n=`https://${r}/favicon.png`,Zt(n,()=>{z[r]=`https://${r}`,e(`https://${r}`)},()=>{z[r]="",e("")});break;case"https:":n=`/proxy/${r}/favicon.png`,Zt(n,()=>{z[r]=`/proxy/${r}`,e(`/proxy/${r}`)},()=>{z[r]="",e("")});break;default:z[r]="",e("")}})},fa),tt=(t,e)=>nt.getItem(t).then(function(n){n?(z[t]=n,e(n)):Cr.push({site:t},function(r){z[t]=r,nt.setItem(t,r).then(()=>e(r)).catch(function(o){console.log("findAdapter setItem error: ",t,o),e(r)})})}).catch(function(n){console.log("findAdapter error: ",t,n),z[t]="",e("")});Ae.local={flag(){return"/favicon.png"},getURL(t){return`/${t}`},getDirectURL(t){return`/${t}`},get(t,e){let n,r=function(o,s){e&&e(o,s)};if(n=localStorage.getItem(t.replace(/\.json$/,""))){let o=JSON.parse(n);r(null,o),e||Promise.resolve(o)}else{let o={msg:`no page named '${t}' in browser local storage`};r(o,null),e||Promise.reject(o)}},put(t,e,n){localStorage.setItem(t,JSON.stringify(e)),n()},delete(t){localStorage.removeItem(t)}};Ae.origin={flag(){return"/favicon.png"},getURL(t){return`/${t}`},getDirectURL(t){return`/${t}`},get(t,e){let n=function(r,o){e&&e(r,o)};$.ajax({type:"GET",dataType:"json",url:`/${t}`,success(r,o,s){t==="system/sitemap.json"?n(null,{data:r,lastModified:Date.parse(s.getResponseHeader("Last-Modified"))}):n(null,r)},error(r,o,s){n({msg:s,xhr:r},null)}})},getIndex(t,e){let n=function(r,o){e&&e(r,o)};$.ajax({type:"GET",dataType:"text",url:`/${t}`,success(r){n(null,r)},error(r,o,s){n({msg:s,xhr:r},null)}})},put(t,e,n){$.ajax({type:"PUT",url:`/page/${t}/action`,data:{action:JSON.stringify(e)},success(){n(null)},error(r,o,s){n({xhr:r,type:o,msg:s})}})},delete(t,e){$.ajax({type:"DELETE",url:`/${t}`,success(){e(null)},error(n,r,o){e({xhr:n,type:r,msg:o})}})}};Ae.recycler={flag(){return"/recycler/favicon.png"},getURL(t){return`/recycler/${t}`},getDirectURL(t){return`/recycler/${t}`},get(t,e){let n=function(r,o){e&&e(r,o)};$.ajax({type:"GET",dataType:"json",url:`/recycler/${t}`,success(r){n(null,r)},error(r,o,s){n({msg:s,xhr:r},null)}})},delete(t,e){$.ajax({type:"DELETE",url:`/recycler/${t}`,success(){e(null)},error(n,r,o){e({xhr:n,type:r,msg:o})}})}};Ae.site=function(t){if(!t||t===window.location.host)return Ae.origin;if(t==="recycler")return Ae.recycler;let e=()=>{let n=document.createElement("canvas");n.width=32,n.height=32;let r=n.getContext("2d"),o=Math.random()*32,s=o,c=Math.random()*32,d=32-c,f=(Math.random()*255<<0).toString(16),i=(Math.random()*255<<0).toString(16),u="#"+f+f+f,p="#"+i+i+i,h=r.createRadialGradient(o,s,32,d,c,0);return h.addColorStop(0,u),h.addColorStop(1,p),r.fillStyle=h,r.fillRect(0,0,32,32),n.toDataURL()};return{flag(){if(z[t]!=null)return z[t]===""?fe[t]?fe[t]:fe[t]=e(t):z[t]+"/favicon.png";if(fe[t])return fe[t];{tt(t,function(r){if(r==="")console.log(`Prefix for ${t} is undetermined...`);else{console.log(`Prefix for ${t} is ${r}`);let o=fe[t],s=z[t]+"/favicon.png";$('img[src="'+o+'"]').attr("src",s),$('a[target="'+t+'"]').attr("style","background-image: url("+s+")"),fe[t]=null}});let n=e(t);return fe[t]=n,n}},getURL(n){return z[t]!=null?z[t]===""?(console.log(`${t} is unreachable, can't link to ${n}`),""):`${z[t]}/${n}`:(tt(t,function(r){r===""?console.log(`${t} is unreachable`):(console.log(`Prefix for ${t} is ${r}, about to fixup links`),$('a[target="'+t+'"]').each(function(){let o;/proxy/.test(r)?o=`http://${r.substring(7)}`:o=r,$(this).attr("href",`${o}/${$(this).data("slug")}.html`)}))}),"")},getDirectURL(n){let r,o;return z[t]!=null?z[t]===""?(console.log(`${t} is unreachable, can't link to ${n}`),""):(/proxy/.test(z[t])?(o=z[t].substring(7),r=`http://${o}`):r=z[t],`${r}/${n}`):(tt(t,function(s){s===""?console.log(`${t} is unreachable`):(console.log(`Prefix for ${t} is ${s}, about to fixup links`),$('a[target="'+t+'"]').each(function(){/proxy/.test(s)?(o=s.substring(7),r=`http://${o}`):r=s,$(this).attr("href",`${r}/${$(this).data("slug")}.html`)}))}),"")},get(n,r){let o,s=function(d,f){r&&r(d,f)};var c=function(d,f){let i=`${z[t]}/${d}`,u=we[t]||!1;$.ajax({type:"GET",dataType:"json",url:i,xhrFields:{withCredentials:u},success(p,h,m){if((d==="system/sitemap.json"&&Array.isArray(p)&&p[0]==="Login Required"||p.title==="Login Required")&&!i.includes("login-required")&&we[t]!==!0)we[t]=!0,c(d,function(x,T){x?(we[t]=!1,f(x,T)):(en.setItem(t,!0),f(x,T))});else if(d==="system/sitemap.json"?f(null,{data:p,lastModified:Date.parse(m.getResponseHeader("Last-Modified"))}):f(null,p),!r)return Promise.resolve(p)},error(p,h,m){if(f({msg:m,xhr:p},null),!r)return Promise.reject(m)}})};if(z[t]!=null)if(z[t]===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},s(o,null),!r)return Promise.reject(o)}else return c(n,s);else tt(t,function(d){if(d===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},s(o,null),!r)return Promise.reject(o)}else return c(n,s)})},getIndex(n,r){let o,s=function(d,f){r&&r(d,f)};var c=function(d,f){let i=`${z[t]}/${d}`,u=we[t]||!1;$.ajax({type:"GET",dataType:"text",url:i,xhrFields:{withCredentials:u},success(p){if(p.title==="Login Required"&&!i.includes("login-required")&&we[t]!==!0)return we[t]=!0,c(d,function(h,m){h?(we[t]=!1,f(h,m)):(en.setItem(t,!0),f(h,m))});if(f(null,p),!r)return Promise.resolve(p)},error(p,h,m){if(f({msg:m,xhr:p},null),!r)return Promise.reject(m)}})};if(z[t]!=null)if(z[t]===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},s(o,null),!r)return Promise.reject(o)}else return c(n,s);else tt(t,function(d){if(d===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},s(o,null),!r)return Promise.reject(o)}else return c(n,s)})},refresh(n){if(console.log(`Refreshing ${t}`),fe[t]==null){let r=e(t);fe[t]=r;let o=z[t]+"/favicon.png";$('img[src="'+o+'"]').attr("src",r),$('a[target="'+t+'"]').attr("style","background-image: url("+r+")")}z[t]=null,nt.removeItem(t).then(()=>{Cr.push({site:t},r=>{nt.setItem(t,r).then(()=>{if(r==="")console.log(`Refreshed prefix for ${t} is undetermined...`);else{console.log(`Refreshed prefix for ${t} is ${r}`);let o=fe[t],s=z[t]+"/favicon.png";$('img[src="'+o+'"]').attr("src",s),$('a[target="'+t+'"]').attr("style","background-image: url("+s+")")}n()}).catch(o=>{console.log("findAdapter setItem error: ",t,o),z[t]="",n()})})}).catch(r=>{console.log("refresh error ",t,r),n()})}}}});var Le=F((vu,Pr)=>{var Pe;Pr.exports=Pe={};Pe.formatTime=function(t){let e=new Date(t>1e10?t:t*1e3),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],r=e.getHours(),o=r<12?"AM":"PM";r=r===0?12:r>12?r-12:r;let s=(e.getMinutes()<10?"0":"")+e.getMinutes();return`${r}:${s} ${o}<br>${e.getDate()} ${n} ${e.getFullYear()}`};Pe.formatDate=function(t){let e=new Date(t),n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()],r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate(),s=e.getFullYear(),c=e.getHours(),d=c<12?"AM":"PM";c=c===0?12:c>12?c-12:c;let f=(e.getMinutes()<10?"0":"")+e.getMinutes(),i=(e.getSeconds()<10?"0":"")+e.getSeconds();return`${n} ${r} ${o}, ${s}<br>${c}:${f}:${i} ${d}`};Pe.formatActionTitle=function(t){let e="";return t.site&&(e+=`${t.site}
`),e+=t.type||"separator",t.date&&(e+=` ${Pe.formatElapsedTime(t.date)}`),t.attribution?.page&&(e+=`
from ${t.attribution.page}`),t.removedTo?.page&&(e+=`
to ${t.removedTo.page}`),e};Pe.formatElapsedTime=function(t){let e,n,r,o,s,c,d,f=new Date().getTime()-t;return(s=f/1e3)<2?`${Math.floor(f)} milliseconds ago`:(r=s/60)<2?`${Math.floor(s)} seconds ago`:(n=r/60)<2?`${Math.floor(r)} minutes ago`:(e=n/24)<2?`${Math.floor(n)} hours ago`:(c=e/7)<2?`${Math.floor(e)} days ago`:(o=e/31)<2?`${Math.floor(c)} weeks ago`:(d=e/365)<2?`${Math.floor(o)} months ago`:`${Math.floor(d)} years ago`};Pe.formatDelay=function(t){let e,n,r,o=t-Date.now();return(r=o/1e3)<2?`in ${Math.floor(o)} milliseconds`:(n=r/60)<2?`in ${Math.floor(r)} seconds`:(e=n/60)<2?`in ${Math.floor(n)} minutes`:`in ${Math.floor(e)} hours`}});var De=F((yu,Or)=>{var Lr=()=>((1+Math.random())*256|0).toString(16).substring(1),Dr=t=>[...Array(t)].map(()=>Lr()).join(""),da=()=>Dr(8);Or.exports={randomByte:Lr,randomBytes:Dr,itemId:da}});var tn=F((wu,Fr)=>{var Mr=function(t,e){let n,r=()=>(t.story||[]).map(f=>f?.id),o=function(f,i){let u=r().indexOf(f)+1;t.story.splice(u,0,i)},s=function(){let f;(f=r().indexOf(e.id))!==-1&&t.story.splice(f,1)};switch(t.story||(t.story=[]),e.type){case"create":e.item&&(e.item.title&&(t.title=e.item.title),e.item.story&&(t.story=e.item.story.slice()));break;case"add":o(e.after,e.item);break;case"edit":(n=r().indexOf(e.id))!==-1?t.story.splice(n,1,e.item):t.story.push(e.item);break;case"move":n=e.order.indexOf(e.id);var c=e.order[n-1],d=t.story[r().indexOf(e.id)];s(),o(c,d);break;case"remove":s();break}t.journal||(t.journal=[]),e.fork&&t.journal.push({type:"fork",site:e.fork,date:e.date-1}),t.journal.push(e)},ha=function(t,e){t=+t;let n=e.journal.slice(0,+t+1||void 0),r={title:e.title,story:[]};for(var o of n)Mr(r,o||{});return r};Fr.exports={create:ha,apply:Mr}});var _t=F((bu,qr)=>{qr.exports=function(t){let{synopsis:e}=t;if(t?.story){let n=t.story[0],r=t.story[1];n&&n.type==="paragraph"&&(e||=n.text),r&&r.type==="paragraph"&&(e||=r.text),n&&n.text&&(e||=n.text),r&&r.text&&(e||=r.text),e||=t.story&&`A page with ${t.story.length} items.`}else e="A page with no story.";return e=e.trim().split(/\r|\n/,1)[0],e.substring(0,560)}});var le=F(($u,zr)=>{var{formatDate:ga}=Le(),pa=De(),jr=tn(),ma=_t(),va=new EventTarget,St=t=>t.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase(),ya=t=>t.replace(/-/g," "),wa=t=>[{symbol:"\u2744",date:t-1e3*60*60*24*366,period:"a Year"},{symbol:"\u2698",date:t-1e3*60*60*24*31*3,period:"a Season"},{symbol:"\u26AA",date:t-1e3*60*60*24*31,period:"a Month"},{symbol:"\u263D",date:t-1e3*60*60*24*7,period:"a Week"},{symbol:"\u2600",date:t-1e3*60*60*24,period:"a Day"},{symbol:"\u231A",date:t-1e3*60*60,period:"an Hour"}],Nr=function(t,e){let n=t||{};n.title||(n.title="empty"),n.story||(n.story=[]),n.journal||(n.journal=[]);let r=()=>n,o=function(){let L=["view"];c()&&L.push(e);let q=function(J){J&&!L.includes(J)&&L.push(J)};for(var X of n.journal.slice(0).reverse())q(X?.site);return L},s=()=>n.plugin!=null;var c=()=>![void 0,null,"view","origin","local","recycler"].includes(e);let d=()=>e==="local",f=()=>e==="recycler",i=function(L=null){return c()?e:L},u=function(L=null){let q=[];return(L||c())&&q.push(i(L)),s()&&q.push(`${n.plugin} plugin`),q.join(`
`)},p=()=>St(n.title),h=function(L){let q=[];c()?q.push(e):L&&q.push(L);for(var X of n.story)X?.site&&q.push(X.site);for(var J of n.journal)J?.site&&q.push(J.site);return Array.from(new Set(q))},m=()=>n.title,x=L=>n.title=L,T=()=>n.journal.length-1,D=function(){let L=n.journal[T()];if(L&&L.date)return L.date},R=function(){let L=n.journal[T()];return L?L.date?ga(L.date):`Revision ${T()}`:"Unrecorded Date"},C=()=>ma(n),P=function(){let L,q,X=function(J,ne,Be,We){try{let ie=/\[\[([^\]]+)\]\]/g,pe;for(;(pe=ie.exec(ne.text))!==null;)J.has(St(pe[1]))||J.set(St(pe[1]),ne.id);ne.type==="reference"&&(J.has(ne.slug)||J.set(ne.slug,ne.id))}catch(ie){console.log(`*** Error extracting links from ${Be} of ${JSON.stringify(We)}`,ie.message)}return J};try{q=n.story.reduce(X,new Map)}catch(J){let ne=J;console.log(`+++ Extract links on ${n.slug} fails`,ne)}return q.size>0?L=Object.fromEntries(q):L={},L},j=function(L){L=Object.assign({},{id:pa.itemId()},L),n.story.push(L)},W=function(L){for(var q of n.story)if(q.id===L)return q;return null},S=function(L){return new Promise(X=>{var J=function(ne){return ne>=n.story.length?X():L(n.story[ne]||{text:"null"},()=>J(ne+1))};return J(0)})},O=function(L){j({type:"paragraph",text:L})},M=function(L){let q=0,X=wa(new Date().getTime());var J=function(ne){if(ne>=n.journal.length)return;let Be=n.journal[ne]||{},We=Be.date||0,ie=null;for(var pe of X)pe.date>q&&pe.date<We&&(ie=pe);q=We,L({action:Be,separator:ie},()=>J(ne+1))};J(0)},B=function(L,q){n.story=L?.getRawPage().story||[],q&&(n.journal=q?.getRawPage().journal)},H=function(){let L=p(),q=L==="welcome-visitors"?"view/welcome-visitors":`view/welcome-visitors/view/${L}`;return c()?wiki.site(e).getDirectURL(q):`/${q}`},Q=function(L,q){for(var X of L)if(X.id===q.id&&X.date===q.date)return!1;return!0};return{getRawPage:r,getContext:o,isPlugin:s,isRemote:c,isLocal:d,isRecycler:f,getRemoteSite:i,getRemoteSiteDetails:u,getSlug:p,getNeighbors:h,getTitle:m,getLinks:P,setTitle:x,getRevision:T,getDate:D,getTimestamp:R,getSynopsis:C,addItem:j,getItem:W,addParagraph:O,seqItems:S,seqActions:M,become:B,siteLineup:H,merge:function(L){let q,X=n.journal.slice();for(q of L.getRawPage().journal)Q(n.journal,q)&&X.push(q);X.push({type:"fork",site:L.getRemoteSite(),date:new Date().getTime()}),Nr(jr.create(999,{title:n.title,journal:X}),e)},apply:function(L){jr.apply(n,L),L.site&&(e=null)},getCreate:function(){let L=q=>q.type==="create";n.journal.reverse().find(L)}}};zr.exports={newPage:Nr,asSlug:St,asTitle:ya,pageEmitter:va}});var rt=F((xu,Ur)=>{var Oe;Ur.exports=Oe={};Oe.scrollContainer=void 0;var ba=()=>{let t=$("body, html").filter(function(){return $(this).scrollLeft()>0});return t.length>0?t:$("body, html").scrollLeft(12).filter(function(){return $(this).scrollLeft()>0}).scrollTop(0)},$a=t=>{let e;if(t.position()==null)return;Oe.scrollContainer==null&&(Oe.scrollContainer=ba());let n=$("body").width(),r=Oe.scrollContainer.scrollLeft(),o=r+n,s=t.position().left,c=t.outerWidth(!0),d=$(".page").outerWidth(!0)*$(".page").length;s<r?e=s:s+c>o?e=s-(n-c):o>$(".pages").outerWidth()&&(e=Math.min(s,d-n)),Oe.scrollContainer.animate({scrollLeft:e},function(){$.contains(t[0],document.activeElement)||t.trigger("focus")})};Oe.set=(t,e)=>{$(".incremental-search").remove(),t=$(t),$(".active").removeClass("active"),t.addClass("active"),e||$a(t)}});var be=F((_u,Kr)=>{var xa=De(),Me={},G=[],_a=function(t){let e=xa.randomBytes(4);return Me[e]=t,G.push(e),e},Sa=function(t,e){let n=G.indexOf(t);G.splice(n,1),G.splice(e,0,t)},ka=function(t){return G.includes(t)?(G=G.filter(e=>t!==e),delete Me[t],t):null},Ia=function(t){let e=[];if(!G.includes(t))return e;for(;G[G.length-1]!==t;){var n=G.pop();e.unshift(n),delete Me[n]}return e},Br=t=>Me[t],Wr=t=>Br(t).getTitle(),Ea=function(){return G.length?Wr(G[G.length-1]):"Wiki"},Ta=()=>G,Ca=function(){Me={},G=[]},Ra=function(t){`${G}`!=`${t}`&&(console.log("The lineup is out of sync with the dom."),console.log(".pages:",t),console.log("lineup:",G),`${Object.keys(G).sort()}`==`${Object.keys(t).sort()}`&&(console.log("It looks like an ordering problem we can fix."),G=t))},Aa=function(t){let e=G.indexOf(t);return e<1?null:G[e-1]},Pa=function(t,e){let n,r,o=Me[t],s=o.getRemoteSite(e),c=["view",r=o.getSlug()];if(r!=="welcome-visitors"&&c.unshift("view","welcome-visitors"),s!==e&&(n=Aa(t))){let d;(d=Me[n]).isRemote()||c.push(e,d.getSlug())}return c.unshift(s),c};Kr.exports={addPage:_a,changePageIndex:Sa,removeKey:ka,removeAllAfterKey:Ia,atKey:Br,titleAtKey:Wr,bestTitle:Ea,debugKeys:Ta,debugReset:Ca,crumbs:Pa,debugSelfCheck:Ra}});var ot=F((Su,Vr)=>{var te,La=rt(),kt=be(),nn=null;Vr.exports=te={};te.inject=t=>nn=t;te.pagesInDom=()=>Array.from(document.querySelectorAll(".page")).map(t=>t.id);te.urlPages=()=>new URL(window.location.href).pathname.split("/").slice(1).filter((...[,e])=>e%2===1);te.locsInDom=()=>$.makeArray($(".page").map((t,e)=>$(e).data("site")||"view"));te.urlLocs=()=>new URL(window.location.href).pathname.split("/").slice(1).filter((...[,e])=>e%2===0);te.setUrl=()=>{if(document.title=kt.bestTitle(),history&&history.pushState){let t=te.locsInDom(),n=te.pagesInDom().map((r,o)=>`/${t[o]||"view"}/${r}`).join("");n!==new URL(window.location.href).pathname&&history.pushState(null,null,n)}};te.debugStates=()=>{console.log("a .page keys ",Array.from($(".page")).map(t=>$(t).data("key"))),console.log("a lineup keys",kt.debugKeys())};te.show=()=>{let t=te.pagesInDom(),e=te.urlPages(),n=te.urlLocs();if(!location.pathname||location.pathname==="/")return;let r=!0;for(let[o,s]of t.entries()){if(r&&(r=s===e[o]))continue;let c=$(".page:last");kt.removeKey(c.data("key")),c.remove()}r=!0;for(let[o,s]of e.entries())r&&(r=s===t[o])||nn.showPage(s,n[o]);window.debug&&te.debugStates(),La.set($(".page").last()),document.title=kt.bestTitle()};te.first=()=>{te.setUrl();let t=te.urlPages(),e=te.urlLocs(),n=te.pagesInDom();for(let r=0;r<t.length;r++){let o=t[r];!n.includes(o)&&o!==""&&nn.createPage(o,e[r])}}});var on=F((ku,Jr)=>{var rn={create:"\u263C",add:"+",edit:"\u270E",fork:"\u2691",move:"\u2195",remove:"\u2715",copyIn:"\u2A2D",copyOut:"\u2A35"},Da=rn.fork,Oa=rn.add;Jr.exports={symbols:rn,fork:Da,add:Oa}});var an=F((Iu,Yr)=>{var Ma=Le(),sn=on();Yr.exports=(t,e)=>{let n=t.parents(".page:first"),r=$('<a href="#" /> ').addClass("action").addClass(e.type||"separator").text(e.symbol||sn.symbols[e.type]).attr("title",Ma.formatActionTitle(e)).attr("data-id",e.id||"0").attr("data-date",e.date||"0").data("action",e);e.type==="add"&&e.attribution&&(r.text(sn.symbols.copyIn),e.attribution.site&&r.css("background-image",`url(${wiki.site(e.attribution.site).flag()})`)),e.type==="remove"&&e.removedTo&&r.text(sn.symbols.copyOut);let o=t.children(".control-buttons");o.length>0?r.insertBefore(o):r.appendTo(t),e.type==="fork"&&e.site&&r.css("background-image",`url(${wiki.site(e.site).flag()}`).attr("href",`${wiki.site(e.site).getDirectURL(n.attr("id"))}.html`).attr("target",`${e.site}`).data("site",e.site).data("slug",n.attr("id"))}});var ao=F((Eu,so)=>{"use strict";function Tt(t,e,n,r){function o(s){return s instanceof n?s:new n(function(c){c(s)})}return new(n||(n=Promise))(function(s,c){function d(u){try{i(r.next(u))}catch(p){c(p)}}function f(u){try{i(r.throw(u))}catch(p){c(p)}}function i(u){u.done?s(u.value):o(u.value).then(d,f)}i((r=r.apply(t,e||[])).next())})}var Fa="ENTRIES",Zr="KEYS",eo="VALUES",re="",it=class{constructor(e,n){let r=e._tree,o=Array.from(r.keys());this.set=e,this._type=n,this._path=o.length>0?[{node:r,keys:o}]:[]}next(){let e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};let{node:e,keys:n}=Ve(this._path);if(Ve(n)===re)return{done:!1,value:this.result()};let r=e.get(Ve(n));return this._path.push({node:r,keys:Array.from(r.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;let e=Ve(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>Ve(e)).filter(e=>e!==re).join("")}value(){return Ve(this._path).node.get(re)}result(){switch(this._type){case eo:return this.value();case Zr:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}},Ve=t=>t[t.length-1],qa=(t,e,n)=>{let r=new Map;if(e===void 0)return r;let o=e.length+1,s=o+n,c=new Uint8Array(s*o).fill(n+1);for(let d=0;d<o;++d)c[d]=d;for(let d=1;d<s;++d)c[d*o]=d;return to(t,e,n,r,c,1,o,""),r},to=(t,e,n,r,o,s,c,d)=>{let f=s*c;e:for(let i of t.keys())if(i===re){let u=o[f-1];u<=n&&r.set(d,[t.get(i),u])}else{let u=s;for(let p=0;p<i.length;++p,++u){let h=i[p],m=c*u,x=m-c,T=o[m],D=Math.max(0,u-n-1),R=Math.min(c-1,u+n);for(let C=D;C<R;++C){let P=h!==e[C],j=o[x+C]+ +P,W=o[x+C+1]+1,S=o[m+C]+1,O=o[m+C+1]=Math.min(j,W,S);O<T&&(T=O)}if(T>n)continue e}to(t.get(i),e,n,r,o,u,c,d+i)}},st=class t{constructor(e=new Map,n=""){this._size=void 0,this._tree=e,this._prefix=n}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");let[n,r]=Ct(this._tree,e.slice(this._prefix.length));if(n===void 0){let[o,s]=pn(r);for(let c of o.keys())if(c!==re&&c.startsWith(s)){let d=new Map;return d.set(c.slice(s.length),o.get(c)),new t(d,e)}}return new t(n,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,ja(this._tree,e)}entries(){return new it(this,Fa)}forEach(e){for(let[n,r]of this)e(n,r,this)}fuzzyGet(e,n){return qa(this._tree,e,n)}get(e){let n=dn(this._tree,e);return n!==void 0?n.get(re):void 0}has(e){let n=dn(this._tree,e);return n!==void 0&&n.has(re)}keys(){return new it(this,Zr)}set(e,n){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,cn(this._tree,e).set(re,n),this}get size(){if(this._size)return this._size;this._size=0;let e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let r=cn(this._tree,e);return r.set(re,n(r.get(re))),this}fetch(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let r=cn(this._tree,e),o=r.get(re);return o===void 0&&r.set(re,o=n()),o}values(){return new it(this,eo)}[Symbol.iterator](){return this.entries()}static from(e){let n=new t;for(let[r,o]of e)n.set(r,o);return n}static fromObject(e){return t.from(Object.entries(e))}},Ct=(t,e,n=[])=>{if(e.length===0||t==null)return[t,n];for(let r of t.keys())if(r!==re&&e.startsWith(r))return n.push([t,r]),Ct(t.get(r),e.slice(r.length),n);return n.push([t,e]),Ct(void 0,"",n)},dn=(t,e)=>{if(e.length===0||t==null)return t;for(let n of t.keys())if(n!==re&&e.startsWith(n))return dn(t.get(n),e.slice(n.length))},cn=(t,e)=>{let n=e.length;e:for(let r=0;t&&r<n;){for(let s of t.keys())if(s!==re&&e[r]===s[0]){let c=Math.min(n-r,s.length),d=1;for(;d<c&&e[r+d]===s[d];)++d;let f=t.get(s);if(d===s.length)t=f;else{let i=new Map;i.set(s.slice(d),f),t.set(e.slice(r,r+d),i),t.delete(s),t=i}r+=d;continue e}let o=new Map;return t.set(e.slice(r),o),o}return t},ja=(t,e)=>{let[n,r]=Ct(t,e);if(n!==void 0){if(n.delete(re),n.size===0)no(r);else if(n.size===1){let[o,s]=n.entries().next().value;ro(r,o,s)}}},no=t=>{if(t.length===0)return;let[e,n]=pn(t);if(e.delete(n),e.size===0)no(t.slice(0,-1));else if(e.size===1){let[r,o]=e.entries().next().value;r!==re&&ro(t.slice(0,-1),r,o)}},ro=(t,e,n)=>{if(t.length===0)return;let[r,o]=pn(t);r.set(o+e,n),r.delete(o)},pn=t=>t[t.length-1],mn="or",oo="and",Na="and_not",Rt=class t{constructor(e){if(e?.fields==null)throw new Error('MiniSearch: option "fields" must be provided');let n=e.autoVacuum==null||e.autoVacuum===!0?fn:e.autoVacuum;this._options=Object.assign(Object.assign(Object.assign({},un),e),{autoVacuum:n,searchOptions:Object.assign(Object.assign({},Hr),e.searchOptions||{}),autoSuggestOptions:Object.assign(Object.assign({},Ka),e.autoSuggestOptions||{})}),this._index=new st,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=gn,this.addFields(this._options.fields)}add(e){let{extractField:n,tokenize:r,processTerm:o,fields:s,idField:c}=this._options,d=n(e,c);if(d==null)throw new Error(`MiniSearch: document does not have ID field "${c}"`);if(this._idToShortId.has(d))throw new Error(`MiniSearch: duplicate ID ${d}`);let f=this.addDocumentId(d);this.saveStoredFields(f,e);for(let i of s){let u=n(e,i);if(u==null)continue;let p=r(u.toString(),i),h=this._fieldIds[i],m=new Set(p).size;this.addFieldLength(f,h,this._documentCount-1,m);for(let x of p){let T=o(x,i);if(Array.isArray(T))for(let D of T)this.addTerm(h,f,D);else T&&this.addTerm(h,f,T)}}}addAll(e){for(let n of e)this.add(n)}addAllAsync(e,n={}){let{chunkSize:r=10}=n,o={chunk:[],promise:Promise.resolve()},{chunk:s,promise:c}=e.reduce(({chunk:d,promise:f},i,u)=>(d.push(i),(u+1)%r===0?{chunk:[],promise:f.then(()=>new Promise(p=>setTimeout(p,0))).then(()=>this.addAll(d))}:{chunk:d,promise:f}),o);return c.then(()=>this.addAll(s))}remove(e){let{tokenize:n,processTerm:r,extractField:o,fields:s,idField:c}=this._options,d=o(e,c);if(d==null)throw new Error(`MiniSearch: document does not have ID field "${c}"`);let f=this._idToShortId.get(d);if(f==null)throw new Error(`MiniSearch: cannot remove document with ID ${d}: it is not in the index`);for(let i of s){let u=o(e,i);if(u==null)continue;let p=n(u.toString(),i),h=this._fieldIds[i],m=new Set(p).size;this.removeFieldLength(f,h,this._documentCount,m);for(let x of p){let T=r(x,i);if(Array.isArray(T))for(let D of T)this.removeTerm(h,f,D);else T&&this.removeTerm(h,f,T)}}this._storedFields.delete(f),this._documentIds.delete(f),this._idToShortId.delete(d),this._fieldLength.delete(f),this._documentCount-=1}removeAll(e){if(e)for(let n of e)this.remove(n);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new st,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){let n=this._idToShortId.get(e);if(n==null)throw new Error(`MiniSearch: cannot discard document with ID ${e}: it is not in the index`);this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach((r,o)=>{this.removeFieldLength(n,o,this._documentCount,r)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;let{minDirtFactor:e,minDirtCount:n,batchSize:r,batchWait:o}=this._options.autoVacuum;this.conditionalVacuum({batchSize:r,batchWait:o},{minDirtCount:n,minDirtFactor:e})}discardAll(e){let n=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(let r of e)this.discard(r)}finally{this._options.autoVacuum=n}this.maybeAutoVacuum()}replace(e){let{idField:n,extractField:r}=this._options,o=r(e,n);this.discard(o),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,n){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&n,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{let r=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=gn,this.performVacuuming(e,r)}),this._enqueuedVacuum)):this.vacuumConditionsMet(n)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}performVacuuming(e,n){return Tt(this,void 0,void 0,function*(){let r=this._dirtCount;if(this.vacuumConditionsMet(n)){let o=e.batchSize||hn.batchSize,s=e.batchWait||hn.batchWait,c=1;for(let[d,f]of this._index){for(let[i,u]of f)for(let[p]of u)this._documentIds.has(p)||(u.size<=1?f.delete(i):u.delete(p));this._index.get(d).size===0&&this._index.delete(d),c%o===0&&(yield new Promise(i=>setTimeout(i,s))),c+=1}this._dirtCount-=r}yield null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null})}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:n,minDirtFactor:r}=e;return n=n||fn.minDirtCount,r=r||fn.minDirtFactor,this.dirtCount>=n&&this.dirtFactor>=r}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){let n=this._idToShortId.get(e);if(n!=null)return this._storedFields.get(n)}search(e,n={}){let r=this.executeQuery(e,n),o=[];for(let[s,{score:c,terms:d,match:f}]of r){let i=d.length||1,u={id:this._documentIds.get(s),score:c*i,terms:Object.keys(f),queryTerms:d,match:f};Object.assign(u,this._storedFields.get(s)),(n.filter==null||n.filter(u))&&o.push(u)}return e===t.wildcard&&n.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(Qr),o}autoSuggest(e,n={}){n=Object.assign(Object.assign({},this._options.autoSuggestOptions),n);let r=new Map;for(let{score:s,terms:c}of this.search(e,n)){let d=c.join(" "),f=r.get(d);f!=null?(f.score+=s,f.count+=1):r.set(d,{score:s,terms:c,count:1})}let o=[];for(let[s,{score:c,terms:d,count:f}]of r)o.push({suggestion:s,terms:d,score:c/f});return o.sort(Qr),o}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),n)}static loadJSONAsync(e,n){return Tt(this,void 0,void 0,function*(){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),n)})}static getDefault(e){if(un.hasOwnProperty(e))return ln(un,e);throw new Error(`MiniSearch: unknown option "${e}"`)}static loadJS(e,n){let{index:r,documentIds:o,fieldLength:s,storedFields:c,serializationVersion:d}=e,f=this.instantiateMiniSearch(e,n);f._documentIds=It(o),f._fieldLength=It(s),f._storedFields=It(c);for(let[i,u]of f._documentIds)f._idToShortId.set(u,i);for(let[i,u]of r){let p=new Map;for(let h of Object.keys(u)){let m=u[h];d===1&&(m=m.ds),p.set(parseInt(h,10),It(m))}f._index.set(i,p)}return f}static loadJSAsync(e,n){return Tt(this,void 0,void 0,function*(){let{index:r,documentIds:o,fieldLength:s,storedFields:c,serializationVersion:d}=e,f=this.instantiateMiniSearch(e,n);f._documentIds=yield Et(o),f._fieldLength=yield Et(s),f._storedFields=yield Et(c);for(let[u,p]of f._documentIds)f._idToShortId.set(p,u);let i=0;for(let[u,p]of r){let h=new Map;for(let m of Object.keys(p)){let x=p[m];d===1&&(x=x.ds),h.set(parseInt(m,10),yield Et(x))}++i%1e3===0&&(yield io(0)),f._index.set(u,h)}return f})}static instantiateMiniSearch(e,n){let{documentCount:r,nextId:o,fieldIds:s,averageFieldLength:c,dirtCount:d,serializationVersion:f}=e;if(f!==1&&f!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");let i=new t(n);return i._documentCount=r,i._nextId=o,i._idToShortId=new Map,i._fieldIds=s,i._avgFieldLength=c,i._dirtCount=d||0,i._index=new st,i}executeQuery(e,n={}){if(e===t.wildcard)return this.executeWildcardQuery(n);if(typeof e!="string"){let h=Object.assign(Object.assign(Object.assign({},n),e),{queries:void 0}),m=e.queries.map(x=>this.executeQuery(x,h));return this.combineResults(m,h.combineWith)}let{tokenize:r,processTerm:o,searchOptions:s}=this._options,c=Object.assign(Object.assign({tokenize:r,processTerm:o},s),n),{tokenize:d,processTerm:f}=c,p=d(e).flatMap(h=>f(h)).filter(h=>!!h).map(Wa(c)).map(h=>this.executeQuerySpec(h,c));return this.combineResults(p,c.combineWith)}executeQuerySpec(e,n){let r=Object.assign(Object.assign({},this._options.searchOptions),n),o=(r.fields||this._options.fields).reduce((T,D)=>Object.assign(Object.assign({},T),{[D]:ln(r.boost,D)||1}),{}),{boostDocument:s,weights:c,maxFuzzy:d,bm25:f}=r,{fuzzy:i,prefix:u}=Object.assign(Object.assign({},Hr.weights),c),p=this._index.get(e.term),h=this.termResults(e.term,e.term,1,e.termBoost,p,o,s,f),m,x;if(e.prefix&&(m=this._index.atPrefix(e.term)),e.fuzzy){let T=e.fuzzy===!0?.2:e.fuzzy,D=T<1?Math.min(d,Math.round(e.term.length*T)):T;D&&(x=this._index.fuzzyGet(e.term,D))}if(m)for(let[T,D]of m){let R=T.length-e.term.length;if(!R)continue;x?.delete(T);let C=u*T.length/(T.length+.3*R);this.termResults(e.term,T,C,e.termBoost,D,o,s,f,h)}if(x)for(let T of x.keys()){let[D,R]=x.get(T);if(!R)continue;let C=i*T.length/(T.length+R);this.termResults(e.term,T,C,e.termBoost,D,o,s,f,h)}return h}executeWildcardQuery(e){let n=new Map,r=Object.assign(Object.assign({},this._options.searchOptions),e);for(let[o,s]of this._documentIds){let c=r.boostDocument?r.boostDocument(s,"",this._storedFields.get(o)):1;n.set(o,{score:c,terms:[],match:{}})}return n}combineResults(e,n=mn){if(e.length===0)return new Map;let r=n.toLowerCase(),o=za[r];if(!o)throw new Error(`Invalid combination operator: ${n}`);return e.reduce(o)||new Map}toJSON(){let e=[];for(let[n,r]of this._index){let o={};for(let[s,c]of r)o[s]=Object.fromEntries(c);e.push([n,o])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,n,r,o,s,c,d,f,i=new Map){if(s==null)return i;for(let u of Object.keys(c)){let p=c[u],h=this._fieldIds[u],m=s.get(h);if(m==null)continue;let x=m.size,T=this._avgFieldLength[h];for(let D of m.keys()){if(!this._documentIds.has(D)){this.removeTerm(h,D,n),x-=1;continue}let R=d?d(this._documentIds.get(D),n,this._storedFields.get(D)):1;if(!R)continue;let C=m.get(D),P=this._fieldLength.get(D)[h],j=Ba(C,x,this._documentCount,P,T,f),W=r*o*p*R*j,S=i.get(D);if(S){S.score+=W,Va(S.terms,e);let O=ln(S.match,n);O?O.push(u):S.match[n]=[u]}else i.set(D,{score:W,terms:[e],match:{[n]:[u]}})}}return i}addTerm(e,n,r){let o=this._index.fetch(r,Xr),s=o.get(e);if(s==null)s=new Map,s.set(n,1),o.set(e,s);else{let c=s.get(n);s.set(n,(c||0)+1)}}removeTerm(e,n,r){if(!this._index.has(r)){this.warnDocumentChanged(n,e,r);return}let o=this._index.fetch(r,Xr),s=o.get(e);s==null||s.get(n)==null?this.warnDocumentChanged(n,e,r):s.get(n)<=1?s.size<=1?o.delete(e):s.delete(n):s.set(n,s.get(n)-1),this._index.get(r).size===0&&this._index.delete(r)}warnDocumentChanged(e,n,r){for(let o of Object.keys(this._fieldIds))if(this._fieldIds[o]===n){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(e)} has changed before removal: term "${r}" was not present in field "${o}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(e){let n=this._nextId;return this._idToShortId.set(e,n),this._documentIds.set(n,e),this._documentCount+=1,this._nextId+=1,n}addFields(e){for(let n=0;n<e.length;n++)this._fieldIds[e[n]]=n}addFieldLength(e,n,r,o){let s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[n]=o;let d=(this._avgFieldLength[n]||0)*r+o;this._avgFieldLength[n]=d/(r+1)}removeFieldLength(e,n,r,o){if(r===1){this._avgFieldLength[n]=0;return}let s=this._avgFieldLength[n]*r-o;this._avgFieldLength[n]=s/(r-1)}saveStoredFields(e,n){let{storeFields:r,extractField:o}=this._options;if(r==null||r.length===0)return;let s=this._storedFields.get(e);s==null&&this._storedFields.set(e,s={});for(let c of r){let d=o(n,c);d!==void 0&&(s[c]=d)}}};Rt.wildcard=Symbol("*");var ln=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0,za={[mn]:(t,e)=>{for(let n of e.keys()){let r=t.get(n);if(r==null)t.set(n,e.get(n));else{let{score:o,terms:s,match:c}=e.get(n);r.score=r.score+o,r.match=Object.assign(r.match,c),Gr(r.terms,s)}}return t},[oo]:(t,e)=>{let n=new Map;for(let r of e.keys()){let o=t.get(r);if(o==null)continue;let{score:s,terms:c,match:d}=e.get(r);Gr(o.terms,c),n.set(r,{score:o.score+s,terms:o.terms,match:Object.assign(o.match,d)})}return n},[Na]:(t,e)=>{for(let n of e.keys())t.delete(n);return t}},Ua={k:1.2,b:.7,d:.5},Ba=(t,e,n,r,o,s)=>{let{k:c,b:d,d:f}=s;return Math.log(1+(n-e+.5)/(e+.5))*(f+t*(c+1)/(t+c*(1-d+d*r/o)))},Wa=t=>(e,n,r)=>{let o=typeof t.fuzzy=="function"?t.fuzzy(e,n,r):t.fuzzy||!1,s=typeof t.prefix=="function"?t.prefix(e,n,r):t.prefix===!0,c=typeof t.boostTerm=="function"?t.boostTerm(e,n,r):1;return{term:e,fuzzy:o,prefix:s,termBoost:c}},un={idField:"id",extractField:(t,e)=>t[e],tokenize:t=>t.split(Ja),processTerm:t=>t.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(t,e)=>{typeof console?.[t]=="function"&&console[t](e)},autoVacuum:!0},Hr={combineWith:mn,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Ua},Ka={combineWith:oo,prefix:(t,e,n)=>e===n.length-1},hn={batchSize:1e3,batchWait:10},gn={minDirtFactor:.1,minDirtCount:20},fn=Object.assign(Object.assign({},hn),gn),Va=(t,e)=>{t.includes(e)||t.push(e)},Gr=(t,e)=>{for(let n of e)t.includes(n)||t.push(n)},Qr=({score:t},{score:e})=>e-t,Xr=()=>new Map,It=t=>{let e=new Map;for(let n of Object.keys(t))e.set(parseInt(n,10),t[n]);return e},Et=t=>Tt(void 0,void 0,void 0,function*(){let e=new Map,n=0;for(let r of Object.keys(t))e.set(parseInt(r,10),t[r]),++n%1e3===0&&(yield io(0));return e}),io=t=>new Promise(e=>setTimeout(e,t)),Ja=/[\n\r\p{Z}\p{P}]+/u;so.exports=Rt});var Ie=F((Tu,ho)=>{var Y,uo=ao();ho.exports=Y={};Y.sites={};var At=0,co=500,Ya=t=>new Promise(e=>setTimeout(e,t)),fo=function(t,e){if(e.sitemapRequestInflight)return;e.sitemapRequestInflight=!0;let n=(f,i,u)=>$(`.neighbor[data-site="${f}"]`).find("div").removeClass(i).addClass(u),r=function(f){return f>432e5?432e5:f<6e4?6e4:f};var o=function(f,i){return i.sitemapRequestInflight=!0,wiki.site(f).get("system/sitemap.json",function(u,p){if(i.sitemapRequestInflight=!1,u){n(f,"fetch","fail"),wiki.site(f).refresh(function(){}),console.warn(`Unable to fetch sitemap for ${f}`);return}let{data:h,lastModified:m}=p;isNaN(m)&&(m=0),m>i.lastModified&&(i.sitemap=h,i.lastModified=m,$("body").trigger("new-neighbor-done",f),s(f,i));let x=r(Math.floor((Date.now()-m)/4));return i.nextCheck=Date.now()+x,console.log("delay for ",f,x/6e4),n(f,"fetch","done"),Ya(x).then(function(){return n(f,"done","fetch"),o(f,i)})})},s=(f,i)=>wiki.site(f).getIndex("system/site-index.json",function(u,p){if(u)console.log("error loading index",f,u);else try{i.siteIndex=uo.loadJSON(p,{fields:["title","content"]}),console.log(f,"index loaded")}catch{console.log("error loading index - not a valid index",f)}});let c=function(){return n(t,"wait","fetch"),e.lastModified=0,o(t,e)},d=Date.now();d>At?(At=d+co,setTimeout(c,100)):(setTimeout(c,At-d),At+=co)};Y.retryNeighbor=function(t){console.log("retrying neighbor");let e={};Y.sites[t]=e,fo(t,e)};Y.registerNeighbor=function(t){if(Y.sites[t])return;let e={};Y.sites[t]=e,fo(t,e),$("body").trigger("new-neighbor",t)};Y.updateSitemap=function(t){let e,n=location.host;if(!(e=Y.sites[n])||e.sitemapRequestInflight)return;let r=t.getSlug(),o=t.getDate(),s=t.getTitle(),c=t.getSynopsis(),d=t.getLinks(),f={slug:r,date:o,title:s,synopsis:c,links:d},{sitemap:i}=e,u=i.findIndex(p=>p.slug===r);u>=0?i[u]=f:i.push(f),$("body").trigger("new-neighbor-done",n)};Y.deleteFromSitemap=function(t){let e,n=location.host;if(!(e=Y.sites[n])||e.sitemapRequestInflight)return;let r=t.getSlug(),{sitemap:o}=e,s=o.findIndex(c=>c.slug===r);s>=0&&(o.splice(s),$("body").trigger("delete-neighbor-done",n))};Y.listNeighbors=()=>Object.keys(Y.sites);var lo=t=>t.replace(/\[([^\]]*?)\][[(].*?[\])]/g," $1 ").replace(/\[{2}|\[(?:[\S]+)|\]{1,2}/g," ").replace(/\n/g," ").replace(/<style.*?<\/style>/g," ").replace(/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g," ").replace(/<(?:[^>])+>/g," ").replace(/(https?.*?)(?=\p{White_Space}|\p{Quotation_Mark}|$)/gu,function(e){let n=new URL(e);return n.hostname+n.pathname}).replace(/[\p{P}\p{Emoji}\p{Symbol}}]+/gu," ").replace(/[\p{White_Space}\n\t]+/gu," "),Ha=function(t,e,n){try{if(e.text)switch(e.type){case"paragraph":case"markdown":case"html":case"reference":case"image":case"pagefold":case"math":case"mathjax":case"code":t+=lo(e.text);break;case"audio":case"video":case"frame":t+=lo(e.text.split(/\r\n?|\n/).map(function(r){let o=r.split(/\p{White_Space}/u)[0];return o.startsWith("http")||o.toUpperCase()===o||o.startsWith("//")?"":r}).join(" "));break}}catch(r){throw new Error(`Error extracting text from ${n}, ${JSON.stringify(e)} ${r}, ${r.stack}`)}return t};Y.updateIndex=function(t){let e;console.log(`updating ${t.getSlug()} in index`);let n=location.host;if(!(e=Y.sites[n]))return;let r=t.getSlug(),o=t.getTitle(),c=t.getRawPage().story.reduce(Ha,"");return e.siteIndex.has(r)?e.siteIndex.replace({id:r,title:o,content:c}):e.siteIndex.add({id:r,title:o,content:c})};Y.deleteFromIndex=function(t){let e,n=location.host;if(!(e=Y.sites[n]))return;let r=t.getSlug();try{e.siteIndex.discard(r)}catch(o){o.message.includes("not in the index")||console.log(`removing ${r} from index failed`,o)}};Y.search=function(t){let e,n,r=[],o={},s=function(m){return o[m]?o[m]++:o[m]=1},c=m=>{let x=`indexing sitemap ( ${m} )`;console.time(x),console.log("indexing sitemap:",m);let T=new uo({fields:["title","content"]});return e.sitemap.forEach(function(D){T.add({id:D.slug,title:D.title,content:D.synopsis})}),console.timeEnd(x),T},d=Date.now();for(n of Object.keys(Y.sites))e=Y.sites[n],e.sitemap&&(e.siteIndex||(e.siteIndex=c(n,e)));let f=location.host;for(n of Object.keys(Y.sites))if(e=Y.sites[n],e.siteIndex){var i,u,p,h;s("sites");try{o.pages?o.pages+=e.sitemap.length:o.pages=e.sitemap.length}catch(m){u=m,console.info("+++ sitemap not valid for ",n),e.sitemap=[]}n===f?(h=20,i=2):(h=10,i=1);try{p=e.siteIndex.search(t,{boost:{title:h,content:i},prefix:!0,combineWith:"AND"})}catch(m){u=m,console.error("search index error",n,t,u),p=[]}p.forEach(function(m){s("finds"),r.push({page:e.sitemap.find(({slug:x})=>x===m.id),site:n,rank:m.score})})}return r.sort((m,x)=>x.rank-m.rank),o.msec=Date.now()-d,{finds:r,tally:o}};Y.backLinks=function(t){let e=[];for(var n of Object.keys(Y.sites)){var r=Y.sites[n];r.sitemap&&r.sitemap.forEach(s=>{s.links&&Object.keys(s.links).length>0&&Object.keys(s.links).includes(t)&&e.push({slug:s.slug,title:s.title,site:n,itemId:s.links[t],date:s.date})})}let o={};return e.forEach(function(s){t=s.slug,o[t]=o[t]||{},o[t].title=s.title,o[t].sites=o[t].sites||[],o[t].sites.push({site:s.site,date:s.date,itemId:s.itemId})}),o}});var Ee=F((Cu,wo)=>{var de,Ga=ot(),yn=tn(),wn=an(),{newPage:vn}=le(),po=be(),Pt=Ie();wo.exports=de={};var go=t=>JSON.parse(JSON.stringify(t));de.useLocalStorage=()=>$(".login").length>0;var mo=function(t){let e;if(e=localStorage.getItem(t))return JSON.parse(e)},vo=function({pageInformation:t,whenGotten:e,whenNotGotten:n,localContext:r}){let{slug:o,rev:s,site:c}=t,d={get(i,u){wiki.local.get(i,function(p,h){p?wiki.origin.get(i,u):(c="local",u(null,h))})}};c?r=[]:c=r.shift(),c===window.location.host&&(c="origin"),c===null&&(c="view");let f={local:wiki.local,origin:wiki.origin,recycler:wiki.recycler,view:d}[c]??wiki.site(c);f.get(`${o}.json`,function(i,u){if(!i)s&&(u=yn.create(s,u)),e(vn(u,c));else if([403,404].includes(i.xhr.status)||i.xhr.status===0)r.length>0?vo({pageInformation:t,whenGotten:e,whenNotGotten:n,localContext:r}):n();else{let p=f.getDirectURL(t.slug),h=`The page handler has run into problems with this request.
<pre class=error>${JSON.stringify(t)}</pre>
The requested url.
<pre class=error>${p}</pre>
The server reported status.
<pre class=error>${i.xhr?.status}</pre>
The error message.
<pre class=error>${i.msg}</pre>
These problems are rarely solved by reporting issues.
There could be additional information reported in the browser's console.log.
More information might be accessible by fetching the page outside of wiki.
<a href="${p}" target="_blank">try-now</a>`,m=vn({title:"Trouble: Can't Get Page"},null);m.addItem({type:"html",text:h}),e(m)}})};de.get=function({whenGotten:t,whenNotGotten:e,pageInformation:n}){if(!n.site){let r;if(r=mo(n.slug)){n.rev&&(r=yn.create(n.rev,r)),t(vn(r,"local"));return}}de.context.length||(de.context=["view"]),vo({pageInformation:n,whenGotten:t,whenNotGotten:e,localContext:de.context.slice()})};de.context=[];var yo=function(t,e,n){let r;if(n.type==="create")r={title:n.item.title,story:[],journal:[]};else{let o;r=mo(e.slug),r||(r=po.atKey(t.data("key")).getRawPage()),r.journal||=[],(o=n.fork)&&(r.journal=r.journal.concat({type:"fork",site:o,date:new Date().getTime()}),delete n.fork)}yn.apply(r,n),wiki.local.put(e.slug,r,function(){wn(t.find(".journal"),n),t.addClass("local")})},Qa=function(t,e,n){let r=go(n),o=po.atKey(t.data("key"));(n.fork||n.type==="fork")&&(r.forkPage=go(o.getRawPage())),wiki.origin.put(e.slug,r,function(s){if(s)n.error={type:s.type,msg:s.msg,response:s.xhr.responseText},yo(t,e,n);else if(o?.apply&&o.apply(n),Pt.updateSitemap(o),Pt.updateIndex(o),wn(t.find(".journal"),n),n.type==="fork"&&wiki.local.delete(t.attr("id")),n.type!=="fork"&&n.fork&&n.item.type==="image"){let c=t.find(".item").index(t.find("#"+n.item.id).context);wiki.renderFrom(c)}})};de.put=function(t,e){let n=function(){let s;switch(s=t.data("site")){case"origin":case"local":case"view":return null;case location.host:return null;default:return s}},r={slug:t.attr("id").split("_rev")[0],rev:t.attr("id").split("_rev")[1],site:n(),local:t.hasClass("local")},o=r.site;de.useLocalStorage()&&(r.site||r.local||(e.site=o=location.host)),e.date=new Date().getTime(),e.site==="origin"&&delete e.site,t.removeClass("plugin"),o&&(t.find("h1").prop("title",location.host),t.find("h1 img").attr("src","/favicon.png"),t.find("h1 a").attr("href",`/view/welcome-visitors/view/${r.slug}`).attr("target",location.host),t.data("site",null),t.removeClass("remote"),Ga.setUrl(),e.type!=="fork"&&(e.fork=o,wn(t.find(".journal"),{type:"fork",site:o,date:e.date}))),de.useLocalStorage()||r.site==="local"?yo(t,r,e):Qa(t,r,e)};de.delete=function(t,e,n){t.isRecycler()?wiki.recycler.delete(`${t.getSlug()}.json`,function(r){setTimeout(()=>n(r),300)}):wiki.origin.delete(`${t.getSlug()}.json`,function(r){setTimeout(function(){r||(Pt.deleteFromSitemap(t),Pt.deleteFromIndex(t)),n(r)},300)})}});var $e=F((Ru,_o)=>{var se;_o.exports=se={};var Xa=t=>(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),Za=function(t){return console.log("loading url:",t),import(t)},bo=[],Lt={},$o=se.getScript=async function(t,e=()=>{}){if(bo.includes(t))e();else{try{await Za(t)}catch(n){console.log("getScript: Failed to load:",t,n)}bo.push(t),e()}};se.renderFrom=async function(t){let e=$(".item").slice(t);for(let n of e.toArray()){let r=$(n);if(!r.hasClass("textEditing")){let o=r.data("item");try{r.off(),await se.emit(r.empty(),o)}catch(s){console.error(s)}}}for(let n of e.toArray()){let r=$(n),o=r.data("item");try{let s=await se.get(o.type);s&&s.bind&&await s.bind(r,o)}catch(s){console.error(s)}}};var ec=function(t){return function(n,r){return n.addClass("emit"),t(n,r)}},tc=function(t,e){return async function(r,o){r[0].consuming=[];let s=$(".item").index(r),{consumes:c}=window.plugins[t];if(c){let d=[];c.forEach(function(f){let i=$(`.item:lt(${s})`).filter(f);(!i||i.length===0)&&console.log("warn: no items in lineup that produces",f),i.each(function(u,p){let h=$(p).parents(".page").data("key"),m=$(p).attr("data-id");r[0].consuming.push(`${h}/${m}`),d.push(p.promise)})}),await Promise.all(d)}try{r.removeClass("emit"),await(r[0].promise=async function(){return e(r,o)}()),window.plugins[t].processServerEvent&&console.log("listening for server events",r,o)}catch(d){console.log("plugin emit: unexpected error",d)}}};se.wrap=xo;function xo(t,e){return e.emit=ec(e.emit),e.bind=tc(t,e.bind),e}se.get=se.getPlugin=async function(t,e=()=>{}){if(window.pluginSuccessor[t]&&(wiki.log("plugin successor",t,window.pluginSuccessor[t]),t=window.pluginSuccessor[t]),window.plugins[t])return e(window.plugins[t]),window.plugins[t];Lt[t]||(Lt[t]=async function(){if(window.plugins[t])return window.plugins[t];await $o(`/plugins/${t}/${t}.js`),window.plugins[t]||await $o(`/plugins/${t}.js`);let r=window.plugins[t];return r&&xo(t,r),r}());let n=await Lt[t];return delete Lt[t],n||console.log("Could not find plugin ",t),e(n),n};se.do=se.doPlugin=async function(t,e,n=()=>{}){return t.data("item",e),await se.renderFrom($(".item").index(t)),n()};se.emit=async function(t,e,n=()=>{}){let r=function(s,c){t.append(`<div class="error">
  ${Xa(e.text||"")}
  <button>help</button><br>
</div>`),e.text&&t.find(".error").on("dblclick",()=>wiki.textEditor(t,e)),t.find("button").on("click",function(){t[0].querySelector("dialog")||t.append(`<dialog>
  <h3>${s.toString()}</h3>
  <p> This "${e.type}" plugin won't show.</p>
  <ul>
    <li> Is it available on this server?
    <li> Is its markup correct?
    <li> Can it find necessary data?
    <li> Has network access been interrupted?
    <li> Has its code been tested?
  </ul>
  <p> Developers may open debugging tools and retry the plugin.</p>
  <button class="retry">retry</button>  <button class="close">close</button>
  <p> Learn more
    <a class="external" target="_blank" rel="nofollow"
    href="http://plugins.fed.wiki.org/about-plugins.html"
    title="http://plugins.fed.wiki.org/about-plugins.html">
      About Plugins
      <img src="/images/external-link-ltr-icon.png">
    </a>
  </p>

</dialog>`);let d=t[0].querySelector("dialog");d.addEventListener("click",function(f){f.target===d&&d.close()}),d.showModal(),$(".close").on("click",()=>d.close()),$(".retry").on("click",function(){c.emit.length>2?c.emit(t,e,()=>n()):(c.emit(t,e),n())})})};t.data("pageElement",t.parents(".page")),t.data("item",e);let o=await se.get(e.type);try{if(o==null)throw TypeError(`Can't find plugin for '${e.type}'`);o.emit.length>2?await new Promise(s=>{o.emit(t,e,function(){o.bind&&o.bind(t,e),s()})}):o.emit(t,e)}catch(s){console.log("plugin error",s),r(s,o)}n()};se.registerPlugin=(t,e)=>window.plugins[t]=e($)});var Dt=F((Au,Io)=>{var bn=Ee(),So=$e(),nc=De(),rc=(t,e)=>setTimeout(e,t),ko=function(t){if($(t).length>0)return $(t).data("item")||$(t).data("staticItem")},oc=function(t,e){bn.put(t.parents(".page:first"),{type:"remove",id:e.id}),t.remove()},ic=function(t,e,n){t||(t=e.parents(".page")),n.id=nc.itemId();let r=$(`<div class="item ${n.type}" data-id=""</div>`);r.data("item",n).data("pageElement",t),e?e.after(r):t.find(".story").append(r),So.do(r,n);let o=ko(e);return rc(500,()=>bn.put(t,{item:n,id:n.id,type:"add",after:o?.id})),r},sc=function(t,e,n){let r=$.extend({},n);t.empty().off(),t.removeClass(e).addClass(r.type);let o=t.parents(".page:first");try{t.data("pageElement",o),t.data("item",r),So.getPlugin(n.type,function(s){s.emit(t,r),s.bind(t,r)})}catch(s){t.append(`<p class='error'>${s}</p>`)}return bn.put(o,{type:"edit",id:r.id,item:r})};Io.exports={createItem:ic,removeItem:oc,getItem:ko,replaceItem:sc}});var $n=F((Pu,Eo)=>{var ac=(t,e)=>{let n=e;typeof e=="object"&&(n=e[0].outerHTML);let r=window.open("/dialog/#","dialog","popup,height=600,width=800");r.location.pathname!=="/dialog/"?r.addEventListener("load",()=>r.postMessage({title:t,body:n},window.origin)):r.postMessage({title:t,body:n},window.origin)};Eo.exports={open:ac}});var xe=F((Lu,To)=>{var Ot,Te,{asSlug:cc}=le();To.exports=Te={};Te.resolutionContext=[];Te.escape=Ot=t=>(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");Te.resolveFrom=function(t,e){Te.resolutionContext.push(t);try{e()}finally{Te.resolutionContext.pop()}};Te.resolveLinks=function(t,e=Ot){let n=[],r=function(d){let f=n.length;return n.push(d),`\u3016${f}\u3017`},o=(d,f)=>n[+f],s=function(d,f){let i=cc(f),u=f===f.trim()?"internal":"internal spaced";return i.length?r(`<a class="${u}" href="/${i}.html" data-page-name="${i}" title="${Te.resolutionContext.join(" => ")}">${Ot(f)}</a>`):d},c=(d,f,i,u)=>r(`<a class="external" target="_blank" href="${f}" title="${f}" rel="nofollow">${Ot(u)} <img src="/images/external-link-ltr-icon.png"></a>`);return t=(t||"").replace(/〖(\d+)〗/g,"\u3016 $1 \u3017").replace(/\[\[([^\]]+)\]\]/gi,s).replace(/\[((http|https|ftp):.*?) (.*?)\]/gi,c),e(t).replace(/〖(\d+)〗/g,o)}});var Mt=F((Du,jo)=>{var Fe=Ee(),at=$e(),lc=ot(),Je=Ie(),Co=an(),Ro=on(),ct=be(),Sn=xe(),Po=De(),kn=le(),{newPage:uc}=kn,{asSlug:Lo}=kn,{pageEmitter:fc}=kn,xn=function(t){if($(t).length>0)return $(t).data("item")||$(t).data("staticItem")},dc=function(t,e,n){let r=$.extend({},n);e.data("item",r);let o=ct.atKey(t.data("key"));return o.getItem(r.id)!=null?(r.alias||(r.alias=r.id),r.id=Po.itemId(),e.attr("data-id",r.id),e.data("id",r.id),e.data("item").id=r.id):r.alias!=null&&o.getItem(r.alias)==null&&(r.id=r.alias,delete r.alias,e.attr("data-id",r.id)),r},Do=(t,e)=>t&&e&&t.get(0)===e.get(0),Oo=t=>t.children().map((e,n)=>$(n).attr("data-id")).get(),hc=function(t,e,n,r){let o,s,c=e.item,d=xn(c),f=c.data("pageElement"),i=f.hasClass("ghost")||f.hasClass("remote");f.hasClass("ghost")||(o={page:f.data().data.title},f.data().site!=null&&(o.site=f.data().site));let u=c.parents(".page:first"),p=u.hasClass("ghost"),h=Do(f,u),m=!h&&!t.shiftKey&&f.attr("id")===u.attr("id"),x={page:u.data().data.title};if(p||m){$(t.target).sortable("cancel");return}if(h){let C=Oo(c.parents(".story:first"));JSON.stringify(C)!==JSON.stringify(r)&&($(".shadow-copy").remove(),c.empty(),s=$(".item").index(c),n<s&&(s=n),at.renderFrom(s),Fe.put(u,{id:d.id,type:"move",order:C}));return}i||t.shiftKey?$(".shadow-copy").removeClass("shadow-copy").data(c.data()).attr({"data-id":c.attr("data-id")}):Fe.put(f,{id:d.id,type:"remove",removedTo:x}),c.data("pageElement",u);let D=c.prev(".item"),R=xn(D);d=dc(u,c,d),Fe.put(u,{id:d.id,type:"add",item:d,after:R?.id,attribution:o}),$(".shadow-copy").remove(),c.empty(),D.after(c),s=$(".item").index(c),n<s&&(s=n),at.renderFrom(s)},gc=function(t,e){let n=e.item.data("pageElement"),r=n.hasClass("ghost")||n.hasClass("remote"),o=e.placeholder.parents(".page:first"),s=o.hasClass("ghost"),c=Do(n,o),d=!c&&n.attr("id")===o.attr("id"),f=r||t.shiftKey&&!c;return s||d&&!t.shiftKey?($("body").css("cursor","no-drop"),$(".shadow-copy").hide()):f?($("body").css("cursor","copy"),$(".shadow-copy").show()):($("body").css("cursor","move"),$(".shadow-copy").hide())},pc=function(t){let e=$("body").css("cursor"),n={connectWith:".page .story",placeholder:"item-placeholder",forcePlaceholderSize:!0,delay:150},r=t.find(".story"),o=null,s=null,c=null,d=function(f){if(f.which===27)return c=!0,r.sortable("cancel")};return r.sortable(n).on("sortstart",function(f,i){let u=i.item;return o=Oo(r),s=$(".item").index(u),c=!1,$("body").on("keydown",d),u.clone().insertAfter(i.placeholder).hide().addClass("shadow-copy").css({width:"",height:"",position:"",zIndex:""}).removeAttr("data-id")}).on("sort",gc).on("sortstop",function(f,i){return $("body").css("cursor",e).off("keydown",d),c||hc(f,i,s,o),$(".shadow-copy").remove()})},Ao=function(t){let e=$(t).parents(".page:first");return ct.atKey(e.data("key"))},mc=function(t,e){let n=Ao(e.draggable),r=Ao(t.target);fc.dispatchEvent(new CustomEvent("show",{detail:r.merge(n)}))},vc=function(t){let e=t.find(".journal");e.draggable({revert:!0,appendTo:".main",scroll:!1,helper:"clone"}),e.droppable({hoverClass:"ui-state-hover",drop:mc,accept:".journal"})},yc=t=>t.find(".add-factory").on("click",function(e){t.hasClass("ghost")||(e.preventDefault(),wc(t))}),wc=function(t){let e={type:"factory",id:Po.itemId()},n=$("<div />",{class:"item factory"}).data("item",e).attr("data-id",e.id);n.data("pageElement",t),t.find(".story").append(n),at.do(n,e);let r=n.prev(".item"),o=xn(r);Fe.put(t,{item:e,id:e.id,type:"add",after:o?.id})},bc=function(t){t.preventDefault(),ct.debugSelfCheck(Array.from($(".page")).map(c=>$(c).data("key")));let e=$(t.target).parents(".page:first"),n=ct.crumbs(e.data("key"),location.host),r=n[0],o=wiki.site(r).getDirectURL("").split("/")[0];o===""&&(o=window.location.protocol),window.open(`${o}//${n.join("/")}`,r).focus()},$c=function(t,e,n){let r;n.isRecycler()?r="recycler":r=n.getRemoteSite(location.host);let o=n.getRemoteSiteDetails(location.host);t.append(`<h1 title="${o}">
  <span>
    <a href="${n.siteLineup()}" target="${r}">
      <img src="${wiki.site(r).flag()}" height="32px" class="favicon"></a>
    ${Sn.escape(n.getTitle())}
  </span>
</h1>`),t.find("a").on("click",bc)},xc=function(t,e,n){e.attr("id").match(/_rev/)&&(e.addClass("ghost"),e.data("rev",n.getRevision()),t.append($(`<h2 class="revision">
  <span>
    ${n.getTimestamp()}
  </span>
</h2>`)))},_c=t=>t.append(`<div class="control-buttons">
<a href="#" class="button fork-page" title="fork this page">${Ro.fork}</a>
<a href="#" class="button add-factory" title="add paragraph">${Ro.add}</a>
</div>`),Sc=function(t,e){let n=e.getSlug(),r=Je.backLinks(n);if(Object.keys(r).length>0){let p=[];for(var o in r){var s=r[o];s.sites.sort((h,m)=>(h.date||0)<(m.date||0));for(var c=[],d=0;d<s.sites.length;d++){var f=s.sites[d];if(d<10){var i=s.sites[d-1]?.date===f.date?"":" ";c.unshift(i),c.unshift(`<img class="remote"
    src="${wiki.site(f.site).flag()}"
    data-slug="${o}"
    data-site="${f.site}"
    data-id="${f.itemId}"
    title="${f.site}
${wiki.util.formatElapsedTime(f.date)}">`)}else d===10&&c.unshift(" \u22EF ")}var u=Sn.resolveLinks(`[[${s.title}]]`);p.push(`<div style="clear: both;">
  <div style="float: left;">${u}</div>
  <div style="text-align: right;"> ${c.join("")} </div>
</div>`)}p&&t.append(`<details>
  <summary>${p.length} pages link here:</summary>
  ${p.join(`
`)}
</details>`)}},kc=function(t,e){let n=e.getRemoteSite(location.host),r=e.getSlug();t.append(`<a class="show-page-license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a> .
<a class="show-page-source" href="${wiki.site(n).getDirectURL(r)}.json" title="source">JSON</a> .
<a href= "${wiki.site(n).getDirectURL(r)}.html" date-slug="${r}" target="${n}">${n} </a> .
<a href= "#" class=search>search</a>`)},Ic=function(t){let e=t||[];for(let r=e.length-1;r>=0;r--){var n=e[r];if(n.date&&n.type!=="fork")return n.date}},Mo=function(t){let e,n,r,o=t.data("data");if(!o)return;let s=t.data("site")||window.location.host;["view","origin"].includes(s)&&(s=window.location.host);let c=Lo(o.title);if(e=Ic(o.journal)){let i,u={newer:[],same:[],older:[]};for(n in Je.sites){var d=Je.sites[n];if(n!==s&&d.sitemap!=null)for(r of d.sitemap)r.slug===c&&(i=r.date>e?u.newer:r.date<e?u.older:u.same,i.push({remoteSite:n,item:r}))}let p=[];for(var f in u){if(i=u[f],!i.length)continue;i.sort((m,x)=>m.item.date<x.item.date);let h=[];for(let m=0;m<i.length&&({remoteSite:n,item:r}=i[m],!(m>=8));m++)h.push(`<img class="remote"
src="${wiki.site(n).flag()}"
data-slug="${c}"
data-site="${n}"
title="${n}">`);p.push(`${h.join("&nbsp;")} ${f}`)}p&&t.find(".twins").html(`<p><span>${p.join(", ")}</span></p>`)}},Ec=function(t,e){e.data("data",t.getRawPage()),t.isRemote()&&e.data("site",t.getRemoteSite()),Sn.resolutionContext=t.getContext(),e.empty();let n=$("<div class='paper' />");e.append(n);let[r,o,s,c,d,f,i]=["handle-parent","twins","header","story","backlinks","journal","footer"].map(function(h){if(h!=="journal"||$(".editEnable").is(":visible"))return $("<div />").addClass(h).appendTo(n)}),u=$("<div />").addClass("page-handle").appendTo(r);$c(s,e,t),xc(s,e,t);let p=t.seqItems(function(h,m){let x=$(`<div class="item ${h.type}" data-id="${h.id}">`);return c.append(x),x.data("item",h),m()});return p=p.then(function(){let h=$(".page").index(e[0]),m=$(".item").index($($(".page")[h]).find(".item"));return at.renderFrom(m)}).then(()=>e),$(".editEnable").is(":visible")&&t.seqActions(function(h,m){return h.separator&&Co(f,h.separator),Co(f,h.action),m()}),Mo(e),Sc(d,t),$(".editEnable").is(":visible")&&_c(f),kc(i,t),u.css({height:`${c.position().top-r.position().top-5}px`}),p},Tc=function(t,e){e.isRemote()||$("img.favicon",t).on("error",()=>at.get("favicon",n=>n.create()))},Fo=function(t,e){t.isLocal()&&e.addClass("local"),t.isRecycler()&&e.addClass("recycler"),t.isRemote()&&e.addClass("remote"),t.isPlugin()&&e.addClass("plugin");let n=Ec(t,e);return Tc(e,t),lc.setUrl(),$(".editEnable").is(":visible")&&(pc(e),vc(e),yc(e)),n},_n=function(t,e){let n=ct.addPage(t);return e.data("key",n),e.get(0).dataset.key=n,Fo(t,e)},qo=function(t,e){let n=Lo(t),r=uc();r.setTitle(t);let o=[];for(var s in Je.sites){var c=Je.sites[s];if(c.sitemap!=null){var d=c.sitemap.find(i=>i.slug===n);d!=null&&o.push({type:"reference",site:s,slug:n,title:d.title||n,text:d.synopsis||""})}}if(o.length>0){r.addItem({type:"future",text:"We could not find this page where it was expected.",title:t,create:e,context:Fe.context.filter(i=>!["view","origin","local"].includes(i))}),r.addItem({type:"paragraph",text:"We did find possible duplicate in the current neighborhood."});for(var f of o)r.addItem(f)}else r.addItem({type:"future",text:"We could not find this page.",title:t,create:e,context:Fe.context.filter(i=>!["view","origin","local"].includes(i))});return r},Cc=function(t){var e=new Promise(function(n){let[r,o]=t.attr("id").split("_rev"),s=t.find(".header h1").text().trim(),c={slug:r,rev:o,site:t.data("site")},d=function(){let i=$(`a.internal[href="/${r}.html"]:last`);s=s||i.text()||r;let u=qo(s);return e=_n(u,t),e.then(p=>p.addClass("ghost")),n(e)},f=function(i){e=_n(i,t);for(var u of i.getNeighbors(location.host))Je.registerNeighbor(u);return n(e)};return Fe.get({whenGotten:f,whenNotGotten:d,pageInformation:c})});return e};jo.exports={cycle:Cc,emitTwins:Mo,buildPage:_n,rebuildPage:Fo,newFuturePage:qo}});var Ce=F((Ou,Ko)=>{var No=be(),zo=rt(),Uo=Mt(),{asTitle:Rc,asSlug:Ac,pageEmitter:Pc}=le(),In=function(t,e,n=null){let r;e&&e!=="view"&&(r=e),n||(n=Rc(t));let o=$(`<div class="page" id="${t}" tabindex="-1">
  <div class="paper">
    <div class="twins"> <p> </p> </div>
    <div class="header">
      <h1> <img class="favicon" src="${wiki.site(r).flag()}" height="32px"> ${n} </h1>
    </div>
  </div>
</div>`);return r&&o.data("site",r),o},Bo=(t,e,n=null)=>In(t,e,n).appendTo(".main").each((r,o)=>Uo.cycle($(o))),Lc=function(t,e,n=null){let r=Ac(t);e&&$(e).nextAll().remove(),e&&No.removeAllAfterKey($(e).data("key")),Bo(r,n,t),zo.set($(".page").last())},Wo=function(t,e={}){e.$page&&$(e.$page).nextAll().remove(),e.$page&&No.removeAllAfterKey($(e.$page).data("key"));let n=t.getSlug();e.rev!=null&&(n+=`_rev${e.rev}`);let r=In(n).addClass("ghost");r.appendTo($(".main")),Uo.buildPage(t,r),zo.set($(".page").last())};Pc.addEventListener("show",t=>{Wo(t.detail)});Ko.exports={createPage:In,doInternalLink:Lc,showPage:Bo,showResult:Wo}});var lt=F((Mu,Qo)=>{var Vo=$e(),Go=Dt(),En=Ee(),Dc=Ce(),Oc=De(),Jo=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Tn=function(t,e,n){let r;if(n==null&&(n={}),e.type==="markdown"&&(r=0),!$(".editEnable").is(":visible"))return;let o=function(f){if(f.which===27||(f.ctrlKey||f.metaKey)&&f.which===83)return f.preventDefault(),d.trigger("focusout"),!1;if((f.ctrlKey||f.metaKey)&&f.which===73){let i;return f.preventDefault(),f.shiftKey||(i=$(f.target).parents(".page")),Dc.doInternalLink(`about ${e.type} plugin`,i),!1}if((f.ctrlKey||f.metaKey)&&f.which===77)return f.preventDefault(),t.removeClass(e.type).addClass(e.type="factory"),d.trigger("focusout"),!1;if(e.type==="paragraph"||e.type==="markdown"){let i,u=Mc(d);if(f.which===$.ui.keyCode.BACKSPACE&&u.start===0&&u.start===u.end){let p=t.prev(),h=Go.getItem(p);if(h.type!==e.type)return!1;let m=h[n.field||"text"].length;return i=d.val(),d.val(""),Tn(p,h,{caret:m,suffix:i}),!1}if(f.which===$.ui.keyCode.ENTER){if(!u)return!1;if(e.type==="markdown"&&r++,e.type==="paragraph"||e.type==="markdown"&&r===2){let p=t.parents(".page"),h=d.val(),m=h.substring(0,u.start).trim();return i=h.substring(u.end).trim(),m===""?(d.val(i),d.trigger("focusout"),Yo(p,t.prev(),e.type,m)):(d.val(m),d.trigger("focusout"),Yo(p,t,e.type,i)),!1}}else e.type==="markdown"&&(r=0)}},s=function(){t.removeClass("textEditing"),d.off();let f=t.parents(".page:first");if(e[n.field||"text"]=d.val())if(t.removeClass("output-item"),t.removeClass((i,u)=>(u.match(/\S+-source/)||[]).join(" ")),Vo.do(t.empty(),e),n.after){if(e[n.field||"text"]==="")return;En.put(f,{type:"add",id:e.id,item:e,after:n.after})}else{if(e[n.field||"text"]===c)return;En.put(f,{type:"edit",id:e.id,item:e})}else{n.after||En.put(f,{type:"remove",id:e.id});let i=$(".item").index(t);t.remove(),Vo.renderFrom(i)}};if(!t.hasClass("textEditing")){t.addClass("textEditing"),t.off();var c=e[n.field||"text"]||"",d=$(`<textarea>${Jo(c)}${Jo(n.suffix||"")}</textarea>`).on("focusout",s).on("keydown",o);t.html(d),n.caret?Ho(d,n.caret):n.append?(Ho(d,d.val().length),d.scrollTop(d[0].scrollHeight-d.height())):d.trigger("focus")}},Yo=function(t,e,n,r){let o={type:n,id:Oc.itemId(),text:r},s=$(`<div class="item ${o.type}" data-id=${o.id}></div>`);s.data("item",o).data("pageElement",t),e.after(s);let c=Go.getItem(e);Tn(s,o,{after:c?.id})},Mc=function(t){let e=t.get(0);if(document.selection){e.focus();let n=document.selection.createRange();n.moveStart("character",-e.value.length);let r=n.text.length;return{start:r,end:r}}else return{start:e.selectionStart,end:e.selectionEnd}},Ho=function(t,e){let n=t.get(0);if(n){if(n.createTextRange){let r=n.createTextRange();r.move("character",e),r.select()}else n.setSelectionRange(e,e);n.focus()}};Qo.exports={textEditor:Tn}});var Zo=F((Fu,Xo)=>{var Fc=$e();Xo.exports=t=>Fc.getScript("/security/security.js",()=>window.plugins.security.setup(t))});var Pn=F((qu,ni)=>{var U={},Ft=Ar();U.local=Ft.local;U.origin=Ft.origin;U.recycler=Ft.recycler;U.site=Ft.site;U.asSlug=le().asSlug;U.newPage=le().newPage;var Cn=Dt();U.removeItem=Cn.removeItem;U.createItem=Cn.createItem;U.getItem=Cn.getItem;var qc=$n();U.dialog=qc.open;var Rn=Ce();U.createPage=Rn.createPage;U.doInternalLink=Rn.doInternalLink;U.showResult=Rn.showResult;var ut=$e();U.getScript=ut.getScript;U.getPlugin=ut.getPlugin;U.doPlugin=ut.doPlugin;U.registerPlugin=ut.registerPlugin;U.renderFrom=ut.renderFrom;U.getData=function(t){let e;if(t){let n=$(".item").index(t);return e=$(`.item:lt(${n})`).filter(".chart,.data,.calculator").last(),e?e.data("item").data:{}}else return e=$(".chart,.data,.calculator").last(),e?e.data("item").data:{}};U.getDataNodes=function(t){let e;if(t){let n=$(".item").index(t);return e=$(`.item:lt(${n})`).filter(".chart,.data,.calculator").toArray().reverse(),$(e)}else return e=$(".chart,.data,.calculator").toArray().reverse(),$(e)};U.log=function(...t){console?.log&&console.log(...t||[])};var ei=Ie();U.neighborhood=ei.sites;U.neighborhoodObject=ei;var ti=Ee();U.pageHandler=ti;U.useLocalStorage=ti.useLocalStorage;var An=xe();U.resolveFrom=An.resolveFrom;U.resolveLinks=An.resolveLinks;U.resolutionContext=An.resolutionContext;var jc=lt();U.textEditor=jc.textEditor;U.util=Le();U.security=Zo();U.createSynopsis=_t();U.lineup=be();ni.exports=U});var Ln=F((ju,ri)=>{var Nc=function(t){let e;return(e=t.originalEvent.dataTransfer)!=null&&e.types.includes("Files")?e.files[0]:null},zc=function(t){let e;if((e=t.originalEvent.dataTransfer)!=null&&e.types!=null&&(e.types.includes("text/uri-list")||e.types.includes("text/x-moz-url"))){let n=e.getData("URL");if(n?.length)return n}return null},Uc=function(t){let e;if(e=t.match(/^https?:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/)){let n,r={};return[,n,,r.site,r.slug]=e,["view","local","origin"].includes(r.site)&&(r.site=n),r}return null},Bc=function(t){return new URL(t).pathname.match(/\.(jpg|jpeg|png)$/i)?t:null},Wc=function(t){return new URL(t).pathname.match(/\.(svg)$/i)?t:null},Kc=function(t){let e=new URL(t);try{e.searchParams.get("source")==="video"&&(e=new URL(e.searchParams.get("url")))}catch{}switch(e.hostname){case"www.youtube.com":return e.searchParams.get("list")!=null?{text:`YOUTUBE PLAYLIST ${e.searchParams.get("list")}`}:{text:`YOUTUBE ${e.searchParams.get("v")}`};case"youtu.be":return e.searchParams.get("list")!=null?{text:`YOUTUBE PLAYLIST ${e.searchParams.get("list")}`}:{text:`YOUTUBE ${e.pathname.substring(1)}`};case"vimeo.com":return{text:`VIMEO ${e.pathname.substring(1)}`};case"archive.org":return{text:`ARCHIVE ${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`};case"tedxtalks.ted.com":return{text:`TEDX ${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`};case"www.ted.com":return{text:`TED ${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`};default:return null}},Vc=t=>e=>{let n,r,o,s,c=()=>{e.preventDefault(),e.stopPropagation()};if(s=zc(e)){let d,f,i,u;if((f=Uc(s))&&(r=t.page))return c(r(f));if((u=Kc(s))&&(r=t.video))return c(r(u));if((d=Bc(s))&&(r=t.image))return c(r(d));if((i=Wc(s))&&(r=t.svg))return c(r(i));o={url:s}}if(n=Nc(e)){if(r=t.file)return c(r(n));o={file:n}}if(r=t.punt)return o||(o={dt:e.dataTransfer,types:e.dataTransfer!=null?e.dataTransfer.types:void 0}),c(r(o))};ri.exports={dispatch:Vc}});var si=F((je,ii)=>{var ve=!1,oe=null,me=null,qe=null,Ye=null,He=null,Jc=function(){$(document).on("keydown",function(t){t.keyCode===16&&Yc(t)}).on("keyup",function(t){t.keyCode===16&&Hc(t)}),$(".main").on("mouseenter",".item",Qc).on("mouseleave",".item",Xc).on("mouseenter",".action",Zc).on("mouseleave",".action",el).on("align-item",".page",rl).on("mouseenter",".backlinks .remote",tl).on("mouseleave",".backlinks .remote",nl)},Yc=function(t){if(ve=t.shiftKey,ve&&oe){let e;if($(".emit").addClass("highlight"),e=me||Ye){$(`[data-id=${e}]`).addClass("target");let n=$(this).parents(".page:first").data("key"),r=oe.offset().top;$(".page").trigger("align-item",{key:n,id:me,place:r})}qe&&(He=qe.consuming,He&&He.forEach(n=>oi(n).addClass("consumed")))}},Hc=function(t){ve=t.shiftKey,ve||($(".emit").removeClass("highlight"),$(".item, .action").removeClass("target"),$(".item").removeClass("consumed"))},Gc=function(t){let e=$(".page").filter((n,r)=>$(r).data("key")===t);return e.length===0?null:(e.length>1&&console.log("warning: more than one page found for",t,e),e)},oi=function(t){let[e,n]=t.split("/"),r=Gc(e);return!r||(oe=r.find(`.item[data-id=${n}]`),oe.length===0)?null:(oe.length>1&&console.log("warning: more than one item found for",t,oe),oe)},Qc=()=>{if(me=(oe=$(je)).attr("data-id"),qe=oe[0],ve){$(`[data-id=${me}]`).addClass("target");let t=$(je).parents(".page:first").data("key"),e=oe.offset().top;$(".page").trigger("align-item",{key:t,id:me,place:e}),He=qe.consuming,He&&He.forEach(n=>oi(n).addClass("consumed"))}},Xc=()=>{ve&&($(".item, .action").removeClass("target"),$(".item").removeClass("consumed")),me=null,oe=null,qe=null},Zc=()=>{if(Ye=$(je).data("id"),ve){$(`[data-id=${Ye}]`).addClass("target");let t=$(je).parents(".page:first").data("key");$(".page").trigger("align-item",{key:t,id:Ye})}},el=()=>{ve&&$(`[data-id=${Ye}]`).removeClass("target"),Ye=null},tl=()=>{if(me=(oe=$(je)).attr("data-id"),qe=oe[0],ve){$(`[data-id=${me}]`).addClass("target");let t=$(je).parents(".page:first").data("key"),e=oe.offset().top;$(".page").trigger("align-item",{key:t,id:me,place:e})}},nl=()=>{ve&&$(".item, .action").removeClass("target"),me=null,qe=null},rl=function(t,e){let n=$(this);if(n.data("key")===e.key||(oe=n.find(`.item[data-id=${e.id}]`),!oe.length))return;let r=e.place||n.height()/2,o=oe.offset().top+n.scrollTop()-r;n.stop().animate({scrollTop:o},"slow")};ii.exports={bind:Jc}});var ci=F((Nu,ai)=>{var ol=xe(),il=be(),sl=()=>`<p>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
</p><p>
This work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  Creative Commons Attribution-ShareAlike 4.0 International License
</a>.
</p><p>
This license applies uniformly to all contributions
by all authors. Where authors quote other sources
they do so within the terms of fair use or other
compatiable terms.
</p>`,al=function(t,e){if(!t.journal)return"";let n={},r=[];for(var o of t.journal.slice(0).reverse())if(o.site&&(e=o.site),o.attribution?.site&&(e=o.attribution.site),o.type!=="fork"&&!n[e]){var s=wiki.site(e).getDirectURL(""),c=wiki.site(e).flag();r.push(`<a href="${s}" target="_blank"><img class="remote" title="${e}" src="${c}"> ${e}</a>`),n[e]=!0}return r.length>0?`<p>
  Author's Sites:
</p><p>
  ${r.join("<br>")}
</p>`:""},cl=function(t){return t?.provenance?`<p>
  Created From:
</p><p>
  ${ol.resolveLinks(t.provenance)}
</p>`:""},ll=function(t){let e=il.atKey(t.data("key")),n=e.getRawPage(),r=e.getRemoteSite(location.hostname);return sl()+al(n,r)+cl(n.journal[0])};ai.exports={info:ll}});var ui=F(()=>{var Re=Ee(),ft=ot(),Ne=rt(),ze=Mt(),he=be(),ul=Ln(),Dn=$n(),Ge=Ce(),fl=si(),dl=ci(),hl=$e(),gl=Le(),{asSlug:li}=le(),{newPage:On}=le(),pl=t=>t.filter(e=>e.editor).forEach(function(e){console.log(`${e.name} Plugin declares an editor, so pre-loading the plugin`),wiki.getPlugin(e.name.toLowerCase(),function(n){(!n.editor||typeof n.editor!="function")&&console.log(`${e.name} Plugin ERROR.
Cannot find \`editor\` function in plugin. Set \`"editor": false\` in factory.json or
Correct the plugin to include all three of \`{emit, bind, editor}\``)})});wiki.origin.get("system/factories.json",function(t,e){Array.isArray(e)&&(window.catalog=e,pl(e))});$(function(){$(document).on("keydown",function(i){let u=i.which==37?-1:i.which==39?1:null;if(u&&!$(i.target).is(":input")){let p=$(".page"),h=p.index($(".active"))+u;0<=h&&h<p.length&&Ne.set(p.eq(h))}(i.ctrlKey||i.metaKey)&&i.which===83&&(i.preventDefault(),$("input.search").trigger("focus"))}),$(window).on("popstate",ft.show),$(document).ajaxError(function(i,u,p){u.status===0||u.status===404||console.log("ajax error",i,u,p)});let n=i=>`${i}`.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),r=function(i){if(i?.type==="application/json"){let u=new FileReader;u.onload=function(p){let{result:h}=p.target,m=JSON.parse(h),x=On();if(x.setTitle(`Import from ${i.name}`),m.title&&m.story&&m.journal){let T=li(m.title),D=m;m={},m[T]=D,x.addParagraph(`Import of one page
(${n(i.size)} bytes)
from a page-json file dated ${i.lastModifiedDate}.`)}else x.addParagraph(`Import of ${Object.keys(m).length} pages
(${n(i.size)} bytes)
from an export file dated ${i.lastModifiedDate}.`);x.addItem({type:"importer",pages:m}),Ge.showResult(x)},u.readAsText(i)}},o=(i,u)=>Re.delete(i,u,function(p){if(!p)if(i.isRecycler())u.addClass("ghost");else{let h=ze.newFuturePage(i.getTitle(),i.getCreate());i.become(h),u.attr("id",h.getSlug()),ze.rebuildPage(i,u),u.addClass("ghost")}}),s=function(i,u){if(!i)return u(null);console.log("getTemplate",i),Re.get({whenGotten(p){u(p)},whenNotGotten(){u(null)},pageInformation:{slug:i}})},c=function(i,u){let p;return i.preventDefault(),i.shiftKey||(p=$(i.target).parents(".page")),Ge.doInternalLink(u,p,$(i.target).data("site")),!1},d=null;$(".main").sortable({handle:".page-handle",cursor:"grabbing"}).on("sortstart",function(i,u){if(!u.item.hasClass("page"))return;Ne.set(u.item,!0),d=$(".page").index(u.item[0])}).on("sort",function(i,u){if(!u.item.hasClass("page"))return;let p=u.item;i.pageY<0&&$(".page").length>2?p.addClass("pending-remove"):p.removeClass("pending-remove")}).on("sortstop",function(i,u){if(!u.item.hasClass("page"))return;let p=u.item,h=$(".page"),m=h.index($(".active")),x=$(".item").index(p.find(".item")[0]);if(p.hasClass("pending-remove")){if(h.length===1)return;he.removeKey(p.data("key")),p.remove(),Ne.set($(".page")[m])}else he.changePageIndex(p.data("key"),m),Ne.set($(".active")),d<m&&(m=d,x=$(".item").index($($(".page")[m]).find(".item")[0]));hl.renderFrom(x),ft.setUrl(),window.debug&&ft.debugStates()}).on("click",".show-page-license",function(i){i.preventDefault();let u=$(this).parents(".page"),p=u.find("h1").text().trim();Dn.open(`License for ${p}`,dl.info(u))}).on("click",".show-page-source",function(i){i.preventDefault();let u=$(this).parents(".page"),p=he.atKey(u.data("key")).getRawPage();Dn.open(`JSON for ${p.title}`,$("<pre/>").text(JSON.stringify(p,null,2)))}).on("click",".page",function(i){if(!$(i.target).is("a"))return Ne.set(this)}).on("click",".internal",function(i){let u=$(i.target),p=u.text()||u.data("pageName");return p=`${p}`,Re.context=$(i.target).attr("title").split(" => "),c(i,p)}).on("click","img.remote",function(i){if($(i.target).attr("src").startsWith("data:image/png")){i.preventDefault();let u=$(i.target).data("site");wiki.site(u).refresh(function(){})}else{let u=$(i.target).data("slug");return Re.context=[$(i.target).data("site")],c(i,u)}}).on("dblclick",".revision",function(i){i.preventDefault();let u=$(this).parents(".page"),p=he.atKey(u.data("key")).getRawPage(),h=p.journal.length-1,m=p.journal[h],x=JSON.stringify(m,null,2);Dn.open(`Revision ${h}, ${m.type} action`,$("<pre/>").text(x))}).on("click",".action",function(i){i.preventDefault();let u=$(i.target),p=u.data("slug");if(u.is(".fork")&&p)return Re.context=[u.data("site")],c(i,p.split("_")[0]);{let h=$(this).parents(".page"),m=h.data("key"),x=he.atKey(m).getSlug(),T=$(this).parent().children().not(".separator").index(u);if(T<0)return;i.shiftKey||h.nextAll().remove(),i.shiftKey||he.removeAllAfterKey(m),Ge.createPage(`${x}_rev${T}`,h.data("site")).appendTo($(".main")).each((D,R)=>ze.cycle($(R))),Ne.set($(".page").last())}}).on("mouseenter",".action",function(i){let u=$(i.target),{action:p}=u.data();u.attr("title",gl.formatActionTitle(p))}).on("click",".fork-page",function(i){let u=$(i.target).parents(".page");if(u.find(".future").length)return;let p=he.atKey(u.data("key"));if(u.attr("id").match(/_rev0$/))o(p,u);else{let x={type:"fork"};if(u.hasClass("local")){if(Re.useLocalStorage())return;u.removeClass("local")}else p.isRecycler()?u.removeClass("recycler"):p.isRemote()&&(x.site=p.getRemoteSite());u.data("rev")!=null&&u.find(".revision").remove(),u.removeClass("ghost"),u.attr("id",u.attr("id").replace(/_rev\d+$/,"")),ft.setUrl();let T=$(".page");for(let D=0;D<T.length;D++){var h=T[D],m=$(h).data("site");$(h).data("key")!==u.data("key")&&$(h).attr("id")===u.attr("id")&&[void 0,null,"view","origin","local","recycler",location.host].includes(m)&&$(h).addClass("ghost")}Re.put(u,x)}}).on("click","button.create",i=>s($(i.target).data("slug"),function(u){let p=$(i.target).parents(".page:first");p.removeClass("ghost");let h=he.atKey(p.data("key"));h.become(u);let m=h.getRawPage();ze.rebuildPage(h,p.empty()),Re.put(p,{type:"create",id:m.id,item:{title:m.title,story:m.story}})})).on("mouseenter mouseleave",".score",function(i){console.log("in .score..."),$(".main").trigger("thumb",$(i.target).data("thumb"))}).on("click","a.search",function(i){let u=$(i.target).parents(".page"),p=u.data("key"),h=he.atKey(p),m=On();m.setTitle(`Search from '${h.getTitle()}'`),m.addParagraph(`Search for pages related to '${h.getTitle()}'.
Each search on this page will find pages related in a different way.
Choose the search of interest. Be patient.`),m.addParagraph("Find pages with links to this title."),m.addItem({type:"search",text:`SEARCH LINKS ${h.getSlug()}`}),m.addParagraph("Find pages with titles similar to this title."),m.addItem({type:"search",text:`SEARCH SLUGS ${h.getSlug()}`}),m.addParagraph("Find pages neighboring  this site."),m.addItem({type:"search",text:`SEARCH SITES ${h.getRemoteSite(location.host)}`}),m.addParagraph("Find pages sharing any of these items."),m.addItem({type:"search",text:`SEARCH ANY ITEMS ${h.getRawPage().story.map(x=>x.id).join(" ")}`}),i.shiftKey||u.nextAll().remove(),i.shiftKey||he.removeAllAfterKey(p),Ge.showResult(m)}).on("dragenter",i=>i.preventDefault()).on("dragover",i=>i.preventDefault()).on("drop",ul.dispatch({page:i=>{Ge.doInternalLink(i.slug,null,i.site)},file:i=>{r(i)}})),$(".provider input").on("click",function(){$("footer input:first").val($(this).attr("data-provider")),$("footer form").submit()}),$("body").on("new-neighbor-done",()=>$(".page").each((i,u)=>ze.emitTwins($(u))));let f=i=>new Promise(function(u){let p=li(i);wiki.origin.get(`${p}.json`,(h,m)=>u({title:i,slug:p,type:"reference",text:(h?h.msg:m?.story[0].text)||""}))});$("<span>&nbsp; \u2630 </span>").css({cursor:"pointer"}).appendTo("footer").on("click",function(){let i=On();if(i.setTitle("Selected Plugin Pages"),i.addParagraph("Installed plugins offer these utility pages:"),!window.catalog)return;let u=[];for(var p of window.catalog)if(p.pages)for(var h of p.pages)u.push(h);Promise.all(u.map(f)).then(function(m){m.forEach(x=>i.addItem(x)),Ge.showResult(i)})}),$("<span>&nbsp; wiki <span class=editEnable>\u2714\uFE0E</span> &nbsp; </span>").css({cursor:"pointer"}).appendTo("footer").on("click",function(){$(".editEnable").toggle(),$(".page").each(function(){let i=$(this),u=he.atKey(i.data("key"));ze.rebuildPage(u,i.empty())})}),isAuthenticated||$(".editEnable").toggle(),fl.bind(),$(function(){ft.first();let i=$(".page").toArray();var u=function(p){if(p.length===0){Ne.set($(".page").last());return}let h=$(p.shift());ze.cycle(h).then(()=>u(p))};u(i)})})});var mi=F((Bu,pi)=>{var ml=Ce(),gi=Pn(),fi=Ie(),di=Le(),Ue=null,hi=0,vl=t=>Object.hasOwn(t,"links"),yl=t=>`<span class="neighbor" data-site="${t}">
<div class="wait">
  <img src="${gi.site(t).flag()}" title="${t}">
</div>
</span>`,wl=t=>Ue=t.sites,bl=function(t){let e,n="";n+=`${t}
`;try{e=Ue[t].sitemap.length}catch{e=0}try{Ue[t].sitemap.some(vl)?n+=`${e} pages with 2-way links
`:n+=`${e} pages
`}catch{console.info("+++ sitemap not valid for ",t)}return Ue[t].lastModified!==0&&(n+=`Updated ${di.formatElapsedTime(Ue[t].lastModified)}`,Ue[t].nextCheck-Date.now()>0&&(n+=`, next refresh ${di.formatDelay(Ue[t].nextCheck)}`)),n},$l=function(){let t=$(".neighborhood");$("body").on("new-neighbor",(e,n)=>t.append(yl(n))).on("new-neighbor-done",()=>{hi=Object.values(fi.sites).reduce(function(e,n){try{return n.sitemapRequestInflight?e:e+n.sitemap.length}catch{return e}},0),$(".searchbox .pages").text(`${hi} pages`)}).on("mouseenter",".neighbor",function(e){let n=$(e.currentTarget),{site:r}=n.data();n.find("img:first").attr("title",bl(r))}).on("click",".neighbor img",function(e){if($(e.target).parent().hasClass("fail")){$(e.target).parent().removeClass("fail").addClass("wait");let n=$(e.target).attr("title").split(`
`)[0];gi.site(n).refresh(function(){console.log("about to retry neighbor"),fi.retryNeighbor(n)})}else ml.doInternalLink("welcome-visitors",null,this.title.split(`
`)[0])})};pi.exports={inject:wl,bind:$l}});var $i=F((Wu,bi)=>{var vi=Ee(),Mn=De(),wi=Ce(),{newPage:xl}=le(),Fn=xe(),qn=le(),_l=t=>JSON.parse(JSON.stringify(t)),Sl=function(t,e){let n=e.slug;e.title&&(n||=qn.asSlug(e.title)),n||="welcome-visitors";let r=e.site;Fn.resolveFrom(r,()=>t.append(`<p>
<img class='remote'
  src='${wiki.site(r).flag()}'
  title='${r}'
  data-site="${r}"
  data-slug="${n}"
>
${Fn.resolveLinks(`[[${e.title||n}]]`)}
\u2014
${Fn.resolveLinks(e.text)}
</p>`))},yi=function(t,e){return t.preventDefault(),t.shiftKey||(qn=$(t.target).parents(".page")),wi.doInternalLink(e,qn,$(t.target).data("site")),!1},kl=function({neighborhood:t}){return{incrementalSearch:function(r){if(r.length<2){$(".incremental-search").remove();return}if($(".incremental-search").length===0){let p=$(".searchbox").position();$("<div/>").css("left",`${p.left}px`).css("bottom",`${p.top+$(".searchbox").height()}px`).addClass("incremental-search").on("click",".internal",function(h){h.target.nodeName==="SPAN"&&(h.target=$(h.target).parent()[0]);let m=$(h.target).data("pageName");return m=`${m}`,vi.context=$(h.target).attr("title").split(" => "),yi(h,m)}).on("click","img.remote",function(h){if($(h.target).attr("src").startsWith("data:image/png")){h.preventDefault();let m=$(h.target).data("site");wiki.site(m).refresh(function(){})}else{let m=$(h.target).data("slug");return vi.context=[$(h.target).data("site")],yi(h,m)}return!1}).appendTo($(".searchbox"))}let o=t.search(r),s=r.split(" ").map(p=>p.toLowerCase()).filter(String),c=new RegExp("\\b("+r.split(" ").map(p=>p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).filter(String).join("|")+")","i"),d=p=>p.split(c).map(function(h){return s.includes(h.toLowerCase())?`{{${h}}}`:h}).join(""),f=$(".incremental-search").empty();(!o.finds||o.finds.length===0)&&$("<div/>").text("No results found").addClass("no-results").appendTo(f);let i=0,u=100;for(let p of o.finds){if(i++,i===u+1&&$("<div/>").text(`${o.finds.length-u} results omitted`).addClass("omitted-results").appendTo(f),i>u)continue;let h=$("<div/>").appendTo(f),m={id:Mn.itemId(),type:"reference",site:p.site,slug:p.page.slug,title:d(p.page.title),text:d(p.page.synopsis)};Sl(h,m),h.html(h.html().split(new RegExp("({{.*?}})","i")).map(x=>x.indexOf("{{")===0?`<span class='search-term'>${x.substring(2,x.length-2)}</span>`:x).join(""))}},performSearch:function(r){let o=t.search(r);if(o.finds&&o.finds.length===1){$(".incremental-search").find(".internal").trigger("click"),$(".incremental-search").remove();return}$(".incremental-search").remove();let{tally:s}=o,c={};c.title=`Search for '${r}'`,c.story=[],c.story.push({type:"paragraph",id:Mn.itemId(),text:`String '${r}' found on ${s.finds||"none"} of ${s.pages||"no"} pages from ${s.sites||"no"} sites.
Text matched on ${s.title||"no"} titles, ${s.text||"no"} paragraphs, and ${s.slug||"no"} slugs.
Elapsed time ${s.msec} milliseconds.`});for(var d of o.finds)c.story.push({id:Mn.itemId(),type:"reference",site:d.site,slug:d.page.slug,title:d.page.title,text:d.page.synopsis||""});c.journal=[{type:"create",item:{title:c.title,story:_l(c.story)},date:Date.now()}];let f=xl(c);wi.showResult(f)}}};bi.exports=kl});var _i=F((Ku,xi)=>{var Il=$i(),qt=null,El=t=>qt=Il({neighborhood:t}),Tl=function(){return $("input.search").attr("autocomplete","off"),$("input.search").on("keydown",function(t){t.keyCode===27&&$(".incremental-search").remove()}),$("input.search").on("keypress",function(t){if(t.keyCode!==13)return;let e=$(this).val();qt.performSearch(e),$(this).val("")}),$("input.search").on("focus",function(){let t=$(this).val();qt.incrementalSearch(t)}),$("input.search").on("input",function(){let t=$(this).val();qt.incrementalSearch(t)})};xi.exports={inject:El,bind:Tl}});var Ii=F(()=>{var jn=Ie(),Si=mi(),ki=_i(),Cl=ot(),Rl=Ce();$(function(){ki.inject(jn),ki.bind(),Si.inject(jn),Si.bind(),window.seedNeighbors&&window.seedNeighbors.split(",").forEach(t=>jn.registerNeighbor(t.trim())),Cl.inject(Rl)})});var Ti=F((Yu,Ei)=>{var Al=lt(),Nn=xe(),Pl=le(),Ll=function(t,e){let n=e.slug;!n&&e.title&&(n=Pl.asSlug(e.title)),n||(n="welcome-visitors");let r=e.site;Nn.resolveFrom(r,()=>t.append(`
<p>
<img class='remote'
  src='${wiki.site(r).flag()}'
  title='${r}'
  data-site="${r}"
  data-slug="${n}"
>
${Nn.resolveLinks(`[[${e.title||n}]]`)}
\u2014
${Nn.resolveLinks(e.text)}
</p>`))},Dl=(t,e)=>t.on("dblclick",()=>Al.textEditor(t,e));Ei.exports={emit:Ll,bind:Dl}});var Ri=F((Hu,Ci)=>{var Ol=Ie(),Ml=$e(),Fl=xe(),ql=Ee(),jt=lt(),jl=_t(),Nl=Ln(),zl=rt(),Ul=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),Bl=function(t,e){t.append("<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>");let n=function(){let o=t.find("p").append(`<br>Or Choose a Plugin
<center>
<table style="text-align:left;">
<tr><td><ul id=format><td><ul id=data><td><ul id=other>`);for(var s of window.catalog)if(s&&s.category){var c=s.category;["format","data"].includes(c)||(c="other"),o.find("#"+c).append(`<li><a class="menu" href="#" title="${s.title}">${s.name}</a></li>`)}o.find("a.menu").on("click",function(d){let f=d.target.text,i=f.toLowerCase();if(t.removeClass("factory").addClass(e.type=i),t.off(),d.preventDefault(),zl.set(t.parents(".page")),window.catalog.find(p=>f===p.name).editor)try{window.plugins[i].editor(t,e)}catch(p){console.log(`${f} Plugin editor failed: ${p}. Falling back to textEditor`),jt.textEditor(t,e)}else jt.textEditor(t,e)})},r=()=>t.append(`<p>${Fl.resolveLinks(e.prompt,Ul)}</b>`);e.prompt?r():window.catalog?n():wiki.origin.get("system/factories.json",function(o,s){window.catalog=s,n()})},Wl=function(t,e){let n=function(){t.empty().off(),t.removeClass("factory").addClass(e.type);let i=t.parents(".page:first");try{t.data("pageElement",i),t.data("item",e),Ml.getPlugin(e.type,function(u){u.emit(t,e),u.bind(t,e)})}catch(u){t.append(`<p class='error'>${u}</p>`)}ql.put(i,{type:"edit",id:e.id,item:e})},r=function(i){e.prompt=`Unexpected Item
We can't make sense of the drop.
Try something else or see [[About Factory Plugin]].`,i.userAgent=navigator.userAgent,e.punt=i,n()},o=i=>wiki.site(i.site).get(`${i.slug}.json`,function(u,p){u||(e.type="reference",e.site=i.site,e.slug=i.slug,e.title=p.title||i.slug,e.text=jl(p),n(),e.site&&Ol.registerNeighbor(e.site))}),s=function(i){e.type="video",e.text=`${i.text}
(double-click to edit caption)
`,n()},c=function(i){document.documentElement.style.cursor="wait",fetch(i).then(function(u){if(u.ok)return u.blob();throw new Error("Unable to fetch image")}).then(function(u){let p=i.split("/").pop().split("#")[0].split("?")[0],h=new FileReader;h.readAsDataURL(u),h.onload=function(m){let x=m.target.result;window.plugins.image.editor({imageDataURL:x,filename:p,imageSourceURL:i,imageCaption:`Remote image [${i} source]`,$item:t,item:e})}})},d=function(i){document.documentElement.style.cursor="wait",fetch(i).then(function(u){if(u.ok)return u;throw new Error("Unable to fetch svg")}).then(u=>u.text()).then(function(u){document.documentElement.style.cursor="default",e.type="html",e.source=i,e.text=u+`<p>[${i} Source]</p>`,n()})},f=function(i){if(i!=null){let[u,p]=i.type.split("/"),h=new FileReader;u==="image"?p.startsWith("svg")?(h.onload=function(m){let{result:x}=m.target;e.type="html",e.text=x,n()},h.readAsText(i)):(h.onload=function(m){let x=m.target.result;window.plugins.image.editor({imageDataURL:x,filename:i.name,imageCaption:"Uploaded image",$item:t,item:e})},h.readAsDataURL(i)):u==="text"?(h.onload=function(m){let{result:x}=m.target;if(p==="csv"){let T;e.type="data",e.columns=(T=Kl(x))[0],e.data=Vl(T),e.text=i.fileName}else e.type="paragraph",e.text=x;n()},h.readAsText(i)):r({name:i.name,type:i.type,size:i.size,fileName:i.fileName,lastModified:i.lastModified})}};t.on("dblclick",function(i){if($(".editEnable").is(":visible"))return i.shiftKey?jt.textEditor(t,e,{field:"prompt"}):(t.removeClass("factory").addClass(e.type="paragraph"),t.off(),jt.textEditor(t,e))}),t.on("dragenter",i=>i.preventDefault()),t.on("dragover",i=>i.preventDefault()),t.on("drop",Nl.dispatch({page:o,file:f,video:s,image:c,svg:d,punt:r}))},Kl=function(t,e){e=e||",";let n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),r=[[]],o=null;for(;o=n.exec(t);){var s,c=o[1];c.length&&c!==e&&r.push([]),o[2]?s=o[2].replace(new RegExp('""',"g"),'"'):s=o[3],r[r.length-1].push(s)}return r},Vl=function(t){let e=t.shift(),n=function(s){let c={};return s.forEach(function(d,f){let i=e[f];d!=null&&d.match(/\S/)&&d!=="NULL"&&(c[i]=d)}),c},r=[];for(var o of t)r.push(n(o));return r};Ci.exports={emit:Bl,bind:Wl}});var Pi=F((Gu,Ai)=>{var Jl=lt(),Yl=xe(),Hl=Dt(),Gl=function(t){return t.match(/<(i|b|p|a|h\d|hr|br|li|img|div|span|table|blockquote)\b.*?>/i)?"html":"markdown"},Ql=(t,e)=>{for(var n of e.text.split(/\n\n+/))n.match(/\S/)&&t.append(`<p>${Yl.resolveLinks(n)}</p>`)},Xl=(t,e)=>t.on("dblclick",function(n){return n.shiftKey?(e.type=Gl(e.text),Hl.replaceItem(t,"paragraph",e)):Jl.textEditor(t,e,{append:!0})});Ai.exports={emit:Ql,bind:Xl}});var Di=F((Qu,Li)=>{var Zl=xe(),eu=Ie(),tu=be(),nu=Mt(),ru=function(t,e){let n,r;t.append(`${e.text}`);let o=t.parents(".page:first")[0].id;if(wiki.asSlug(e.title)!==o?t.append("<p style='font-weight: 500;'>Page titles with leading/trailing spaces cannot be used to create a new page.</p>"):t.append('<br><br><button class="create">create</button> new blank page'),(r=e.create?.source?.transport)&&(t.append(`<br><button class="transport" data-slug=${e.slug}>create</button> transport from ${r}`),t.append("<p class=caption> unavailable</p>"),$.get("//localhost:4020",()=>t.find(".caption").text("ready"))),(n=eu.sites[location.host])&&n.sitemap)for(var s of n.sitemap)s.slug.match(/-template$/)&&t.append(`<br><button class="create" data-slug=${s.slug}>create</button> from ${Zl.resolveLinks(`[[${s.title}]]`)}`);(e.context?.length>0||isSecureContext&&!location.hostname.endsWith("localhost"))&&t.append("<p>Some possible places to look for this page, if it exists.</p>");let c=!0;if(e.context?.length>0){let d=[];e.context.forEach(f=>{if(wiki.neighborhood[f].lastModified===0){let i=wiki.asSlug(e.title);d.push(`<p>
  <img class='remote'
    src='${wiki.site(f).flag()}'
    title="${f}">
  <a class='internal'
    href='http://${f}/${i}.html'
    target='_blank'>${f}</a>
</p>`)}}),d.length>0?t.append(`<div>
  <p>Try on remote wiki where it was expected to be found, opens in a new tab.</p>
  ${d.join(`
`)}
</div>`):(c=!1,t.append(`<div>
  <p>None of the expected places were unreachable.</p>
</div>`))}else c=!1;if(isSecureContext&&c&&!location.hostname.endsWith("localhost")){let d=document.URL.replace(/^https/,"http").replace(/\/\w+\/[\w-]+$/,""),f=d.length>55?d.substring(0,55)+"...":d;t.append(`<div>
  <p>Try opening lineup using http, opens in a new tab.</p>
  <p><a href="${d}" target="_blank"><img class='remote' src='/favicon.png' title='${location.host}'> ${f}</a>.</p>
</div>
<div>
  <p>
</div>`)}},ou=(t,e)=>t.find("button.transport").on("click",()=>{t.find(".caption").text("waiting");let n={title:t.parents(".page").data("data").title,create:e.create},r={type:"POST",url:e.create.source.transport,dataType:"json",contentType:"application/json",data:JSON.stringify(n)};$.ajax(r).done(function(o){t.find(".caption").text("ready");let s=wiki.newPage(o),c=t.parents(".page"),d=tu.atKey(c.data("key"));d.become(s,s),o=d.getRawPage(),nu.rebuildPage(d,c.empty())})});Li.exports={emit:ru,bind:ou}});var Mi=F((Xu,Oi)=>{var iu=Le(),su=Ce(),{newPage:au}=le(),cu=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),lu=function(t,e){let n=function(r){let o=[];for(var s in r){var c=r[s],d=`<a href=${s}>${cu(c.title)||s}</a>`;if(c.journal){var f;(f=c.journal[c.journal.length-1].date)?d+=` &nbsp; from ${iu.formatElapsedTime(f)}`:d+=` &nbsp; from revision ${c.journal.length-1}`}o.push(d)}return o.join("<br>")};return t.append(`<p style="background-color:#eee;padding:15px;">
  ${n(e.pages)}
</p>`)},uu=(t,e)=>t.find("a").on("click",function(n){let r,o=$(n.target).attr("href");n.shiftKey||(r=$(n.target).parents(".page"));let s=au(e.pages[o]);su.showResult(s,{$page:r})});Oi.exports={emit:lu,bind:uu}});var Fi=F(()=>{var dt=$e();window.plugins={reference:dt.wrap("reference",Ti()),factory:dt.wrap("factory",Ri()),paragraph:dt.wrap("paragraph",Pi()),future:dt.wrap("future",Di()),importer:dt.wrap("importer",Mi())};window.pluginSuccessor={federatedWiki:"reference",mathjax:"math"}});window.name=window.location.host;window.wiki=Pn();ui();Ii();Fi();})();
/*! Bundled license information:

localforage/dist/localforage.js:
  (*!
      localForage -- Offline Storage, Improved
      Version 1.10.0
      https://localforage.github.io/localForage
      (c) 2013-2017 Mozilla, Apache License 2.0
  *)
*/
//# sourceMappingURL=client.js.map
