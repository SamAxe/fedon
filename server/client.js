/* wiki-client - 0.31.0-decaffeinate.5 - Sun, 17 Nov 2024 16:35:54 GMT */
(()=>{var et=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var F=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ar=F((gt,sr)=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.default=Ds;function Ds(t){return function(...e){if(t===null)throw new Error("Callback was already called.");var n=t;t=null,n.apply(this,e)}}sr.exports=gt.default});var Yt=F(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.fallback=cr;Ie.wrap=lr;var Os=Ie.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,Ms=Ie.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Fs=Ie.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function cr(t){setTimeout(t,0)}function lr(t){return(e,...n)=>t(()=>e(...n))}var tt;Os?tt=queueMicrotask:Ms?tt=setImmediate:Fs?tt=process.nextTick:tt=cr;Ie.default=lr(tt)});var dr=F((pt,fr)=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});var Ht=class{constructor(){this.head=this.tail=null,this.length=0}removeLink(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e}empty(){for(;this.head;)this.shift();return this}insertAfter(e,n){n.prev=e,n.next=e.next,e.next?e.next.prev=n:this.tail=n,e.next=n,this.length+=1}insertBefore(e,n){n.prev=e.prev,n.next=e,e.prev?e.prev.next=n:this.head=n,e.prev=n,this.length+=1}unshift(e){this.head?this.insertBefore(this.head,e):ur(this,e)}push(e){this.tail?this.insertAfter(this.tail,e):ur(this,e)}shift(){return this.head&&this.removeLink(this.head)}pop(){return this.tail&&this.removeLink(this.tail)}toArray(){return[...this]}*[Symbol.iterator](){for(var e=this.head;e;)yield e.data,e=e.next}remove(e){for(var n=this.head;n;){var{next:r}=n;e(n)&&this.removeLink(n),n=r}return this}};pt.default=Ht;function ur(t,e){t.length=1,t.head=t.tail=e}fr.exports=pt.default});var gr=F((mt,hr)=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.default=function(t){return function(...e){var n=e.pop();return t.call(this,e,n)}};hr.exports=mt.default});var wr=F((vt,yr)=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.default=Bs;var qs=gr(),js=vr(qs),Ns=Yt(),zs=vr(Ns),Us=yt();function vr(t){return t&&t.__esModule?t:{default:t}}function Bs(t){return(0,Us.isAsync)(t)?function(...e){let n=e.pop(),r=t.apply(this,e);return pr(r,n)}:(0,js.default)(function(e,n){var r;try{r=t.apply(this,e)}catch(o){return n(o)}if(r&&typeof r.then=="function")return pr(r,n);n(null,r)})}function pr(t,e){return t.then(n=>{mr(e,null,n)},n=>{mr(e,n&&(n instanceof Error||n.message)?n:new Error(n))})}function mr(t,e,n){try{t(e,n)}catch(r){(0,zs.default)(o=>{throw o},r)}}yr.exports=vt.default});var yt=F(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.isAsyncIterable=we.isAsyncGenerator=we.isAsync=void 0;var Ws=wr(),Ks=Vs(Ws);function Vs(t){return t&&t.__esModule?t:{default:t}}function br(t){return t[Symbol.toStringTag]==="AsyncFunction"}function Js(t){return t[Symbol.toStringTag]==="AsyncGenerator"}function Ys(t){return typeof t[Symbol.asyncIterator]=="function"}function Hs(t){if(typeof t!="function")throw new Error("expected a function");return br(t)?(0,Ks.default)(t):t}we.default=Hs;we.isAsync=br;we.isAsyncGenerator=Js;we.isAsyncIterable=Ys});var xr=F((bt,$r)=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.default=ra;var Gs=ar(),Qs=wt(Gs),Xs=Yt(),Gt=wt(Xs),Zs=dr(),ea=wt(Zs),ta=yt(),na=wt(ta);function wt(t){return t&&t.__esModule?t:{default:t}}function ra(t,e,n){if(e==null)e=1;else if(e===0)throw new RangeError("Concurrency must not be zero");var r=(0,na.default)(t),o=0,i=[];let c={error:[],drain:[],saturated:[],unsaturated:[],empty:[]};function d(T,P){c[T].push(P)}function u(T,P){let j=(...W)=>{s(T,j),P(...W)};c[T].push(j)}function s(T,P){if(!T)return Object.keys(c).forEach(j=>c[j]=[]);if(!P)return c[T]=[];c[T]=c[T].filter(j=>j!==P)}function f(T,...P){c[T].forEach(j=>j(...P))}var m=!1;function h(T,P,j,W){if(W!=null&&typeof W!="function")throw new Error("task callback must be a function");R.started=!0;var S,O;function M(H,...G){if(H)return j?O(H):S();if(G.length<=1)return S(G[0]);S(G)}var B=R._createTaskItem(T,j?M:W||M);if(P?R._tasks.unshift(B):R._tasks.push(B),m||(m=!0,(0,Gt.default)(()=>{m=!1,R.process()})),j||!W)return new Promise((H,G)=>{S=H,O=G})}function p(T){return function(P,...j){o-=1;for(var W=0,S=T.length;W<S;W++){var O=T[W],M=i.indexOf(O);M===0?i.shift():M>0&&i.splice(M,1),O.callback(P,...j),P!=null&&f("error",P,O.data)}o<=R.concurrency-R.buffer&&f("unsaturated"),R.idle()&&f("drain"),R.process()}}function x(T){return T.length===0&&R.idle()?((0,Gt.default)(()=>f("drain")),!0):!1}let C=T=>P=>{if(!P)return new Promise((j,W)=>{u(T,(S,O)=>{if(S)return W(S);j(O)})});s(T),d(T,P)};var D=!1,R={_tasks:new ea.default,_createTaskItem(T,P){return{data:T,callback:P}},*[Symbol.iterator](){yield*R._tasks[Symbol.iterator]()},concurrency:e,payload:n,buffer:e/4,started:!1,paused:!1,push(T,P){return Array.isArray(T)?x(T)?void 0:T.map(j=>h(j,!1,!1,P)):h(T,!1,!1,P)},pushAsync(T,P){return Array.isArray(T)?x(T)?void 0:T.map(j=>h(j,!1,!0,P)):h(T,!1,!0,P)},kill(){s(),R._tasks.empty()},unshift(T,P){return Array.isArray(T)?x(T)?void 0:T.map(j=>h(j,!0,!1,P)):h(T,!0,!1,P)},unshiftAsync(T,P){return Array.isArray(T)?x(T)?void 0:T.map(j=>h(j,!0,!0,P)):h(T,!0,!0,P)},remove(T){R._tasks.remove(T)},process(){if(!D){for(D=!0;!R.paused&&o<R.concurrency&&R._tasks.length;){var T=[],P=[],j=R._tasks.length;R.payload&&(j=Math.min(j,R.payload));for(var W=0;W<j;W++){var S=R._tasks.shift();T.push(S),i.push(S),P.push(S.data)}o+=1,R._tasks.length===0&&f("empty"),o===R.concurrency&&f("saturated");var O=(0,Qs.default)(p(T));r(P,O)}D=!1}},length(){return R._tasks.length},running(){return o},workersList(){return i},idle(){return R._tasks.length+o===0},pause(){R.paused=!0},resume(){R.paused!==!1&&(R.paused=!1,(0,Gt.default)(R.process))}};return Object.defineProperties(R,{saturated:{writable:!1,value:C("saturated")},unsaturated:{writable:!1,value:C("unsaturated")},empty:{writable:!1,value:C("empty")},drain:{writable:!1,value:C("drain")},error:{writable:!1,value:C("error")}}),R}$r.exports=bt.default});var kr=F(($t,Sr)=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.default=function(t,e){var n=(0,aa.default)(t);return(0,ia.default)((r,o)=>{n(r[0],o)},e,1)};var oa=xr(),ia=_r(oa),sa=yt(),aa=_r(sa);function _r(t){return t&&t.__esModule?t:{default:t}}Sr.exports=$t.default});var Er=F((Ir,Qt)=>{(function(t){if(typeof Ir=="object"&&typeof Qt<"u")Qt.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.localforage=t()}})(function(){var t,e,n;return function r(o,i,c){function d(f,m){if(!i[f]){if(!o[f]){var h=typeof et=="function"&&et;if(!m&&h)return h(f,!0);if(u)return u(f,!0);var p=new Error("Cannot find module '"+f+"'");throw p.code="MODULE_NOT_FOUND",p}var x=i[f]={exports:{}};o[f][0].call(x.exports,function(C){var D=o[f][1][C];return d(D||C)},x,x.exports,r,o,i,c)}return i[f].exports}for(var u=typeof et=="function"&&et,s=0;s<c.length;s++)d(c[s]);return d}({1:[function(r,o,i){(function(c){"use strict";var d=c.MutationObserver||c.WebKitMutationObserver,u;if(d){var s=0,f=new d(C),m=c.document.createTextNode("");f.observe(m,{characterData:!0}),u=function(){m.data=s=++s%2}}else if(!c.setImmediate&&typeof c.MessageChannel<"u"){var h=new c.MessageChannel;h.port1.onmessage=C,u=function(){h.port2.postMessage(0)}}else"document"in c&&"onreadystatechange"in c.document.createElement("script")?u=function(){var R=c.document.createElement("script");R.onreadystatechange=function(){C(),R.onreadystatechange=null,R.parentNode.removeChild(R),R=null},c.document.documentElement.appendChild(R)}:u=function(){setTimeout(C,0)};var p,x=[];function C(){p=!0;for(var R,T,P=x.length;P;){for(T=x,x=[],R=-1;++R<P;)T[R]();P=x.length}p=!1}o.exports=D;function D(R){x.push(R)===1&&!p&&u()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,o,i){"use strict";var c=r(1);function d(){}var u={},s=["REJECTED"],f=["FULFILLED"],m=["PENDING"];o.exports=h;function h(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,S!==d&&D(this,S)}h.prototype.catch=function(S){return this.then(null,S)},h.prototype.then=function(S,O){if(typeof S!="function"&&this.state===f||typeof O!="function"&&this.state===s)return this;var M=new this.constructor(d);if(this.state!==m){var B=this.state===f?S:O;x(M,B,this.outcome)}else this.queue.push(new p(M,S,O));return M};function p(S,O,M){this.promise=S,typeof O=="function"&&(this.onFulfilled=O,this.callFulfilled=this.otherCallFulfilled),typeof M=="function"&&(this.onRejected=M,this.callRejected=this.otherCallRejected)}p.prototype.callFulfilled=function(S){u.resolve(this.promise,S)},p.prototype.otherCallFulfilled=function(S){x(this.promise,this.onFulfilled,S)},p.prototype.callRejected=function(S){u.reject(this.promise,S)},p.prototype.otherCallRejected=function(S){x(this.promise,this.onRejected,S)};function x(S,O,M){c(function(){var B;try{B=O(M)}catch(H){return u.reject(S,H)}B===S?u.reject(S,new TypeError("Cannot resolve promise with itself")):u.resolve(S,B)})}u.resolve=function(S,O){var M=R(C,O);if(M.status==="error")return u.reject(S,M.value);var B=M.value;if(B)D(S,B);else{S.state=f,S.outcome=O;for(var H=-1,G=S.queue.length;++H<G;)S.queue[H].callFulfilled(O)}return S},u.reject=function(S,O){S.state=s,S.outcome=O;for(var M=-1,B=S.queue.length;++M<B;)S.queue[M].callRejected(O);return S};function C(S){var O=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof O=="function")return function(){O.apply(S,arguments)}}function D(S,O){var M=!1;function B(ce){M||(M=!0,u.reject(S,ce))}function H(ce){M||(M=!0,u.resolve(S,ce))}function G(){O(H,B)}var ae=R(G);ae.status==="error"&&B(ae.value)}function R(S,O){var M={};try{M.value=S(O),M.status="success"}catch(B){M.status="error",M.value=B}return M}h.resolve=T;function T(S){return S instanceof this?S:u.resolve(new this(d),S)}h.reject=P;function P(S){var O=new this(d);return u.reject(O,S)}h.all=j;function j(S){var O=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var M=S.length,B=!1;if(!M)return this.resolve([]);for(var H=new Array(M),G=0,ae=-1,ce=new this(d);++ae<M;)ge(S[ae],ae);return ce;function ge(L,q){O.resolve(L).then(Q,function(J){B||(B=!0,u.reject(ce,J))});function Q(J){H[q]=J,++G===M&&!B&&(B=!0,u.resolve(ce,H))}}}h.race=W;function W(S){var O=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var M=S.length,B=!1;if(!M)return this.resolve([]);for(var H=-1,G=new this(d);++H<M;)ae(S[H]);return G;function ae(ce){O.resolve(ce).then(function(ge){B||(B=!0,u.resolve(G,ge))},function(ge){B||(B=!0,u.reject(G,ge))})}}},{1:1}],3:[function(r,o,i){(function(c){"use strict";typeof c.Promise!="function"&&(c.Promise=r(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,o,i){"use strict";var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function d(a,g){if(!(a instanceof g))throw new TypeError("Cannot call a class as a function")}function u(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var s=u();function f(){try{if(!s||!s.open)return!1;var a=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),g=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!a||g)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function m(a,g){a=a||[],g=g||{};try{return new Blob(a,g)}catch(v){if(v.name!=="TypeError")throw v;for(var l=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,y=new l,w=0;w<a.length;w+=1)y.append(a[w]);return y.getBlob(g.type)}}typeof Promise>"u"&&r(3);var h=Promise;function p(a,g){g&&a.then(function(l){g(null,l)},function(l){g(l)})}function x(a,g,l){typeof g=="function"&&a.then(g),typeof l=="function"&&a.catch(l)}function C(a){return typeof a!="string"&&(console.warn(a+" used as a key, but it is not a string."),a=String(a)),a}function D(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var R="local-forage-detect-blob-support",T=void 0,P={},j=Object.prototype.toString,W="readonly",S="readwrite";function O(a){for(var g=a.length,l=new ArrayBuffer(g),y=new Uint8Array(l),w=0;w<g;w++)y[w]=a.charCodeAt(w);return l}function M(a){return new h(function(g){var l=a.transaction(R,S),y=m([""]);l.objectStore(R).put(y,"key"),l.onabort=function(w){w.preventDefault(),w.stopPropagation(),g(!1)},l.oncomplete=function(){var w=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);g(v||!w||parseInt(w[1],10)>=43)}}).catch(function(){return!1})}function B(a){return typeof T=="boolean"?h.resolve(T):M(a).then(function(g){return T=g,T})}function H(a){var g=P[a.name],l={};l.promise=new h(function(y,w){l.resolve=y,l.reject=w}),g.deferredOperations.push(l),g.dbReady?g.dbReady=g.dbReady.then(function(){return l.promise}):g.dbReady=l.promise}function G(a){var g=P[a.name],l=g.deferredOperations.pop();if(l)return l.resolve(),l.promise}function ae(a,g){var l=P[a.name],y=l.deferredOperations.pop();if(y)return y.reject(g),y.promise}function ce(a,g){return new h(function(l,y){if(P[a.name]=P[a.name]||me(),a.db)if(g)H(a),a.db.close();else return l(a.db);var w=[a.name];g&&w.push(a.version);var v=s.open.apply(s,w);g&&(v.onupgradeneeded=function(b){var _=v.result;try{_.createObjectStore(a.storeName),b.oldVersion<=1&&_.createObjectStore(R)}catch(k){if(k.name==="ConstraintError")console.warn('The database "'+a.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+a.storeName+'" already exists.');else throw k}}),v.onerror=function(b){b.preventDefault(),y(v.error)},v.onsuccess=function(){var b=v.result;b.onversionchange=function(_){_.target.close()},l(b),G(a)}})}function ge(a){return ce(a,!1)}function L(a){return ce(a,!0)}function q(a,g){if(!a.db)return!0;var l=!a.db.objectStoreNames.contains(a.storeName),y=a.version<a.db.version,w=a.version>a.db.version;if(y&&(a.version!==g&&console.warn('The database "'+a.name+`" can't be downgraded from version `+a.db.version+" to version "+a.version+"."),a.version=a.db.version),w||l){if(l){var v=a.db.version+1;v>a.version&&(a.version=v)}return!0}return!1}function Q(a){return new h(function(g,l){var y=new FileReader;y.onerror=l,y.onloadend=function(w){var v=btoa(w.target.result||"");g({__local_forage_encoded_blob:!0,data:v,type:a.type})},y.readAsBinaryString(a)})}function J(a){var g=O(atob(a.data));return m([g],{type:a.type})}function ne(a){return a&&a.__local_forage_encoded_blob}function pe(a){var g=this,l=g._initReady().then(function(){var y=P[g._dbInfo.name];if(y&&y.dbReady)return y.dbReady});return x(l,a,a),l}function Be(a){H(a);for(var g=P[a.name],l=g.forages,y=0;y<l.length;y++){var w=l[y];w._dbInfo.db&&(w._dbInfo.db.close(),w._dbInfo.db=null)}return a.db=null,ge(a).then(function(v){return a.db=v,q(a)?L(a):v}).then(function(v){a.db=g.db=v;for(var b=0;b<l.length;b++)l[b]._dbInfo.db=v}).catch(function(v){throw ae(a,v),v})}function ie(a,g,l,y){y===void 0&&(y=1);try{var w=a.db.transaction(a.storeName,g);l(null,w)}catch(v){if(y>0&&(!a.db||v.name==="InvalidStateError"||v.name==="NotFoundError"))return h.resolve().then(function(){if(!a.db||v.name==="NotFoundError"&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),L(a)}).then(function(){return Be(a).then(function(){ie(a,g,l,y-1)})}).catch(l);l(v)}}function me(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Fi(a){var g=this,l={db:null};if(a)for(var y in a)l[y]=a[y];var w=P[l.name];w||(w=me(),P[l.name]=w),w.forages.push(g),g._initReady||(g._initReady=g.ready,g.ready=pe);var v=[];function b(){return h.resolve()}for(var _=0;_<w.forages.length;_++){var k=w.forages[_];k!==g&&v.push(k._initReady().catch(b))}var I=w.forages.slice(0);return h.all(v).then(function(){return l.db=w.db,ge(l)}).then(function(E){return l.db=E,q(l,g._defaultConfig.version)?L(l):E}).then(function(E){l.db=w.db=E,g._dbInfo=l;for(var A=0;A<I.length;A++){var N=I[A];N!==g&&(N._dbInfo.db=l.db,N._dbInfo.version=l.version)}})}function qi(a,g){var l=this;a=C(a);var y=new h(function(w,v){l.ready().then(function(){ie(l._dbInfo,W,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=k.get(a);I.onsuccess=function(){var E=I.result;E===void 0&&(E=null),ne(E)&&(E=J(E)),w(E)},I.onerror=function(){v(I.error)}}catch(E){v(E)}})}).catch(v)});return p(y,g),y}function ji(a,g){var l=this,y=new h(function(w,v){l.ready().then(function(){ie(l._dbInfo,W,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=k.openCursor(),E=1;I.onsuccess=function(){var A=I.result;if(A){var N=A.value;ne(N)&&(N=J(N));var K=a(N,A.key,E++);K!==void 0?w(K):A.continue()}else w()},I.onerror=function(){v(I.error)}}catch(A){v(A)}})}).catch(v)});return p(y,g),y}function Ni(a,g,l){var y=this;a=C(a);var w=new h(function(v,b){var _;y.ready().then(function(){return _=y._dbInfo,j.call(g)==="[object Blob]"?B(_.db).then(function(k){return k?g:Q(g)}):g}).then(function(k){ie(y._dbInfo,S,function(I,E){if(I)return b(I);try{var A=E.objectStore(y._dbInfo.storeName);k===null&&(k=void 0);var N=A.put(k,a);E.oncomplete=function(){k===void 0&&(k=null),v(k)},E.onabort=E.onerror=function(){var K=N.error?N.error:N.transaction.error;b(K)}}catch(K){b(K)}})}).catch(b)});return p(w,l),w}function zi(a,g){var l=this;a=C(a);var y=new h(function(w,v){l.ready().then(function(){ie(l._dbInfo,S,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=k.delete(a);_.oncomplete=function(){w()},_.onerror=function(){v(I.error)},_.onabort=function(){var E=I.error?I.error:I.transaction.error;v(E)}}catch(E){v(E)}})}).catch(v)});return p(y,g),y}function Ui(a){var g=this,l=new h(function(y,w){g.ready().then(function(){ie(g._dbInfo,S,function(v,b){if(v)return w(v);try{var _=b.objectStore(g._dbInfo.storeName),k=_.clear();b.oncomplete=function(){y()},b.onabort=b.onerror=function(){var I=k.error?k.error:k.transaction.error;w(I)}}catch(I){w(I)}})}).catch(w)});return p(l,a),l}function Bi(a){var g=this,l=new h(function(y,w){g.ready().then(function(){ie(g._dbInfo,W,function(v,b){if(v)return w(v);try{var _=b.objectStore(g._dbInfo.storeName),k=_.count();k.onsuccess=function(){y(k.result)},k.onerror=function(){w(k.error)}}catch(I){w(I)}})}).catch(w)});return p(l,a),l}function Wi(a,g){var l=this,y=new h(function(w,v){if(a<0){w(null);return}l.ready().then(function(){ie(l._dbInfo,W,function(b,_){if(b)return v(b);try{var k=_.objectStore(l._dbInfo.storeName),I=!1,E=k.openKeyCursor();E.onsuccess=function(){var A=E.result;if(!A){w(null);return}a===0||I?w(A.key):(I=!0,A.advance(a))},E.onerror=function(){v(E.error)}}catch(A){v(A)}})}).catch(v)});return p(y,g),y}function Ki(a){var g=this,l=new h(function(y,w){g.ready().then(function(){ie(g._dbInfo,W,function(v,b){if(v)return w(v);try{var _=b.objectStore(g._dbInfo.storeName),k=_.openKeyCursor(),I=[];k.onsuccess=function(){var E=k.result;if(!E){y(I);return}I.push(E.key),E.continue()},k.onerror=function(){w(k.error)}}catch(E){w(E)}})}).catch(w)});return p(l,a),l}function Vi(a,g){g=D.apply(this,arguments);var l=this.config();a=typeof a!="function"&&a||{},a.name||(a.name=a.name||l.name,a.storeName=a.storeName||l.storeName);var y=this,w;if(!a.name)w=h.reject("Invalid arguments");else{var v=a.name===l.name&&y._dbInfo.db,b=v?h.resolve(y._dbInfo.db):ge(a).then(function(_){var k=P[a.name],I=k.forages;k.db=_;for(var E=0;E<I.length;E++)I[E]._dbInfo.db=_;return _});a.storeName?w=b.then(function(_){if(_.objectStoreNames.contains(a.storeName)){var k=_.version+1;H(a);var I=P[a.name],E=I.forages;_.close();for(var A=0;A<E.length;A++){var N=E[A];N._dbInfo.db=null,N._dbInfo.version=k}var K=new h(function(V,te){var X=s.open(a.name,k);X.onerror=function(ue){var Ze=X.result;Ze.close(),te(ue)},X.onupgradeneeded=function(){var ue=X.result;ue.deleteObjectStore(a.storeName)},X.onsuccess=function(){var ue=X.result;ue.close(),V(ue)}});return K.then(function(V){I.db=V;for(var te=0;te<E.length;te++){var X=E[te];X._dbInfo.db=V,G(X._dbInfo)}}).catch(function(V){throw(ae(a,V)||h.resolve()).catch(function(){}),V})}}):w=b.then(function(_){H(a);var k=P[a.name],I=k.forages;_.close();for(var E=0;E<I.length;E++){var A=I[E];A._dbInfo.db=null}var N=new h(function(K,V){var te=s.deleteDatabase(a.name);te.onerror=function(){var X=te.result;X&&X.close(),V(te.error)},te.onblocked=function(){console.warn('dropInstance blocked for database "'+a.name+'" until all open connections are closed')},te.onsuccess=function(){var X=te.result;X&&X.close(),K(X)}});return N.then(function(K){k.db=K;for(var V=0;V<I.length;V++){var te=I[V];G(te._dbInfo)}}).catch(function(K){throw(ae(a,K)||h.resolve()).catch(function(){}),K})})}return p(w,g),w}var Ji={_driver:"asyncStorage",_initStorage:Fi,_support:f(),iterate:ji,getItem:qi,setItem:Ni,removeItem:zi,clear:Ui,length:Bi,key:Wi,keys:Ki,dropInstance:Vi};function Yi(){return typeof openDatabase=="function"}var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hi="~~local_forage_type~",zn=/^~~local_forage_type~([^~]+)~/,dt="__lfsc__:",jt=dt.length,Nt="arbf",zt="blob",Un="si08",Bn="ui08",Wn="uic8",Kn="si16",Vn="si32",Jn="ur16",Yn="ui32",Hn="fl32",Gn="fl64",Qn=jt+Nt.length,Xn=Object.prototype.toString;function Zn(a){var g=a.length*.75,l=a.length,y,w=0,v,b,_,k;a[a.length-1]==="="&&(g--,a[a.length-2]==="="&&g--);var I=new ArrayBuffer(g),E=new Uint8Array(I);for(y=0;y<l;y+=4)v=Se.indexOf(a[y]),b=Se.indexOf(a[y+1]),_=Se.indexOf(a[y+2]),k=Se.indexOf(a[y+3]),E[w++]=v<<2|b>>4,E[w++]=(b&15)<<4|_>>2,E[w++]=(_&3)<<6|k&63;return I}function Ut(a){var g=new Uint8Array(a),l="",y;for(y=0;y<g.length;y+=3)l+=Se[g[y]>>2],l+=Se[(g[y]&3)<<4|g[y+1]>>4],l+=Se[(g[y+1]&15)<<2|g[y+2]>>6],l+=Se[g[y+2]&63];return g.length%3===2?l=l.substring(0,l.length-1)+"=":g.length%3===1&&(l=l.substring(0,l.length-2)+"=="),l}function Gi(a,g){var l="";if(a&&(l=Xn.call(a)),a&&(l==="[object ArrayBuffer]"||a.buffer&&Xn.call(a.buffer)==="[object ArrayBuffer]")){var y,w=dt;a instanceof ArrayBuffer?(y=a,w+=Nt):(y=a.buffer,l==="[object Int8Array]"?w+=Un:l==="[object Uint8Array]"?w+=Bn:l==="[object Uint8ClampedArray]"?w+=Wn:l==="[object Int16Array]"?w+=Kn:l==="[object Uint16Array]"?w+=Jn:l==="[object Int32Array]"?w+=Vn:l==="[object Uint32Array]"?w+=Yn:l==="[object Float32Array]"?w+=Hn:l==="[object Float64Array]"?w+=Gn:g(new Error("Failed to get type for BinaryArray"))),g(w+Ut(y))}else if(l==="[object Blob]"){var v=new FileReader;v.onload=function(){var b=Hi+a.type+"~"+Ut(this.result);g(dt+zt+b)},v.readAsArrayBuffer(a)}else try{g(JSON.stringify(a))}catch(b){console.error("Couldn't convert value into a JSON string: ",a),g(null,b)}}function Qi(a){if(a.substring(0,jt)!==dt)return JSON.parse(a);var g=a.substring(Qn),l=a.substring(jt,Qn),y;if(l===zt&&zn.test(g)){var w=g.match(zn);y=w[1],g=g.substring(w[0].length)}var v=Zn(g);switch(l){case Nt:return v;case zt:return m([v],{type:y});case Un:return new Int8Array(v);case Bn:return new Uint8Array(v);case Wn:return new Uint8ClampedArray(v);case Kn:return new Int16Array(v);case Jn:return new Uint16Array(v);case Vn:return new Int32Array(v);case Yn:return new Uint32Array(v);case Hn:return new Float32Array(v);case Gn:return new Float64Array(v);default:throw new Error("Unkown type: "+l)}}var Bt={serialize:Gi,deserialize:Qi,stringToBuffer:Zn,bufferToString:Ut};function er(a,g,l,y){a.executeSql("CREATE TABLE IF NOT EXISTS "+g.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],l,y)}function Xi(a){var g=this,l={db:null};if(a)for(var y in a)l[y]=typeof a[y]!="string"?a[y].toString():a[y];var w=new h(function(v,b){try{l.db=openDatabase(l.name,String(l.version),l.description,l.size)}catch(_){return b(_)}l.db.transaction(function(_){er(_,l,function(){g._dbInfo=l,v()},function(k,I){b(I)})},b)});return l.serializer=Bt,w}function ke(a,g,l,y,w,v){a.executeSql(l,y,w,function(b,_){_.code===_.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[g.storeName],function(k,I){I.rows.length?v(k,_):er(k,g,function(){k.executeSql(l,y,w,v)},v)},v):v(b,_)},v)}function Zi(a,g){var l=this;a=C(a);var y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){ke(_,b,"SELECT * FROM "+b.storeName+" WHERE key = ? LIMIT 1",[a],function(k,I){var E=I.rows.length?I.rows.item(0).value:null;E&&(E=b.serializer.deserialize(E)),w(E)},function(k,I){v(I)})})}).catch(v)});return p(y,g),y}function es(a,g){var l=this,y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){ke(_,b,"SELECT * FROM "+b.storeName,[],function(k,I){for(var E=I.rows,A=E.length,N=0;N<A;N++){var K=E.item(N),V=K.value;if(V&&(V=b.serializer.deserialize(V)),V=a(V,K.key,N+1),V!==void 0){w(V);return}}w()},function(k,I){v(I)})})}).catch(v)});return p(y,g),y}function tr(a,g,l,y){var w=this;a=C(a);var v=new h(function(b,_){w.ready().then(function(){g===void 0&&(g=null);var k=g,I=w._dbInfo;I.serializer.serialize(g,function(E,A){A?_(A):I.db.transaction(function(N){ke(N,I,"INSERT OR REPLACE INTO "+I.storeName+" (key, value) VALUES (?, ?)",[a,E],function(){b(k)},function(K,V){_(V)})},function(N){if(N.code===N.QUOTA_ERR){if(y>0){b(tr.apply(w,[a,k,l,y-1]));return}_(N)}})})}).catch(_)});return p(v,l),v}function ts(a,g,l){return tr.apply(this,[a,g,l,1])}function ns(a,g){var l=this;a=C(a);var y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){ke(_,b,"DELETE FROM "+b.storeName+" WHERE key = ?",[a],function(){w()},function(k,I){v(I)})})}).catch(v)});return p(y,g),y}function rs(a){var g=this,l=new h(function(y,w){g.ready().then(function(){var v=g._dbInfo;v.db.transaction(function(b){ke(b,v,"DELETE FROM "+v.storeName,[],function(){y()},function(_,k){w(k)})})}).catch(w)});return p(l,a),l}function os(a){var g=this,l=new h(function(y,w){g.ready().then(function(){var v=g._dbInfo;v.db.transaction(function(b){ke(b,v,"SELECT COUNT(key) as c FROM "+v.storeName,[],function(_,k){var I=k.rows.item(0).c;y(I)},function(_,k){w(k)})})}).catch(w)});return p(l,a),l}function is(a,g){var l=this,y=new h(function(w,v){l.ready().then(function(){var b=l._dbInfo;b.db.transaction(function(_){ke(_,b,"SELECT key FROM "+b.storeName+" WHERE id = ? LIMIT 1",[a+1],function(k,I){var E=I.rows.length?I.rows.item(0).key:null;w(E)},function(k,I){v(I)})})}).catch(v)});return p(y,g),y}function ss(a){var g=this,l=new h(function(y,w){g.ready().then(function(){var v=g._dbInfo;v.db.transaction(function(b){ke(b,v,"SELECT key FROM "+v.storeName,[],function(_,k){for(var I=[],E=0;E<k.rows.length;E++)I.push(k.rows.item(E).key);y(I)},function(_,k){w(k)})})}).catch(w)});return p(l,a),l}function as(a){return new h(function(g,l){a.transaction(function(y){y.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(w,v){for(var b=[],_=0;_<v.rows.length;_++)b.push(v.rows.item(_).name);g({db:a,storeNames:b})},function(w,v){l(v)})},function(y){l(y)})})}function cs(a,g){g=D.apply(this,arguments);var l=this.config();a=typeof a!="function"&&a||{},a.name||(a.name=a.name||l.name,a.storeName=a.storeName||l.storeName);var y=this,w;return a.name?w=new h(function(v){var b;a.name===l.name?b=y._dbInfo.db:b=openDatabase(a.name,"","",0),a.storeName?v({db:b,storeNames:[a.storeName]}):v(as(b))}).then(function(v){return new h(function(b,_){v.db.transaction(function(k){function I(K){return new h(function(V,te){k.executeSql("DROP TABLE IF EXISTS "+K,[],function(){V()},function(X,ue){te(ue)})})}for(var E=[],A=0,N=v.storeNames.length;A<N;A++)E.push(I(v.storeNames[A]));h.all(E).then(function(){b()}).catch(function(K){_(K)})},function(k){_(k)})})}):w=h.reject("Invalid arguments"),p(w,g),w}var ls={_driver:"webSQLStorage",_initStorage:Xi,_support:Yi(),iterate:es,getItem:Zi,setItem:ts,removeItem:ns,clear:rs,length:os,key:is,keys:ss,dropInstance:cs};function us(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function nr(a,g){var l=a.name+"/";return a.storeName!==g.storeName&&(l+=a.storeName+"/"),l}function fs(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch{return!0}}function ds(){return!fs()||localStorage.length>0}function hs(a){var g=this,l={};if(a)for(var y in a)l[y]=a[y];return l.keyPrefix=nr(a,g._defaultConfig),ds()?(g._dbInfo=l,l.serializer=Bt,h.resolve()):h.reject()}function gs(a){var g=this,l=g.ready().then(function(){for(var y=g._dbInfo.keyPrefix,w=localStorage.length-1;w>=0;w--){var v=localStorage.key(w);v.indexOf(y)===0&&localStorage.removeItem(v)}});return p(l,a),l}function ps(a,g){var l=this;a=C(a);var y=l.ready().then(function(){var w=l._dbInfo,v=localStorage.getItem(w.keyPrefix+a);return v&&(v=w.serializer.deserialize(v)),v});return p(y,g),y}function ms(a,g){var l=this,y=l.ready().then(function(){for(var w=l._dbInfo,v=w.keyPrefix,b=v.length,_=localStorage.length,k=1,I=0;I<_;I++){var E=localStorage.key(I);if(E.indexOf(v)===0){var A=localStorage.getItem(E);if(A&&(A=w.serializer.deserialize(A)),A=a(A,E.substring(b),k++),A!==void 0)return A}}});return p(y,g),y}function vs(a,g){var l=this,y=l.ready().then(function(){var w=l._dbInfo,v;try{v=localStorage.key(a)}catch{v=null}return v&&(v=v.substring(w.keyPrefix.length)),v});return p(y,g),y}function ys(a){var g=this,l=g.ready().then(function(){for(var y=g._dbInfo,w=localStorage.length,v=[],b=0;b<w;b++){var _=localStorage.key(b);_.indexOf(y.keyPrefix)===0&&v.push(_.substring(y.keyPrefix.length))}return v});return p(l,a),l}function ws(a){var g=this,l=g.keys().then(function(y){return y.length});return p(l,a),l}function bs(a,g){var l=this;a=C(a);var y=l.ready().then(function(){var w=l._dbInfo;localStorage.removeItem(w.keyPrefix+a)});return p(y,g),y}function $s(a,g,l){var y=this;a=C(a);var w=y.ready().then(function(){g===void 0&&(g=null);var v=g;return new h(function(b,_){var k=y._dbInfo;k.serializer.serialize(g,function(I,E){if(E)_(E);else try{localStorage.setItem(k.keyPrefix+a,I),b(v)}catch(A){(A.name==="QuotaExceededError"||A.name==="NS_ERROR_DOM_QUOTA_REACHED")&&_(A),_(A)}})})});return p(w,l),w}function xs(a,g){if(g=D.apply(this,arguments),a=typeof a!="function"&&a||{},!a.name){var l=this.config();a.name=a.name||l.name,a.storeName=a.storeName||l.storeName}var y=this,w;return a.name?w=new h(function(v){a.storeName?v(nr(a,y._defaultConfig)):v(a.name+"/")}).then(function(v){for(var b=localStorage.length-1;b>=0;b--){var _=localStorage.key(b);_.indexOf(v)===0&&localStorage.removeItem(_)}}):w=h.reject("Invalid arguments"),p(w,g),w}var _s={_driver:"localStorageWrapper",_initStorage:hs,_support:us(),iterate:ms,getItem:ps,setItem:$s,removeItem:bs,clear:gs,length:ws,key:vs,keys:ys,dropInstance:xs},Ss=function(g,l){return g===l||typeof g=="number"&&typeof l=="number"&&isNaN(g)&&isNaN(l)},ks=function(g,l){for(var y=g.length,w=0;w<y;){if(Ss(g[w],l))return!0;w++}return!1},rr=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},Xe={},or={},We={INDEXEDDB:Ji,WEBSQL:ls,LOCALSTORAGE:_s},Is=[We.INDEXEDDB._driver,We.WEBSQL._driver,We.LOCALSTORAGE._driver],ht=["dropInstance"],Wt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ht),Es={description:"",driver:Is.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Cs(a,g){a[g]=function(){var l=arguments;return a.ready().then(function(){return a[g].apply(a,l)})}}function Kt(){for(var a=1;a<arguments.length;a++){var g=arguments[a];if(g)for(var l in g)g.hasOwnProperty(l)&&(rr(g[l])?arguments[0][l]=g[l].slice():arguments[0][l]=g[l])}return arguments[0]}var Ts=function(){function a(g){d(this,a);for(var l in We)if(We.hasOwnProperty(l)){var y=We[l],w=y._driver;this[l]=w,Xe[w]||this.defineDriver(y)}this._defaultConfig=Kt({},Es),this._config=Kt({},this._defaultConfig,g),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(l){if((typeof l>"u"?"undefined":c(l))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var y in l){if(y==="storeName"&&(l[y]=l[y].replace(/\W/g,"_")),y==="version"&&typeof l[y]!="number")return new Error("Database version must be a number.");this._config[y]=l[y]}return"driver"in l&&l.driver?this.setDriver(this._config.driver):!0}else return typeof l=="string"?this._config[l]:this._config},a.prototype.defineDriver=function(l,y,w){var v=new h(function(b,_){try{var k=l._driver,I=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!l._driver){_(I);return}for(var E=Wt.concat("_initStorage"),A=0,N=E.length;A<N;A++){var K=E[A],V=!ks(ht,K);if((V||l[K])&&typeof l[K]!="function"){_(I);return}}var te=function(){for(var Ze=function(Ps){return function(){var Ls=new Error("Method "+Ps+" is not implemented by the current driver"),ir=h.reject(Ls);return p(ir,arguments[arguments.length-1]),ir}},Vt=0,As=ht.length;Vt<As;Vt++){var Jt=ht[Vt];l[Jt]||(l[Jt]=Ze(Jt))}};te();var X=function(Ze){Xe[k]&&console.info("Redefining LocalForage driver: "+k),Xe[k]=l,or[k]=Ze,b()};"_support"in l?l._support&&typeof l._support=="function"?l._support().then(X,_):X(!!l._support):X(!0)}catch(ue){_(ue)}});return x(v,y,w),v},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(l,y,w){var v=Xe[l]?h.resolve(Xe[l]):h.reject(new Error("Driver not found."));return x(v,y,w),v},a.prototype.getSerializer=function(l){var y=h.resolve(Bt);return x(y,l),y},a.prototype.ready=function(l){var y=this,w=y._driverSet.then(function(){return y._ready===null&&(y._ready=y._initDriver()),y._ready});return x(w,l,l),w},a.prototype.setDriver=function(l,y,w){var v=this;rr(l)||(l=[l]);var b=this._getSupportedDrivers(l);function _(){v._config.driver=v.driver()}function k(A){return v._extend(A),_(),v._ready=v._initStorage(v._config),v._ready}function I(A){return function(){var N=0;function K(){for(;N<A.length;){var V=A[N];return N++,v._dbInfo=null,v._ready=null,v.getDriver(V).then(k).catch(K)}_();var te=new Error("No available storage method found.");return v._driverSet=h.reject(te),v._driverSet}return K()}}var E=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=E.then(function(){var A=b[0];return v._dbInfo=null,v._ready=null,v.getDriver(A).then(function(N){v._driver=N._driver,_(),v._wrapLibraryMethodsWithReady(),v._initDriver=I(b)})}).catch(function(){_();var A=new Error("No available storage method found.");return v._driverSet=h.reject(A),v._driverSet}),x(this._driverSet,y,w),this._driverSet},a.prototype.supports=function(l){return!!or[l]},a.prototype._extend=function(l){Kt(this,l)},a.prototype._getSupportedDrivers=function(l){for(var y=[],w=0,v=l.length;w<v;w++){var b=l[w];this.supports(b)&&y.push(b)}return y},a.prototype._wrapLibraryMethodsWithReady=function(){for(var l=0,y=Wt.length;l<y;l++)Cs(this,Wt[l])},a.prototype.createInstance=function(l){return new a(l)},a}(),Rs=new Ts;o.exports=Rs},{3:3}]},{},[4])(4)})});var Ar=F((mu,Rr)=>{var De,ca=kr(),Cr=Er();Rr.exports=De={};var z={},be={},fe={},la=3e3,ua=8;console.log("siteAdapter: loading data");var rt=Cr.createInstance({name:"routes"});rt.iterate(function(t,e,n){z[e]=t}).then(()=>console.log("siteAdapter: data loaded")).catch(t=>console.log("siteAdapter: error loading data ",t));var Zt=Cr.createInstance({name:"withCredentials"});Zt.iterate(function(t,e,n){be[e]=t}).then(()=>console.log("siteAdapter: withCredentials data loaded")).catch(t=>console.log("siteAdapter: error loading withCredentials data ",t));var Xt=function(t,e,n){let r,o=new Promise(function(c,d){let u=setTimeout(function(){clearTimeout(u),d()},la)}),i=new Promise((c,d)=>$.ajax({type:"GET",url:t,success(){c()},error(){d()}}));r=Promise.race([o,i]).then(()=>e()).catch(()=>n())},Tr=ca(function(t,e){let n,{site:r}=t;return z[r]&&e(z[r]),r.split(".").at(-1).split(":")[0]==="localhost"?n=`http://${r}/favicon.png`:n=`//${r}/favicon.png`,Xt(n,function(){z[r]=n.slice(0,-12),e(n.slice(0,-12))},function(){switch(location.protocol){case"http:":n=`https://${r}/favicon.png`,Xt(n,function(){z[r]=`https://${r}`,e(`https://${r}`)},function(){z[r]="",e("")});break;case"https:":return n=`/proxy/${r}/favicon.png`,Xt(n,function(){z[r]=`/proxy/${r}`,e(`/proxy/${r}`)},function(){z[r]="",e("")});break;default:z[r]="",e("")}})},ua),nt=(t,e)=>rt.getItem(t).then(function(n){n?(z[t]=n,e(n)):Tr.push({site:t},function(r){z[t]=r,rt.setItem(t,r).then(o=>e(r)).catch(function(o){console.log("findAdapter setItem error: ",t,o),e(r)})})}).catch(function(n){console.log("findAdapter error: ",t,n),z[t]="",e("")});De.local={flag(){return"/favicon.png"},getURL(t){return`/${t}`},getDirectURL(t){return`/${t}`},get(t,e){let n,r=function(o,i){e&&e(o,i)};if(n=localStorage.getItem(t.replace(/\.json$/,""))){let o=JSON.parse(n);r(null,o),e||Promise.resolve(o)}else{let o={msg:`no page named '${t}' in browser local storage`};r(o,null),e||Promise.reject(o)}},put(t,e,n){localStorage.setItem(t,JSON.stringify(e)),n()},delete(t){localStorage.removeItem(t)}};De.origin={flag(){return"/favicon.png"},getURL(t){return`/${t}`},getDirectURL(t){return`/${t}`},get(t,e){let n=function(r,o){e&&e(r,o)};$.ajax({type:"GET",dataType:"json",url:`/${t}`,success(r,o,i){t==="system/sitemap.json"?n(null,{data:r,lastModified:Date.parse(i.getResponseHeader("Last-Modified"))}):n(null,r)},error(r,o,i){n({msg:i,xhr:r},null)}})},getIndex(t,e){let n=function(r,o){e&&e(r,o)};$.ajax({type:"GET",dataType:"text",url:`/${t}`,success(r){n(null,r)},error(r,o,i){n({msg:i,xhr:r},null)}})},put(t,e,n){$.ajax({type:"PUT",url:`/page/${t}/action`,data:{action:JSON.stringify(e)},success(){n(null)},error(r,o,i){n({xhr:r,type:o,msg:i})}})},delete(t,e){$.ajax({type:"DELETE",url:`/${t}`,success(){e(null)},error(n,r,o){e({xhr:n,type:r,msg:o})}})}};De.recycler={flag(){return"/recycler/favicon.png"},getURL(t){return`/recycler/${t}`},getDirectURL(t){return`/recycler/${t}`},get(t,e){let n=function(r,o){e&&e(r,o)};$.ajax({type:"GET",dataType:"json",url:`/recycler/${t}`,success(r){n(null,r)},error(r,o,i){n({msg:i,xhr:r},null)}})},delete(t,e){$.ajax({type:"DELETE",url:`/recycler/${t}`,success(){e(null)},error(n,r,o){e({xhr:n,type:r,msg:o})}})}};De.site=function(t){if(!t||t===window.location.host)return De.origin;if(t==="recycler")return De.recycler;let e=function(n){let r=document.createElement("canvas");r.width=32,r.height=32;let o=r.getContext("2d"),i=Math.random()*32,c=i,d=Math.random()*32,u=32-d,s=(Math.random()*255<<0).toString(16),f=(Math.random()*255<<0).toString(16),m="#"+s+s+s,h="#"+f+f+f,p=o.createRadialGradient(i,c,32,u,d,0);return p.addColorStop(0,m),p.addColorStop(1,h),o.fillStyle=p,o.fillRect(0,0,32,32),r.toDataURL()};return{flag(){if(z[t]!=null)return z[t]===""?fe[t]?fe[t]:fe[t]=e(t):z[t]+"/favicon.png";if(fe[t])return fe[t];{nt(t,function(r){if(r==="")console.log(`Prefix for ${t} is undetermined...`);else{console.log(`Prefix for ${t} is ${r}`);let o=fe[t],i=z[t]+"/favicon.png";$('img[src="'+o+'"]').attr("src",i),$('a[target="'+t+'"]').attr("style","background-image: url("+i+")"),fe[t]=null}});let n=e(t);return fe[t]=n,n}},getURL(n){return z[t]!=null?z[t]===""?(console.log(`${t} is unreachable, can't link to ${n}`),""):`${z[t]}/${n}`:(nt(t,function(r){r===""?console.log(`${t} is unreachable`):(console.log(`Prefix for ${t} is ${r}, about to fixup links`),$('a[target="'+t+'"]').each(function(){let o;/proxy/.test(r)?o=`http://${r.substring(7)}`:o=r,$(this).attr("href",`${o}/${$(this).data("slug")}.html`)}))}),"")},getDirectURL(n){let r,o;return z[t]!=null?z[t]===""?(console.log(`${t} is unreachable, can't link to ${n}`),""):(/proxy/.test(z[t])?(o=z[t].substring(7),r=`http://${o}`):r=z[t],`${r}/${n}`):(nt(t,function(i){i===""?console.log(`${t} is unreachable`):(console.log(`Prefix for ${t} is ${i}, about to fixup links`),$('a[target="'+t+'"]').each(function(){/proxy/.test(i)?(o=i.substring(7),r=`http://${o}`):r=i,$(this).attr("href",`${r}/${$(this).data("slug")}.html`)}))}),"")},get(n,r){let o,i=function(d,u){r&&r(d,u)};var c=function(d,u){let s=`${z[t]}/${d}`,f=be[t]||!1;$.ajax({type:"GET",dataType:"json",url:s,xhrFields:{withCredentials:f},success(m,h,p){if((d==="system/sitemap.json"&&Array.isArray(m)&&m[0]==="Login Required"||m.title==="Login Required")&&!s.includes("login-required")&&be[t]!==!0)be[t]=!0,c(d,function(x,C){x?(be[t]=!1,u(x,C)):(Zt.setItem(t,!0),u(x,C))});else if(d==="system/sitemap.json"?u(null,{data:m,lastModified:Date.parse(p.getResponseHeader("Last-Modified"))}):u(null,m),!r)return Promise.resolve(m)},error(m,h,p){if(u({msg:p,xhr:m},null),!r)return Promise.reject(p)}})};if(z[t]!=null)if(z[t]===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},i(o,null),!r)return Promise.reject(o)}else return c(n,i);else nt(t,function(d){if(d===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},i(o,null),!r)return Promise.reject(o)}else return c(n,i)})},getIndex(n,r){let o,i=function(d,u){r&&r(d,u)};var c=function(d,u){let s=`${z[t]}/${d}`,f=be[t]||!1;$.ajax({type:"GET",dataType:"text",url:s,xhrFields:{withCredentials:f},success(m){if(m.title==="Login Required"&&!s.includes("login-required")&&be[t]!==!0)return be[t]=!0,c(d,function(h,p){h?(be[t]=!1,u(h,p)):(Zt.setItem(t,!0),u(h,p))});if(u(null,m),!r)return Promise.resolve(m)},error(m,h,p){if(u({msg:p,xhr:m},null),!r)return Promise.reject(p)}})};if(z[t]!=null)if(z[t]===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},i(o,null),!r)return Promise.reject(o)}else return c(n,i);else nt(t,function(d){if(d===""){if(console.log(`${t} is unreachable`),o={msg:`${t} is unreachable`,xhr:{status:0}},i(o,null),!r)return Promise.reject(o)}else return c(n,i)})},refresh(n){if(console.log(`Refreshing ${t}`),fe[t]==null){let r=e(t);fe[t]=r;let o=z[t]+"/favicon.png";$('img[src="'+o+'"]').attr("src",r),$('a[target="'+t+'"]').attr("style","background-image: url("+r+")")}z[t]=null,rt.removeItem(t).then(()=>{Tr.push({site:t},r=>{rt.setItem(t,r).then(()=>{if(r==="")console.log(`Refreshed prefix for ${t} is undetermined...`);else{console.log(`Refreshed prefix for ${t} is ${r}`);let o=fe[t],i=z[t]+"/favicon.png";$('img[src="'+o+'"]').attr("src",i),$('a[target="'+t+'"]').attr("style","background-image: url("+i+")")}n()}).catch(o=>{console.log("findAdapter setItem error: ",t,o),z[t]="",n()})})}).catch(r=>{console.log("refresh error ",t,r),n()})}}}});var Me=F((vu,Pr)=>{var Oe;Pr.exports=Oe={};Oe.formatTime=function(t){let e=new Date(t>1e10?t:t*1e3),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],r=e.getHours(),o=r<12?"AM":"PM";r=r===0?12:r>12?r-12:r;let i=(e.getMinutes()<10?"0":"")+e.getMinutes();return`${r}:${i} ${o}<br>${e.getDate()} ${n} ${e.getFullYear()}`};Oe.formatDate=function(t){let e=new Date(t),n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()],r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate(),i=e.getFullYear(),c=e.getHours(),d=c<12?"AM":"PM";c=c===0?12:c>12?c-12:c;let u=(e.getMinutes()<10?"0":"")+e.getMinutes(),s=(e.getSeconds()<10?"0":"")+e.getSeconds();return`${n} ${r} ${o}, ${i}<br>${c}:${u}:${s} ${d}`};Oe.formatActionTitle=function(t){let e="";return t.site&&(e+=`${t.site}
`),e+=t.type||"separator",t.date&&(e+=` ${Oe.formatElapsedTime(t.date)}`),t.attribution?.page&&(e+=`
from ${t.attribution.page}`),t.removedTo?.page&&(e+=`
to ${t.removedTo.page}`),e};Oe.formatElapsedTime=function(t){let e,n,r,o,i,c,d,u=new Date().getTime()-t;return(i=u/1e3)<2?`${Math.floor(u)} milliseconds ago`:(r=i/60)<2?`${Math.floor(i)} seconds ago`:(n=r/60)<2?`${Math.floor(r)} minutes ago`:(e=n/24)<2?`${Math.floor(n)} hours ago`:(c=e/7)<2?`${Math.floor(e)} days ago`:(o=e/31)<2?`${Math.floor(c)} weeks ago`:(d=e/365)<2?`${Math.floor(o)} months ago`:`${Math.floor(d)} years ago`};Oe.formatDelay=function(t){let e,n,r,o=t-Date.now();return(r=o/1e3)<2?`in ${Math.floor(o)} milliseconds`:(n=r/60)<2?`in ${Math.floor(r)} seconds`:(e=n/60)<2?`in ${Math.floor(n)} minutes`:`in ${Math.floor(e)} hours`}});var Ee=F((yu,Or)=>{var Lr=()=>((1+Math.random())*256|0).toString(16).substring(1),Dr=t=>[...Array(t)].map(e=>Lr()).join(""),fa=()=>Dr(8);Or.exports={randomByte:Lr,randomBytes:Dr,itemId:fa}});var en=F((wu,Fr)=>{var Mr=function(t,e){let n,r=()=>(t.story||[]).map(u=>u?.id),o=function(u,s){let f=r().indexOf(u)+1;t.story.splice(f,0,s)},i=function(){let u;(u=r().indexOf(e.id))!==-1&&t.story.splice(u,1)};switch(t.story||(t.story=[]),e.type){case"create":e.item&&(e.item.title&&(t.title=e.item.title),e.item.story&&(t.story=e.item.story.slice()));break;case"add":o(e.after,e.item);break;case"edit":(n=r().indexOf(e.id))!==-1?t.story.splice(n,1,e.item):t.story.push(e.item);break;case"move":n=e.order.indexOf(e.id);var c=e.order[n-1],d=t.story[r().indexOf(e.id)];i(),o(c,d);break;case"remove":i();break}t.journal||(t.journal=[]),e.fork&&t.journal.push({type:"fork",site:e.fork,date:e.date-1}),t.journal.push(e)},da=function(t,e){t=+t;let n=e.journal.slice(0,+t+1||void 0),r={title:e.title,story:[]};for(var o of n)Mr(r,o||{});return r};Fr.exports={create:da,apply:Mr}});var xt=F((bu,qr)=>{qr.exports=function(t){let{synopsis:e}=t;if(t?.story){let n=t.story[0],r=t.story[1];n&&n.type==="paragraph"&&(e||=n.text),r&&r.type==="paragraph"&&(e||=r.text),n&&n.text&&(e||=n.text),r&&r.text&&(e||=r.text),e||=t.story&&`A page with ${t.story.length} items.`}else e="A page with no story.";return e=e.trim().split(/\r|\n/,1)[0],e.substring(0,560)}});var le=F(($u,zr)=>{var{formatDate:ha}=Me(),ga=Ee(),jr=en(),pa=xt(),ma=new EventTarget,_t=t=>t.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase(),va=t=>t.replace(/-/g," "),ya=t=>[{symbol:"\u2744",date:t-1e3*60*60*24*366,period:"a Year"},{symbol:"\u2698",date:t-1e3*60*60*24*31*3,period:"a Season"},{symbol:"\u26AA",date:t-1e3*60*60*24*31,period:"a Month"},{symbol:"\u263D",date:t-1e3*60*60*24*7,period:"a Week"},{symbol:"\u2600",date:t-1e3*60*60*24,period:"a Day"},{symbol:"\u231A",date:t-1e3*60*60,period:"an Hour"}],Nr=function(t,e){let n=t||{};n.title||(n.title="empty"),n.story||(n.story=[]),n.journal||(n.journal=[]);let r=()=>n,o=function(){let L=["view"];c()&&L.push(e);let q=function(J){J&&!L.includes(J)&&L.push(J)};for(var Q of n.journal.slice(0).reverse())q(Q?.site);return L},i=()=>n.plugin!=null;var c=()=>![void 0,null,"view","origin","local","recycler"].includes(e);let d=()=>e==="local",u=()=>e==="recycler",s=function(L=null){return c()?e:L},f=function(L=null){let q=[];return(L||c())&&q.push(s(L)),i()&&q.push(`${n.plugin} plugin`),q.join(`
`)},m=()=>_t(n.title),h=function(L){let q=[];c()?q.push(e):L&&q.push(L);for(var Q of n.story)Q?.site&&q.push(Q.site);for(var J of n.journal)J?.site&&q.push(J.site);return Array.from(new Set(q))},p=()=>n.title,x=L=>n.title=L,C=()=>n.journal.length-1,D=function(){let L=n.journal[C()];if(L&&L.date)return L.date},R=function(){let L=n.journal[C()];return L?L.date?ha(L.date):`Revision ${C()}`:"Unrecorded Date"},T=()=>pa(n),P=function(){let L,q,Q=function(J,ne,pe,Be){try{let ie=/\[\[([^\]]+)\]\]/g,me;for(;(me=ie.exec(ne.text))!==null;)J.has(_t(me[1]))||J.set(_t(me[1]),ne.id);ne.type==="reference"&&(J.has(ne.slug)||J.set(ne.slug,ne.id))}catch(ie){console.log(`*** Error extracting links from ${pe} of ${JSON.stringify(Be)}`,ie.message)}return J};try{q=n.story.reduce(Q,new Map)}catch(J){let ne=J;console.log(`+++ Extract links on ${n.slug} fails`,ne)}return q.size>0?L=Object.fromEntries(q):L={},L},j=function(L){L=Object.assign({},{id:ga.itemId()},L),n.story.push(L)},W=function(L){for(var q of n.story)if(q.id===L)return q;return null},S=function(L){return new Promise(function(Q,J){var ne=function(pe){return pe>=n.story.length?Q():L(n.story[pe]||{text:"null"},()=>ne(pe+1))};return ne(0)})},O=function(L){j({type:"paragraph",text:L})},M=function(L){let q=0,Q=ya(new Date().getTime());var J=function(ne){if(ne>=n.journal.length)return;let pe=n.journal[ne]||{},Be=pe.date||0,ie=null;for(var me of Q)me.date>q&&me.date<Be&&(ie=me);q=Be,L({action:pe,separator:ie},()=>J(ne+1))};J(0)},B=function(L,q){n.story=L?.getRawPage().story||[],q&&(n.journal=q?.getRawPage().journal)},H=function(){let L=m(),q=L==="welcome-visitors"?"view/welcome-visitors":`view/welcome-visitors/view/${L}`;return c()?wiki.site(e).getDirectURL(q):`/${q}`},G=function(L,q){for(var Q of L)if(Q.id===q.id&&Q.date===q.date)return!1;return!0};return{getRawPage:r,getContext:o,isPlugin:i,isRemote:c,isLocal:d,isRecycler:u,getRemoteSite:s,getRemoteSiteDetails:f,getSlug:m,getNeighbors:h,getTitle:p,getLinks:P,setTitle:x,getRevision:C,getDate:D,getTimestamp:R,getSynopsis:T,addItem:j,getItem:W,addParagraph:O,seqItems:S,seqActions:M,become:B,siteLineup:H,merge:function(L){let q,Q=n.journal.slice();for(q of L.getRawPage().journal)G(n.journal,q)&&Q.push(q);Q.push({type:"fork",site:L.getRemoteSite(),date:new Date().getTime()}),Nr(jr.create(999,{title:n.title,journal:Q}),e)},apply:function(L){jr.apply(n,L),L.site&&(e=null)},getCreate:function(){let L=q=>q.type==="create";n.journal.reverse().find(L)}}};zr.exports={newPage:Nr,asSlug:_t,asTitle:va,pageEmitter:ma}});var Ke=F((xu,Ur)=>{var Fe;Ur.exports=Fe={};Fe.scrollContainer=void 0;var wa=function(){let t=$("body, html").filter(function(){return $(this).scrollLeft()>0});return t.length>0?t:$("body, html").scrollLeft(12).filter(function(){return $(this).scrollLeft()>0}).scrollTop(0)},ba=function(t){let e;if(t.position()==null)return;Fe.scrollContainer==null&&(Fe.scrollContainer=wa());let n=$("body").width(),r=Fe.scrollContainer.scrollLeft(),o=r+n,i=t.position().left,c=t.outerWidth(!0),d=$(".page").outerWidth(!0)*$(".page").length;i<r?e=i:i+c>o?e=i-(n-c):o>$(".pages").outerWidth()&&(e=Math.min(i,d-n)),Fe.scrollContainer.animate({scrollLeft:e},function(){$.contains(t[0],document.activeElement)||t.trigger("focus")})};Fe.set=function(t,e){$(".incremental-search").remove(),t=$(t),$(".active").removeClass("active"),t.addClass("active"),e||ba(t)}});var $e=F((_u,Kr)=>{var $a=Ee(),qe={},Z=[],xa=function(t){let e=$a.randomBytes(4);return qe[e]=t,Z.push(e),e},_a=function(t,e){let n=Z.indexOf(t);Z.splice(n,1),Z.splice(e,0,t)},Sa=function(t){return Z.includes(t)?(Z=Z.filter(e=>t!==e),delete qe[t],t):null},ka=function(t){let e=[];if(!Z.includes(t))return e;for(;Z[Z.length-1]!==t;){var n=Z.pop();e.unshift(n),delete qe[n]}return e},Br=t=>qe[t],Wr=t=>Br(t).getTitle(),Ia=function(){return Z.length?Wr(Z[Z.length-1]):"Wiki"},Ea=()=>Z,Ca=function(){qe={},Z=[]},Ta=function(t){let e,n,r;(e=`${Z}`)!=(r=`${t}`)&&(console.log("The lineup is out of sync with the dom."),console.log(".pages:",t),console.log("lineup:",Z),`${Object.keys(Z).sort()}`==`${Object.keys(t).sort()}`&&(console.log("It looks like an ordering problem we can fix."),n=t))},Ra=function(t){let e=Z.indexOf(t);return e<1?null:Z[e-1]},Aa=function(t,e){let n,r,o=qe[t],i=o.getRemoteSite(e),c=["view",r=o.getSlug()];if(r!=="welcome-visitors"&&c.unshift("view","welcome-visitors"),i!==e&&(n=Ra(t))){let d;(d=qe[n]).isRemote()||c.push(e,d.getSlug())}return c.unshift(i),c};Kr.exports={addPage:xa,changePageIndex:_a,removeKey:Sa,removeAllAfterKey:ka,atKey:Br,titleAtKey:Wr,bestTitle:Ia,debugKeys:Ea,debugReset:Ca,crumbs:Aa,debugSelfCheck:Ta}});var ot=F((Su,Vr)=>{var ee,Pa=Ke(),St=$e(),tn=null;Vr.exports=ee={};ee.inject=t=>tn=t;ee.pagesInDom=()=>Array.from(document.querySelectorAll(".page")).map(t=>t.id);ee.urlPages=()=>new URL(window.location.href).pathname.split("/").slice(1).filter((...[,e])=>e%2===1);ee.locsInDom=()=>$.makeArray($(".page").map((t,e)=>$(e).data("site")||"view"));ee.urlLocs=()=>new URL(window.location.href).pathname.split("/").slice(1).filter((...[,e])=>e%2===0);ee.setUrl=()=>{if(document.title=St.bestTitle(),history&&history.pushState){let t=ee.locsInDom(),n=ee.pagesInDom().map((r,o)=>`/${t[o]||"view"}/${r}`).join("");n!==new URL(window.location.href).pathname&&history.pushState(null,null,n)}};ee.debugStates=()=>{console.log("a .page keys ",Array.from($(".page")).map(t=>$(t).data("key"))),console.log("a lineup keys",St.debugKeys())};ee.show=t=>{let e=ee.pagesInDom(),n=ee.urlPages(),r=ee.locsInDom(),o=ee.urlLocs();if(!location.pathname||location.pathname==="/")return;let i=!0;for(let[c,d]of e.entries()){if(i&&(i=d===n[c]))continue;let u=$(".page:last");St.removeKey(u.data("key")),u.remove()}i=!0;for(let[c,d]of n.entries())i&&(i=d===e[c])||tn.showPage(d,o[c]);window.debug&&ee.debugStates(),Pa.set($(".page").last()),document.title=St.bestTitle()};ee.first=()=>{ee.setUrl();let t=ee.urlPages(),e=ee.urlLocs(),n=ee.pagesInDom();for(let r=0;r<t.length;r++){let o=t[r];!n.includes(o)&&o!==""&&tn.createPage(o,e[r])}}});var rn=F((ku,Jr)=>{var nn={create:"\u263C",add:"+",edit:"\u270E",fork:"\u2691",move:"\u2195",remove:"\u2715",copyIn:"\u2A2D",copyOut:"\u2A35"},La=nn.fork,Da=nn.add;Jr.exports={symbols:nn,fork:La,add:Da}});var sn=F((Iu,Yr)=>{var Oa=Me(),on=rn();Yr.exports=function(t,e){let n=t.parents(".page:first"),r=$('<a href="#" /> ').addClass("action").addClass(e.type||"separator").text(e.symbol||on.symbols[e.type]).attr("title",Oa.formatActionTitle(e)).attr("data-id",e.id||"0").attr("data-date",e.date||"0").data("action",e);e.type==="add"&&e.attribution&&(r.text(on.symbols.copyIn),e.attribution.site&&r.css("background-image",`url(${wiki.site(e.attribution.site).flag()})`)),e.type==="remove"&&e.removedTo&&r.text(on.symbols.copyOut);let o=t.children(".control-buttons");o.length>0?r.insertBefore(o):r.appendTo(t),e.type==="fork"&&e.site&&r.css("background-image",`url(${wiki.site(e.site).flag()}`).attr("href",`${wiki.site(e.site).getDirectURL(n.attr("id"))}.html`).attr("target",`${e.site}`).data("site",e.site).data("slug",n.attr("id"))}});var ao=F((Eu,so)=>{"use strict";function Et(t,e,n,r){function o(i){return i instanceof n?i:new n(function(c){c(i)})}return new(n||(n=Promise))(function(i,c){function d(f){try{s(r.next(f))}catch(m){c(m)}}function u(f){try{s(r.throw(f))}catch(m){c(m)}}function s(f){f.done?i(f.value):o(f.value).then(d,u)}s((r=r.apply(t,e||[])).next())})}var Ma="ENTRIES",Zr="KEYS",eo="VALUES",re="",it=class{constructor(e,n){let r=e._tree,o=Array.from(r.keys());this.set=e,this._type=n,this._path=o.length>0?[{node:r,keys:o}]:[]}next(){let e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};let{node:e,keys:n}=Ve(this._path);if(Ve(n)===re)return{done:!1,value:this.result()};let r=e.get(Ve(n));return this._path.push({node:r,keys:Array.from(r.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;let e=Ve(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>Ve(e)).filter(e=>e!==re).join("")}value(){return Ve(this._path).node.get(re)}result(){switch(this._type){case eo:return this.value();case Zr:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}},Ve=t=>t[t.length-1],Fa=(t,e,n)=>{let r=new Map;if(e===void 0)return r;let o=e.length+1,i=o+n,c=new Uint8Array(i*o).fill(n+1);for(let d=0;d<o;++d)c[d]=d;for(let d=1;d<i;++d)c[d*o]=d;return to(t,e,n,r,c,1,o,""),r},to=(t,e,n,r,o,i,c,d)=>{let u=i*c;e:for(let s of t.keys())if(s===re){let f=o[u-1];f<=n&&r.set(d,[t.get(s),f])}else{let f=i;for(let m=0;m<s.length;++m,++f){let h=s[m],p=c*f,x=p-c,C=o[p],D=Math.max(0,f-n-1),R=Math.min(c-1,f+n);for(let T=D;T<R;++T){let P=h!==e[T],j=o[x+T]+ +P,W=o[x+T+1]+1,S=o[p+T]+1,O=o[p+T+1]=Math.min(j,W,S);O<C&&(C=O)}if(C>n)continue e}to(t.get(s),e,n,r,o,f,c,d+s)}},st=class t{constructor(e=new Map,n=""){this._size=void 0,this._tree=e,this._prefix=n}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");let[n,r]=Ct(this._tree,e.slice(this._prefix.length));if(n===void 0){let[o,i]=gn(r);for(let c of o.keys())if(c!==re&&c.startsWith(i)){let d=new Map;return d.set(c.slice(i.length),o.get(c)),new t(d,e)}}return new t(n,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,qa(this._tree,e)}entries(){return new it(this,Ma)}forEach(e){for(let[n,r]of this)e(n,r,this)}fuzzyGet(e,n){return Fa(this._tree,e,n)}get(e){let n=fn(this._tree,e);return n!==void 0?n.get(re):void 0}has(e){let n=fn(this._tree,e);return n!==void 0&&n.has(re)}keys(){return new it(this,Zr)}set(e,n){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,an(this._tree,e).set(re,n),this}get size(){if(this._size)return this._size;this._size=0;let e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let r=an(this._tree,e);return r.set(re,n(r.get(re))),this}fetch(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let r=an(this._tree,e),o=r.get(re);return o===void 0&&r.set(re,o=n()),o}values(){return new it(this,eo)}[Symbol.iterator](){return this.entries()}static from(e){let n=new t;for(let[r,o]of e)n.set(r,o);return n}static fromObject(e){return t.from(Object.entries(e))}},Ct=(t,e,n=[])=>{if(e.length===0||t==null)return[t,n];for(let r of t.keys())if(r!==re&&e.startsWith(r))return n.push([t,r]),Ct(t.get(r),e.slice(r.length),n);return n.push([t,e]),Ct(void 0,"",n)},fn=(t,e)=>{if(e.length===0||t==null)return t;for(let n of t.keys())if(n!==re&&e.startsWith(n))return fn(t.get(n),e.slice(n.length))},an=(t,e)=>{let n=e.length;e:for(let r=0;t&&r<n;){for(let i of t.keys())if(i!==re&&e[r]===i[0]){let c=Math.min(n-r,i.length),d=1;for(;d<c&&e[r+d]===i[d];)++d;let u=t.get(i);if(d===i.length)t=u;else{let s=new Map;s.set(i.slice(d),u),t.set(e.slice(r,r+d),s),t.delete(i),t=s}r+=d;continue e}let o=new Map;return t.set(e.slice(r),o),o}return t},qa=(t,e)=>{let[n,r]=Ct(t,e);if(n!==void 0){if(n.delete(re),n.size===0)no(r);else if(n.size===1){let[o,i]=n.entries().next().value;ro(r,o,i)}}},no=t=>{if(t.length===0)return;let[e,n]=gn(t);if(e.delete(n),e.size===0)no(t.slice(0,-1));else if(e.size===1){let[r,o]=e.entries().next().value;r!==re&&ro(t.slice(0,-1),r,o)}},ro=(t,e,n)=>{if(t.length===0)return;let[r,o]=gn(t);r.set(o+e,n),r.delete(o)},gn=t=>t[t.length-1],pn="or",oo="and",ja="and_not",Tt=class t{constructor(e){if(e?.fields==null)throw new Error('MiniSearch: option "fields" must be provided');let n=e.autoVacuum==null||e.autoVacuum===!0?un:e.autoVacuum;this._options=Object.assign(Object.assign(Object.assign({},ln),e),{autoVacuum:n,searchOptions:Object.assign(Object.assign({},Hr),e.searchOptions||{}),autoSuggestOptions:Object.assign(Object.assign({},Wa),e.autoSuggestOptions||{})}),this._index=new st,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=hn,this.addFields(this._options.fields)}add(e){let{extractField:n,tokenize:r,processTerm:o,fields:i,idField:c}=this._options,d=n(e,c);if(d==null)throw new Error(`MiniSearch: document does not have ID field "${c}"`);if(this._idToShortId.has(d))throw new Error(`MiniSearch: duplicate ID ${d}`);let u=this.addDocumentId(d);this.saveStoredFields(u,e);for(let s of i){let f=n(e,s);if(f==null)continue;let m=r(f.toString(),s),h=this._fieldIds[s],p=new Set(m).size;this.addFieldLength(u,h,this._documentCount-1,p);for(let x of m){let C=o(x,s);if(Array.isArray(C))for(let D of C)this.addTerm(h,u,D);else C&&this.addTerm(h,u,C)}}}addAll(e){for(let n of e)this.add(n)}addAllAsync(e,n={}){let{chunkSize:r=10}=n,o={chunk:[],promise:Promise.resolve()},{chunk:i,promise:c}=e.reduce(({chunk:d,promise:u},s,f)=>(d.push(s),(f+1)%r===0?{chunk:[],promise:u.then(()=>new Promise(m=>setTimeout(m,0))).then(()=>this.addAll(d))}:{chunk:d,promise:u}),o);return c.then(()=>this.addAll(i))}remove(e){let{tokenize:n,processTerm:r,extractField:o,fields:i,idField:c}=this._options,d=o(e,c);if(d==null)throw new Error(`MiniSearch: document does not have ID field "${c}"`);let u=this._idToShortId.get(d);if(u==null)throw new Error(`MiniSearch: cannot remove document with ID ${d}: it is not in the index`);for(let s of i){let f=o(e,s);if(f==null)continue;let m=n(f.toString(),s),h=this._fieldIds[s],p=new Set(m).size;this.removeFieldLength(u,h,this._documentCount,p);for(let x of m){let C=r(x,s);if(Array.isArray(C))for(let D of C)this.removeTerm(h,u,D);else C&&this.removeTerm(h,u,C)}}this._storedFields.delete(u),this._documentIds.delete(u),this._idToShortId.delete(d),this._fieldLength.delete(u),this._documentCount-=1}removeAll(e){if(e)for(let n of e)this.remove(n);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new st,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){let n=this._idToShortId.get(e);if(n==null)throw new Error(`MiniSearch: cannot discard document with ID ${e}: it is not in the index`);this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach((r,o)=>{this.removeFieldLength(n,o,this._documentCount,r)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;let{minDirtFactor:e,minDirtCount:n,batchSize:r,batchWait:o}=this._options.autoVacuum;this.conditionalVacuum({batchSize:r,batchWait:o},{minDirtCount:n,minDirtFactor:e})}discardAll(e){let n=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(let r of e)this.discard(r)}finally{this._options.autoVacuum=n}this.maybeAutoVacuum()}replace(e){let{idField:n,extractField:r}=this._options,o=r(e,n);this.discard(o),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,n){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&n,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{let r=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=hn,this.performVacuuming(e,r)}),this._enqueuedVacuum)):this.vacuumConditionsMet(n)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}performVacuuming(e,n){return Et(this,void 0,void 0,function*(){let r=this._dirtCount;if(this.vacuumConditionsMet(n)){let o=e.batchSize||dn.batchSize,i=e.batchWait||dn.batchWait,c=1;for(let[d,u]of this._index){for(let[s,f]of u)for(let[m]of f)this._documentIds.has(m)||(f.size<=1?u.delete(s):f.delete(m));this._index.get(d).size===0&&this._index.delete(d),c%o===0&&(yield new Promise(s=>setTimeout(s,i))),c+=1}this._dirtCount-=r}yield null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null})}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:n,minDirtFactor:r}=e;return n=n||un.minDirtCount,r=r||un.minDirtFactor,this.dirtCount>=n&&this.dirtFactor>=r}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){let n=this._idToShortId.get(e);if(n!=null)return this._storedFields.get(n)}search(e,n={}){let r=this.executeQuery(e,n),o=[];for(let[i,{score:c,terms:d,match:u}]of r){let s=d.length||1,f={id:this._documentIds.get(i),score:c*s,terms:Object.keys(u),queryTerms:d,match:u};Object.assign(f,this._storedFields.get(i)),(n.filter==null||n.filter(f))&&o.push(f)}return e===t.wildcard&&n.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(Qr),o}autoSuggest(e,n={}){n=Object.assign(Object.assign({},this._options.autoSuggestOptions),n);let r=new Map;for(let{score:i,terms:c}of this.search(e,n)){let d=c.join(" "),u=r.get(d);u!=null?(u.score+=i,u.count+=1):r.set(d,{score:i,terms:c,count:1})}let o=[];for(let[i,{score:c,terms:d,count:u}]of r)o.push({suggestion:i,terms:d,score:c/u});return o.sort(Qr),o}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),n)}static loadJSONAsync(e,n){return Et(this,void 0,void 0,function*(){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),n)})}static getDefault(e){if(ln.hasOwnProperty(e))return cn(ln,e);throw new Error(`MiniSearch: unknown option "${e}"`)}static loadJS(e,n){let{index:r,documentIds:o,fieldLength:i,storedFields:c,serializationVersion:d}=e,u=this.instantiateMiniSearch(e,n);u._documentIds=kt(o),u._fieldLength=kt(i),u._storedFields=kt(c);for(let[s,f]of u._documentIds)u._idToShortId.set(f,s);for(let[s,f]of r){let m=new Map;for(let h of Object.keys(f)){let p=f[h];d===1&&(p=p.ds),m.set(parseInt(h,10),kt(p))}u._index.set(s,m)}return u}static loadJSAsync(e,n){return Et(this,void 0,void 0,function*(){let{index:r,documentIds:o,fieldLength:i,storedFields:c,serializationVersion:d}=e,u=this.instantiateMiniSearch(e,n);u._documentIds=yield It(o),u._fieldLength=yield It(i),u._storedFields=yield It(c);for(let[f,m]of u._documentIds)u._idToShortId.set(m,f);let s=0;for(let[f,m]of r){let h=new Map;for(let p of Object.keys(m)){let x=m[p];d===1&&(x=x.ds),h.set(parseInt(p,10),yield It(x))}++s%1e3===0&&(yield io(0)),u._index.set(f,h)}return u})}static instantiateMiniSearch(e,n){let{documentCount:r,nextId:o,fieldIds:i,averageFieldLength:c,dirtCount:d,serializationVersion:u}=e;if(u!==1&&u!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");let s=new t(n);return s._documentCount=r,s._nextId=o,s._idToShortId=new Map,s._fieldIds=i,s._avgFieldLength=c,s._dirtCount=d||0,s._index=new st,s}executeQuery(e,n={}){if(e===t.wildcard)return this.executeWildcardQuery(n);if(typeof e!="string"){let h=Object.assign(Object.assign(Object.assign({},n),e),{queries:void 0}),p=e.queries.map(x=>this.executeQuery(x,h));return this.combineResults(p,h.combineWith)}let{tokenize:r,processTerm:o,searchOptions:i}=this._options,c=Object.assign(Object.assign({tokenize:r,processTerm:o},i),n),{tokenize:d,processTerm:u}=c,m=d(e).flatMap(h=>u(h)).filter(h=>!!h).map(Ba(c)).map(h=>this.executeQuerySpec(h,c));return this.combineResults(m,c.combineWith)}executeQuerySpec(e,n){let r=Object.assign(Object.assign({},this._options.searchOptions),n),o=(r.fields||this._options.fields).reduce((C,D)=>Object.assign(Object.assign({},C),{[D]:cn(r.boost,D)||1}),{}),{boostDocument:i,weights:c,maxFuzzy:d,bm25:u}=r,{fuzzy:s,prefix:f}=Object.assign(Object.assign({},Hr.weights),c),m=this._index.get(e.term),h=this.termResults(e.term,e.term,1,e.termBoost,m,o,i,u),p,x;if(e.prefix&&(p=this._index.atPrefix(e.term)),e.fuzzy){let C=e.fuzzy===!0?.2:e.fuzzy,D=C<1?Math.min(d,Math.round(e.term.length*C)):C;D&&(x=this._index.fuzzyGet(e.term,D))}if(p)for(let[C,D]of p){let R=C.length-e.term.length;if(!R)continue;x?.delete(C);let T=f*C.length/(C.length+.3*R);this.termResults(e.term,C,T,e.termBoost,D,o,i,u,h)}if(x)for(let C of x.keys()){let[D,R]=x.get(C);if(!R)continue;let T=s*C.length/(C.length+R);this.termResults(e.term,C,T,e.termBoost,D,o,i,u,h)}return h}executeWildcardQuery(e){let n=new Map,r=Object.assign(Object.assign({},this._options.searchOptions),e);for(let[o,i]of this._documentIds){let c=r.boostDocument?r.boostDocument(i,"",this._storedFields.get(o)):1;n.set(o,{score:c,terms:[],match:{}})}return n}combineResults(e,n=pn){if(e.length===0)return new Map;let r=n.toLowerCase(),o=Na[r];if(!o)throw new Error(`Invalid combination operator: ${n}`);return e.reduce(o)||new Map}toJSON(){let e=[];for(let[n,r]of this._index){let o={};for(let[i,c]of r)o[i]=Object.fromEntries(c);e.push([n,o])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,n,r,o,i,c,d,u,s=new Map){if(i==null)return s;for(let f of Object.keys(c)){let m=c[f],h=this._fieldIds[f],p=i.get(h);if(p==null)continue;let x=p.size,C=this._avgFieldLength[h];for(let D of p.keys()){if(!this._documentIds.has(D)){this.removeTerm(h,D,n),x-=1;continue}let R=d?d(this._documentIds.get(D),n,this._storedFields.get(D)):1;if(!R)continue;let T=p.get(D),P=this._fieldLength.get(D)[h],j=Ua(T,x,this._documentCount,P,C,u),W=r*o*m*R*j,S=s.get(D);if(S){S.score+=W,Ka(S.terms,e);let O=cn(S.match,n);O?O.push(f):S.match[n]=[f]}else s.set(D,{score:W,terms:[e],match:{[n]:[f]}})}}return s}addTerm(e,n,r){let o=this._index.fetch(r,Xr),i=o.get(e);if(i==null)i=new Map,i.set(n,1),o.set(e,i);else{let c=i.get(n);i.set(n,(c||0)+1)}}removeTerm(e,n,r){if(!this._index.has(r)){this.warnDocumentChanged(n,e,r);return}let o=this._index.fetch(r,Xr),i=o.get(e);i==null||i.get(n)==null?this.warnDocumentChanged(n,e,r):i.get(n)<=1?i.size<=1?o.delete(e):i.delete(n):i.set(n,i.get(n)-1),this._index.get(r).size===0&&this._index.delete(r)}warnDocumentChanged(e,n,r){for(let o of Object.keys(this._fieldIds))if(this._fieldIds[o]===n){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(e)} has changed before removal: term "${r}" was not present in field "${o}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(e){let n=this._nextId;return this._idToShortId.set(e,n),this._documentIds.set(n,e),this._documentCount+=1,this._nextId+=1,n}addFields(e){for(let n=0;n<e.length;n++)this._fieldIds[e[n]]=n}addFieldLength(e,n,r,o){let i=this._fieldLength.get(e);i==null&&this._fieldLength.set(e,i=[]),i[n]=o;let d=(this._avgFieldLength[n]||0)*r+o;this._avgFieldLength[n]=d/(r+1)}removeFieldLength(e,n,r,o){if(r===1){this._avgFieldLength[n]=0;return}let i=this._avgFieldLength[n]*r-o;this._avgFieldLength[n]=i/(r-1)}saveStoredFields(e,n){let{storeFields:r,extractField:o}=this._options;if(r==null||r.length===0)return;let i=this._storedFields.get(e);i==null&&this._storedFields.set(e,i={});for(let c of r){let d=o(n,c);d!==void 0&&(i[c]=d)}}};Tt.wildcard=Symbol("*");var cn=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0,Na={[pn]:(t,e)=>{for(let n of e.keys()){let r=t.get(n);if(r==null)t.set(n,e.get(n));else{let{score:o,terms:i,match:c}=e.get(n);r.score=r.score+o,r.match=Object.assign(r.match,c),Gr(r.terms,i)}}return t},[oo]:(t,e)=>{let n=new Map;for(let r of e.keys()){let o=t.get(r);if(o==null)continue;let{score:i,terms:c,match:d}=e.get(r);Gr(o.terms,c),n.set(r,{score:o.score+i,terms:o.terms,match:Object.assign(o.match,d)})}return n},[ja]:(t,e)=>{for(let n of e.keys())t.delete(n);return t}},za={k:1.2,b:.7,d:.5},Ua=(t,e,n,r,o,i)=>{let{k:c,b:d,d:u}=i;return Math.log(1+(n-e+.5)/(e+.5))*(u+t*(c+1)/(t+c*(1-d+d*r/o)))},Ba=t=>(e,n,r)=>{let o=typeof t.fuzzy=="function"?t.fuzzy(e,n,r):t.fuzzy||!1,i=typeof t.prefix=="function"?t.prefix(e,n,r):t.prefix===!0,c=typeof t.boostTerm=="function"?t.boostTerm(e,n,r):1;return{term:e,fuzzy:o,prefix:i,termBoost:c}},ln={idField:"id",extractField:(t,e)=>t[e],tokenize:t=>t.split(Va),processTerm:t=>t.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(t,e)=>{typeof console?.[t]=="function"&&console[t](e)},autoVacuum:!0},Hr={combineWith:pn,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:za},Wa={combineWith:oo,prefix:(t,e,n)=>e===n.length-1},dn={batchSize:1e3,batchWait:10},hn={minDirtFactor:.1,minDirtCount:20},un=Object.assign(Object.assign({},dn),hn),Ka=(t,e)=>{t.includes(e)||t.push(e)},Gr=(t,e)=>{for(let n of e)t.includes(n)||t.push(n)},Qr=({score:t},{score:e})=>e-t,Xr=()=>new Map,kt=t=>{let e=new Map;for(let n of Object.keys(t))e.set(parseInt(n,10),t[n]);return e},It=t=>Et(void 0,void 0,void 0,function*(){let e=new Map,n=0;for(let r of Object.keys(t))e.set(parseInt(r,10),t[r]),++n%1e3===0&&(yield io(0));return e}),io=t=>new Promise(e=>setTimeout(e,t)),Va=/[\n\r\p{Z}\p{P}]+/u;so.exports=Tt});var Ce=F((Cu,ho)=>{var Y,uo=ao();ho.exports=Y={};Y.sites={};var Rt=0,co=500,Ja=t=>new Promise(e=>setTimeout(e,t)),fo=function(t,e){if(e.sitemapRequestInflight)return;e.sitemapRequestInflight=!0;let n=(u,s,f)=>$(`.neighbor[data-site="${u}"]`).find("div").removeClass(s).addClass(f),r=function(u){return u>432e5?432e5:u<6e4?6e4:u};var o=function(u,s){return s.sitemapRequestInflight=!0,wiki.site(u).get("system/sitemap.json",function(f,m){if(s.sitemapRequestInflight=!1,f){n(u,"fetch","fail"),wiki.site(u).refresh(function(){}),console.warn(`Unable to fetch sitemap for ${u}`);return}let{data:h,lastModified:p}=m;isNaN(p)&&(p=0),p>s.lastModified&&(s.sitemap=h,s.lastModified=p,$("body").trigger("new-neighbor-done",u),i(u,s));let x=r(Math.floor((Date.now()-p)/4));return s.nextCheck=Date.now()+x,console.log("delay for ",u,x/6e4),n(u,"fetch","done"),Ja(x).then(function(){return n(u,"done","fetch"),o(u,s)})})},i=(u,s)=>wiki.site(u).getIndex("system/site-index.json",function(f,m){if(f)console.log("error loading index",u,f);else try{s.siteIndex=uo.loadJSON(m,{fields:["title","content"]}),console.log(u,"index loaded")}catch{console.log("error loading index - not a valid index",u)}});let c=function(){return n(t,"wait","fetch"),e.lastModified=0,o(t,e)},d=Date.now();d>Rt?(Rt=d+co,setTimeout(c,100)):(setTimeout(c,Rt-d),Rt+=co)};Y.retryNeighbor=function(t){console.log("retrying neighbor");let e={};Y.sites[t]=e,fo(t,e)};Y.registerNeighbor=function(t){if(Y.sites[t])return;let e={};Y.sites[t]=e,fo(t,e),$("body").trigger("new-neighbor",t)};Y.updateSitemap=function(t){let e,n=location.host;if(!(e=Y.sites[n])||e.sitemapRequestInflight)return;let r=t.getSlug(),o=t.getDate(),i=t.getTitle(),c=t.getSynopsis(),d=t.getLinks(),u={slug:r,date:o,title:i,synopsis:c,links:d},{sitemap:s}=e,f=s.findIndex(m=>m.slug===r);f>=0?s[f]=u:s.push(u),$("body").trigger("new-neighbor-done",n)};Y.deleteFromSitemap=function(t){let e,n=location.host;if(!(e=Y.sites[n])||e.sitemapRequestInflight)return;let r=t.getSlug(),{sitemap:o}=e,i=o.findIndex(c=>c.slug===r);i>=0&&(o.splice(i),$("body").trigger("delete-neighbor-done",n))};Y.listNeighbors=()=>Object.keys(Y.sites);var lo=t=>t.replace(/\[([^\]]*?)\][\[\(].*?[\]\)]/g," $1 ").replace(/\[{2}|\[(?:[\S]+)|\]{1,2}/g," ").replace(/\n/g," ").replace(/<style.*?<\/style>/g," ").replace(/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g," ").replace(/<(?:[^>])+>/g," ").replace(/(https?.*?)(?=\p{White_Space}|\p{Quotation_Mark}|$)/gu,function(e){let n=new URL(e);return n.hostname+n.pathname}).replace(/[\p{P}\p{Emoji}\p{Symbol}}]+/gu," ").replace(/[\p{White_Space}\n\t]+/gu," "),Ya=function(t,e,n){try{if(e.text)switch(e.type){case"paragraph":case"markdown":case"html":case"reference":case"image":case"pagefold":case"math":case"mathjax":case"code":t+=lo(e.text);break;case"audio":case"video":case"frame":t+=lo(e.text.split(/\r\n?|\n/).map(function(r){let o=r.split(/\p{White_Space}/u)[0];return o.startsWith("http")||o.toUpperCase()===o||o.startsWith("//")?"":r}).join(" "));break}}catch(r){throw new Error(`Error extracting text from ${n}, ${JSON.stringify(e)} ${r}, ${r.stack}`)}return t};Y.updateIndex=function(t){let e;console.log(`updating ${t.getSlug()} in index`);let n=location.host;if(!(e=Y.sites[n]))return;let r=t.getSlug(),o=t.getTitle(),c=t.getRawPage().story.reduce(Ya,"");return e.siteIndex.has(r)?e.siteIndex.replace({id:r,title:o,content:c}):e.siteIndex.add({id:r,title:o,content:c})};Y.deleteFromIndex=function(t){let e,n=location.host;if(!(e=Y.sites[n]))return;let r=t.getSlug();try{e.siteIndex.discard(r)}catch(o){o.message.includes("not in the index")||console.log(`removing ${r} from index failed`,o)}};Y.search=function(t){let e,n,r=[],o={},i=function(p){return o[p]?o[p]++:o[p]=1},c=function(p,x){let C=`indexing sitemap ( ${p} )`;console.time(C),console.log("indexing sitemap:",p);let D=new uo({fields:["title","content"]});return e.sitemap.forEach(function(R){D.add({id:R.slug,title:R.title,content:R.synopsis})}),console.timeEnd(C),D},d=Date.now();for(n of Object.keys(Y.sites))e=Y.sites[n],e.sitemap&&(e.siteIndex||(e.siteIndex=c(n,e)));let u=location.host;for(n of Object.keys(Y.sites))if(e=Y.sites[n],e.siteIndex){var s,f,m,h;i("sites");try{o.pages?o.pages+=e.sitemap.length:o.pages=e.sitemap.length}catch(p){f=p,console.info("+++ sitemap not valid for ",n),e.sitemap=[]}n===u?(h=20,s=2):(h=10,s=1);try{m=e.siteIndex.search(t,{boost:{title:h,content:s},prefix:!0,combineWith:"AND"})}catch(p){f=p,console.error("search index error",n,t,f),m=[]}m.forEach(function(p){i("finds"),r.push({page:e.sitemap.find(({slug:x})=>x===p.id),site:n,rank:p.score})})}return r.sort((p,x)=>x.rank-p.rank),o.msec=Date.now()-d,{finds:r,tally:o}};Y.backLinks=function(t){let e=[];for(var n of Object.keys(Y.sites)){var r=Y.sites[n];r.sitemap&&r.sitemap.forEach(function(i,c){i.links&&Object.keys(i.links).length>0&&Object.keys(i.links).includes(t)&&e.push({slug:i.slug,title:i.title,site:n,itemId:i.links[t],date:i.date})})}let o={};return e.forEach(function(i){t=i.slug,o[t]=o[t]||{},o[t].title=i.title,o[t].sites=o[t].sites||[],o[t].sites.push({site:i.site,date:i.date,itemId:i.itemId})}),o}});var Te=F((Ru,wo)=>{var de,Ha=ot(),vn=en(),yn=sn(),{newPage:mn}=le(),Tu=Ee(),po=$e(),At=Ce();wo.exports=de={};var go=t=>JSON.parse(JSON.stringify(t));de.useLocalStorage=()=>$(".login").length>0;var mo=function(t){let e;if(e=localStorage.getItem(t))return JSON.parse(e)},vo=function({pageInformation:t,whenGotten:e,whenNotGotten:n,localContext:r}){let{slug:o,rev:i,site:c}=t,d={get(s,f){wiki.local.get(s,function(m,h){m?wiki.origin.get(s,f):(c="local",f(null,h))})}};c?r=[]:c=r.shift(),c===window.location.host&&(c="origin"),c===null&&(c="view");let u={local:wiki.local,origin:wiki.origin,recycler:wiki.recycler,view:d}[c]??wiki.site(c);u.get(`${o}.json`,function(s,f){if(!s)i&&(f=vn.create(i,f)),e(mn(f,c));else if([403,404].includes(s.xhr.status)||s.xhr.status===0)r.length>0?vo({pageInformation:t,whenGotten:e,whenNotGotten:n,localContext:r}):n();else{let m=u.getDirectURL(t.slug),h=`The page handler has run into problems with this request.
<pre class=error>${JSON.stringify(t)}</pre>
The requested url.
<pre class=error>${m}</pre>
The server reported status.
<pre class=error>${s.xhr?.status}</pre>
The error message.
<pre class=error>${s.msg}</pre>
These problems are rarely solved by reporting issues.
There could be additional information reported in the browser's console.log.
More information might be accessible by fetching the page outside of wiki.
<a href="${m}" target="_blank">try-now</a>`,p=mn({title:"Trouble: Can't Get Page"},null);p.addItem({type:"html",text:h}),e(p)}})};de.get=function({whenGotten:t,whenNotGotten:e,pageInformation:n}){if(!n.site){let r;if(r=mo(n.slug)){n.rev&&(r=vn.create(n.rev,r)),t(mn(r,"local"));return}}de.context.length||(de.context=["view"]),vo({pageInformation:n,whenGotten:t,whenNotGotten:e,localContext:de.context.slice()})};de.context=[];var yo=function(t,e,n){let r;if(n.type==="create")r={title:n.item.title,story:[],journal:[]};else{let o;r=mo(e.slug),r||(r=po.atKey(t.data("key")).getRawPage()),r.journal||=[],(o=n.fork)&&(r.journal=r.journal.concat({type:"fork",site:o,date:new Date().getTime()}),delete n.fork)}vn.apply(r,n),wiki.local.put(e.slug,r,function(){yn(t.find(".journal"),n),t.addClass("local")})},Ga=function(t,e,n){let r=go(n),o=po.atKey(t.data("key"));(n.fork||n.type==="fork")&&(r.forkPage=go(o.getRawPage())),wiki.origin.put(e.slug,r,function(i){if(i)n.error={type:i.type,msg:i.msg,response:i.xhr.responseText},yo(t,e,n);else if(o?.apply&&o.apply(n),At.updateSitemap(o),At.updateIndex(o),yn(t.find(".journal"),n),n.type==="fork"&&wiki.local.delete(t.attr("id")),n.type!=="fork"&&n.fork&&n.item.type==="image"){let c=t.find(".item").index(t.find("#"+n.item.id).context);wiki.renderFrom(c)}})};de.put=function(t,e){let n=function(){let i;switch(i=t.data("site")){case"origin":case"local":case"view":return null;case location.host:return null;default:return i}},r={slug:t.attr("id").split("_rev")[0],rev:t.attr("id").split("_rev")[1],site:n(),local:t.hasClass("local")},o=r.site;de.useLocalStorage()&&(r.site||r.local||(e.site=o=location.host)),e.date=new Date().getTime(),e.site==="origin"&&delete e.site,t.removeClass("plugin"),o&&(t.find("h1").prop("title",location.host),t.find("h1 img").attr("src","/favicon.png"),t.find("h1 a").attr("href",`/view/welcome-visitors/view/${r.slug}`).attr("target",location.host),t.data("site",null),t.removeClass("remote"),Ha.setUrl(),e.type!=="fork"&&(e.fork=o,yn(t.find(".journal"),{type:"fork",site:o,date:e.date}))),de.useLocalStorage()||r.site==="local"?yo(t,r,e):Ga(t,r,e)};de.delete=function(t,e,n){t.isRecycler()?wiki.recycler.delete(`${t.getSlug()}.json`,function(r){setTimeout(()=>n(r),300)}):wiki.origin.delete(`${t.getSlug()}.json`,function(r){setTimeout(function(){r||(At.deleteFromSitemap(t),At.deleteFromIndex(t)),n(r)},300)})}});var xe=F((Au,_o)=>{var se;_o.exports=se={};var Qa=t=>(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),Xa=function(t){return console.log("loading url:",t),import(t)},bo=[],Pt={},$o=se.getScript=async function(t,e=()=>{}){if(bo.includes(t))e();else{try{await Xa(t)}catch(n){console.log("getScript: Failed to load:",t,n)}bo.push(t),e()}};se.renderFrom=async function(t){let e=$(".item").slice(t);for(let n of e.toArray()){let r=$(n);if(!r.hasClass("textEditing")){let o=r.data("item");try{r.off(),await se.emit(r.empty(),o)}catch(i){console.error(i)}}}for(let n of e.toArray()){let r=$(n),o=r.data("item");try{let i=await se.get(o.type);i&&i.bind&&await i.bind(r,o)}catch(i){console.error(i)}}};var Za=function(t){return function(n,r){return n.addClass("emit"),t(n,r)}},ec=function(t,e){return async function(r,o,i){r[0].consuming=[];let c=$(".item").index(r),{consumes:d}=window.plugins[t];if(d){let u=[];d.forEach(function(s){let f=$(`.item:lt(${c})`).filter(s);(!f||f.length===0)&&console.log("warn: no items in lineup that produces",s),f.each(function(m,h){let p=$(h).parents(".page").data("key"),x=$(h).attr("data-id");r[0].consuming.push(`${p}/${x}`),u.push(h.promise)})}),await Promise.all(u)}try{r.removeClass("emit"),await(r[0].promise=async function(){return e(r,o)}()),window.plugins[t].processServerEvent&&(console.log("listening for server events",r,o),forward.init(r,o,window.plugins[t].processServerEvent))}catch(u){console.log("plugin emit: unexpected error",u)}}};se.wrap=xo;function xo(t,e){return e.emit=Za(e.emit),e.bind=ec(t,e.bind),e}se.get=se.getPlugin=async function(t,e=()=>{}){if(window.pluginSuccessor[t]&&(wiki.log("plugin successor",t,window.pluginSuccessor[t]),t=window.pluginSuccessor[t]),window.plugins[t])return e(window.plugins[t]),window.plugins[t];Pt[t]||(Pt[t]=async function(){if(window.plugins[t])return window.plugins[t];await $o(`/plugins/${t}/${t}.js`),window.plugins[t]||await $o(`/plugins/${t}.js`);let r=window.plugins[t];return r&&xo(t,r),r}());let n=await Pt[t];return delete Pt[t],n||console.log("Could not find plugin ",t),e(n),n};se.do=se.doPlugin=async function(t,e,n=()=>{}){return t.data("item",e),await se.renderFrom($(".item").index(t)),n()};se.emit=async function(t,e,n=()=>{}){let r=function(i,c){t.append(`<div class="error">
  ${Qa(e.text||"")}
  <button>help</button><br>
</div>`),e.text&&t.find(".error").on("dblclick",d=>wiki.textEditor(t,e)),t.find("button").on("click",function(){t[0].querySelector("dialog")||t.append(`<dialog>
  <h3>${i.toString()}</h3>
  <p> This "${e.type}" plugin won't show.</p>
  <ul>
    <li> Is it available on this server?
    <li> Is its markup correct?
    <li> Can it find necessary data?
    <li> Has network access been interrupted?
    <li> Has its code been tested?
  </ul>
  <p> Developers may open debugging tools and retry the plugin.</p>
  <button class="retry">retry</button>  <button class="close">close</button>
  <p> Learn more
    <a class="external" target="_blank" rel="nofollow"
    href="http://plugins.fed.wiki.org/about-plugins.html"
    title="http://plugins.fed.wiki.org/about-plugins.html">
      About Plugins
      <img src="/images/external-link-ltr-icon.png">
    </a>
  </p>

</dialog>`);let d=t[0].querySelector("dialog");d.addEventListener("click",function(u){u.target===d&&d.close()}),d.showModal(),$(".close").on("click",()=>d.close()),$(".retry").on("click",function(){c.emit.length>2?c.emit(t,e,()=>n()):(c.emit(t,e),n())})})};t.data("pageElement",t.parents(".page")),t.data("item",e);let o=await se.get(e.type);try{if(o==null)throw TypeError(`Can't find plugin for '${e.type}'`);o.emit.length>2?await new Promise(function(i,c){o.emit(t,e,function(){o.bind&&o.bind(t,e),i()})}):o.emit(t,e)}catch(i){console.log("plugin error",i),r(i,o)}n()};se.registerPlugin=(t,e)=>window.plugins[t]=e($)});var Lt=F((Pu,Io)=>{var wn=Te(),So=xe(),tc=Ee(),nc=(t,e)=>setTimeout(e,t),ko=function(t){if($(t).length>0)return $(t).data("item")||$(t).data("staticItem")},rc=function(t,e){wn.put(t.parents(".page:first"),{type:"remove",id:e.id}),t.remove()},oc=function(t,e,n){t||(t=e.parents(".page")),n.id=tc.itemId();let r=$(`<div class="item ${n.type}" data-id=""</div>`);r.data("item",n).data("pageElement",t),e?e.after(r):t.find(".story").append(r),So.do(r,n);let o=ko(e);return nc(500,()=>wn.put(t,{item:n,id:n.id,type:"add",after:o?.id})),r},ic=function(t,e,n){let r=$.extend({},n);t.empty().off(),t.removeClass(e).addClass(r.type);let o=t.parents(".page:first");try{t.data("pageElement",o),t.data("item",r),So.getPlugin(n.type,function(i){i.emit(t,r),i.bind(t,r)})}catch(i){t.append(`<p class='error'>${i}</p>`)}return wn.put(o,{type:"edit",id:r.id,item:r})};Io.exports={createItem:oc,removeItem:rc,getItem:ko,replaceItem:ic}});var bn=F((Lu,Eo)=>{var sc=function(t,e){let n=e;typeof e=="object"&&(n=e[0].outerHTML);let r=window.open("/dialog/#","dialog","popup,height=600,width=800");r.location.pathname!=="/dialog/"?r.addEventListener("load",o=>r.postMessage({title:t,body:n},window.origin)):r.postMessage({title:t,body:n},window.origin)};Eo.exports={open:sc}});var _e=F((Du,Co)=>{var Dt,Re,{asSlug:ac}=le();Co.exports=Re={};Re.resolutionContext=[];Re.escape=Dt=t=>(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");Re.resolveFrom=function(t,e){Re.resolutionContext.push(t);try{e()}finally{Re.resolutionContext.pop()}};Re.resolveLinks=function(t,e=Dt){let n=[],r=function(d){let u=n.length;return n.push(d),`\u3016${u}\u3017`},o=(d,u)=>n[+u],i=function(d,u){let s=ac(u),f=u===u.trim()?"internal":"internal spaced";return s.length?r(`<a class="${f}" href="/${s}.html" data-page-name="${s}" title="${Re.resolutionContext.join(" => ")}">${Dt(u)}</a>`):d},c=(d,u,s,f)=>r(`<a class="external" target="_blank" href="${u}" title="${u}" rel="nofollow">${Dt(f)} <img src="/images/external-link-ltr-icon.png"></a>`);return t=(t||"").replace(/〖(\d+)〗/g,"\u3016 $1 \u3017").replace(/\[\[([^\]]+)\]\]/gi,i).replace(/\[((http|https|ftp):.*?) (.*?)\]/gi,c),e(t).replace(/〖(\d+)〗/g,o)}});var Ot=F((Ou,jo)=>{var je=Te(),at=xe(),cc=ot(),Je=Ce(),To=sn(),Ro=rn(),Ye=$e(),_n=_e(),Po=Ee(),Sn=le(),{newPage:lc}=Sn,{asSlug:Lo}=Sn,{pageEmitter:uc}=Sn,$n=function(t){if($(t).length>0)return $(t).data("item")||$(t).data("staticItem")},fc=function(t,e,n){let r=$.extend({},n);e.data("item",r);let o=Ye.atKey(t.data("key"));return o.getItem(r.id)!=null?(r.alias||(r.alias=r.id),r.id=Po.itemId(),e.attr("data-id",r.id),e.data("id",r.id),e.data("item").id=r.id):r.alias!=null&&o.getItem(r.alias)==null&&(r.id=r.alias,delete r.alias,e.attr("data-id",r.id)),r},Do=(t,e)=>t&&e&&t.get(0)===e.get(0),Oo=t=>t.children().map((e,n)=>$(n).attr("data-id")).get(),dc=function(t,e,n,r){let o,i,c=e.item,d=$n(c),u=c.data("pageElement"),s=u.hasClass("ghost")||u.hasClass("remote");u.hasClass("ghost")||(o={page:u.data().data.title},u.data().site!=null&&(o.site=u.data().site));let f=c.parents(".page:first"),m=f.hasClass("ghost"),h=Do(u,f),p=!h&&!t.shiftKey&&u.attr("id")===f.attr("id"),x={page:f.data().data.title};if(m||p){$(t.target).sortable("cancel");return}if(h){let T=Oo(c.parents(".story:first"));JSON.stringify(T)!==JSON.stringify(r)&&($(".shadow-copy").remove(),c.empty(),i=$(".item").index(c),n<i&&(i=n),at.renderFrom(i),je.put(f,{id:d.id,type:"move",order:T}));return}s||t.shiftKey?$(".shadow-copy").removeClass("shadow-copy").data(c.data()).attr({"data-id":c.attr("data-id")}):je.put(u,{id:d.id,type:"remove",removedTo:x}),c.data("pageElement",f);let D=c.prev(".item"),R=$n(D);d=fc(f,c,d),je.put(f,{id:d.id,type:"add",item:d,after:R?.id,attribution:o}),$(".shadow-copy").remove(),c.empty(),D.after(c),i=$(".item").index(c),n<i&&(i=n),at.renderFrom(i)},hc=function(t,e){let n=e.item.data("pageElement"),r=n.hasClass("ghost")||n.hasClass("remote"),o=e.placeholder.parents(".page:first"),i=o.hasClass("ghost"),c=Do(n,o),d=!c&&n.attr("id")===o.attr("id"),u=r||t.shiftKey&&!c;return i||d&&!t.shiftKey?($("body").css("cursor","no-drop"),$(".shadow-copy").hide()):u?($("body").css("cursor","copy"),$(".shadow-copy").show()):($("body").css("cursor","move"),$(".shadow-copy").hide())},gc=function(t){let e=$("body").css("cursor"),n={connectWith:".page .story",placeholder:"item-placeholder",forcePlaceholderSize:!0,delay:150},r=t.find(".story"),o=null,i=null,c=null,d=function(u){if(u.which===27)return c=!0,r.sortable("cancel")};return r.sortable(n).on("sortstart",function(u,s){let f=s.item;return o=Oo(r),i=$(".item").index(f),c=!1,$("body").on("keydown",d),f.clone().insertAfter(s.placeholder).hide().addClass("shadow-copy").css({width:"",height:"",position:"",zIndex:""}).removeAttr("data-id")}).on("sort",hc).on("sortstop",function(u,s){return $("body").css("cursor",e).off("keydown",d),c||dc(u,s,i,o),$(".shadow-copy").remove()})},Ao=function(t){let e=$(t).parents(".page:first");return Ye.atKey(e.data("key"))},pc=function(t,e){let n=Ao(e.draggable),r=Ao(t.target);uc.dispatchEvent(new CustomEvent("show",{detail:r.merge(n)}))},mc=function(t){let e=t.find(".journal");e.draggable({revert:!0,appendTo:".main",scroll:!1,helper:"clone"}),e.droppable({hoverClass:"ui-state-hover",drop:pc,accept:".journal"})},vc=t=>t.find(".add-factory").on("click",function(e){t.hasClass("ghost")||(e.preventDefault(),yc(t))}),yc=function(t){let e={type:"factory",id:Po.itemId()},n=$("<div />",{class:"item factory"}).data("item",e).attr("data-id",e.id);n.data("pageElement",t),t.find(".story").append(n),at.do(n,e);let r=n.prev(".item"),o=$n(r);je.put(t,{item:e,id:e.id,type:"add",after:o?.id})},wc=function(t){t.preventDefault(),Ye.debugSelfCheck(Array.from($(".page")).map(c=>$(c).data("key")));let e=$(t.target).parents(".page:first"),n=Ye.crumbs(e.data("key"),location.host),r=n[0],o=wiki.site(r).getDirectURL("").split("/")[0];o===""&&(o=window.location.protocol),window.open(`${o}//${n.join("/")}`,r).focus()},bc=function(t,e,n){let r;n.isRecycler()?r="recycler":r=n.getRemoteSite(location.host);let o=n.getRemoteSiteDetails(location.host);t.append(`<h1 title="${o}">
  <span>
    <a href="${n.siteLineup()}" target="${r}">
      <img src="${wiki.site(r).flag()}" height="32px" class="favicon"></a>
    ${_n.escape(n.getTitle())}
  </span>
</h1>`),t.find("a").on("click",wc)},$c=function(t,e,n){e.attr("id").match(/_rev/)&&(e.addClass("ghost"),e.data("rev",n.getRevision()),t.append($(`<h2 class="revision">
  <span>
    ${n.getTimestamp()}
  </span>
</h2>`)))},xc=t=>t.append(`<div class="control-buttons">
<a href="#" class="button fork-page" title="fork this page">${Ro.fork}</a>
<a href="#" class="button add-factory" title="add paragraph">${Ro.add}</a>
</div>`),_c=function(t,e){let n=e.getSlug(),r=Je.backLinks(n);if(Object.keys(r).length>0){let m=[];for(var o in r){var i=r[o];i.sites.sort((h,p)=>(h.date||0)<(p.date||0));for(var c=[],d=0;d<i.sites.length;d++){var u=i.sites[d];if(d<10){var s=i.sites[d-1]?.date===u.date?"":" ";c.unshift(s),c.unshift(`<img class="remote"
    src="${wiki.site(u.site).flag()}"
    data-slug="${o}"
    data-site="${u.site}"
    data-id="${u.itemId}"
    title="${u.site}
${wiki.util.formatElapsedTime(u.date)}">`)}else d===10&&c.unshift(" \u22EF ")}var f=_n.resolveLinks(`[[${i.title}]]`);m.push(`<div style="clear: both;">
  <div style="float: left;">${f}</div>
  <div style="text-align: right;"> ${c.join("")} </div>
</div>`)}m&&t.append(`<details>
  <summary>${m.length} pages link here:</summary>
  ${m.join(`
`)}
</details>`)}},Sc=function(t,e){let n=e.getRemoteSite(location.host),r=e.getSlug();t.append(`<a class="show-page-license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a> .
<a class="show-page-source" href="${wiki.site(n).getDirectURL(r)}.json" title="source">JSON</a> .
<a href= "${wiki.site(n).getDirectURL(r)}.html" date-slug="${r}" target="${n}">${n} </a> .
<a href= "#" class=search>search</a>`)},kc=function(t){let e=t||[];for(let r=e.length-1;r>=0;r--){var n=e[r];if(n.date&&n.type!=="fork")return n.date}},Mo=function(t){let e,n,r,o=t.data("data");if(!o)return;let i=t.data("site")||window.location.host;["view","origin"].includes(i)&&(i=window.location.host);let c=Lo(o.title);if(e=kc(o.journal)){let s,f={newer:[],same:[],older:[]};for(n in Je.sites){var d=Je.sites[n];if(n!==i&&d.sitemap!=null)for(r of d.sitemap)r.slug===c&&(s=r.date>e?f.newer:r.date<e?f.older:f.same,s.push({remoteSite:n,item:r}))}let m=[];for(var u in f){if(s=f[u],!s.length)continue;s.sort((p,x)=>p.item.date<x.item.date);let h=[];for(let p=0;p<s.length&&({remoteSite:n,item:r}=s[p],!(p>=8));p++)h.push(`<img class="remote"
src="${wiki.site(n).flag()}"
data-slug="${c}"
data-site="${n}"
title="${n}">`);m.push(`${h.join("&nbsp;")} ${u}`)}m&&t.find(".twins").html(`<p><span>${m.join(", ")}</span></p>`)}},Ic=function(t,e){e.data("data",t.getRawPage()),t.isRemote()&&e.data("site",t.getRemoteSite()),_n.resolutionContext=t.getContext(),e.empty();let n=$("<div class='paper' />");e.append(n);let[r,o,i,c,d,u,s]=["handle-parent","twins","header","story","backlinks","journal","footer"].map(function(h){if(h!=="journal"||$(".editEnable").is(":visible"))return $("<div />").addClass(h).appendTo(n)}),f=$("<div />").addClass("page-handle").appendTo(r);bc(i,e,t),$c(i,e,t);let m=t.seqItems(function(h,p){let x=$(`<div class="item ${h.type}" data-id="${h.id}">`);return c.append(x),x.data("item",h),p()});return m=m.then(function(){let h=$(".page").index(e[0]),p=$(".item").index($($(".page")[h]).find(".item"));return at.renderFrom(p)}).then(()=>e),$(".editEnable").is(":visible")&&t.seqActions(function(h,p){return h.separator&&To(u,h.separator),To(u,h.action),p()}),Mo(e),_c(d,t),$(".editEnable").is(":visible")&&xc(u),Sc(s,t),f.css({height:`${c.position().top-r.position().top-5}px`}),m},Ec=function(t,e){e.isRemote()||$("img.favicon",t).on("error",()=>at.get("favicon",n=>n.create()))},Fo=function(t,e){t.isLocal()&&e.addClass("local"),t.isRecycler()&&e.addClass("recycler"),t.isRemote()&&e.addClass("remote"),t.isPlugin()&&e.addClass("plugin");let n=Ic(t,e);return Ec(e,t),cc.setUrl(),$(".editEnable").is(":visible")&&(gc(e),mc(e),vc(e)),n},xn=function(t,e){let n=Ye.addPage(t);return e.data("key",n),e.get(0).dataset.key=n,Fo(t,e)},qo=function(t,e){let n=Lo(t),r=lc();r.setTitle(t);let o=[];for(var i in Je.sites){var c=Je.sites[i];if(c.sitemap!=null){var d=c.sitemap.find(s=>s.slug===n);d!=null&&o.push({type:"reference",site:i,slug:n,title:d.title||n,text:d.synopsis||""})}}if(o.length>0){r.addItem({type:"future",text:"We could not find this page where it was expected.",title:t,create:e,context:je.context.filter(s=>!["view","origin","local"].includes(s))}),r.addItem({type:"paragraph",text:"We did find possible duplicate in the current neighborhood."});for(var u of o)r.addItem(u)}else r.addItem({type:"future",text:"We could not find this page.",title:t,create:e,context:je.context.filter(s=>!["view","origin","local"].includes(s))});return r},Cc=function(t){var e=new Promise(function(n,r){let[o,i]=t.attr("id").split("_rev"),c=t.find(".header h1").text().trim(),d={slug:o,rev:i,site:t.data("site")},u=function(){let f=$(`a.internal[href="/${o}.html"]:last`);c=c||f.text()||o;let m=f.parents(".page").data("key"),h=Ye.atKey(m)?.getCreate(),p=qo(c);return e=xn(p,t),e.then(x=>x.addClass("ghost")),n(e)},s=function(f){e=xn(f,t);for(var m of f.getNeighbors(location.host))Je.registerNeighbor(m);return n(e)};return je.get({whenGotten:s,whenNotGotten:u,pageInformation:d})});return e};jo.exports={cycle:Cc,emitTwins:Mo,buildPage:xn,rebuildPage:Fo,newFuturePage:qo}});var Ae=F((Mu,Ko)=>{var No=$e(),zo=Ke(),Uo=Ot(),{asTitle:Tc,asSlug:Rc,pageEmitter:Ac}=le(),kn=function(t,e,n=null){let r;e&&e!=="view"&&(r=e),n||(n=Tc(t));let o=$(`<div class="page" id="${t}" tabindex="-1">
  <div class="paper">
    <div class="twins"> <p> </p> </div>
    <div class="header">
      <h1> <img class="favicon" src="${wiki.site(r).flag()}" height="32px"> ${n} </h1>
    </div>
  </div>
</div>`);return r&&o.data("site",r),o},Bo=(t,e,n=null)=>kn(t,e,n).appendTo(".main").each((r,o)=>Uo.cycle($(o))),Pc=function(t,e,n=null){let r=Rc(t);e&&$(e).nextAll().remove(),e&&No.removeAllAfterKey($(e).data("key")),Bo(r,n,t),zo.set($(".page").last())},Wo=function(t,e={}){e.$page&&$(e.$page).nextAll().remove(),e.$page&&No.removeAllAfterKey($(e.$page).data("key"));let n=t.getSlug();e.rev!=null&&(n+=`_rev${e.rev}`);let r=kn(n).addClass("ghost");r.appendTo($(".main")),Uo.buildPage(t,r),zo.set($(".page").last())};Ac.addEventListener("show",t=>{Wo(t.detail)});Ko.exports={createPage:kn,doInternalLink:Pc,showPage:Bo,showResult:Wo}});var ct=F((Fu,Qo)=>{var Vo=xe(),Go=Lt(),In=Te(),Lc=Ae(),Dc=Ee(),Jo=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),En=function(t,e,n){let r;if(n==null&&(n={}),e.type==="markdown"&&(r=0),!$(".editEnable").is(":visible"))return;let o=function(u){if(u.which===27||(u.ctrlKey||u.metaKey)&&u.which===83)return u.preventDefault(),d.trigger("focusout"),!1;if((u.ctrlKey||u.metaKey)&&u.which===73){let s;return u.preventDefault(),u.shiftKey||(s=$(u.target).parents(".page")),Lc.doInternalLink(`about ${e.type} plugin`,s),!1}if((u.ctrlKey||u.metaKey)&&u.which===77)return u.preventDefault(),t.removeClass(e.type).addClass(e.type="factory"),d.trigger("focusout"),!1;if(e.type==="paragraph"||e.type==="markdown"){let s,f=Oc(d);if(u.which===$.ui.keyCode.BACKSPACE&&f.start===0&&f.start===f.end){let m=t.prev(),h=Go.getItem(m);if(h.type!==e.type)return!1;let p=h[n.field||"text"].length;return s=d.val(),d.val(""),En(m,h,{caret:p,suffix:s}),!1}if(u.which===$.ui.keyCode.ENTER){if(!f)return!1;if(e.type==="markdown"&&r++,e.type==="paragraph"||e.type==="markdown"&&r===2){let m=t.parents(".page"),h=d.val(),p=h.substring(0,f.start).trim();return s=h.substring(f.end).trim(),p===""?(d.val(s),d.trigger("focusout"),Yo(m,t.prev(),e.type,p)):(d.val(p),d.trigger("focusout"),Yo(m,t,e.type,s)),!1}}else e.type==="markdown"&&(r=0)}},i=function(){t.removeClass("textEditing"),d.off();let u=t.parents(".page:first");if(e[n.field||"text"]=d.val())if(t.removeClass("output-item"),t.removeClass((s,f)=>(f.match(/\S+-source/)||[]).join(" ")),Vo.do(t.empty(),e),n.after){if(e[n.field||"text"]==="")return;In.put(u,{type:"add",id:e.id,item:e,after:n.after})}else{if(e[n.field||"text"]===c)return;In.put(u,{type:"edit",id:e.id,item:e})}else{n.after||In.put(u,{type:"remove",id:e.id});let s=$(".item").index(t);t.remove(),Vo.renderFrom(s)}};if(!t.hasClass("textEditing")){t.addClass("textEditing"),t.off();var c=e[n.field||"text"]||"",d=$(`<textarea>${Jo(c)}${Jo(n.suffix||"")}</textarea>`).on("focusout",i).on("keydown",o);t.html(d),n.caret?Ho(d,n.caret):n.append?(Ho(d,d.val().length),d.scrollTop(d[0].scrollHeight-d.height())):d.trigger("focus")}},Yo=function(t,e,n,r){let o={type:n,id:Dc.itemId(),text:r},i=$(`<div class="item ${o.type}" data-id=${o.id}></div>`);i.data("item",o).data("pageElement",t),e.after(i);let c=Go.getItem(e);En(i,o,{after:c?.id})},Oc=function(t){let e=t.get(0);if(document.selection){e.focus();let n=document.selection.createRange();n.moveStart("character",-e.value.length);let r=n.text.length;return{start:r,end:r}}else return{start:e.selectionStart,end:e.selectionEnd}},Ho=function(t,e){let n=t.get(0);if(n){if(n.createTextRange){let r=n.createTextRange();r.move("character",e),r.select()}else n.setSelectionRange(e,e);n.focus()}};Qo.exports={textEditor:En}});var Xo=F((qu,Cn)=>{var Mc;Cn.exports=Mc={};var Fc=xe();Cn.exports=t=>Fc.getScript("/security/security.js",()=>window.plugins.security.setup(t))});var Pn=F((ju,ti)=>{var U={},Mt=Ar();U.local=Mt.local;U.origin=Mt.origin;U.recycler=Mt.recycler;U.site=Mt.site;U.asSlug=le().asSlug;U.newPage=le().newPage;var Tn=Lt();U.removeItem=Tn.removeItem;U.createItem=Tn.createItem;U.getItem=Tn.getItem;var qc=bn();U.dialog=qc.open;var Rn=Ae();U.createPage=Rn.createPage;U.doInternalLink=Rn.doInternalLink;U.showResult=Rn.showResult;var lt=xe();U.getScript=lt.getScript;U.getPlugin=lt.getPlugin;U.doPlugin=lt.doPlugin;U.registerPlugin=lt.registerPlugin;U.renderFrom=lt.renderFrom;U.getData=function(t){let e;if(t){let n=$(".item").index(t);return e=$(`.item:lt(${n})`).filter(".chart,.data,.calculator").last(),e?e.data("item").data:{}}else return e=$(".chart,.data,.calculator").last(),e?e.data("item").data:{}};U.getDataNodes=function(t){let e;if(t){let n=$(".item").index(t);return e=$(`.item:lt(${n})`).filter(".chart,.data,.calculator").toArray().reverse(),$(e)}else return e=$(".chart,.data,.calculator").toArray().reverse(),$(e)};U.log=function(...t){console?.log&&console.log(...t||[])};var Zo=Ce();U.neighborhood=Zo.sites;U.neighborhoodObject=Zo;var ei=Te();U.pageHandler=ei;U.useLocalStorage=ei.useLocalStorage;var An=_e();U.resolveFrom=An.resolveFrom;U.resolveLinks=An.resolveLinks;U.resolutionContext=An.resolutionContext;var jc=ct();U.textEditor=jc.textEditor;U.util=Me();U.security=Xo();U.createSynopsis=xt();U.lineup=$e();ti.exports=U});var Ln=F((Nu,ni)=>{var Nc=function(t){let e;return(e=t.originalEvent.dataTransfer)!=null&&e.types.includes("Files")?e.files[0]:null},zc=function(t){let e;if((e=t.originalEvent.dataTransfer)!=null&&e.types!=null&&(e.types.includes("text/uri-list")||e.types.includes("text/x-moz-url"))){let n=e.getData("URL");if(n?.length)return n}return null},Uc=function(t){let e;if(e=t.match(/^https?:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/)){let n,r={};return[,n,,r.site,r.slug]=e,["view","local","origin"].includes(r.site)&&(r.site=n),r}return null},Bc=function(t){return new URL(t).pathname.match(/\.(jpg|jpeg|png)$/i)?t:null},Wc=function(t){return new URL(t).pathname.match(/\.(svg)$/i)?t:null},Kc=function(t){let e=new URL(t);try{e.searchParams.get("source")==="video"&&(e=new URL(e.searchParams.get("url")))}catch{}switch(e.hostname){case"www.youtube.com":return e.searchParams.get("list")!=null?{text:`YOUTUBE PLAYLIST ${e.searchParams.get("list")}`}:{text:`YOUTUBE ${e.searchParams.get("v")}`};case"youtu.be":return e.searchParams.get("list")!=null?{text:`YOUTUBE PLAYLIST ${e.searchParams.get("list")}`}:{text:`YOUTUBE ${e.pathname.substring(1)}`};case"vimeo.com":return{text:`VIMEO ${e.pathname.substring(1)}`};case"archive.org":return{text:`ARCHIVE ${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`};case"tedxtalks.ted.com":return{text:`TEDX ${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`};case"www.ted.com":return{text:`TED ${e.pathname.substring(e.pathname.lastIndexOf("/")+1)}`};default:return null}},Vc=t=>function(e){let n,r,o,i,c=function(d){e.preventDefault(),e.stopPropagation()};if(i=zc(e)){let d,u,s,f;if((u=Uc(i))&&(r=t.page))return c(r(u));if((f=Kc(i))&&(r=t.video))return c(r(f));if((d=Bc(i))&&(r=t.image))return c(r(d));if((s=Wc(i))&&(r=t.svg))return c(r(s));o={url:i}}if(n=Nc(e)){if(r=t.file)return c(r(n));o={file:n}}if(r=t.punt)return o||(o={dt:e.dataTransfer,types:e.dataTransfer!=null?e.dataTransfer.types:void 0}),c(r(o))};ni.exports={dispatch:Vc}});var ii=F((zu,oi)=>{var ye=!1,oe=null,ve=null,Ne=null,He=null,Ge=null,Jc=function(){$(document).on("keydown",function(t){t.keyCode===16&&Yc(t)}).on("keyup",function(t){t.keyCode===16&&Hc(t)}),$(".main").on("mouseenter",".item",Qc).on("mouseleave",".item",Xc).on("mouseenter",".action",Zc).on("mouseleave",".action",el).on("align-item",".page",rl).on("mouseenter",".backlinks .remote",tl).on("mouseleave",".backlinks .remote",nl)},Yc=function(t){if(ye=t.shiftKey,ye&&oe){let e;if($(".emit").addClass("highlight"),e=ve||He){let n;$(`[data-id=${e}]`).addClass("target");let r=(n=$(this).parents(".page:first")).data("key"),o=oe.offset().top;$(".page").trigger("align-item",{key:r,id:ve,place:o})}Ne&&(Ge=Ne.consuming,Ge&&Ge.forEach(n=>ri(n).addClass("consumed")))}},Hc=function(t){ye=t.shiftKey,ye||($(".emit").removeClass("highlight"),$(".item, .action").removeClass("target"),$(".item").removeClass("consumed"))},Gc=function(t){let e=$(".page").filter((n,r)=>$(r).data("key")===t);return e.length===0?null:(e.length>1&&console.log("warning: more than one page found for",key,e),e)},ri=function(t){let[e,n]=t.split("/"),r=Gc(e);return!r||(oe=r.find(`.item[data-id=${n}]`),oe.length===0)?null:(oe.length>1&&console.log("warning: more than one item found for",t,oe),oe)},Qc=function(t){if(ve=(oe=$(this)).attr("data-id"),Ne=oe[0],ye){let e;$(`[data-id=${ve}]`).addClass("target");let n=(e=$(this).parents(".page:first")).data("key"),r=oe.offset().top;$(".page").trigger("align-item",{key:n,id:ve,place:r}),Ge=Ne.consuming,Ge&&Ge.forEach(o=>ri(o).addClass("consumed"))}},Xc=function(t){ye&&($(".item, .action").removeClass("target"),$(".item").removeClass("consumed")),ve=null,oe=null,Ne=null},Zc=function(t){if(He=$(this).data("id"),ye){$(`[data-id=${He}]`).addClass("target");let e=$(this).parents(".page:first").data("key");$(".page").trigger("align-item",{key:e,id:He})}},el=function(t){ye&&$(`[data-id=${He}]`).removeClass("target"),He=null},tl=function(t){if(ve=(oe=$(this)).attr("data-id"),Ne=oe[0],ye){let e;$(`[data-id=${ve}]`).addClass("target");let n=(e=$(this).parents(".page:first")).data("key"),r=oe.offset().top;$(".page").trigger("align-item",{key:n,id:ve,place:r})}},nl=function(t){ye&&$(".item, .action").removeClass("target"),ve=null,Ne=null},rl=function(t,e){let n=$(this);if(n.data("key")===e.key||(oe=n.find(`.item[data-id=${e.id}]`),!oe.length))return;let r=e.place||n.height()/2,o=oe.offset().top+n.scrollTop()-r;n.stop().animate({scrollTop:o},"slow")};oi.exports={bind:Jc}});var ai=F((Uu,si)=>{var ol=_e(),il=$e(),sl=()=>`<p>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
</p><p>
This work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  Creative Commons Attribution-ShareAlike 4.0 International License
</a>.
</p><p>
This license applies uniformly to all contributions
by all authors. Where authors quote other sources
they do so within the terms of fair use or other
compatiable terms.
</p>`,al=function(t,e){if(!t.journal)return"";let n={},r=[];for(var o of t.journal.slice(0).reverse())if(o.site&&(e=o.site),o.attribution?.site&&(e=o.attribution.site),o.type!=="fork"&&!n[e]){var i=wiki.site(e).getDirectURL(""),c=wiki.site(e).flag();r.push(`<a href="${i}" target="_blank"><img class="remote" title="${e}" src="${c}"> ${e}</a>`),n[e]=!0}return r.length>0?`<p>
  Author's Sites:
</p><p>
  ${r.join("<br>")}
</p>`:""},cl=function(t){return t?.provenance?`<p>
  Created From:
</p><p>
  ${ol.resolveLinks(t.provenance)}
</p>`:""},ll=function(t){let e=il.atKey(t.data("key")),n=e.getRawPage(),r=e.getRemoteSite(location.hostname);return sl()+al(n,r)+cl(n.journal[0])};si.exports={info:ll}});var li=F(()=>{var Pe=Te(),ut=ot(),ze=Ke(),Ue=Ot(),he=$e(),ul=Ln(),Dn=bn(),Qe=Ae(),fl=ii(),dl=ai(),hl=xe(),gl=Me(),{asSlug:ci}=le(),{newPage:On}=le(),pl=t=>t.filter(e=>e.editor).forEach(function(e){console.log(`${e.name} Plugin declares an editor, so pre-loading the plugin`),wiki.getPlugin(e.name.toLowerCase(),function(n){(!n.editor||typeof n.editor!="function")&&console.log(`${e.name} Plugin ERROR.
Cannot find \`editor\` function in plugin. Set \`"editor": false\` in factory.json or
Correct the plugin to include all three of \`{emit, bind, editor}\``)})});wiki.origin.get("system/factories.json",function(t,e){Array.isArray(e)&&(window.catalog=e,pl(e))});$(function(){$(document).on("keydown",function(s){let f=s.which==37?-1:s.which==39?1:null;if(f&&!$(s.target).is(":input")){let m=$(".page"),h=m.index($(".active"))+f;0<=h&&h<m.length&&ze.set(m.eq(h))}(s.ctrlKey||s.metaKey)&&s.which===83&&(s.preventDefault(),$("input.search").trigger("focus"))}),$(window).on("popstate",ut.show),$(document).ajaxError(function(s,f,m){f.status===0||f.status===404||console.log("ajax error",s,f,m)});let n=s=>`${s}`.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),r=function(s){if(s?.type==="application/json"){let f=new FileReader;f.onload=function(m){let{result:h}=m.target,p=JSON.parse(h),x=On();if(x.setTitle(`Import from ${s.name}`),p.title&&p.story&&p.journal){let C=ci(p.title),D=p;p={},p[C]=D,x.addParagraph(`Import of one page
(${n(s.size)} bytes)
from a page-json file dated ${s.lastModifiedDate}.`)}else x.addParagraph(`Import of ${Object.keys(p).length} pages
(${n(s.size)} bytes)
from an export file dated ${s.lastModifiedDate}.`);x.addItem({type:"importer",pages:p}),Qe.showResult(x)},f.readAsText(s)}},o=(s,f)=>Pe.delete(s,f,function(m){if(!m)if(s.isRecycler())f.addClass("ghost");else{let h=Ue.newFuturePage(s.getTitle(),s.getCreate());s.become(h),f.attr("id",h.getSlug()),Ue.rebuildPage(s,f),f.addClass("ghost")}}),i=function(s,f){if(!s)return f(null);console.log("getTemplate",s),Pe.get({whenGotten(m,h){f(m)},whenNotGotten(){f(null)},pageInformation:{slug:s}})},c=function(s,f){let m;return s.preventDefault(),s.shiftKey||(m=$(s.target).parents(".page")),Qe.doInternalLink(f,m,$(s.target).data("site")),!1},d=null;$(".main").sortable({handle:".page-handle",cursor:"grabbing"}).on("sortstart",function(s,f){if(!f.item.hasClass("page"))return;ze.set(f.item,!0),d=$(".page").index(f.item[0])}).on("sort",function(s,f){if(!f.item.hasClass("page"))return;let m=f.item;s.pageY<0&&$(".page").length>2?m.addClass("pending-remove"):m.removeClass("pending-remove")}).on("sortstop",function(s,f){if(!f.item.hasClass("page"))return;let m=f.item,h=$(".page"),p=h.index($(".active")),x=$(".item").index(m.find(".item")[0]);if(m.hasClass("pending-remove")){if(h.length===1)return;he.removeKey(m.data("key")),m.remove(),ze.set($(".page")[p])}else he.changePageIndex(m.data("key"),p),ze.set($(".active")),d<p&&(p=d,x=$(".item").index($($(".page")[p]).find(".item")[0]));hl.renderFrom(x),ut.setUrl(),window.debug&&ut.debugStates()}).on("click",".show-page-license",function(s){s.preventDefault();let f=$(this).parents(".page"),m=f.find("h1").text().trim();Dn.open(`License for ${m}`,dl.info(f))}).on("click",".show-page-source",function(s){s.preventDefault();let f=$(this).parents(".page"),m=he.atKey(f.data("key")).getRawPage();Dn.open(`JSON for ${m.title}`,$("<pre/>").text(JSON.stringify(m,null,2)))}).on("click",".page",function(s){if(!$(s.target).is("a"))return ze.set(this)}).on("click",".internal",function(s){let f=$(s.target),m=f.text()||f.data("pageName");return m=`${m}`,Pe.context=$(s.target).attr("title").split(" => "),c(s,m)}).on("click","img.remote",function(s){if($(s.target).attr("src").startsWith("data:image/png")){s.preventDefault();let f=$(s.target).data("site");wiki.site(f).refresh(function(){})}else{let f=$(s.target).data("slug");return Pe.context=[$(s.target).data("site")],c(s,f)}}).on("dblclick",".revision",function(s){s.preventDefault();let f=$(this).parents(".page"),m=he.atKey(f.data("key")).getRawPage(),h=m.journal.length-1,p=m.journal[h],x=JSON.stringify(p,null,2);Dn.open(`Revision ${h}, ${p.type} action`,$("<pre/>").text(x))}).on("click",".action",function(s){s.preventDefault();let f=$(s.target),m=f.data("slug");if(f.is(".fork")&&m)return Pe.context=[f.data("site")],c(s,m.split("_")[0]);{let h=$(this).parents(".page"),p=h.data("key"),x=he.atKey(p).getSlug(),C=$(this).parent().children().not(".separator").index(f);if(C<0)return;s.shiftKey||h.nextAll().remove(),s.shiftKey||he.removeAllAfterKey(p),Qe.createPage(`${x}_rev${C}`,h.data("site")).appendTo($(".main")).each((D,R)=>Ue.cycle($(R))),ze.set($(".page").last())}}).on("mouseenter",".action",function(s){let f=$(s.target),{action:m}=f.data();f.attr("title",gl.formatActionTitle(m))}).on("click",".fork-page",function(s){let f=$(s.target).parents(".page");if(f.find(".future").length)return;let m=he.atKey(f.data("key"));if(f.attr("id").match(/_rev0$/))o(m,f);else{let x={type:"fork"};if(f.hasClass("local")){if(Pe.useLocalStorage())return;f.removeClass("local")}else m.isRecycler()?f.removeClass("recycler"):m.isRemote()&&(x.site=m.getRemoteSite());f.data("rev")!=null&&f.find(".revision").remove(),f.removeClass("ghost"),f.attr("id",f.attr("id").replace(/_rev\d+$/,"")),ut.setUrl();let C=$(".page");for(let D=0;D<C.length;D++){var h=C[D],p=$(h).data("site");$(h).data("key")!==f.data("key")&&$(h).attr("id")===f.attr("id")&&[void 0,null,"view","origin","local","recycler",location.host].includes(p)&&$(h).addClass("ghost")}Pe.put(f,x)}}).on("click","button.create",s=>i($(s.target).data("slug"),function(f){let m=$(s.target).parents(".page:first");m.removeClass("ghost");let h=he.atKey(m.data("key"));h.become(f);let p=h.getRawPage();Ue.rebuildPage(h,m.empty()),Pe.put(m,{type:"create",id:p.id,item:{title:p.title,story:p.story}})})).on("mouseenter mouseleave",".score",function(s){console.log("in .score..."),$(".main").trigger("thumb",$(s.target).data("thumb"))}).on("click","a.search",function(s){let f=$(s.target).parents(".page"),m=f.data("key"),h=he.atKey(m),p=On();p.setTitle(`Search from '${h.getTitle()}'`),p.addParagraph(`Search for pages related to '${h.getTitle()}'.
Each search on this page will find pages related in a different way.
Choose the search of interest. Be patient.`),p.addParagraph("Find pages with links to this title."),p.addItem({type:"search",text:`SEARCH LINKS ${h.getSlug()}`}),p.addParagraph("Find pages with titles similar to this title."),p.addItem({type:"search",text:`SEARCH SLUGS ${h.getSlug()}`}),p.addParagraph("Find pages neighboring  this site."),p.addItem({type:"search",text:`SEARCH SITES ${h.getRemoteSite(location.host)}`}),p.addParagraph("Find pages sharing any of these items."),p.addItem({type:"search",text:`SEARCH ANY ITEMS ${h.getRawPage().story.map(x=>x.id).join(" ")}`}),s.shiftKey||f.nextAll().remove(),s.shiftKey||he.removeAllAfterKey(m),Qe.showResult(p)}).on("dragenter",s=>s.preventDefault()).on("dragover",s=>s.preventDefault()).on("drop",ul.dispatch({page:s=>{Qe.doInternalLink(s.slug,null,s.site)},file:s=>{r(s)}})),$(".provider input").on("click",function(){$("footer input:first").val($(this).attr("data-provider")),$("footer form").submit()}),$("body").on("new-neighbor-done",(s,f)=>$(".page").each((m,h)=>Ue.emitTwins($(h))));let u=s=>new Promise(function(f,m){let h=ci(s);wiki.origin.get(`${h}.json`,(p,x)=>f({title:s,slug:h,type:"reference",text:(p?p.msg:x?.story[0].text)||""}))});$("<span>&nbsp; \u2630 </span>").css({cursor:"pointer"}).appendTo("footer").on("click",function(){let s=On();if(s.setTitle("Selected Plugin Pages"),s.addParagraph("Installed plugins offer these utility pages:"),!window.catalog)return;let f=[];for(var m of window.catalog)if(m.pages)for(var h of m.pages)f.push(h);Promise.all(f.map(u)).then(function(p){p.forEach(x=>s.addItem(x)),Qe.showResult(s)})}),$("<span>&nbsp; wiki <span class=editEnable>\u2714\uFE0E</span> &nbsp; </span>").css({cursor:"pointer"}).appendTo("footer").on("click",function(){$(".editEnable").toggle(),$(".page").each(function(){let s=$(this),f=he.atKey(s.data("key"));Ue.rebuildPage(f,s.empty())})}),isAuthenticated||$(".editEnable").toggle(),fl.bind(),$(function(){ut.first();let s=$(".page").toArray();var f=function(m){if(m.length===0){ze.set($(".page").last());return}let h=$(m.shift());Ue.cycle(h).then(()=>f(m))};f(s)})})});var pi=F((Ku,gi)=>{var ml=Ae(),hi=Pn(),ui=Ce(),fi=Me(),Le=null,di=0,vl=t=>t.hasOwnProperty("links"),yl=t=>`<span class="neighbor" data-site="${t}">
<div class="wait">
  <img src="${hi.site(t).flag()}" title="${t}">
</div>
</span>`,wl=t=>Le=t.sites,bl=function(t){let e,n,r="";r+=`${t}
`;try{n=Le[t].sitemap.length}catch(o){e=o,n=0}try{Le[t].sitemap.some(vl)?r+=`${n} pages with 2-way links
`:r+=`${n} pages
`}catch(o){e=o,console.info("+++ sitemap not valid for ",t)}return Le[t].lastModified!==0&&(r+=`Updated ${fi.formatElapsedTime(Le[t].lastModified)}`,Le[t].nextCheck-Date.now()>0&&(r+=`, next refresh ${fi.formatDelay(Le[t].nextCheck)}`)),r},$l=function(){let t=$(".neighborhood");$("body").on("new-neighbor",(e,n)=>t.append(yl(n))).on("new-neighbor-done",function(e,n){let r;try{r=Le[n].sitemap.length}catch(o){let i=o;r=0}di=Object.values(ui.sites).reduce(function(o,i){try{return i.sitemapRequestInflight?o:o+i.sitemap.length}catch{return o}},0),$(".searchbox .pages").text(`${di} pages`)}).on("mouseenter",".neighbor",function(e){let n=$(e.currentTarget),{site:r}=n.data();n.find("img:first").attr("title",bl(r))}).on("click",".neighbor img",function(e){if($(e.target).parent().hasClass("fail")){$(e.target).parent().removeClass("fail").addClass("wait");let n=$(e.target).attr("title").split(`
`)[0];hi.site(n).refresh(function(){console.log("about to retry neighbor"),ui.retryNeighbor(n)})}else ml.doInternalLink("welcome-visitors",null,this.title.split(`
`)[0])})};gi.exports={inject:wl,bind:$l}});var bi=F((Ju,wi)=>{var mi=Te(),Mn=Ee(),yi=Ae(),Vu=Ke(),{newPage:xl}=le(),Fn=_e(),qn=le(),_l=t=>JSON.parse(JSON.stringify(t)),Sl=function(t,e){let n=e.slug;e.title&&(n||=qn.asSlug(e.title)),n||="welcome-visitors";let r=e.site;Fn.resolveFrom(r,()=>t.append(`<p>
<img class='remote'
  src='${wiki.site(r).flag()}'
  title='${r}'
  data-site="${r}"
  data-slug="${n}"
>
${Fn.resolveLinks(`[[${e.title||n}]]`)}
\u2014
${Fn.resolveLinks(e.text)}
</p>`))},vi=function(t,e){return t.preventDefault(),t.shiftKey||(qn=$(t.target).parents(".page")),yi.doInternalLink(e,qn,$(t.target).data("site")),!1},kl=function({neighborhood:t}){return{incrementalSearch:function(r){if(r.length<2){$(".incremental-search").remove();return}if($(".incremental-search").length===0){let m=$(".searchbox").position();$("<div/>").css("left",`${m.left}px`).css("bottom",`${m.top+$(".searchbox").height()}px`).addClass("incremental-search").on("click",".internal",function(h){h.target.nodeName==="SPAN"&&(h.target=$(h.target).parent()[0]);let p=$(h.target).data("pageName");return p=`${p}`,mi.context=$(h.target).attr("title").split(" => "),vi(h,p)}).on("click","img.remote",function(h){if($(h.target).attr("src").startsWith("data:image/png")){h.preventDefault();let p=$(h.target).data("site");wiki.site(p).refresh(function(){})}else{let p=$(h.target).data("slug");return mi.context=[$(h.target).data("site")],vi(h,p)}return!1}).appendTo($(".searchbox"))}let o=t.search(r),i=r.split(" ").map(m=>m.toLowerCase()).filter(String),c=new RegExp("\\b("+r.split(" ").map(m=>m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).filter(String).join("|")+")","i"),d=m=>m.split(c).map(function(h){return i.includes(h.toLowerCase())?`{{${h}}}`:h}).join(""),u=$(".incremental-search").empty();(!o.finds||o.finds.length===0)&&$("<div/>").text("No results found").addClass("no-results").appendTo(u);let s=0,f=100;for(let m of o.finds){if(s++,s===f+1&&$("<div/>").text(`${o.finds.length-f} results omitted`).addClass("omitted-results").appendTo(u),s>f)continue;let h=$("<div/>").appendTo(u),p={id:Mn.itemId(),type:"reference",site:m.site,slug:m.page.slug,title:d(m.page.title),text:d(m.page.synopsis)};Sl(h,p),h.html(h.html().split(new RegExp("({{.*?}})","i")).map(x=>x.indexOf("{{")===0?`<span class='search-term'>${x.substring(2,x.length-2)}</span>`:x).join(""))}},performSearch:function(r){let o=t.search(r);if(o.finds&&o.finds.length===1){$(".incremental-search").find(".internal").trigger("click"),$(".incremental-search").remove();return}$(".incremental-search").remove();let{tally:i}=o,c={};c.title=`Search for '${r}'`,c.story=[],c.story.push({type:"paragraph",id:Mn.itemId(),text:`String '${r}' found on ${i.finds||"none"} of ${i.pages||"no"} pages from ${i.sites||"no"} sites.
Text matched on ${i.title||"no"} titles, ${i.text||"no"} paragraphs, and ${i.slug||"no"} slugs.
Elapsed time ${i.msec} milliseconds.`});for(var d of o.finds)c.story.push({id:Mn.itemId(),type:"reference",site:d.site,slug:d.page.slug,title:d.page.title,text:d.page.synopsis||""});c.journal=[{type:"create",item:{title:c.title,story:_l(c.story)},date:Date.now()}];let u=xl(c);yi.showResult(u)}}};wi.exports=kl});var xi=F((Yu,$i)=>{var Il=bi(),Ft=null,El=t=>Ft=Il({neighborhood:t}),Cl=function(){return $("input.search").attr("autocomplete","off"),$("input.search").on("keydown",function(t){t.keyCode===27&&$(".incremental-search").remove()}),$("input.search").on("keypress",function(t){if(t.keyCode!==13)return;let e=$(this).val();Ft.performSearch(e),$(this).val("")}),$("input.search").on("focus",function(t){let e=$(this).val();Ft.incrementalSearch(e)}),$("input.search").on("input",function(t){let e=$(this).val();Ft.incrementalSearch(e)})};$i.exports={inject:El,bind:Cl}});var ki=F(()=>{var jn=Ce(),_i=pi(),Si=xi(),Tl=ot(),Rl=Ae();$(function(){Si.inject(jn),Si.bind(),_i.inject(jn),_i.bind(),window.seedNeighbors&&seedNeighbors.split(",").forEach(t=>jn.registerNeighbor(t.trim())),Tl.inject(Rl)})});var Ei=F((Qu,Ii)=>{var Al=ct(),Nn=_e(),Pl=le(),Ll=function(t,e){let n=e.slug;!n&&e.title&&(n=Pl.asSlug(e.title)),n||(n="welcome-visitors");let r=e.site;Nn.resolveFrom(r,()=>t.append(`
<p>
<img class='remote'
  src='${wiki.site(r).flag()}'
  title='${r}'
  data-site="${r}"
  data-slug="${n}"
>
${Nn.resolveLinks(`[[${e.title||n}]]`)}
\u2014
${Nn.resolveLinks(e.text)}
</p>`))},Dl=(t,e)=>t.on("dblclick",()=>Al.textEditor(t,e));Ii.exports={emit:Ll,bind:Dl}});var Ti=F((Xu,Ci)=>{var Ol=Ce(),Ml=xe(),Fl=_e(),ql=Te(),qt=ct(),jl=xt(),Nl=Ln(),zl=Ke(),Ul=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),Bl=function(t,e){t.append("<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>");let n=function(){let o=t.find("p").append(`<br>Or Choose a Plugin
<center>
<table style="text-align:left;">
<tr><td><ul id=format><td><ul id=data><td><ul id=other>`);for(var i of window.catalog)if(i&&i.category){var c=i.category;["format","data"].includes(c)||(c="other"),o.find("#"+c).append(`<li><a class="menu" href="#" title="${i.title}">${i.name}</a></li>`)}o.find("a.menu").on("click",function(d){let u=d.target.text,s=u.toLowerCase();if(t.removeClass("factory").addClass(e.type=s),t.off(),d.preventDefault(),zl.set(t.parents(".page")),window.catalog.find(m=>u===m.name).editor)try{window.plugins[s].editor(t,e)}catch(m){console.log(`${u} Plugin editor failed: ${m}. Falling back to textEditor`),qt.textEditor(t,e)}else qt.textEditor(t,e)})},r=()=>t.append(`<p>${Fl.resolveLinks(e.prompt,Ul)}</b>`);e.prompt?r():window.catalog?n():wiki.origin.get("system/factories.json",function(o,i){window.catalog=i,n()})},Wl=function(t,e){let n=function(){t.empty().off(),t.removeClass("factory").addClass(e.type);let s=t.parents(".page:first");try{t.data("pageElement",s),t.data("item",e),Ml.getPlugin(e.type,function(f){f.emit(t,e),f.bind(t,e)})}catch(f){t.append(`<p class='error'>${f}</p>`)}ql.put(s,{type:"edit",id:e.id,item:e})},r=function(s){e.prompt=`Unexpected Item
We can't make sense of the drop.
Try something else or see [[About Factory Plugin]].`,s.userAgent=navigator.userAgent,e.punt=s,n()},o=s=>wiki.site(s.site).get(`${s.slug}.json`,function(f,m){f||(e.type="reference",e.site=s.site,e.slug=s.slug,e.title=m.title||s.slug,e.text=jl(m),n(),e.site&&Ol.registerNeighbor(e.site))}),i=function(s){e.type="video",e.text=`${s.text}
(double-click to edit caption)
`,n()},c=function(s){document.documentElement.style.cursor="wait",fetch(s).then(function(f){if(f.ok)return f.blob();throw new Error("Unable to fetch image")}).then(function(f){let m=s.split("/").pop().split("#")[0].split("?")[0],h=new FileReader;h.readAsDataURL(f),h.onload=function(p){let x=p.target.result;window.plugins.image.editor({imageDataURL:x,filename:m,imageSourceURL:s,imageCaption:`Remote image [${s} source]`,$item:t,item:e})}})},d=function(s){document.documentElement.style.cursor="wait",fetch(s).then(function(f){if(f.ok)return f;throw new Error("Unable to fetch svg")}).then(f=>f.text()).then(function(f){document.documentElement.style.cursor="default",e.type="html",e.source=s,e.text=f+`<p>[${s} Source]</p>`,n()})},u=function(s){if(s!=null){let[f,m]=s.type.split("/"),h=new FileReader;f==="image"?m.startsWith("svg")?(h.onload=function(p){let{result:x}=p.target;e.type="html",e.text=x,n()},h.readAsText(s)):(h.onload=function(p){let x=p.target.result;window.plugins.image.editor({imageDataURL:x,filename:s.name,imageCaption:"Uploaded image",$item:t,item:e})},h.readAsDataURL(s)):f==="text"?(h.onload=function(p){let{result:x}=p.target;if(m==="csv"){let C;e.type="data",e.columns=(C=Kl(x))[0],e.data=Vl(C),e.text=s.fileName}else e.type="paragraph",e.text=x;n()},h.readAsText(s)):r({name:s.name,type:s.type,size:s.size,fileName:s.fileName,lastModified:s.lastModified})}};t.on("dblclick",function(s){if($(".editEnable").is(":visible"))return s.shiftKey?qt.textEditor(t,e,{field:"prompt"}):(t.removeClass("factory").addClass(e.type="paragraph"),t.off(),qt.textEditor(t,e))}),t.on("dragenter",s=>s.preventDefault()),t.on("dragover",s=>s.preventDefault()),t.on("drop",Nl.dispatch({page:o,file:u,video:i,image:c,svg:d,punt:r}))},Kl=function(t,e){e=e||",";let n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),r=[[]],o=null;for(;o=n.exec(t);){var i,c=o[1];c.length&&c!==e&&r.push([]),o[2]?i=o[2].replace(new RegExp('""',"g"),'"'):i=o[3],r[r.length-1].push(i)}return r},Vl=function(t){let e=t.shift(),n=function(i){let c={};return i.forEach(function(d,u){let s=e[u];d!=null&&d.match(/\S/)&&d!=="NULL"&&(c[s]=d)}),c},r=[];for(var o of t)r.push(n(o));return r};Ci.exports={emit:Bl,bind:Wl}});var Ai=F((Zu,Ri)=>{var Jl=ct(),Yl=_e(),Hl=Lt(),Gl=function(t){return t.match(/<(i|b|p|a|h\d|hr|br|li|img|div|span|table|blockquote)\b.*?>/i)?"html":"markdown"},Ql=(t,e)=>{for(var n of e.text.split(/\n\n+/))n.match(/\S/)&&t.append(`<p>${Yl.resolveLinks(n)}</p>`)},Xl=(t,e)=>t.on("dblclick",function(n){return n.shiftKey?(e.type=Gl(e.text),Hl.replaceItem(t,"paragraph",e)):Jl.textEditor(t,e,{append:!0})});Ri.exports={emit:Ql,bind:Xl}});var Li=F((ef,Pi)=>{var Zl=_e(),eu=Ce(),tu=$e(),nu=Ot(),ru=function(t,e){let n,r;t.append(`${e.text}`);let o=t.parents(".page:first")[0].id;if(wiki.asSlug(e.title)!==o?t.append("<p style='font-weight: 500;'>Page titles with leading/trailing spaces cannot be used to create a new page.</p>"):t.append('<br><br><button class="create">create</button> new blank page'),(r=e.create?.source?.transport)&&(t.append(`<br><button class="transport" data-slug=${e.slug}>create</button> transport from ${r}`),t.append("<p class=caption> unavailable</p>"),$.get("//localhost:4020",()=>t.find(".caption").text("ready"))),(n=eu.sites[location.host])&&n.sitemap)for(var i of n.sitemap)i.slug.match(/-template$/)&&t.append(`<br><button class="create" data-slug=${i.slug}>create</button> from ${Zl.resolveLinks(`[[${i.title}]]`)}`);(e.context?.length>0||isSecureContext&&!location.hostname.endsWith("localhost"))&&t.append("<p>Some possible places to look for this page, if it exists.</p>");let c=!0;if(e.context?.length>0){let d=[];e.context.forEach(u=>{if(wiki.neighborhood[u].lastModified===0){let s=wiki.asSlug(e.title);d.push(`<p>
  <img class='remote'
    src='${wiki.site(u).flag()}'
    title="${u}">
  <a class='internal'
    href='http://${u}/${s}.html'
    target='_blank'>${u}</a>
</p>`)}}),d.length>0?t.append(`<div>
  <p>Try on remote wiki where it was expected to be found, opens in a new tab.</p>
  ${d.join(`
`)}
</div>`):(c=!1,t.append(`<div>
  <p>None of the expected places were unreachable.</p>
</div>`))}else c=!1;if(isSecureContext&&c&&!location.hostname.endsWith("localhost")){let d=document.URL.replace(/^https/,"http").replace(/\/\w+\/[\w-]+$/,""),u=d.length>55?d.substring(0,55)+"...":d;t.append(`<div>
  <p>Try opening lineup using http, opens in a new tab.</p>
  <p><a href="${d}" target="_blank"><img class='remote' src='/favicon.png' title='${location.host}'> ${u}</a>.</p>
</div>
<div>
  <p>
</div>`)}},ou=(t,e)=>t.find("button.transport").on("click",function(n){t.find(".caption").text("waiting");let r={title:t.parents(".page").data("data").title,create:e.create},o={type:"POST",url:e.create.source.transport,dataType:"json",contentType:"application/json",data:JSON.stringify(r)};$.ajax(o).done(function(i){t.find(".caption").text("ready");let c=wiki.newPage(i),d=t.parents(".page"),u=tu.atKey(d.data("key"));u.become(c,c),i=u.getRawPage(),nu.rebuildPage(u,d.empty())})});Pi.exports={emit:ru,bind:ou}});var Oi=F((tf,Di)=>{var iu=Me(),su=Ae(),{newPage:au}=le(),cu=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),lu=function(t,e){let n=function(r){let o=[];for(var i in r){var c=r[i],d=`<a href=${i}>${cu(c.title)||i}</a>`;if(c.journal){var u;(u=c.journal[c.journal.length-1].date)?d+=` &nbsp; from ${iu.formatElapsedTime(u)}`:d+=` &nbsp; from revision ${c.journal.length-1}`}o.push(d)}return o.join("<br>")};return t.append(`<p style="background-color:#eee;padding:15px;">
  ${n(e.pages)}
</p>`)},uu=(t,e)=>t.find("a").on("click",function(n){let r,o=$(n.target).attr("href");n.shiftKey||(r=$(n.target).parents(".page"));let i=au(e.pages[o]);su.showResult(i,{$page:r})});Di.exports={emit:lu,bind:uu}});var Mi=F(()=>{var ft=xe();window.plugins={reference:ft.wrap("reference",Ei()),factory:ft.wrap("factory",Ti()),paragraph:ft.wrap("paragraph",Ai()),future:ft.wrap("future",Li()),importer:ft.wrap("importer",Oi())};window.pluginSuccessor={federatedWiki:"reference",mathjax:"math"}});window.name=window.location.host;window.wiki=Pn();li();ki();Mi();})();
/*! Bundled license information:

localforage/dist/localforage.js:
  (*!
      localForage -- Offline Storage, Improved
      Version 1.10.0
      https://localforage.github.io/localForage
      (c) 2013-2017 Mozilla, Apache License 2.0
  *)
*/
//# sourceMappingURL=client.js.map
