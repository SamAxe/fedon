{
  "version": 3,
  "sources": ["../node_modules/async/internal/onlyOnce.js", "../node_modules/async/internal/setImmediate.js", "../node_modules/async/internal/DoublyLinkedList.js", "../node_modules/async/internal/initialParams.js", "../node_modules/async/asyncify.js", "../node_modules/async/internal/wrapAsync.js", "../node_modules/async/internal/queue.js", "../node_modules/async/queue.js", "../node_modules/localforage/dist/localforage.js", "../lib/siteAdapter.js", "../lib/util.js", "../lib/random.js", "../lib/revision.js", "../lib/synopsis.js", "../lib/page.js", "../lib/active.js", "../lib/lineup.js", "../lib/state.js", "../lib/actionSymbols.js", "../lib/addToJournal.js", "../node_modules/minisearch/node_modules/tslib/tslib.es6.js", "../node_modules/minisearch/src/SearchableMap/TreeIterator.ts", "../node_modules/minisearch/src/SearchableMap/fuzzySearch.ts", "../node_modules/minisearch/src/SearchableMap/SearchableMap.ts", "../node_modules/minisearch/src/MiniSearch.ts", "../lib/neighborhood.js", "../lib/pageHandler.js", "../lib/plugin.js", "../lib/itemz.js", "../lib/dialog.js", "../lib/resolve.js", "../lib/refresh.js", "../lib/link.js", "../lib/editor.js", "../lib/security.js", "../lib/wiki.js", "../lib/drop.js", "../lib/target.js", "../lib/license.js", "../lib/legacy.js", "../lib/neighbors.js", "../lib/search.js", "../lib/searchbox.js", "../lib/bind.js", "../lib/reference.js", "../lib/factory.js", "../lib/paragraph.js", "../lib/future.js", "../lib/importer.js", "../lib/plugins.js", "../client.js"],
  "sourcesContent": ["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = onlyOnce;\nfunction onlyOnce(fn) {\n    return function (...args) {\n        if (fn === null) throw new Error(\"Callback was already called.\");\n        var callFn = fn;\n        fn = null;\n        callFn.apply(this, args);\n    };\n}\nmodule.exports = exports.default;", "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.fallback = fallback;\nexports.wrap = wrap;\n/* istanbul ignore file */\n\nvar hasQueueMicrotask = exports.hasQueueMicrotask = typeof queueMicrotask === 'function' && queueMicrotask;\nvar hasSetImmediate = exports.hasSetImmediate = typeof setImmediate === 'function' && setImmediate;\nvar hasNextTick = exports.hasNextTick = typeof process === 'object' && typeof process.nextTick === 'function';\n\nfunction fallback(fn) {\n    setTimeout(fn, 0);\n}\n\nfunction wrap(defer) {\n    return (fn, ...args) => defer(() => fn(...args));\n}\n\nvar _defer;\n\nif (hasQueueMicrotask) {\n    _defer = queueMicrotask;\n} else if (hasSetImmediate) {\n    _defer = setImmediate;\n} else if (hasNextTick) {\n    _defer = process.nextTick;\n} else {\n    _defer = fallback;\n}\n\nexports.default = wrap(_defer);", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n// Simple doubly linked list (https://en.wikipedia.org/wiki/Doubly_linked_list) implementation\n// used for queues. This implementation assumes that the node provided by the user can be modified\n// to adjust the next and last properties. We implement only the minimal functionality\n// for queue support.\nclass DLL {\n    constructor() {\n        this.head = this.tail = null;\n        this.length = 0;\n    }\n\n    removeLink(node) {\n        if (node.prev) node.prev.next = node.next;else this.head = node.next;\n        if (node.next) node.next.prev = node.prev;else this.tail = node.prev;\n\n        node.prev = node.next = null;\n        this.length -= 1;\n        return node;\n    }\n\n    empty() {\n        while (this.head) this.shift();\n        return this;\n    }\n\n    insertAfter(node, newNode) {\n        newNode.prev = node;\n        newNode.next = node.next;\n        if (node.next) node.next.prev = newNode;else this.tail = newNode;\n        node.next = newNode;\n        this.length += 1;\n    }\n\n    insertBefore(node, newNode) {\n        newNode.prev = node.prev;\n        newNode.next = node;\n        if (node.prev) node.prev.next = newNode;else this.head = newNode;\n        node.prev = newNode;\n        this.length += 1;\n    }\n\n    unshift(node) {\n        if (this.head) this.insertBefore(this.head, node);else setInitial(this, node);\n    }\n\n    push(node) {\n        if (this.tail) this.insertAfter(this.tail, node);else setInitial(this, node);\n    }\n\n    shift() {\n        return this.head && this.removeLink(this.head);\n    }\n\n    pop() {\n        return this.tail && this.removeLink(this.tail);\n    }\n\n    toArray() {\n        return [...this];\n    }\n\n    *[Symbol.iterator]() {\n        var cur = this.head;\n        while (cur) {\n            yield cur.data;\n            cur = cur.next;\n        }\n    }\n\n    remove(testFn) {\n        var curr = this.head;\n        while (curr) {\n            var { next } = curr;\n            if (testFn(curr)) {\n                this.removeLink(curr);\n            }\n            curr = next;\n        }\n        return this;\n    }\n}\n\nexports.default = DLL;\nfunction setInitial(dll, node) {\n    dll.length = 1;\n    dll.head = dll.tail = node;\n}\nmodule.exports = exports.default;", "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nexports.default = function (fn) {\n    return function (...args /*, callback*/) {\n        var callback = args.pop();\n        return fn.call(this, args, callback);\n    };\n};\n\nmodule.exports = exports.default;", "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = asyncify;\n\nvar _initialParams = require('./internal/initialParams.js');\n\nvar _initialParams2 = _interopRequireDefault(_initialParams);\n\nvar _setImmediate = require('./internal/setImmediate.js');\n\nvar _setImmediate2 = _interopRequireDefault(_setImmediate);\n\nvar _wrapAsync = require('./internal/wrapAsync.js');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Take a sync function and make it async, passing its return value to a\n * callback. This is useful for plugging sync functions into a waterfall,\n * series, or other async functions. Any arguments passed to the generated\n * function will be passed to the wrapped function (except for the final\n * callback argument). Errors thrown will be passed to the callback.\n *\n * If the function passed to `asyncify` returns a Promise, that promises's\n * resolved/rejected state will be used to call the callback, rather than simply\n * the synchronous return value.\n *\n * This also means you can asyncify ES2017 `async` functions.\n *\n * @name asyncify\n * @static\n * @memberOf module:Utils\n * @method\n * @alias wrapSync\n * @category Util\n * @param {Function} func - The synchronous function, or Promise-returning\n * function to convert to an {@link AsyncFunction}.\n * @returns {AsyncFunction} An asynchronous wrapper of the `func`. To be\n * invoked with `(args..., callback)`.\n * @example\n *\n * // passing a regular synchronous function\n * async.waterfall([\n *     async.apply(fs.readFile, filename, \"utf8\"),\n *     async.asyncify(JSON.parse),\n *     function (data, next) {\n *         // data is the result of parsing the text.\n *         // If there was a parsing error, it would have been caught.\n *     }\n * ], callback);\n *\n * // passing a function returning a promise\n * async.waterfall([\n *     async.apply(fs.readFile, filename, \"utf8\"),\n *     async.asyncify(function (contents) {\n *         return db.model.create(contents);\n *     }),\n *     function (model, next) {\n *         // `model` is the instantiated model object.\n *         // If there was an error, this function would be skipped.\n *     }\n * ], callback);\n *\n * // es2017 example, though `asyncify` is not needed if your JS environment\n * // supports async functions out of the box\n * var q = async.queue(async.asyncify(async function(file) {\n *     var intermediateStep = await processFile(file);\n *     return await somePromise(intermediateStep)\n * }));\n *\n * q.push(files);\n */\nfunction asyncify(func) {\n    if ((0, _wrapAsync.isAsync)(func)) {\n        return function (...args /*, callback*/) {\n            const callback = args.pop();\n            const promise = func.apply(this, args);\n            return handlePromise(promise, callback);\n        };\n    }\n\n    return (0, _initialParams2.default)(function (args, callback) {\n        var result;\n        try {\n            result = func.apply(this, args);\n        } catch (e) {\n            return callback(e);\n        }\n        // if result is Promise object\n        if (result && typeof result.then === 'function') {\n            return handlePromise(result, callback);\n        } else {\n            callback(null, result);\n        }\n    });\n}\n\nfunction handlePromise(promise, callback) {\n    return promise.then(value => {\n        invokeCallback(callback, null, value);\n    }, err => {\n        invokeCallback(callback, err && (err instanceof Error || err.message) ? err : new Error(err));\n    });\n}\n\nfunction invokeCallback(callback, error, value) {\n    try {\n        callback(error, value);\n    } catch (err) {\n        (0, _setImmediate2.default)(e => {\n            throw e;\n        }, err);\n    }\n}\nmodule.exports = exports.default;", "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.isAsyncIterable = exports.isAsyncGenerator = exports.isAsync = undefined;\n\nvar _asyncify = require('../asyncify.js');\n\nvar _asyncify2 = _interopRequireDefault(_asyncify);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction isAsync(fn) {\n    return fn[Symbol.toStringTag] === 'AsyncFunction';\n}\n\nfunction isAsyncGenerator(fn) {\n    return fn[Symbol.toStringTag] === 'AsyncGenerator';\n}\n\nfunction isAsyncIterable(obj) {\n    return typeof obj[Symbol.asyncIterator] === 'function';\n}\n\nfunction wrapAsync(asyncFn) {\n    if (typeof asyncFn !== 'function') throw new Error('expected a function');\n    return isAsync(asyncFn) ? (0, _asyncify2.default)(asyncFn) : asyncFn;\n}\n\nexports.default = wrapAsync;\nexports.isAsync = isAsync;\nexports.isAsyncGenerator = isAsyncGenerator;\nexports.isAsyncIterable = isAsyncIterable;", "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = queue;\n\nvar _onlyOnce = require('./onlyOnce.js');\n\nvar _onlyOnce2 = _interopRequireDefault(_onlyOnce);\n\nvar _setImmediate = require('./setImmediate.js');\n\nvar _setImmediate2 = _interopRequireDefault(_setImmediate);\n\nvar _DoublyLinkedList = require('./DoublyLinkedList.js');\n\nvar _DoublyLinkedList2 = _interopRequireDefault(_DoublyLinkedList);\n\nvar _wrapAsync = require('./wrapAsync.js');\n\nvar _wrapAsync2 = _interopRequireDefault(_wrapAsync);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction queue(worker, concurrency, payload) {\n    if (concurrency == null) {\n        concurrency = 1;\n    } else if (concurrency === 0) {\n        throw new RangeError('Concurrency must not be zero');\n    }\n\n    var _worker = (0, _wrapAsync2.default)(worker);\n    var numRunning = 0;\n    var workersList = [];\n    const events = {\n        error: [],\n        drain: [],\n        saturated: [],\n        unsaturated: [],\n        empty: []\n    };\n\n    function on(event, handler) {\n        events[event].push(handler);\n    }\n\n    function once(event, handler) {\n        const handleAndRemove = (...args) => {\n            off(event, handleAndRemove);\n            handler(...args);\n        };\n        events[event].push(handleAndRemove);\n    }\n\n    function off(event, handler) {\n        if (!event) return Object.keys(events).forEach(ev => events[ev] = []);\n        if (!handler) return events[event] = [];\n        events[event] = events[event].filter(ev => ev !== handler);\n    }\n\n    function trigger(event, ...args) {\n        events[event].forEach(handler => handler(...args));\n    }\n\n    var processingScheduled = false;\n    function _insert(data, insertAtFront, rejectOnError, callback) {\n        if (callback != null && typeof callback !== 'function') {\n            throw new Error('task callback must be a function');\n        }\n        q.started = true;\n\n        var res, rej;\n        function promiseCallback(err, ...args) {\n            // we don't care about the error, let the global error handler\n            // deal with it\n            if (err) return rejectOnError ? rej(err) : res();\n            if (args.length <= 1) return res(args[0]);\n            res(args);\n        }\n\n        var item = q._createTaskItem(data, rejectOnError ? promiseCallback : callback || promiseCallback);\n\n        if (insertAtFront) {\n            q._tasks.unshift(item);\n        } else {\n            q._tasks.push(item);\n        }\n\n        if (!processingScheduled) {\n            processingScheduled = true;\n            (0, _setImmediate2.default)(() => {\n                processingScheduled = false;\n                q.process();\n            });\n        }\n\n        if (rejectOnError || !callback) {\n            return new Promise((resolve, reject) => {\n                res = resolve;\n                rej = reject;\n            });\n        }\n    }\n\n    function _createCB(tasks) {\n        return function (err, ...args) {\n            numRunning -= 1;\n\n            for (var i = 0, l = tasks.length; i < l; i++) {\n                var task = tasks[i];\n\n                var index = workersList.indexOf(task);\n                if (index === 0) {\n                    workersList.shift();\n                } else if (index > 0) {\n                    workersList.splice(index, 1);\n                }\n\n                task.callback(err, ...args);\n\n                if (err != null) {\n                    trigger('error', err, task.data);\n                }\n            }\n\n            if (numRunning <= q.concurrency - q.buffer) {\n                trigger('unsaturated');\n            }\n\n            if (q.idle()) {\n                trigger('drain');\n            }\n            q.process();\n        };\n    }\n\n    function _maybeDrain(data) {\n        if (data.length === 0 && q.idle()) {\n            // call drain immediately if there are no tasks\n            (0, _setImmediate2.default)(() => trigger('drain'));\n            return true;\n        }\n        return false;\n    }\n\n    const eventMethod = name => handler => {\n        if (!handler) {\n            return new Promise((resolve, reject) => {\n                once(name, (err, data) => {\n                    if (err) return reject(err);\n                    resolve(data);\n                });\n            });\n        }\n        off(name);\n        on(name, handler);\n    };\n\n    var isProcessing = false;\n    var q = {\n        _tasks: new _DoublyLinkedList2.default(),\n        _createTaskItem(data, callback) {\n            return {\n                data,\n                callback\n            };\n        },\n        *[Symbol.iterator]() {\n            yield* q._tasks[Symbol.iterator]();\n        },\n        concurrency,\n        payload,\n        buffer: concurrency / 4,\n        started: false,\n        paused: false,\n        push(data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return;\n                return data.map(datum => _insert(datum, false, false, callback));\n            }\n            return _insert(data, false, false, callback);\n        },\n        pushAsync(data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return;\n                return data.map(datum => _insert(datum, false, true, callback));\n            }\n            return _insert(data, false, true, callback);\n        },\n        kill() {\n            off();\n            q._tasks.empty();\n        },\n        unshift(data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return;\n                return data.map(datum => _insert(datum, true, false, callback));\n            }\n            return _insert(data, true, false, callback);\n        },\n        unshiftAsync(data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return;\n                return data.map(datum => _insert(datum, true, true, callback));\n            }\n            return _insert(data, true, true, callback);\n        },\n        remove(testFn) {\n            q._tasks.remove(testFn);\n        },\n        process() {\n            // Avoid trying to start too many processing operations. This can occur\n            // when callbacks resolve synchronously (#1267).\n            if (isProcessing) {\n                return;\n            }\n            isProcessing = true;\n            while (!q.paused && numRunning < q.concurrency && q._tasks.length) {\n                var tasks = [],\n                    data = [];\n                var l = q._tasks.length;\n                if (q.payload) l = Math.min(l, q.payload);\n                for (var i = 0; i < l; i++) {\n                    var node = q._tasks.shift();\n                    tasks.push(node);\n                    workersList.push(node);\n                    data.push(node.data);\n                }\n\n                numRunning += 1;\n\n                if (q._tasks.length === 0) {\n                    trigger('empty');\n                }\n\n                if (numRunning === q.concurrency) {\n                    trigger('saturated');\n                }\n\n                var cb = (0, _onlyOnce2.default)(_createCB(tasks));\n                _worker(data, cb);\n            }\n            isProcessing = false;\n        },\n        length() {\n            return q._tasks.length;\n        },\n        running() {\n            return numRunning;\n        },\n        workersList() {\n            return workersList;\n        },\n        idle() {\n            return q._tasks.length + numRunning === 0;\n        },\n        pause() {\n            q.paused = true;\n        },\n        resume() {\n            if (q.paused === false) {\n                return;\n            }\n            q.paused = false;\n            (0, _setImmediate2.default)(q.process);\n        }\n    };\n    // define these as fixed properties, so people get useful errors when updating\n    Object.defineProperties(q, {\n        saturated: {\n            writable: false,\n            value: eventMethod('saturated')\n        },\n        unsaturated: {\n            writable: false,\n            value: eventMethod('unsaturated')\n        },\n        empty: {\n            writable: false,\n            value: eventMethod('empty')\n        },\n        drain: {\n            writable: false,\n            value: eventMethod('drain')\n        },\n        error: {\n            writable: false,\n            value: eventMethod('error')\n        }\n    });\n    return q;\n}\nmodule.exports = exports.default;", "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nexports.default = function (worker, concurrency) {\n    var _worker = (0, _wrapAsync2.default)(worker);\n    return (0, _queue2.default)((items, cb) => {\n        _worker(items[0], cb);\n    }, concurrency, 1);\n};\n\nvar _queue = require('./internal/queue.js');\n\nvar _queue2 = _interopRequireDefault(_queue);\n\nvar _wrapAsync = require('./internal/wrapAsync.js');\n\nvar _wrapAsync2 = _interopRequireDefault(_wrapAsync);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = exports.default;", "/*!\n    localForage -- Offline Storage, Improved\n    Version 1.10.0\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.localforage = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw (f.code=\"MODULE_NOT_FOUND\", f)}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\n'use strict';\nvar immediate = _dereq_(1);\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n\n},{\"1\":1}],3:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nif (typeof global.Promise !== 'function') {\n  global.Promise = _dereq_(2);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"2\":2}],4:[function(_dereq_,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getIDB() {\n    /* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */\n    try {\n        if (typeof indexedDB !== 'undefined') {\n            return indexedDB;\n        }\n        if (typeof webkitIndexedDB !== 'undefined') {\n            return webkitIndexedDB;\n        }\n        if (typeof mozIndexedDB !== 'undefined') {\n            return mozIndexedDB;\n        }\n        if (typeof OIndexedDB !== 'undefined') {\n            return OIndexedDB;\n        }\n        if (typeof msIndexedDB !== 'undefined') {\n            return msIndexedDB;\n        }\n    } catch (e) {\n        return;\n    }\n}\n\nvar idb = getIDB();\n\nfunction isIndexedDBValid() {\n    try {\n        // Initialize IndexedDB; fall back to vendor-prefixed versions\n        // if needed.\n        if (!idb || !idb.open) {\n            return false;\n        }\n        // We mimic PouchDB here;\n        //\n        // We test for openDatabase because IE Mobile identifies itself\n        // as Safari. Oh the lulz...\n        var isSafari = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform);\n\n        var hasFetch = typeof fetch === 'function' && fetch.toString().indexOf('[native code') !== -1;\n\n        // Safari <10.1 does not meet our requirements for IDB support\n        // (see: https://github.com/pouchdb/pouchdb/issues/5572).\n        // Safari 10.1 shipped with fetch, we can use that to detect it.\n        // Note: this creates issues with `window.fetch` polyfills and\n        // overrides; see:\n        // https://github.com/localForage/localForage/issues/856\n        return (!isSafari || hasFetch) && typeof indexedDB !== 'undefined' &&\n        // some outdated implementations of IDB that appear on Samsung\n        // and HTC Android devices <4.4 are missing IDBKeyRange\n        // See: https://github.com/mozilla/localForage/issues/128\n        // See: https://github.com/mozilla/localForage/issues/272\n        typeof IDBKeyRange !== 'undefined';\n    } catch (e) {\n        return false;\n    }\n}\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\nfunction createBlob(parts, properties) {\n    /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n    parts = parts || [];\n    properties = properties || {};\n    try {\n        return new Blob(parts, properties);\n    } catch (e) {\n        if (e.name !== 'TypeError') {\n            throw e;\n        }\n        var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder;\n        var builder = new Builder();\n        for (var i = 0; i < parts.length; i += 1) {\n            builder.append(parts[i]);\n        }\n        return builder.getBlob(properties.type);\n    }\n}\n\n// This is CommonJS because lie is an external dependency, so Rollup\n// can just ignore it.\nif (typeof Promise === 'undefined') {\n    // In the \"nopromises\" build this will just throw if you don't have\n    // a global promise object, but it would throw anyway later.\n    _dereq_(3);\n}\nvar Promise$1 = Promise;\n\nfunction executeCallback(promise, callback) {\n    if (callback) {\n        promise.then(function (result) {\n            callback(null, result);\n        }, function (error) {\n            callback(error);\n        });\n    }\n}\n\nfunction executeTwoCallbacks(promise, callback, errorCallback) {\n    if (typeof callback === 'function') {\n        promise.then(callback);\n    }\n\n    if (typeof errorCallback === 'function') {\n        promise[\"catch\"](errorCallback);\n    }\n}\n\nfunction normalizeKey(key) {\n    // Cast the key to a string, as that's all we can set as a key.\n    if (typeof key !== 'string') {\n        console.warn(key + ' used as a key, but it is not a string.');\n        key = String(key);\n    }\n\n    return key;\n}\n\nfunction getCallback() {\n    if (arguments.length && typeof arguments[arguments.length - 1] === 'function') {\n        return arguments[arguments.length - 1];\n    }\n}\n\n// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n\nvar DETECT_BLOB_SUPPORT_STORE = 'local-forage-detect-blob-support';\nvar supportsBlobs = void 0;\nvar dbContexts = {};\nvar toString = Object.prototype.toString;\n\n// Transaction Modes\nvar READ_ONLY = 'readonly';\nvar READ_WRITE = 'readwrite';\n\n// Transform a binary string to an array buffer, because otherwise\n// weird stuff happens when you try to work with the binary string directly.\n// It is known.\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction _binStringToArrayBuffer(bin) {\n    var length = bin.length;\n    var buf = new ArrayBuffer(length);\n    var arr = new Uint8Array(buf);\n    for (var i = 0; i < length; i++) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return buf;\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\n// Code borrowed from PouchDB. See:\n// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js\n//\nfunction _checkBlobSupportWithoutCaching(idb) {\n    return new Promise$1(function (resolve) {\n        var txn = idb.transaction(DETECT_BLOB_SUPPORT_STORE, READ_WRITE);\n        var blob = createBlob(['']);\n        txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob, 'key');\n\n        txn.onabort = function (e) {\n            // If the transaction aborts now its due to not being able to\n            // write to the database, likely due to the disk being full\n            e.preventDefault();\n            e.stopPropagation();\n            resolve(false);\n        };\n\n        txn.oncomplete = function () {\n            var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n            var matchedEdge = navigator.userAgent.match(/Edge\\//);\n            // MS Edge pretends to be Chrome 42:\n            // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n            resolve(matchedEdge || !matchedChrome || parseInt(matchedChrome[1], 10) >= 43);\n        };\n    })[\"catch\"](function () {\n        return false; // error, so assume unsupported\n    });\n}\n\nfunction _checkBlobSupport(idb) {\n    if (typeof supportsBlobs === 'boolean') {\n        return Promise$1.resolve(supportsBlobs);\n    }\n    return _checkBlobSupportWithoutCaching(idb).then(function (value) {\n        supportsBlobs = value;\n        return supportsBlobs;\n    });\n}\n\nfunction _deferReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Create a deferred object representing the current database operation.\n    var deferredOperation = {};\n\n    deferredOperation.promise = new Promise$1(function (resolve, reject) {\n        deferredOperation.resolve = resolve;\n        deferredOperation.reject = reject;\n    });\n\n    // Enqueue the deferred operation.\n    dbContext.deferredOperations.push(deferredOperation);\n\n    // Chain its promise to the database readiness.\n    if (!dbContext.dbReady) {\n        dbContext.dbReady = deferredOperation.promise;\n    } else {\n        dbContext.dbReady = dbContext.dbReady.then(function () {\n            return deferredOperation.promise;\n        });\n    }\n}\n\nfunction _advanceReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Resolve its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.resolve();\n        return deferredOperation.promise;\n    }\n}\n\nfunction _rejectReadiness(dbInfo, err) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Reject its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.reject(err);\n        return deferredOperation.promise;\n    }\n}\n\nfunction _getConnection(dbInfo, upgradeNeeded) {\n    return new Promise$1(function (resolve, reject) {\n        dbContexts[dbInfo.name] = dbContexts[dbInfo.name] || createDbContext();\n\n        if (dbInfo.db) {\n            if (upgradeNeeded) {\n                _deferReadiness(dbInfo);\n                dbInfo.db.close();\n            } else {\n                return resolve(dbInfo.db);\n            }\n        }\n\n        var dbArgs = [dbInfo.name];\n\n        if (upgradeNeeded) {\n            dbArgs.push(dbInfo.version);\n        }\n\n        var openreq = idb.open.apply(idb, dbArgs);\n\n        if (upgradeNeeded) {\n            openreq.onupgradeneeded = function (e) {\n                var db = openreq.result;\n                try {\n                    db.createObjectStore(dbInfo.storeName);\n                    if (e.oldVersion <= 1) {\n                        // Added when support for blob shims was added\n                        db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n                    }\n                } catch (ex) {\n                    if (ex.name === 'ConstraintError') {\n                        console.warn('The database \"' + dbInfo.name + '\"' + ' has been upgraded from version ' + e.oldVersion + ' to version ' + e.newVersion + ', but the storage \"' + dbInfo.storeName + '\" already exists.');\n                    } else {\n                        throw ex;\n                    }\n                }\n            };\n        }\n\n        openreq.onerror = function (e) {\n            e.preventDefault();\n            reject(openreq.error);\n        };\n\n        openreq.onsuccess = function () {\n            var db = openreq.result;\n            db.onversionchange = function (e) {\n                // Triggered when the database is modified (e.g. adding an objectStore) or\n                // deleted (even when initiated by other sessions in different tabs).\n                // Closing the connection here prevents those operations from being blocked.\n                // If the database is accessed again later by this instance, the connection\n                // will be reopened or the database recreated as needed.\n                e.target.close();\n            };\n            resolve(db);\n            _advanceReadiness(dbInfo);\n        };\n    });\n}\n\nfunction _getOriginalConnection(dbInfo) {\n    return _getConnection(dbInfo, false);\n}\n\nfunction _getUpgradedConnection(dbInfo) {\n    return _getConnection(dbInfo, true);\n}\n\nfunction _isUpgradeNeeded(dbInfo, defaultVersion) {\n    if (!dbInfo.db) {\n        return true;\n    }\n\n    var isNewStore = !dbInfo.db.objectStoreNames.contains(dbInfo.storeName);\n    var isDowngrade = dbInfo.version < dbInfo.db.version;\n    var isUpgrade = dbInfo.version > dbInfo.db.version;\n\n    if (isDowngrade) {\n        // If the version is not the default one\n        // then warn for impossible downgrade.\n        if (dbInfo.version !== defaultVersion) {\n            console.warn('The database \"' + dbInfo.name + '\"' + \" can't be downgraded from version \" + dbInfo.db.version + ' to version ' + dbInfo.version + '.');\n        }\n        // Align the versions to prevent errors.\n        dbInfo.version = dbInfo.db.version;\n    }\n\n    if (isUpgrade || isNewStore) {\n        // If the store is new then increment the version (if needed).\n        // This will trigger an \"upgradeneeded\" event which is required\n        // for creating a store.\n        if (isNewStore) {\n            var incVersion = dbInfo.db.version + 1;\n            if (incVersion > dbInfo.version) {\n                dbInfo.version = incVersion;\n            }\n        }\n\n        return true;\n    }\n\n    return false;\n}\n\n// encode a blob for indexeddb engines that don't support blobs\nfunction _encodeBlob(blob) {\n    return new Promise$1(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = function (e) {\n            var base64 = btoa(e.target.result || '');\n            resolve({\n                __local_forage_encoded_blob: true,\n                data: base64,\n                type: blob.type\n            });\n        };\n        reader.readAsBinaryString(blob);\n    });\n}\n\n// decode an encoded blob\nfunction _decodeBlob(encodedBlob) {\n    var arrayBuff = _binStringToArrayBuffer(atob(encodedBlob.data));\n    return createBlob([arrayBuff], { type: encodedBlob.type });\n}\n\n// is this one of our fancy encoded blobs?\nfunction _isEncodedBlob(value) {\n    return value && value.__local_forage_encoded_blob;\n}\n\n// Specialize the default `ready()` function by making it dependent\n// on the current database operations. Thus, the driver will be actually\n// ready when it's been initialized (default) *and* there are no pending\n// operations on the database (initiated by some other instances).\nfunction _fullyReady(callback) {\n    var self = this;\n\n    var promise = self._initReady().then(function () {\n        var dbContext = dbContexts[self._dbInfo.name];\n\n        if (dbContext && dbContext.dbReady) {\n            return dbContext.dbReady;\n        }\n    });\n\n    executeTwoCallbacks(promise, callback, callback);\n    return promise;\n}\n\n// Try to establish a new db connection to replace the\n// current one which is broken (i.e. experiencing\n// InvalidStateError while creating a transaction).\nfunction _tryReconnect(dbInfo) {\n    _deferReadiness(dbInfo);\n\n    var dbContext = dbContexts[dbInfo.name];\n    var forages = dbContext.forages;\n\n    for (var i = 0; i < forages.length; i++) {\n        var forage = forages[i];\n        if (forage._dbInfo.db) {\n            forage._dbInfo.db.close();\n            forage._dbInfo.db = null;\n        }\n    }\n    dbInfo.db = null;\n\n    return _getOriginalConnection(dbInfo).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        // store the latest db reference\n        // in case the db was upgraded\n        dbInfo.db = dbContext.db = db;\n        for (var i = 0; i < forages.length; i++) {\n            forages[i]._dbInfo.db = db;\n        }\n    })[\"catch\"](function (err) {\n        _rejectReadiness(dbInfo, err);\n        throw err;\n    });\n}\n\n// FF doesn't like Promises (micro-tasks) and IDDB store operations,\n// so we have to do it with callbacks\nfunction createTransaction(dbInfo, mode, callback, retries) {\n    if (retries === undefined) {\n        retries = 1;\n    }\n\n    try {\n        var tx = dbInfo.db.transaction(dbInfo.storeName, mode);\n        callback(null, tx);\n    } catch (err) {\n        if (retries > 0 && (!dbInfo.db || err.name === 'InvalidStateError' || err.name === 'NotFoundError')) {\n            return Promise$1.resolve().then(function () {\n                if (!dbInfo.db || err.name === 'NotFoundError' && !dbInfo.db.objectStoreNames.contains(dbInfo.storeName) && dbInfo.version <= dbInfo.db.version) {\n                    // increase the db version, to create the new ObjectStore\n                    if (dbInfo.db) {\n                        dbInfo.version = dbInfo.db.version + 1;\n                    }\n                    // Reopen the database for upgrading.\n                    return _getUpgradedConnection(dbInfo);\n                }\n            }).then(function () {\n                return _tryReconnect(dbInfo).then(function () {\n                    createTransaction(dbInfo, mode, callback, retries - 1);\n                });\n            })[\"catch\"](callback);\n        }\n\n        callback(err);\n    }\n}\n\nfunction createDbContext() {\n    return {\n        // Running localForages sharing a database.\n        forages: [],\n        // Shared database.\n        db: null,\n        // Database readiness (promise).\n        dbReady: null,\n        // Deferred operations on the database.\n        deferredOperations: []\n    };\n}\n\n// Open the IndexedDB database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    // Get the current context of the database;\n    var dbContext = dbContexts[dbInfo.name];\n\n    // ...or create a new context.\n    if (!dbContext) {\n        dbContext = createDbContext();\n        // Register the new context in the global container.\n        dbContexts[dbInfo.name] = dbContext;\n    }\n\n    // Register itself as a running localForage in the current context.\n    dbContext.forages.push(self);\n\n    // Replace the default `ready()` function with the specialized one.\n    if (!self._initReady) {\n        self._initReady = self.ready;\n        self.ready = _fullyReady;\n    }\n\n    // Create an array of initialization states of the related localForages.\n    var initPromises = [];\n\n    function ignoreErrors() {\n        // Don't handle errors here,\n        // just makes sure related localForages aren't pending.\n        return Promise$1.resolve();\n    }\n\n    for (var j = 0; j < dbContext.forages.length; j++) {\n        var forage = dbContext.forages[j];\n        if (forage !== self) {\n            // Don't wait for itself...\n            initPromises.push(forage._initReady()[\"catch\"](ignoreErrors));\n        }\n    }\n\n    // Take a snapshot of the related localForages.\n    var forages = dbContext.forages.slice(0);\n\n    // Initialize the connection process only when\n    // all the related localForages aren't pending.\n    return Promise$1.all(initPromises).then(function () {\n        dbInfo.db = dbContext.db;\n        // Get the connection or open a new one without upgrade.\n        return _getOriginalConnection(dbInfo);\n    }).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo, self._defaultConfig.version)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        dbInfo.db = dbContext.db = db;\n        self._dbInfo = dbInfo;\n        // Share the final connection amongst related localForages.\n        for (var k = 0; k < forages.length; k++) {\n            var forage = forages[k];\n            if (forage !== self) {\n                // Self is already up-to-date.\n                forage._dbInfo.db = dbInfo.db;\n                forage._dbInfo.version = dbInfo.version;\n            }\n        }\n    });\n}\n\nfunction getItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.get(key);\n\n                    req.onsuccess = function () {\n                        var value = req.result;\n                        if (value === undefined) {\n                            value = null;\n                        }\n                        if (_isEncodedBlob(value)) {\n                            value = _decodeBlob(value);\n                        }\n                        resolve(value);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items stored in database.\nfunction iterate(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var iterationNumber = 1;\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (cursor) {\n                            var value = cursor.value;\n                            if (_isEncodedBlob(value)) {\n                                value = _decodeBlob(value);\n                            }\n                            var result = iterator(value, cursor.key, iterationNumber++);\n\n                            // when the iterator callback returns any\n                            // (non-`undefined`) value, then we stop\n                            // the iteration immediately\n                            if (result !== void 0) {\n                                resolve(result);\n                            } else {\n                                cursor[\"continue\"]();\n                            }\n                        } else {\n                            resolve();\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n\n    return promise;\n}\n\nfunction setItem(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        var dbInfo;\n        self.ready().then(function () {\n            dbInfo = self._dbInfo;\n            if (toString.call(value) === '[object Blob]') {\n                return _checkBlobSupport(dbInfo.db).then(function (blobSupport) {\n                    if (blobSupport) {\n                        return value;\n                    }\n                    return _encodeBlob(value);\n                });\n            }\n            return value;\n        }).then(function (value) {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n\n                    // The reason we don't _save_ null is because IE 10 does\n                    // not support saving the `null` type in IndexedDB. How\n                    // ironic, given the bug below!\n                    // See: https://github.com/mozilla/localForage/issues/161\n                    if (value === null) {\n                        value = undefined;\n                    }\n\n                    var req = store.put(value, key);\n\n                    transaction.oncomplete = function () {\n                        // Cast to undefined so the value passed to\n                        // callback/promise is the same as what one would get out\n                        // of `getItem()` later. This leads to some weirdness\n                        // (setItem('foo', undefined) will return `null`), but\n                        // it's not my fault localStorage is our baseline and that\n                        // it's weird.\n                        if (value === undefined) {\n                            value = null;\n                        }\n\n                        resolve(value);\n                    };\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction removeItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    // We use a Grunt task to make this safe for IE and some\n                    // versions of Android (including those used by Cordova).\n                    // Normally IE won't like `.delete()` and will insist on\n                    // using `['delete']()`, but we have a build step that\n                    // fixes this for us now.\n                    var req = store[\"delete\"](key);\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onerror = function () {\n                        reject(req.error);\n                    };\n\n                    // The request will be also be aborted if we've exceeded our storage\n                    // space.\n                    transaction.onabort = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction clear(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.clear();\n\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction length(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.count();\n\n                    req.onsuccess = function () {\n                        resolve(req.result);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction key(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        if (n < 0) {\n            resolve(null);\n\n            return;\n        }\n\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var advanced = false;\n                    var req = store.openKeyCursor();\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            // this means there weren't enough keys\n                            resolve(null);\n\n                            return;\n                        }\n\n                        if (n === 0) {\n                            // We have the first key, return it if that's what they\n                            // wanted.\n                            resolve(cursor.key);\n                        } else {\n                            if (!advanced) {\n                                // Otherwise, ask the cursor to skip ahead n\n                                // records.\n                                advanced = true;\n                                cursor.advance(n);\n                            } else {\n                                // When we get here, we've got the nth key.\n                                resolve(cursor.key);\n                            }\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openKeyCursor();\n                    var keys = [];\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (!cursor) {\n                            resolve(keys);\n                            return;\n                        }\n\n                        keys.push(cursor.key);\n                        cursor[\"continue\"]();\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        var isCurrentDb = options.name === currentConfig.name && self._dbInfo.db;\n\n        var dbPromise = isCurrentDb ? Promise$1.resolve(self._dbInfo.db) : _getOriginalConnection(options).then(function (db) {\n            var dbContext = dbContexts[options.name];\n            var forages = dbContext.forages;\n            dbContext.db = db;\n            for (var i = 0; i < forages.length; i++) {\n                forages[i]._dbInfo.db = db;\n            }\n            return db;\n        });\n\n        if (!options.storeName) {\n            promise = dbPromise.then(function (db) {\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                }\n\n                var dropDBPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.deleteDatabase(options.name);\n\n                    req.onerror = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        reject(req.error);\n                    };\n\n                    req.onblocked = function () {\n                        // Closing all open connections in onversionchange handler should prevent this situation, but if\n                        // we do get here, it just means the request remains pending - eventually it will succeed or error\n                        console.warn('dropInstance blocked for database \"' + options.name + '\" until all open connections are closed');\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        resolve(db);\n                    };\n                });\n\n                return dropDBPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var i = 0; i < forages.length; i++) {\n                        var _forage = forages[i];\n                        _advanceReadiness(_forage._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        } else {\n            promise = dbPromise.then(function (db) {\n                if (!db.objectStoreNames.contains(options.storeName)) {\n                    return;\n                }\n\n                var newVersion = db.version + 1;\n\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                    forage._dbInfo.version = newVersion;\n                }\n\n                var dropObjectPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.open(options.name, newVersion);\n\n                    req.onerror = function (err) {\n                        var db = req.result;\n                        db.close();\n                        reject(err);\n                    };\n\n                    req.onupgradeneeded = function () {\n                        var db = req.result;\n                        db.deleteObjectStore(options.storeName);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        db.close();\n                        resolve(db);\n                    };\n                });\n\n                return dropObjectPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var j = 0; j < forages.length; j++) {\n                        var _forage2 = forages[j];\n                        _forage2._dbInfo.db = db;\n                        _advanceReadiness(_forage2._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        }\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar asyncStorage = {\n    _driver: 'asyncStorage',\n    _initStorage: _initStorage,\n    _support: isIndexedDBValid(),\n    iterate: iterate,\n    getItem: getItem,\n    setItem: setItem,\n    removeItem: removeItem,\n    clear: clear,\n    length: length,\n    key: key,\n    keys: keys,\n    dropInstance: dropInstance\n};\n\nfunction isWebSQLValid() {\n    return typeof openDatabase === 'function';\n}\n\n// Sadly, the best way to save binary data in WebSQL/localStorage is serializing\n// it to Base64, so this is how we store it to prevent very strange errors with less\n// verbose ways of binary <-> string data storage.\nvar BASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nvar BLOB_TYPE_PREFIX = '~~local_forage_type~';\nvar BLOB_TYPE_PREFIX_REGEX = /^~~local_forage_type~([^~]+)~/;\n\nvar SERIALIZED_MARKER = '__lfsc__:';\nvar SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER.length;\n\n// OMG the serializations!\nvar TYPE_ARRAYBUFFER = 'arbf';\nvar TYPE_BLOB = 'blob';\nvar TYPE_INT8ARRAY = 'si08';\nvar TYPE_UINT8ARRAY = 'ui08';\nvar TYPE_UINT8CLAMPEDARRAY = 'uic8';\nvar TYPE_INT16ARRAY = 'si16';\nvar TYPE_INT32ARRAY = 'si32';\nvar TYPE_UINT16ARRAY = 'ur16';\nvar TYPE_UINT32ARRAY = 'ui32';\nvar TYPE_FLOAT32ARRAY = 'fl32';\nvar TYPE_FLOAT64ARRAY = 'fl64';\nvar TYPE_SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER_LENGTH + TYPE_ARRAYBUFFER.length;\n\nvar toString$1 = Object.prototype.toString;\n\nfunction stringToBuffer(serializedString) {\n    // Fill the string into a ArrayBuffer.\n    var bufferLength = serializedString.length * 0.75;\n    var len = serializedString.length;\n    var i;\n    var p = 0;\n    var encoded1, encoded2, encoded3, encoded4;\n\n    if (serializedString[serializedString.length - 1] === '=') {\n        bufferLength--;\n        if (serializedString[serializedString.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    var buffer = new ArrayBuffer(bufferLength);\n    var bytes = new Uint8Array(buffer);\n\n    for (i = 0; i < len; i += 4) {\n        encoded1 = BASE_CHARS.indexOf(serializedString[i]);\n        encoded2 = BASE_CHARS.indexOf(serializedString[i + 1]);\n        encoded3 = BASE_CHARS.indexOf(serializedString[i + 2]);\n        encoded4 = BASE_CHARS.indexOf(serializedString[i + 3]);\n\n        /*jslint bitwise: true */\n        bytes[p++] = encoded1 << 2 | encoded2 >> 4;\n        bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;\n        bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;\n    }\n    return buffer;\n}\n\n// Converts a buffer to a string to store, serialized, in the backend\n// storage library.\nfunction bufferToString(buffer) {\n    // base64-arraybuffer\n    var bytes = new Uint8Array(buffer);\n    var base64String = '';\n    var i;\n\n    for (i = 0; i < bytes.length; i += 3) {\n        /*jslint bitwise: true */\n        base64String += BASE_CHARS[bytes[i] >> 2];\n        base64String += BASE_CHARS[(bytes[i] & 3) << 4 | bytes[i + 1] >> 4];\n        base64String += BASE_CHARS[(bytes[i + 1] & 15) << 2 | bytes[i + 2] >> 6];\n        base64String += BASE_CHARS[bytes[i + 2] & 63];\n    }\n\n    if (bytes.length % 3 === 2) {\n        base64String = base64String.substring(0, base64String.length - 1) + '=';\n    } else if (bytes.length % 3 === 1) {\n        base64String = base64String.substring(0, base64String.length - 2) + '==';\n    }\n\n    return base64String;\n}\n\n// Serialize a value, afterwards executing a callback (which usually\n// instructs the `setItem()` callback/promise to be executed). This is how\n// we store binary data with localStorage.\nfunction serialize(value, callback) {\n    var valueType = '';\n    if (value) {\n        valueType = toString$1.call(value);\n    }\n\n    // Cannot use `value instanceof ArrayBuffer` or such here, as these\n    // checks fail when running the tests using casper.js...\n    //\n    // TODO: See why those tests fail and use a better solution.\n    if (value && (valueType === '[object ArrayBuffer]' || value.buffer && toString$1.call(value.buffer) === '[object ArrayBuffer]')) {\n        // Convert binary arrays to a string and prefix the string with\n        // a special marker.\n        var buffer;\n        var marker = SERIALIZED_MARKER;\n\n        if (value instanceof ArrayBuffer) {\n            buffer = value;\n            marker += TYPE_ARRAYBUFFER;\n        } else {\n            buffer = value.buffer;\n\n            if (valueType === '[object Int8Array]') {\n                marker += TYPE_INT8ARRAY;\n            } else if (valueType === '[object Uint8Array]') {\n                marker += TYPE_UINT8ARRAY;\n            } else if (valueType === '[object Uint8ClampedArray]') {\n                marker += TYPE_UINT8CLAMPEDARRAY;\n            } else if (valueType === '[object Int16Array]') {\n                marker += TYPE_INT16ARRAY;\n            } else if (valueType === '[object Uint16Array]') {\n                marker += TYPE_UINT16ARRAY;\n            } else if (valueType === '[object Int32Array]') {\n                marker += TYPE_INT32ARRAY;\n            } else if (valueType === '[object Uint32Array]') {\n                marker += TYPE_UINT32ARRAY;\n            } else if (valueType === '[object Float32Array]') {\n                marker += TYPE_FLOAT32ARRAY;\n            } else if (valueType === '[object Float64Array]') {\n                marker += TYPE_FLOAT64ARRAY;\n            } else {\n                callback(new Error('Failed to get type for BinaryArray'));\n            }\n        }\n\n        callback(marker + bufferToString(buffer));\n    } else if (valueType === '[object Blob]') {\n        // Conver the blob to a binaryArray and then to a string.\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n            // Backwards-compatible prefix for the blob type.\n            var str = BLOB_TYPE_PREFIX + value.type + '~' + bufferToString(this.result);\n\n            callback(SERIALIZED_MARKER + TYPE_BLOB + str);\n        };\n\n        fileReader.readAsArrayBuffer(value);\n    } else {\n        try {\n            callback(JSON.stringify(value));\n        } catch (e) {\n            console.error(\"Couldn't convert value into a JSON string: \", value);\n\n            callback(null, e);\n        }\n    }\n}\n\n// Deserialize data we've inserted into a value column/field. We place\n// special markers into our strings to mark them as encoded; this isn't\n// as nice as a meta field, but it's the only sane thing we can do whilst\n// keeping localStorage support intact.\n//\n// Oftentimes this will just deserialize JSON content, but if we have a\n// special marker (SERIALIZED_MARKER, defined above), we will extract\n// some kind of arraybuffer/binary data/typed array out of the string.\nfunction deserialize(value) {\n    // If we haven't marked this string as being specially serialized (i.e.\n    // something other than serialized JSON), we can just return it and be\n    // done with it.\n    if (value.substring(0, SERIALIZED_MARKER_LENGTH) !== SERIALIZED_MARKER) {\n        return JSON.parse(value);\n    }\n\n    // The following code deals with deserializing some kind of Blob or\n    // TypedArray. First we separate out the type of data we're dealing\n    // with from the data itself.\n    var serializedString = value.substring(TYPE_SERIALIZED_MARKER_LENGTH);\n    var type = value.substring(SERIALIZED_MARKER_LENGTH, TYPE_SERIALIZED_MARKER_LENGTH);\n\n    var blobType;\n    // Backwards-compatible blob type serialization strategy.\n    // DBs created with older versions of localForage will simply not have the blob type.\n    if (type === TYPE_BLOB && BLOB_TYPE_PREFIX_REGEX.test(serializedString)) {\n        var matcher = serializedString.match(BLOB_TYPE_PREFIX_REGEX);\n        blobType = matcher[1];\n        serializedString = serializedString.substring(matcher[0].length);\n    }\n    var buffer = stringToBuffer(serializedString);\n\n    // Return the right type based on the code/type set during\n    // serialization.\n    switch (type) {\n        case TYPE_ARRAYBUFFER:\n            return buffer;\n        case TYPE_BLOB:\n            return createBlob([buffer], { type: blobType });\n        case TYPE_INT8ARRAY:\n            return new Int8Array(buffer);\n        case TYPE_UINT8ARRAY:\n            return new Uint8Array(buffer);\n        case TYPE_UINT8CLAMPEDARRAY:\n            return new Uint8ClampedArray(buffer);\n        case TYPE_INT16ARRAY:\n            return new Int16Array(buffer);\n        case TYPE_UINT16ARRAY:\n            return new Uint16Array(buffer);\n        case TYPE_INT32ARRAY:\n            return new Int32Array(buffer);\n        case TYPE_UINT32ARRAY:\n            return new Uint32Array(buffer);\n        case TYPE_FLOAT32ARRAY:\n            return new Float32Array(buffer);\n        case TYPE_FLOAT64ARRAY:\n            return new Float64Array(buffer);\n        default:\n            throw new Error('Unkown type: ' + type);\n    }\n}\n\nvar localforageSerializer = {\n    serialize: serialize,\n    deserialize: deserialize,\n    stringToBuffer: stringToBuffer,\n    bufferToString: bufferToString\n};\n\n/*\n * Includes code from:\n *\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nfunction createDbTable(t, dbInfo, callback, errorCallback) {\n    t.executeSql('CREATE TABLE IF NOT EXISTS ' + dbInfo.storeName + ' ' + '(id INTEGER PRIMARY KEY, key unique, value)', [], callback, errorCallback);\n}\n\n// Open the WebSQL database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage$1(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = typeof options[i] !== 'string' ? options[i].toString() : options[i];\n        }\n    }\n\n    var dbInfoPromise = new Promise$1(function (resolve, reject) {\n        // Open the database; the openDatabase API will automatically\n        // create it for us if it doesn't exist.\n        try {\n            dbInfo.db = openDatabase(dbInfo.name, String(dbInfo.version), dbInfo.description, dbInfo.size);\n        } catch (e) {\n            return reject(e);\n        }\n\n        // Create our key/value table if it doesn't exist.\n        dbInfo.db.transaction(function (t) {\n            createDbTable(t, dbInfo, function () {\n                self._dbInfo = dbInfo;\n                resolve();\n            }, function (t, error) {\n                reject(error);\n            });\n        }, reject);\n    });\n\n    dbInfo.serializer = localforageSerializer;\n    return dbInfoPromise;\n}\n\nfunction tryExecuteSql(t, dbInfo, sqlStatement, args, callback, errorCallback) {\n    t.executeSql(sqlStatement, args, callback, function (t, error) {\n        if (error.code === error.SYNTAX_ERR) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name = ?\", [dbInfo.storeName], function (t, results) {\n                if (!results.rows.length) {\n                    // if the table is missing (was deleted)\n                    // re-create it table and retry\n                    createDbTable(t, dbInfo, function () {\n                        t.executeSql(sqlStatement, args, callback, errorCallback);\n                    }, errorCallback);\n                } else {\n                    errorCallback(t, error);\n                }\n            }, errorCallback);\n        } else {\n            errorCallback(t, error);\n        }\n    }, errorCallback);\n}\n\nfunction getItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName + ' WHERE key = ? LIMIT 1', [key], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).value : null;\n\n                    // Check to see if this is serialized content we need to\n                    // unpack.\n                    if (result) {\n                        result = dbInfo.serializer.deserialize(result);\n                    }\n\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction iterate$1(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var rows = results.rows;\n                    var length = rows.length;\n\n                    for (var i = 0; i < length; i++) {\n                        var item = rows.item(i);\n                        var result = item.value;\n\n                        // Check to see if this is serialized content\n                        // we need to unpack.\n                        if (result) {\n                            result = dbInfo.serializer.deserialize(result);\n                        }\n\n                        result = iterator(result, item.key, i + 1);\n\n                        // void(0) prevents problems with redefinition\n                        // of `undefined`.\n                        if (result !== void 0) {\n                            resolve(result);\n                            return;\n                        }\n                    }\n\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction _setItem(key, value, callback, retriesLeft) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            // The localStorage API doesn't return undefined values in an\n            // \"expected\" way, so undefined is always cast to null in all\n            // drivers. See: https://github.com/mozilla/localForage/pull/42\n            if (value === undefined) {\n                value = null;\n            }\n\n            // Save the original value to pass to the callback.\n            var originalValue = value;\n\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    dbInfo.db.transaction(function (t) {\n                        tryExecuteSql(t, dbInfo, 'INSERT OR REPLACE INTO ' + dbInfo.storeName + ' ' + '(key, value) VALUES (?, ?)', [key, value], function () {\n                            resolve(originalValue);\n                        }, function (t, error) {\n                            reject(error);\n                        });\n                    }, function (sqlError) {\n                        // The transaction failed; check\n                        // to see if it's a quota error.\n                        if (sqlError.code === sqlError.QUOTA_ERR) {\n                            // We reject the callback outright for now, but\n                            // it's worth trying to re-run the transaction.\n                            // Even if the user accepts the prompt to use\n                            // more storage on Safari, this error will\n                            // be called.\n                            //\n                            // Try to re-run the transaction.\n                            if (retriesLeft > 0) {\n                                resolve(_setItem.apply(self, [key, originalValue, callback, retriesLeft - 1]));\n                                return;\n                            }\n                            reject(sqlError);\n                        }\n                    });\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction setItem$1(key, value, callback) {\n    return _setItem.apply(this, [key, value, callback, 1]);\n}\n\nfunction removeItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName + ' WHERE key = ?', [key], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Deletes every item in the table.\n// TODO: Find out if this resets the AUTO_INCREMENT number.\nfunction clear$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName, [], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Does a simple `COUNT(key)` to get the number of items stored in\n// localForage.\nfunction length$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                // Ahhh, SQL makes this one soooooo easy.\n                tryExecuteSql(t, dbInfo, 'SELECT COUNT(key) as c FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var result = results.rows.item(0).c;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Return the key located at key index X; essentially gets the key from a\n// `WHERE id = ?`. This is the most efficient way I can think to implement\n// this rarely-used (in my experience) part of the API, but it can seem\n// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so\n// the ID of each key will change every time it's updated. Perhaps a stored\n// procedure for the `setItem()` SQL would solve this problem?\n// TODO: Don't change ID on `setItem()`.\nfunction key$1(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName + ' WHERE id = ? LIMIT 1', [n + 1], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).key : null;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var keys = [];\n\n                    for (var i = 0; i < results.rows.length; i++) {\n                        keys.push(results.rows.item(i).key);\n                    }\n\n                    resolve(keys);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// https://www.w3.org/TR/webdatabase/#databases\n// > There is no way to enumerate or delete the databases available for an origin from this API.\nfunction getAllStoreNames(db) {\n    return new Promise$1(function (resolve, reject) {\n        db.transaction(function (t) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\", [], function (t, results) {\n                var storeNames = [];\n\n                for (var i = 0; i < results.rows.length; i++) {\n                    storeNames.push(results.rows.item(i).name);\n                }\n\n                resolve({\n                    db: db,\n                    storeNames: storeNames\n                });\n            }, function (t, error) {\n                reject(error);\n            });\n        }, function (sqlError) {\n            reject(sqlError);\n        });\n    });\n}\n\nfunction dropInstance$1(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            var db;\n            if (options.name === currentConfig.name) {\n                // use the db reference of the current instance\n                db = self._dbInfo.db;\n            } else {\n                db = openDatabase(options.name, '', '', 0);\n            }\n\n            if (!options.storeName) {\n                // drop all database tables\n                resolve(getAllStoreNames(db));\n            } else {\n                resolve({\n                    db: db,\n                    storeNames: [options.storeName]\n                });\n            }\n        }).then(function (operationInfo) {\n            return new Promise$1(function (resolve, reject) {\n                operationInfo.db.transaction(function (t) {\n                    function dropTable(storeName) {\n                        return new Promise$1(function (resolve, reject) {\n                            t.executeSql('DROP TABLE IF EXISTS ' + storeName, [], function () {\n                                resolve();\n                            }, function (t, error) {\n                                reject(error);\n                            });\n                        });\n                    }\n\n                    var operations = [];\n                    for (var i = 0, len = operationInfo.storeNames.length; i < len; i++) {\n                        operations.push(dropTable(operationInfo.storeNames[i]));\n                    }\n\n                    Promise$1.all(operations).then(function () {\n                        resolve();\n                    })[\"catch\"](function (e) {\n                        reject(e);\n                    });\n                }, function (sqlError) {\n                    reject(sqlError);\n                });\n            });\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar webSQLStorage = {\n    _driver: 'webSQLStorage',\n    _initStorage: _initStorage$1,\n    _support: isWebSQLValid(),\n    iterate: iterate$1,\n    getItem: getItem$1,\n    setItem: setItem$1,\n    removeItem: removeItem$1,\n    clear: clear$1,\n    length: length$1,\n    key: key$1,\n    keys: keys$1,\n    dropInstance: dropInstance$1\n};\n\nfunction isLocalStorageValid() {\n    try {\n        return typeof localStorage !== 'undefined' && 'setItem' in localStorage &&\n        // in IE8 typeof localStorage.setItem === 'object'\n        !!localStorage.setItem;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction _getKeyPrefix(options, defaultConfig) {\n    var keyPrefix = options.name + '/';\n\n    if (options.storeName !== defaultConfig.storeName) {\n        keyPrefix += options.storeName + '/';\n    }\n    return keyPrefix;\n}\n\n// Check if localStorage throws when saving an item\nfunction checkIfLocalStorageThrows() {\n    var localStorageTestKey = '_localforage_support_test';\n\n    try {\n        localStorage.setItem(localStorageTestKey, true);\n        localStorage.removeItem(localStorageTestKey);\n\n        return false;\n    } catch (e) {\n        return true;\n    }\n}\n\n// Check if localStorage is usable and allows to save an item\n// This method checks if localStorage is usable in Safari Private Browsing\n// mode, or in any other case where the available quota for localStorage\n// is 0 and there wasn't any saved items yet.\nfunction _isLocalStorageUsable() {\n    return !checkIfLocalStorageThrows() || localStorage.length > 0;\n}\n\n// Config the localStorage backend, using options set in the config.\nfunction _initStorage$2(options) {\n    var self = this;\n    var dbInfo = {};\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    dbInfo.keyPrefix = _getKeyPrefix(options, self._defaultConfig);\n\n    if (!_isLocalStorageUsable()) {\n        return Promise$1.reject();\n    }\n\n    self._dbInfo = dbInfo;\n    dbInfo.serializer = localforageSerializer;\n\n    return Promise$1.resolve();\n}\n\n// Remove all keys from the datastore, effectively destroying all data in\n// the app's key/value store!\nfunction clear$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var keyPrefix = self._dbInfo.keyPrefix;\n\n        for (var i = localStorage.length - 1; i >= 0; i--) {\n            var key = localStorage.key(i);\n\n            if (key.indexOf(keyPrefix) === 0) {\n                localStorage.removeItem(key);\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Retrieve an item from the store. Unlike the original async_storage\n// library in Gaia, we don't modify return values at all. If a key's value\n// is `undefined`, we pass that value to the callback function.\nfunction getItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result = localStorage.getItem(dbInfo.keyPrefix + key);\n\n        // If a result was found, parse it from the serialized\n        // string into a JS object. If result isn't truthy, the key\n        // is likely undefined and we'll pass it straight to the\n        // callback.\n        if (result) {\n            result = dbInfo.serializer.deserialize(result);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items in the store.\nfunction iterate$2(iterator, callback) {\n    var self = this;\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var keyPrefix = dbInfo.keyPrefix;\n        var keyPrefixLength = keyPrefix.length;\n        var length = localStorage.length;\n\n        // We use a dedicated iterator instead of the `i` variable below\n        // so other keys we fetch in localStorage aren't counted in\n        // the `iterationNumber` argument passed to the `iterate()`\n        // callback.\n        //\n        // See: github.com/mozilla/localForage/pull/435#discussion_r38061530\n        var iterationNumber = 1;\n\n        for (var i = 0; i < length; i++) {\n            var key = localStorage.key(i);\n            if (key.indexOf(keyPrefix) !== 0) {\n                continue;\n            }\n            var value = localStorage.getItem(key);\n\n            // If a result was found, parse it from the serialized\n            // string into a JS object. If result isn't truthy, the\n            // key is likely undefined and we'll pass it straight\n            // to the iterator.\n            if (value) {\n                value = dbInfo.serializer.deserialize(value);\n            }\n\n            value = iterator(value, key.substring(keyPrefixLength), iterationNumber++);\n\n            if (value !== void 0) {\n                return value;\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Same as localStorage's key() method, except takes a callback.\nfunction key$2(n, callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result;\n        try {\n            result = localStorage.key(n);\n        } catch (error) {\n            result = null;\n        }\n\n        // Remove the prefix from the key, if a key is found.\n        if (result) {\n            result = result.substring(dbInfo.keyPrefix.length);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var length = localStorage.length;\n        var keys = [];\n\n        for (var i = 0; i < length; i++) {\n            var itemKey = localStorage.key(i);\n            if (itemKey.indexOf(dbInfo.keyPrefix) === 0) {\n                keys.push(itemKey.substring(dbInfo.keyPrefix.length));\n            }\n        }\n\n        return keys;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Supply the number of keys in the datastore to the callback function.\nfunction length$2(callback) {\n    var self = this;\n    var promise = self.keys().then(function (keys) {\n        return keys.length;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Remove an item from the store, nice and simple.\nfunction removeItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        localStorage.removeItem(dbInfo.keyPrefix + key);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Set a key's value and run an optional callback once the value is set.\n// Unlike Gaia's implementation, the callback function is passed the value,\n// in case you want to operate on that value only after you're sure it\n// saved, or something like that.\nfunction setItem$2(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        // Convert undefined values to null.\n        // https://github.com/mozilla/localForage/pull/42\n        if (value === undefined) {\n            value = null;\n        }\n\n        // Save the original value to pass to the callback.\n        var originalValue = value;\n\n        return new Promise$1(function (resolve, reject) {\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    try {\n                        localStorage.setItem(dbInfo.keyPrefix + key, value);\n                        resolve(originalValue);\n                    } catch (e) {\n                        // localStorage capacity exceeded.\n                        // TODO: Make this a specific error/event.\n                        if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                            reject(e);\n                        }\n                        reject(e);\n                    }\n                }\n            });\n        });\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance$2(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        var currentConfig = this.config();\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            if (!options.storeName) {\n                resolve(options.name + '/');\n            } else {\n                resolve(_getKeyPrefix(options, self._defaultConfig));\n            }\n        }).then(function (keyPrefix) {\n            for (var i = localStorage.length - 1; i >= 0; i--) {\n                var key = localStorage.key(i);\n\n                if (key.indexOf(keyPrefix) === 0) {\n                    localStorage.removeItem(key);\n                }\n            }\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar localStorageWrapper = {\n    _driver: 'localStorageWrapper',\n    _initStorage: _initStorage$2,\n    _support: isLocalStorageValid(),\n    iterate: iterate$2,\n    getItem: getItem$2,\n    setItem: setItem$2,\n    removeItem: removeItem$2,\n    clear: clear$2,\n    length: length$2,\n    key: key$2,\n    keys: keys$2,\n    dropInstance: dropInstance$2\n};\n\nvar sameValue = function sameValue(x, y) {\n    return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);\n};\n\nvar includes = function includes(array, searchElement) {\n    var len = array.length;\n    var i = 0;\n    while (i < len) {\n        if (sameValue(array[i], searchElement)) {\n            return true;\n        }\n        i++;\n    }\n\n    return false;\n};\n\nvar isArray = Array.isArray || function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n};\n\n// Drivers are stored here when `defineDriver()` is called.\n// They are shared across all instances of localForage.\nvar DefinedDrivers = {};\n\nvar DriverSupport = {};\n\nvar DefaultDrivers = {\n    INDEXEDDB: asyncStorage,\n    WEBSQL: webSQLStorage,\n    LOCALSTORAGE: localStorageWrapper\n};\n\nvar DefaultDriverOrder = [DefaultDrivers.INDEXEDDB._driver, DefaultDrivers.WEBSQL._driver, DefaultDrivers.LOCALSTORAGE._driver];\n\nvar OptionalDriverMethods = ['dropInstance'];\n\nvar LibraryMethods = ['clear', 'getItem', 'iterate', 'key', 'keys', 'length', 'removeItem', 'setItem'].concat(OptionalDriverMethods);\n\nvar DefaultConfig = {\n    description: '',\n    driver: DefaultDriverOrder.slice(),\n    name: 'localforage',\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\n    // we can use without a prompt.\n    size: 4980736,\n    storeName: 'keyvaluepairs',\n    version: 1.0\n};\n\nfunction callWhenReady(localForageInstance, libraryMethod) {\n    localForageInstance[libraryMethod] = function () {\n        var _args = arguments;\n        return localForageInstance.ready().then(function () {\n            return localForageInstance[libraryMethod].apply(localForageInstance, _args);\n        });\n    };\n}\n\nfunction extend() {\n    for (var i = 1; i < arguments.length; i++) {\n        var arg = arguments[i];\n\n        if (arg) {\n            for (var _key in arg) {\n                if (arg.hasOwnProperty(_key)) {\n                    if (isArray(arg[_key])) {\n                        arguments[0][_key] = arg[_key].slice();\n                    } else {\n                        arguments[0][_key] = arg[_key];\n                    }\n                }\n            }\n        }\n    }\n\n    return arguments[0];\n}\n\nvar LocalForage = function () {\n    function LocalForage(options) {\n        _classCallCheck(this, LocalForage);\n\n        for (var driverTypeKey in DefaultDrivers) {\n            if (DefaultDrivers.hasOwnProperty(driverTypeKey)) {\n                var driver = DefaultDrivers[driverTypeKey];\n                var driverName = driver._driver;\n                this[driverTypeKey] = driverName;\n\n                if (!DefinedDrivers[driverName]) {\n                    // we don't need to wait for the promise,\n                    // since the default drivers can be defined\n                    // in a blocking manner\n                    this.defineDriver(driver);\n                }\n            }\n        }\n\n        this._defaultConfig = extend({}, DefaultConfig);\n        this._config = extend({}, this._defaultConfig, options);\n        this._driverSet = null;\n        this._initDriver = null;\n        this._ready = false;\n        this._dbInfo = null;\n\n        this._wrapLibraryMethodsWithReady();\n        this.setDriver(this._config.driver)[\"catch\"](function () {});\n    }\n\n    // Set any config values for localForage; can be called anytime before\n    // the first API call (e.g. `getItem`, `setItem`).\n    // We loop through options so we don't overwrite existing config\n    // values.\n\n\n    LocalForage.prototype.config = function config(options) {\n        // If the options argument is an object, we use it to set values.\n        // Otherwise, we return either a specified config value or all\n        // config values.\n        if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n            // If localforage is ready and fully initialized, we can't set\n            // any new configuration values. Instead, we return an error.\n            if (this._ready) {\n                return new Error(\"Can't call config() after localforage \" + 'has been used.');\n            }\n\n            for (var i in options) {\n                if (i === 'storeName') {\n                    options[i] = options[i].replace(/\\W/g, '_');\n                }\n\n                if (i === 'version' && typeof options[i] !== 'number') {\n                    return new Error('Database version must be a number.');\n                }\n\n                this._config[i] = options[i];\n            }\n\n            // after all config options are set and\n            // the driver option is used, try setting it\n            if ('driver' in options && options.driver) {\n                return this.setDriver(this._config.driver);\n            }\n\n            return true;\n        } else if (typeof options === 'string') {\n            return this._config[options];\n        } else {\n            return this._config;\n        }\n    };\n\n    // Used to define a custom driver, shared across all instances of\n    // localForage.\n\n\n    LocalForage.prototype.defineDriver = function defineDriver(driverObject, callback, errorCallback) {\n        var promise = new Promise$1(function (resolve, reject) {\n            try {\n                var driverName = driverObject._driver;\n                var complianceError = new Error('Custom driver not compliant; see ' + 'https://mozilla.github.io/localForage/#definedriver');\n\n                // A driver name should be defined and not overlap with the\n                // library-defined, default drivers.\n                if (!driverObject._driver) {\n                    reject(complianceError);\n                    return;\n                }\n\n                var driverMethods = LibraryMethods.concat('_initStorage');\n                for (var i = 0, len = driverMethods.length; i < len; i++) {\n                    var driverMethodName = driverMethods[i];\n\n                    // when the property is there,\n                    // it should be a method even when optional\n                    var isRequired = !includes(OptionalDriverMethods, driverMethodName);\n                    if ((isRequired || driverObject[driverMethodName]) && typeof driverObject[driverMethodName] !== 'function') {\n                        reject(complianceError);\n                        return;\n                    }\n                }\n\n                var configureMissingMethods = function configureMissingMethods() {\n                    var methodNotImplementedFactory = function methodNotImplementedFactory(methodName) {\n                        return function () {\n                            var error = new Error('Method ' + methodName + ' is not implemented by the current driver');\n                            var promise = Promise$1.reject(error);\n                            executeCallback(promise, arguments[arguments.length - 1]);\n                            return promise;\n                        };\n                    };\n\n                    for (var _i = 0, _len = OptionalDriverMethods.length; _i < _len; _i++) {\n                        var optionalDriverMethod = OptionalDriverMethods[_i];\n                        if (!driverObject[optionalDriverMethod]) {\n                            driverObject[optionalDriverMethod] = methodNotImplementedFactory(optionalDriverMethod);\n                        }\n                    }\n                };\n\n                configureMissingMethods();\n\n                var setDriverSupport = function setDriverSupport(support) {\n                    if (DefinedDrivers[driverName]) {\n                        console.info('Redefining LocalForage driver: ' + driverName);\n                    }\n                    DefinedDrivers[driverName] = driverObject;\n                    DriverSupport[driverName] = support;\n                    // don't use a then, so that we can define\n                    // drivers that have simple _support methods\n                    // in a blocking manner\n                    resolve();\n                };\n\n                if ('_support' in driverObject) {\n                    if (driverObject._support && typeof driverObject._support === 'function') {\n                        driverObject._support().then(setDriverSupport, reject);\n                    } else {\n                        setDriverSupport(!!driverObject._support);\n                    }\n                } else {\n                    setDriverSupport(true);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n\n        executeTwoCallbacks(promise, callback, errorCallback);\n        return promise;\n    };\n\n    LocalForage.prototype.driver = function driver() {\n        return this._driver || null;\n    };\n\n    LocalForage.prototype.getDriver = function getDriver(driverName, callback, errorCallback) {\n        var getDriverPromise = DefinedDrivers[driverName] ? Promise$1.resolve(DefinedDrivers[driverName]) : Promise$1.reject(new Error('Driver not found.'));\n\n        executeTwoCallbacks(getDriverPromise, callback, errorCallback);\n        return getDriverPromise;\n    };\n\n    LocalForage.prototype.getSerializer = function getSerializer(callback) {\n        var serializerPromise = Promise$1.resolve(localforageSerializer);\n        executeTwoCallbacks(serializerPromise, callback);\n        return serializerPromise;\n    };\n\n    LocalForage.prototype.ready = function ready(callback) {\n        var self = this;\n\n        var promise = self._driverSet.then(function () {\n            if (self._ready === null) {\n                self._ready = self._initDriver();\n            }\n\n            return self._ready;\n        });\n\n        executeTwoCallbacks(promise, callback, callback);\n        return promise;\n    };\n\n    LocalForage.prototype.setDriver = function setDriver(drivers, callback, errorCallback) {\n        var self = this;\n\n        if (!isArray(drivers)) {\n            drivers = [drivers];\n        }\n\n        var supportedDrivers = this._getSupportedDrivers(drivers);\n\n        function setDriverToConfig() {\n            self._config.driver = self.driver();\n        }\n\n        function extendSelfWithDriver(driver) {\n            self._extend(driver);\n            setDriverToConfig();\n\n            self._ready = self._initStorage(self._config);\n            return self._ready;\n        }\n\n        function initDriver(supportedDrivers) {\n            return function () {\n                var currentDriverIndex = 0;\n\n                function driverPromiseLoop() {\n                    while (currentDriverIndex < supportedDrivers.length) {\n                        var driverName = supportedDrivers[currentDriverIndex];\n                        currentDriverIndex++;\n\n                        self._dbInfo = null;\n                        self._ready = null;\n\n                        return self.getDriver(driverName).then(extendSelfWithDriver)[\"catch\"](driverPromiseLoop);\n                    }\n\n                    setDriverToConfig();\n                    var error = new Error('No available storage method found.');\n                    self._driverSet = Promise$1.reject(error);\n                    return self._driverSet;\n                }\n\n                return driverPromiseLoop();\n            };\n        }\n\n        // There might be a driver initialization in progress\n        // so wait for it to finish in order to avoid a possible\n        // race condition to set _dbInfo\n        var oldDriverSetDone = this._driverSet !== null ? this._driverSet[\"catch\"](function () {\n            return Promise$1.resolve();\n        }) : Promise$1.resolve();\n\n        this._driverSet = oldDriverSetDone.then(function () {\n            var driverName = supportedDrivers[0];\n            self._dbInfo = null;\n            self._ready = null;\n\n            return self.getDriver(driverName).then(function (driver) {\n                self._driver = driver._driver;\n                setDriverToConfig();\n                self._wrapLibraryMethodsWithReady();\n                self._initDriver = initDriver(supportedDrivers);\n            });\n        })[\"catch\"](function () {\n            setDriverToConfig();\n            var error = new Error('No available storage method found.');\n            self._driverSet = Promise$1.reject(error);\n            return self._driverSet;\n        });\n\n        executeTwoCallbacks(this._driverSet, callback, errorCallback);\n        return this._driverSet;\n    };\n\n    LocalForage.prototype.supports = function supports(driverName) {\n        return !!DriverSupport[driverName];\n    };\n\n    LocalForage.prototype._extend = function _extend(libraryMethodsAndProperties) {\n        extend(this, libraryMethodsAndProperties);\n    };\n\n    LocalForage.prototype._getSupportedDrivers = function _getSupportedDrivers(drivers) {\n        var supportedDrivers = [];\n        for (var i = 0, len = drivers.length; i < len; i++) {\n            var driverName = drivers[i];\n            if (this.supports(driverName)) {\n                supportedDrivers.push(driverName);\n            }\n        }\n        return supportedDrivers;\n    };\n\n    LocalForage.prototype._wrapLibraryMethodsWithReady = function _wrapLibraryMethodsWithReady() {\n        // Add a stub for each driver API method that delays the call to the\n        // corresponding driver method until localForage is ready. These stubs\n        // will be replaced by the driver methods as soon as the driver is\n        // loaded, so there is no performance impact.\n        for (var i = 0, len = LibraryMethods.length; i < len; i++) {\n            callWhenReady(this, LibraryMethods[i]);\n        }\n    };\n\n    LocalForage.prototype.createInstance = function createInstance(options) {\n        return new LocalForage(options);\n    };\n\n    return LocalForage;\n}();\n\n// The actual localForage object that we expose as a module or via a\n// global. It's extended by pulling in one of our other libraries.\n\n\nvar localforage_js = new LocalForage();\n\nmodule.exports = localforage_js;\n\n},{\"3\":3}]},{},[4])(4)\n});\n", "// The siteAdapter handles fetching resources from sites, including origin\n// and local browser storage.\n\nlet siteAdapter;\nconst queue = require('async/queue');\nconst localForage = require('localforage');\n\nmodule.exports = (siteAdapter = {});\n\n// we save the site prefix once we have determined it,\nconst sitePrefix = {};\n// and if the CORS request requires credentials...\nconst credentialsNeeded = {};\n\n// when asked for a site's flag, if we don't know the current prefix we create\n// a temporary greyscale flag. We save them here, so we can replace them when\n// we know how to get a site's flag\nconst tempFlags = {};\n\n// some settings\nconst fetchTimeoutMS = 3000;\nconst findQueueWorkers = 8;\n\nconsole.log(\"siteAdapter: loading data\");\nconst routeStore = localForage.createInstance({ name: \"routes\" });\nrouteStore.iterate(function(value, key, iterationNumber) {\n  sitePrefix[key] = value;\n  }).then(() => console.log(\"siteAdapter: data loaded\")).catch(err => console.log(\"siteAdapter: error loading data \", err));\n\nconst withCredsStore = localForage.createInstance({name: \"withCredentials\" });\nwithCredsStore.iterate(function(value, key, iterationNumber) {\n  credentialsNeeded[key] = value;\n  }).then(() => console.log(\"siteAdapter: withCredentials data loaded\")).catch(err => console.log(\"siteAdapter: error loading withCredentials data \", err));\n\nconst testWikiSite = function(url, good, bad) {\n  let testRace;\n  const fetchTimeout = new Promise( function(resolve, reject) {\n    const id = setTimeout( function() {\n      clearTimeout(id);\n      reject();\n    }\n    , fetchTimeoutMS);\n  });\n\n  const fetchURL = new Promise( (resolve, reject) => $.ajax({\n    type: 'GET',\n    url,\n    success() { resolve(); },\n    error() { reject(); }}));\n\n  testRace = Promise.race([\n    fetchTimeout,\n    fetchURL\n    ])\n  .then(() => good())\n  .catch(() => bad());\n};\n\n\n\n\nconst findAdapterQ = queue( function(task, done) {\n  let testURL;\n  const { site } = task;\n  if (sitePrefix[site]) {\n    done(sitePrefix[site]);\n  }\n\n  if (site.split('.').at(-1).split(':')[0] === 'localhost') {\n    testURL = `http://${site}/favicon.png`;\n  } else {\n    testURL = `//${site}/favicon.png`;\n  }\n  return testWikiSite(testURL, (function() {\n    sitePrefix[site] = testURL.slice(0,-12);\n    done(testURL.slice(0,-12));\n  }), function() {\n    switch (location.protocol) {\n      case 'http:':\n        testURL = `https://${site}/favicon.png`;\n        testWikiSite(testURL, (function () {\n          sitePrefix[site] = `https://${site}`;\n          done(`https://${site}`);\n        }), function () {\n          sitePrefix[site] = \"\";\n          done(\"\");\n        });\n        break;\n      case 'https:':\n        testURL = `/proxy/${site}/favicon.png`;\n        return testWikiSite(testURL, (function () {\n          sitePrefix[site] = `/proxy/${site}`;\n          done(`/proxy/${site}`);\n        }), function () {\n          sitePrefix[site] = \"\";\n          done(\"\");\n        });\n        break;\n      default:\n        sitePrefix[site] = \"\";\n        done(\"\");\n    }\n  });\n}\n, findQueueWorkers); // start with 8 process working on the queue\n\nconst findAdapter = (site, done) => routeStore.getItem(site).then(function(value) {\n  // console.log \"findAdapter: \", site, value\n  if (!value) {\n    findAdapterQ.push({site}, function(prefix) {\n      sitePrefix[site] = prefix;\n      routeStore.setItem(site, prefix).then(value => done(prefix)).catch(function(err) {\n        console.log(\"findAdapter setItem error: \", site, err);\n        done(prefix);\n      });\n    });\n  } else {\n    sitePrefix[site] = value;\n    done(value);\n  }}).catch(function(err) {\n  console.log(\"findAdapter error: \", site, err);\n  sitePrefix[site] = \"\";\n  done(\"\");\n});\n\nsiteAdapter.local = {\n  flag() { return \"/favicon.png\"; },\n  getURL(route) { return `/${route}`; },\n  getDirectURL(route) { return `/${route}`; },\n  get(route, callback) {\n    let page;\n    const done = function(err, value) { if (callback) { callback(err, value); } };\n\n    // console.log \"wiki.local.get #{route}\"\n    if (page = localStorage.getItem(route.replace(/\\.json$/,''))) {\n      const parsedPage = JSON.parse(page);\n      done(null, parsedPage);\n      if (!callback) { Promise.resolve(parsedPage); }\n    } else {\n      const errMsg = {msg: `no page named '${route}' in browser local storage`};\n      done(errMsg, null);\n      // console.log(\"tried to local fetch a page that isn't local\")\n      if (!callback) { Promise.reject(errMsg); }\n    }\n  },\n  put(route, data, done) {\n    // console.log \"wiki.local.put #{route}\"\n    localStorage.setItem(route, JSON.stringify(data));\n    done();\n  },\n  delete(route) {\n    // console.log \"wiki.local.delete #{route}\"\n    localStorage.removeItem(route);\n  }\n};\n\nsiteAdapter.origin = {\n  flag() { return \"/favicon.png\"; },\n  getURL(route) { return `/${route}`; },\n  getDirectURL(route) { return `/${route}`; },\n  get(route, callback) {\n    const done = function(err, value) { if (callback) { callback(err, value); } };\n    // console.log \"wiki.origin.get #{route}\"\n    $.ajax({\n      type: 'GET',\n      dataType: 'json',\n      url: `/${route}`,\n      success(page, code, xhr) {\n        if (route === 'system/sitemap.json') {\n          done(null, { data: page, lastModified: Date.parse(xhr.getResponseHeader('Last-Modified') )});\n        } else {\n          done(null, page);\n        }\n      },\n      error(xhr, type, msg) { done({msg, xhr}, null); }\n    });\n  },\n  getIndex(route, callback) {\n    const done = function(err, value) { if (callback) { callback(err, value); } };\n    // console.log \"wiki.origin.get #{route}\"\n    $.ajax({\n      type: 'GET',\n      dataType: 'text',\n      url: `/${route}`,\n      success(page) { done(null, page); },\n      error(xhr, type, msg) { done({msg, xhr}, null); }\n    });\n  },\n  put(route, data, done) {\n    // console.log \"wiki.orgin.put #{route}\"\n    $.ajax({\n      type: 'PUT',\n      url: `/page/${route}/action`,\n      data: {\n        'action': JSON.stringify(data)\n      },\n      success() { done(null); },\n      error(xhr, type, msg) { done({xhr, type, msg}); }});\n  },\n  delete(route, done) {\n    // console.log \"wiki.origin.delete #{route}\"\n    $.ajax({\n      type: 'DELETE',\n      url: `/${route}`,\n      success() { done(null); },\n      error(xhr, type, msg) { done({xhr, type, msg}); }});\n  }\n};\n\nsiteAdapter.recycler = {\n  flag() { return \"/recycler/favicon.png\"; },\n  getURL(route) { return `/recycler/${route}`; },\n  getDirectURL(route) { return `/recycler/${route}`; },\n  get(route, callback) {\n    const done = function(err, value) { if (callback) { callback(err, value); } };\n    // console.log \"wiki.recycler.get #{route}\"\n    $.ajax({\n      type: 'GET',\n      dataType: 'json',\n      url: `/recycler/${route}`,\n      success(page) { done(null, page); },\n      error(xhr, type, msg) { done({msg, xhr}, null); }\n    });\n  },\n  delete(route, done) {\n    // console.log \"wiki.recycler.delete #{route}\"\n    $.ajax({\n      type: 'DELETE',\n      url: `/recycler/${route}`,\n      success() { done(null); },\n      error(xhr, type, msg) { done({xhr, type, msg}); }});\n  }\n};\n\nsiteAdapter.site = function(site) {\n  if (!site || (site === window.location.host)) { return siteAdapter.origin; }\n  if (site === 'recycler') { return siteAdapter.recycler; }\n\n  const createTempFlag = function(site) {\n    // console.log \"creating temp flag for #{site}\"\n    const myCanvas = document.createElement('canvas');\n    myCanvas.width = 32;\n    myCanvas.height = 32;\n\n    const ctx = myCanvas.getContext('2d');\n\n    const x1 = Math.random() * 32;\n    const y1 = x1;\n    const y2 = Math.random() * 32;\n    const x2 = 32 - y2;\n\n    const c1 = ((Math.random() * 0xFF)<<0).toString(16);\n    const c2 = ((Math.random() * 0xFF)<<0).toString(16);\n\n    const color1 = '#' + c1 + c1 + c1;\n    const color2 = '#' + c2 + c2 + c2;\n\n\n    const gradient = ctx.createRadialGradient(x1,y1,32,x2,y2,0);\n    gradient.addColorStop(0, color1);\n    gradient.addColorStop(1, color2);\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0,0,32,32);\n    return myCanvas.toDataURL();\n  };\n\n  return {\n    flag() {\n      if (sitePrefix[site] != null) {\n        if (sitePrefix[site] === \"\") {\n          if (tempFlags[site]) {\n            return tempFlags[site];\n          } else {\n            return tempFlags[site] = createTempFlag(site);\n          }\n        } else {\n          // we already know how to construct flag url\n          return sitePrefix[site] + \"/favicon.png\";\n        }\n      } else if (tempFlags[site]) {\n        // we already have a temp. flag\n        return tempFlags[site];\n      } else {\n        // we don't know the url to the real flag, or have a temp flag\n\n//        findAdapterQ.push {site: site}, (prefix) ->\n        findAdapter(site, function(prefix) {\n          if (prefix === \"\") {\n            console.log(`Prefix for ${site} is undetermined...`);\n          } else {\n            console.log(`Prefix for ${site} is ${prefix}`);\n            // replace temp flags\n            const tempFlag = tempFlags[site];\n            const realFlag = sitePrefix[site] + \"/favicon.png\";\n            // replace temporary flag where it is used as an image\n            $('img[src=\"' + tempFlag + '\"]').attr('src', realFlag);\n            // replace temporary flag where its used as a background to fork event in journal\n            $('a[target=\"' + site + '\"]').attr('style', 'background-image: url(' + realFlag + ')');\n            tempFlags[site] = null;\n          }\n        });\n\n\n        // create a temp flag, save it for reuse, and return it\n        const tempFlag = createTempFlag(site);\n        tempFlags[site] = tempFlag;\n        return tempFlag;\n      }\n    },\n\n    getURL(route) {\n      if (sitePrefix[site] != null) {\n        if (sitePrefix[site] === \"\") {\n          console.log(`${site} is unreachable, can't link to ${route}`);\n          return \"\";\n        } else {\n          return `${sitePrefix[site]}/${route}`;\n        }\n      } else {\n        // don't yet know how to construct links for site, so find how and fixup\n        //findAdapterQ.push {site: site}, (prefix) ->\n        findAdapter(site, function(prefix) {\n          if (prefix === \"\") {\n            console.log(`${site} is unreachable`);\n          } else {\n            console.log(`Prefix for ${site} is ${prefix}, about to fixup links`);\n            // add href to journal fork\n            $('a[target=\"' + site + '\"]').each( function() {\n              let thisPrefix;\n              if (/proxy/.test(prefix)) {\n                const thisSite = prefix.substring(7);\n                thisPrefix = `http://${thisSite}`;\n              } else {\n                thisPrefix = prefix;\n              }\n              $(this).attr('href', `${thisPrefix}/${$(this).data(\"slug\")}.html`); });\n          }\n        });\n        return \"\";\n      }\n    },\n\n    getDirectURL(route) {\n      let thisPrefix, thisSite;\n      if (sitePrefix[site] != null) {\n        if (sitePrefix[site] === \"\") {\n          console.log(`${site} is unreachable, can't link to ${route}`);\n          return \"\";\n        } else {\n          if (/proxy/.test(sitePrefix[site])) {\n            thisSite = sitePrefix[site].substring(7);\n            thisPrefix = `http://${thisSite}`;\n          } else {\n            thisPrefix = sitePrefix[site];\n          }\n          return `${thisPrefix}/${route}`;\n        }\n      } else {\n        findAdapter(site, function(prefix) {\n          if (prefix === \"\") {\n            console.log(`${site} is unreachable`);\n          } else {\n            console.log(`Prefix for ${site} is ${prefix}, about to fixup links`);\n            // add href to journal fork\n            $('a[target=\"' + site + '\"]').each( function() {\n              if (/proxy/.test(prefix)) {\n                thisSite = prefix.substring(7);\n                thisPrefix = `http://${thisSite}`;\n              } else {\n                thisPrefix = prefix;\n              }\n              $(this).attr('href', `${thisPrefix}/${$(this).data(\"slug\")}.html`); });\n          }\n        });\n        return \"\";\n      }\n    },\n\n    get(route, callback) {\n      let errMsg;\n      const done = function(err, value) { if (callback) { callback(err, value); } };\n\n      var getContent = function(route, done) {\n        const url = `${sitePrefix[site]}/${route}`;\n        const useCredentials = credentialsNeeded[site] || false;\n\n        $.ajax({\n          type: 'GET',\n          dataType: 'json',\n          url,\n          xhrFields: { withCredentials: useCredentials },\n          success(data, code, xhr) {\n            if ((((route === 'system/sitemap.json') && Array.isArray(data) && (data[0] === 'Login Required')) || (data.title === 'Login Required')) && !url.includes('login-required') && (credentialsNeeded[site] !== true)) {\n              credentialsNeeded[site] = true;\n              getContent(route, function(err, page) {\n                if (!err) {\n                  withCredsStore.setItem(site, true);\n                  done(err, page);\n                } else {\n                  credentialsNeeded[site] = false;\n                  done(err, page);\n                }\n              });\n            } else {\n              if (route === 'system/sitemap.json') {\n                done(null, { data, lastModified: Date.parse(xhr.getResponseHeader('Last-Modified')) });\n              } else {\n                done(null, data);\n              }\n              if (!callback) { return Promise.resolve(data); }\n            }\n          },\n          error(xhr, type, msg) {\n            done({msg, xhr}, null);\n            if (!callback) { return Promise.reject(msg); }\n          }\n        });\n      };\n\n      if (sitePrefix[site] != null) {\n        if (sitePrefix[site] === \"\") {\n          console.log(`${site} is unreachable`);\n          errMsg = {msg: `${site} is unreachable`, xhr: {status: 0}};\n          done(errMsg, null);\n          if (!callback) { return Promise.reject(errMsg); }\n        } else {\n          return getContent(route, done);\n        }\n      } else {\n        //findAdapterQ.push {site: site}, (prefix) ->\n        findAdapter(site, function(prefix) {\n          if (prefix === \"\") {\n            console.log(`${site} is unreachable`);\n            errMsg = {msg: `${site} is unreachable`, xhr: {status: 0}};\n            done(errMsg, null);\n            if (!callback) { return Promise.reject(errMsg); }\n          } else {\n            return getContent(route, done);\n          }\n        });\n      }\n    },\n\n    getIndex(route, callback) {\n      // used for getting the serialized JSON file used by minisearch, needs to be a text string rather than an object.\n      // This only differs from `get` by using dataType of text, rather than json.\n      let errMsg;\n      const done = function(err, value) { if (callback) { callback(err, value); } };\n\n      var getContent = function(route, done) {\n        const url = `${sitePrefix[site]}/${route}`;\n        const useCredentials = credentialsNeeded[site] || false;\n\n        $.ajax({\n          type: 'GET',\n          dataType: 'text',\n          url,\n          xhrFields: { withCredentials: useCredentials },\n          success(data) {\n            if ((data.title === 'Login Required') && !url.includes('login-required') && (credentialsNeeded[site] !== true)) {\n              credentialsNeeded[site] = true;\n              return getContent(route, function(err, page) {\n                if (!err) {\n                  withCredsStore.setItem(site, true);\n                  done(err, page);\n                } else {\n                  credentialsNeeded[site] = false;\n                  done(err, page);\n                }\n              });\n            } else {\n              done(null, data);\n              if (!callback) { return Promise.resolve(data); }\n            }\n          },\n          error(xhr, type, msg) {\n            done({msg, xhr}, null);\n            if (!callback) { return Promise.reject(msg); }\n          }\n        });\n      };\n\n      if (sitePrefix[site] != null) {\n        if (sitePrefix[site] === \"\") {\n          console.log(`${site} is unreachable`);\n          errMsg = {msg: `${site} is unreachable`, xhr: {status: 0}};\n          done(errMsg, null);\n          if (!callback) { return Promise.reject(errMsg); }\n        } else {\n          return getContent(route, done);\n        }\n      } else {\n        //findAdapterQ.push {site: site}, (prefix) ->\n        findAdapter(site, function(prefix) {\n          if (prefix === \"\") {\n            console.log(`${site} is unreachable`);\n            errMsg = {msg: `${site} is unreachable`, xhr: {status: 0}};\n            done(errMsg, null);\n            if (!callback) { return Promise.reject(errMsg); }\n          } else {\n            return getContent(route, done);\n          }\n        });\n      }\n    },\n    refresh(done) {\n      // Refresh is used to redetermine the sitePrefix prefix, and update the\n      // stored value.\n      console.log(`Refreshing ${site}`);\n\n      if (tempFlags[site] == null) {\n        // refreshing route for a site that we know the route for...\n        // currently performed when clicking on a neighbor that we\n        // can't retrieve a sitemap for.\n\n        // replace flag with temp flags\n        const tempFlag = createTempFlag(site);\n        tempFlags[site] = tempFlag;\n        const realFlag = sitePrefix[site] + \"/favicon.png\";\n        // replace flag with temporary flag where it is used as an image\n        $('img[src=\"' + realFlag + '\"]').attr('src', tempFlag);\n        // replace temporary flag where its used as a background to fork event in journal\n        $('a[target=\"' + site + '\"]').attr('style', 'background-image: url(' + tempFlag + ')');\n      }\n\n      // reset site prefix\n      sitePrefix[site] = null;\n\n      // update storage\n      routeStore.removeItem(site)\n        .then(() => {\n          findAdapterQ.push({site}, prefix => {\n            routeStore.setItem(site, prefix)\n              .then(() => {\n                if (prefix === \"\") {\n                  console.log(`Refreshed prefix for ${site} is undetermined...`);\n                } else {\n                  console.log(`Refreshed prefix for ${site} is ${prefix}`);\n                  // replace temp flags\n                  const tempFlag = tempFlags[site];\n                  const realFlag = sitePrefix[site] + \"/favicon.png\";\n                  // replace temporary flag where it is used as an image\n                  $('img[src=\"' + tempFlag + '\"]').attr('src', realFlag);\n                  // replace temporary flag where its used as a background to fork event in journal\n                  $('a[target=\"' + site + '\"]').attr('style', 'background-image: url(' + realFlag + ')');\n                }\n                done();\n              })\n              .catch(err => {\n                console.log(\"findAdapter setItem error: \", site, err);\n                sitePrefix[site] = \"\";\n                done();\n              });\n          });\n        })\n        .catch(err => {\n          console.log('refresh error ', site, err);\n          done();\n        });\n    }\n        // same as if delete worked?\n  };\n};\n", "// This module collects various functions that might belong\n// better elsewhere. At one point we thought of uniformity\n// of representations but that hasn't been a strong influency.\n\nlet util;\nmodule.exports = (util = {});\n\n// for chart plug-in\nutil.formatTime = function(time) {\n  const d = new Date((time > 10000000000 ? time : time*1000));\n  const mo = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][d.getMonth()];\n  let h = d.getHours();\n  const am = h < 12 ? 'AM' : 'PM';\n  h = h === 0 ? 12 : h > 12 ? h - 12 : h;\n  const mi = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes();\n  return `${h}:${mi} ${am}<br>${d.getDate()} ${mo} ${d.getFullYear()}`;\n};\n\n// for journal mouse-overs and possibly for date header\nutil.formatDate = function(msSinceEpoch) {\n  const d = new Date(msSinceEpoch);\n  const wk = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][d.getDay()];\n  const mo = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][d.getMonth()];\n  const day = d.getDate();\n  const yr = d.getFullYear();\n  let h = d.getHours();\n  const am = h < 12 ? 'AM' : 'PM';\n  h = h === 0 ? 12 : h > 12 ? h - 12 : h;\n  const mi = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes();\n  const sec = (d.getSeconds() < 10 ? \"0\" : \"\") + d.getSeconds();\n  return `${wk} ${mo} ${day}, ${yr}<br>${h}:${mi}:${sec} ${am}`;\n};\n\nutil.formatActionTitle = function(action) {\n  let title = '';\n  if (action.site) { title += `${action.site}\\n`; }\n  title += action.type || 'separator';\n  if (action.date) { title += ` ${util.formatElapsedTime(action.date)}`; }\n  if (action.attribution?.page) { title += `\\nfrom ${action.attribution.page}`; }\n  if (action.removedTo?.page) { title += `\\nto ${action.removedTo.page}`; }\n  return title;\n};\n\nutil.formatElapsedTime = function(msSinceEpoch) {\n  let days, hrs, mins, months, secs, weeks, years;\n  const msecs = (new Date().getTime() - msSinceEpoch);\n  if ((secs = msecs/1000) < 2) { return `${Math.floor(msecs)} milliseconds ago`; }\n  if ((mins = secs/60) < 2) { return `${Math.floor(secs)} seconds ago`; }\n  if ((hrs = mins/60) < 2) { return `${Math.floor(mins)} minutes ago`; }\n  if ((days = hrs/24) < 2) { return `${Math.floor(hrs)} hours ago`; }\n  if ((weeks = days/7) < 2) { return `${Math.floor(days)} days ago`; }\n  if ((months = days/31) < 2) { return `${Math.floor(weeks)} weeks ago`; }\n  if ((years = days/365) < 2) { return `${Math.floor(months)} months ago`; }\n  return `${Math.floor(years)} years ago`;\n};\n\nutil.formatDelay = function(msSinceEpoch) {\n  let hrs, mins, secs;\n  const msecs = (msSinceEpoch - Date.now());\n  if ((secs = msecs/1000) < 2) { return `in ${Math.floor(msecs)} milliseconds`; }\n  if ((mins = secs/60) < 2) { return `in ${Math.floor(secs)} seconds`; }\n  if ((hrs = mins/60) < 2) { return `in ${Math.floor(mins)} minutes`; }\n  return `in ${Math.floor(hrs)} hours`;\n};\n", "// We create strings of hexidecimal digits representing a\n// given number of random bytes. We use short strings for\n// cache busting, medium strings for keys linking dom to\n// model, and, longer still strings for lifetime identity\n// of story elements.\n\nconst randomByte = () => (((1+Math.random())*0x100)|0).toString(16).substring(1);\n\nconst randomBytes = n => [...Array(n)].map((i) => randomByte()).join('');\n\nconst itemId = () => randomBytes(8);\n\nmodule.exports = {randomByte, randomBytes, itemId}", "// This module interprets journal actions in order to update\n// a story or even regenerate a complete story from some or\n// all of a journal.\n\nconst apply = function(page, action) {\n\n  let index;\n  const order = () => (page.story||[]).map((item) => item?.id);\n\n  const add = function(after, item) {\n    const index = order().indexOf(after) + 1;\n    page.story.splice(index, 0, item);\n  };\n\n  const remove = function() {\n    let index;\n    if ((index = order().indexOf(action.id)) !== -1) {\n      page.story.splice(index,1);\n    }\n  };\n\n  if (!page.story) { page.story = []; }\n\n  switch (action.type) {\n    case 'create':\n      if (action.item) {\n        if (action.item.title) { page.title = action.item.title; }\n        if (action.item.story) { page.story = action.item.story.slice(); }\n      }\n      break;\n    case 'add':\n      add(action.after, action.item);\n      break;\n    case 'edit':\n      if ((index = order().indexOf(action.id)) !== -1) {\n        page.story.splice(index,1,action.item);\n      } else {\n        page.story.push(action.item);\n      }\n      break;\n    case 'move':\n      // construct relative addresses from absolute order\n      index = action.order.indexOf(action.id);\n      var after = action.order[index-1];\n      var item = page.story[order().indexOf(action.id)];\n      remove();\n      add(after, item);\n      break;\n    case 'remove':\n      remove();\n      break;\n  }\n\n  if (!page.journal) { page.journal = []; }\n  if (action.fork) {\n    // implicit fork\n    page.journal.push({type: 'fork', site: action.fork, date: action.date - 1 });\n  }\n  page.journal.push(action);\n};\n\nconst create = function(revIndex, data) {\n  revIndex = +revIndex;\n  const revJournal = data.journal.slice(0, +revIndex + 1 || undefined);\n  const revPage = {title: data.title, story: []};\n  for (var action of revJournal) {\n    apply(revPage, action||{});\n  }\n  return revPage;\n};\n\nmodule.exports = {create, apply};\n", "// The synopsis module extracts a summary from the json derrived\n// representation of a page. This might be from a \"synopsys:\" field,\n// but more likely it comes from text found in the first or second item.\n\nmodule.exports = function(page) {\n  let { synopsis } = page;\n  if (page?.story) {\n    const p1 = page.story[0];\n    const p2 = page.story[1];\n    if (p1 && (p1.type === 'paragraph')) { synopsis ||= p1.text }\n    if (p2 && (p2.type === 'paragraph')) { synopsis ||= p2.text }\n    if (p1 && p1.text) { synopsis ||= p1.text }\n    if (p2 && p2.text) { synopsis ||= p2.text; }\n    synopsis ||= (page.story && `A page with ${page.story.length} items.`)\n  } else {\n    synopsis = 'A page with no story.';\n  }\n  // discard anything after the first line break, after trimming any at beginning\n  synopsis = synopsis.trim().split(/\\r|\\n/, 1)[0];\n  return synopsis.substring(0, 560);\n};\n", "// Page provides a factory for pageObjects, a model that combines\n// the json derrived object and the site from which it came.\n\n\nconst {\n  formatDate\n} = require('./util');\nconst random = require('./random');\nconst revision = require('./revision');\nconst synopsis = require('./synopsis');\n\nconst pageEmitter = new EventTarget();\n\n\n// TODO: better home for asSlug\nconst asSlug = name => name.replace(/\\s/g, '-').replace(/[^A-Za-z0-9-]/g, '').toLowerCase();\n\nconst asTitle = slug => slug.replace(/-/g, ' ');\n\nconst nowSections = now => [\n  {symbol: '\u2744', date: now-(1000*60*60*24*366), period: 'a Year'},\n  {symbol: '\u2698', date: now-(1000*60*60*24*31*3), period: 'a Season'},\n  {symbol: '\u26AA', date: now-(1000*60*60*24*31), period: 'a Month'},\n  {symbol: '\u263D', date: now-(1000*60*60*24*7), period: 'a Week'},\n  {symbol: '\u2600', date: now-(1000*60*60*24), period: 'a Day'},\n  {symbol: '\u231A', date: now-(1000*60*60), period: 'an Hour'}\n];\n\nvar newPage = function(json, site) {\n  const page = json || {};\n  if (!page.title) { page.title = 'empty'; }\n  if (!page.story) { page.story = []; }\n  if (!page.journal) { page.journal = []; }\n\n  const getRawPage = () => page;\n\n  const getContext = function() {\n    const context = ['view'];\n    if (isRemote()) { context.push(site); }\n    const addContext = function(site) { if (site && !context.includes(site)) { context.push(site); } };\n    for (var action of page.journal.slice(0).reverse()) { addContext(action?.site); }\n    return context;\n  };\n\n  const isPlugin = () => page.plugin != null;\n\n  var isRemote = () => !([undefined, null, 'view', 'origin', 'local', 'recycler'].includes(site));\n\n  const isLocal = () => site === 'local';\n\n  const isRecycler = () => site === 'recycler';\n\n  const getRemoteSite = function(host = null) {\n    if (isRemote()) { return site; } else { return host; }\n  };\n\n  const getRemoteSiteDetails = function(host = null) {\n    const result = [];\n    if (host || isRemote()) { result.push(getRemoteSite(host)); }\n    if (isPlugin()) { result.push(`${page.plugin} plugin`); }\n    return result.join(\"\\n\");\n  };\n\n  const getSlug = () => asSlug(page.title);\n\n  const getNeighbors = function(host) {\n    const neighbors = [];\n    if (isRemote()) {\n      neighbors.push(site);\n    } else {\n      if (host) { neighbors.push(host); }\n    }\n    for (var item of page.story) {\n      if (item?.site) { neighbors.push(item.site); }\n    }\n    for (var action of page.journal) {\n      if (action?.site) { neighbors.push(action.site); }\n    }\n    return Array.from(new Set(neighbors));\n  };\n\n  const getTitle = () => page.title;\n\n  const setTitle = title => page.title = title;\n\n  const getRevision = () => page.journal.length-1;\n\n  const getDate = function() {\n    const action = page.journal[getRevision()];\n    if (action) {\n      if (action.date) {\n        return action.date;\n      }\n    }\n    return undefined;\n  };\n\n  const getTimestamp = function() {\n    const action = page.journal[getRevision()];\n    if (action) {\n      if (action.date) {\n        return formatDate(action.date);\n      } else {\n        return `Revision ${getRevision()}`;\n      }\n    } else {\n      return \"Unrecorded Date\";\n    }\n  };\n\n  const getSynopsis = () => synopsis(page);\n\n  const getLinks = function() {\n\n    let pageLinks, pageLinksMap;\n    const extractPageLinks = function(collaborativeLinks, currentItem, currentIndex, array) {\n      // extract collaborative links\n      // - this will need extending if we also extract the id of the item containing the link\n      try {\n        const linkRe = /\\[\\[([^\\]]+)\\]\\]/g;\n        let match = undefined;\n        while ((match = linkRe.exec(currentItem.text)) !== null) {\n          if (!collaborativeLinks.has(asSlug(match[1]))) {\n            collaborativeLinks.set(asSlug(match[1]), currentItem.id);\n          }\n        }\n        if ('reference' === currentItem.type) {\n          if (!collaborativeLinks.has(currentItem.slug)) {\n            collaborativeLinks.set(currentItem.slug, currentItem.id);\n          }\n        }\n      } catch (err) {\n        console.log(`*** Error extracting links from ${currentIndex} of ${JSON.stringify(array)}`, err.message);\n      }\n      return collaborativeLinks;\n    };\n\n    try {\n      pageLinksMap = page.story.reduce( extractPageLinks, new Map());\n    } catch (error) {\n      const err = error;\n      console.log(`+++ Extract links on ${page.slug} fails`, err);\n    }\n    if (pageLinksMap.size > 0) {\n      pageLinks = Object.fromEntries(pageLinksMap);\n    } else {\n      pageLinks = {};\n    }\n    return pageLinks;\n  };\n\n\n  const addItem = function(item) {\n    item = Object.assign({}, {id: random.itemId()}, item);\n    page.story.push(item);\n  };\n\n  const getItem = function(id) {\n    for (var item of page.story) {\n      if (item.id === id) { return item; }\n    }\n    return null;\n  };\n\n  const seqItems = function(each) {\n    const promise = new Promise(function(resolve, _reject) {\n      var emitItem = function(i) {\n        if (i >= page.story.length) { return resolve(); }\n        return each(page.story[i]||{text:'null'}, () => emitItem(i+1));\n      };\n      return emitItem(0);\n    });\n    return promise;\n  };\n\n  const addParagraph = function(text) {\n    const type = \"paragraph\";\n    addItem({type, text});\n  };\n\n    // page.journal.push {type: 'add'}\n\n  const seqActions = function(each) {\n    let smaller = 0;\n    const sections = nowSections((new Date).getTime());\n    var emitAction = function(i) {\n      if (i >= page.journal.length) { return; }\n      const action = page.journal[i]||{};\n      const bigger = action.date || 0;\n      let separator = null;\n      for (var section of sections) {\n        if ((section.date > smaller) && (section.date < bigger)) {\n          separator = section;\n        }\n      }\n      smaller = bigger;\n      each({action, separator}, () => emitAction(i+1));\n    };\n    emitAction(0);\n  };\n\n  const become = function(story, journal) {\n    page.story = story?.getRawPage().story || [];\n    if (journal) { page.journal = journal?.getRawPage().journal }\n  };\n\n  const siteLineup = function() {\n    const slug = getSlug();\n    const path = slug === 'welcome-visitors' ?\n      \"view/welcome-visitors\"\n    :\n      `view/welcome-visitors/view/${slug}`;\n    if (isRemote()) {\n      // \"//#{site}/#{path}\"\n      return wiki.site(site).getDirectURL(path);\n    } else {\n      return `/${path}`;\n    }\n  };\n\n  const notDuplicate = function(journal, action) {\n    for (var each of journal) {\n      if ((each.id === action.id) && (each.date === action.date)) {\n        return false;\n      }\n    }\n    return true;\n  };\n\n  const merge = function(update) {\n    let action;\n\n    const merged = page.journal.slice();\n\n    for (action of update.getRawPage().journal) {\n      if (notDuplicate(page.journal, action)) { merged.push(action); }\n    }\n    merged.push({\n      type: 'fork',\n      site: update.getRemoteSite(),\n      date: (new Date()).getTime()\n    });\n    newPage(revision.create(999, {title: page.title, journal: merged}), site);\n  };\n\n  const apply = function(action) {\n    revision.apply(page, action);\n    if (action.site) { site = null; }\n  };\n\n  const getCreate = function() {\n    const isCreate = action => action.type === 'create';\n    page.journal.reverse().find(isCreate);\n  };\n\n  return {getRawPage, getContext, isPlugin, isRemote, isLocal, isRecycler, getRemoteSite, getRemoteSiteDetails, getSlug, getNeighbors, getTitle, getLinks, setTitle, getRevision, getDate, getTimestamp, getSynopsis, addItem, getItem, addParagraph, seqItems, seqActions, become, siteLineup, merge, apply, getCreate};\n};\n\nmodule.exports = {newPage, asSlug, asTitle, pageEmitter};\n", "// Wiki considers one page to be active. Use active.set to change which\n// page this is. A page need not be active to be edited.\n\nlet active;\nmodule.exports = (active = {});\n\nactive.scrollContainer = undefined;\n\nconst findScrollContainer = function() {\n  const scrolled = $(\"body, html\").filter(function() { return $(this).scrollLeft() > 0; });\n  if (scrolled.length > 0) {\n    return scrolled;\n  } else {\n    return $(\"body, html\").scrollLeft(12).filter(function() { return $(this).scrollLeft() > 0; }).scrollTop(0);\n  }\n};\n\nconst scrollTo = function($page) {\n  let scrollTarget;\n  if ($page.position() == null) { return; }\n  if (active.scrollContainer == null) { active.scrollContainer = findScrollContainer(); }\n  const bodyWidth = $(\"body\").width();\n  const minX = active.scrollContainer.scrollLeft();\n  const maxX = minX + bodyWidth;\n  const target = $page.position().left;\n  const width = $page.outerWidth(true);\n  const contentWidth = $(\".page\").outerWidth(true) * $(\".page\").length;\n\n  // determine target position to scroll to...\n  if (target < minX) {\n    scrollTarget = target;\n  } else if ((target + width) > maxX) {\n    scrollTarget = target - (bodyWidth - width);\n  } else if (maxX > $(\".pages\").outerWidth()) {\n    scrollTarget = Math.min(target, contentWidth - bodyWidth);\n  }\n  // scroll to target and set focus once animation is complete\n  active.scrollContainer.animate({\n    scrollLeft: scrollTarget\n    }, function() {\n      // only set focus if focus is not already within the page to get focus\n      if (!$.contains($page[0], document.activeElement)) { $page.trigger('focus'); }\n  } );\n};\n\n\nactive.set = function($page, noScroll) {\n  $('.incremental-search').remove();\n  $page = $($page);\n  $(\".active\").removeClass(\"active\");\n  $page.addClass(\"active\");\n  if (!noScroll) { scrollTo($page); }\n};\n", "// The lineup represents a sequence of pages with possible\n// duplication. We maintain the lineup in parallel with\n// the DOM list of .page elements. Eventually lineup will\n// play a more central role managing calculations and\n// display updates.\n\nconst random = require('./random');\n\nlet pageByKey = {};\nlet keyByIndex = [];\n\n\n// Basic manipulations that correspond to typical user activity\n\nconst addPage = function(pageObject) {\n  const key = random.randomBytes(4);\n  pageByKey[key] = pageObject;\n  keyByIndex.push(key);\n  return key;\n};\n\nconst changePageIndex = function(key, newIndex) {\n  const oldIndex = keyByIndex.indexOf(key);\n  keyByIndex.splice(oldIndex, 1);\n  keyByIndex.splice(newIndex, 0, key);\n};\n\nconst removeKey = function(key) {\n  if (!keyByIndex.includes(key)) { return null; }\n  keyByIndex = keyByIndex.filter(each => key !== each);\n  delete pageByKey[key];\n  return key;\n};\n\nconst removeAllAfterKey = function(key) {\n  const result = [];\n  if (!keyByIndex.includes(key)) { return result; }\n  while (keyByIndex[keyByIndex.length-1] !== key) {\n    var unwanted = keyByIndex.pop();\n    result.unshift(unwanted);\n    delete pageByKey[unwanted];\n  }\n  return result;\n};\n\nconst atKey = key => pageByKey[key];\n\nconst titleAtKey = key => atKey(key).getTitle();\n\nconst bestTitle = function() {\n  if (!keyByIndex.length) { return \"Wiki\"; }\n  return titleAtKey(keyByIndex[keyByIndex.length-1]);\n};\n\n\n// Debug access to internal state used by unit tests.\n\nconst debugKeys = () => keyByIndex;\n\nconst debugReset = function() {\n  pageByKey = {};\n  keyByIndex = [];\n};\n\n\n// Debug self-check which corrects misalignments until we get it right\n\nconst debugSelfCheck = function(keys) {\n  let have, keysByIndex, want;\n  if ((have = `${keyByIndex}`) === (want = `${keys}`)) { return; }\n  console.log('The lineup is out of sync with the dom.');\n  console.log(\".pages:\", keys);\n  console.log(\"lineup:\", keyByIndex);\n  if (`${Object.keys(keyByIndex).sort()}` !== `${Object.keys(keys).sort()}`) { return; }\n  console.log('It looks like an ordering problem we can fix.');\n  keysByIndex = keys;\n};\n\n\n// Select a few crumbs from the lineup that will take us\n// close to welcome-visitors on a (possibly) remote site.\n\nconst leftKey = function(key) {\n  const pos = keyByIndex.indexOf(key);\n  if (pos < 1) { return null; }\n  return keyByIndex[pos-1];\n};\n\nconst crumbs = function(key, location) {\n  let left, slug;\n  const page = pageByKey[key];\n  const host = page.getRemoteSite(location);\n  const result = ['view', (slug = page.getSlug())];\n  if (slug !== 'welcome-visitors') { result.unshift('view', 'welcome-visitors'); }\n  if ((host !== location) && (left = leftKey(key))) {\n    let adjacent;\n    if (!(adjacent = pageByKey[left]).isRemote()) {\n      result.push(location, adjacent.getSlug());\n    }\n  }\n  result.unshift(host);\n  return result;\n};\n\n\nmodule.exports = {addPage, changePageIndex, removeKey, removeAllAfterKey, atKey, titleAtKey, bestTitle, debugKeys, debugReset, crumbs, debugSelfCheck};\n", "// The state module saves the .page lineup in the browser's location\n// bar and history. It also reconstructs that state when the browser\n// notifies us that the user has changed this sequence.\n\nlet state;\nconst active = require('./active');\nconst lineup = require('./lineup');\nlet link = null;\n\nmodule.exports = (state = {});\n\n// FUNCTIONS and HANDLERS to manage location bar and back button\n\nstate.inject = link_ => link = link_;\n\nstate.pagesInDom = () => {\n  return Array.from(document.querySelectorAll('.page')).map(el => el.id)\n};\n\nstate.urlPages = () => {\n  const pathname = new URL(window.location.href).pathname;\n  return pathname.split('/').slice(1).filter((...[, index]) => index % 2 === 1)\n};\n\n// site is not held in DOM, but using jQuery data - so stick with jQuery for now.\nstate.locsInDom = () => $.makeArray($(\".page\").map((_, el) => $(el).data('site') || 'view')\n);\n\nstate.urlLocs = () => {\n  const pathname = new URL(window.location.href).pathname;\n  return pathname.split('/').slice(1).filter((...[, index]) => index % 2 === 0);\n}\n\nstate.setUrl = () => {\n  document.title = lineup.bestTitle();\n  if (history && history.pushState) {\n    const locs = state.locsInDom();\n    const pages = state.pagesInDom();\n    const url = pages.map((page, idx) => `/${locs[idx] || 'view'}/${page}`).join('');\n    if (url !== new URL(window.location.href).pathname) {\n      history.pushState(null, null, url);\n    }\n  }\n};\n\nstate.debugStates = () => {\n  console.log('a .page keys ', (Array.from($('.page')).map((each) => $(each).data('key'))));\n  console.log('a lineup keys', lineup.debugKeys());\n};\n\nstate.show = (e) => {\n  const oldPages = state.pagesInDom();\n  const newPages = state.urlPages();\n  const oldLocs = state.locsInDom();\n  const newLocs = state.urlLocs();\n\n  if (!location.pathname || location.pathname === '/') return;\n\n  let matching = true;\n  for (const [idx, name] of oldPages.entries()) {\n    if (matching && (matching = name === newPages[idx])) continue;\n    const old = $('.page:last');\n    lineup.removeKey(old.data('key'));\n    old.remove();\n  }\n\n  matching = true;\n  for (const [idx, name] of newPages.entries()) {\n    if (matching && (matching = name === oldPages[idx])) continue;\n    link.showPage(name, newLocs[idx]);\n  }\n\n  if (window.debug) {\n    state.debugStates();\n  }\n\n  active.set($('.page').last());\n  document.title = lineup.bestTitle();\n};\n\nstate.first = () => {\n  state.setUrl();\n  const firstUrlPages = state.urlPages();\n  const firstUrlLocs = state.urlLocs();\n  const oldPages = state.pagesInDom();\n  for (let idx = 0; idx < firstUrlPages.length; idx++) {\n    const urlPage = firstUrlPages[idx];\n      if (!oldPages.includes(urlPage) && urlPage !== '') {\n        link.createPage(urlPage, firstUrlLocs[idx])\n      }\n    }\n};\n", "// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n// We use unicode characters as icons for actions\n// in the journal. Fork and add are also button\n// labels used for user actions leading to forks\n// and adds. How poetic.\n\n// Page keeps its own list of symbols used as journal\n// action separators.\n\nconst symbols = {\n  create: '\u263C',\n  add: '+',\n  edit: '\u270E',\n  fork: '\u2691',\n  move: '\u2195',\n  remove: '\u2715',\n  copyIn: '\u2A2D',\n  copyOut: '\u2A35'\n};\n\nconst fork = symbols['fork'];\nconst add = symbols['add'];\n\nmodule.exports = {symbols, fork, add};", "// A wiki page has a journal of actions that have been completed.\n// The addToJournal function is called when the origin server\n// response that the network operation is complete.\n\nconst util = require('./util');\nconst actionSymbols = require('./actionSymbols');\n\nmodule.exports = function($journal, action) {\n  const $page = $journal.parents('.page:first');\n  const $action = $(\"<a href=\\\"#\\\" /> \").addClass(\"action\").addClass(action.type || 'separator')\n    .text(action.symbol || actionSymbols.symbols[action.type])\n    .attr('title',util.formatActionTitle(action))\n    .attr('data-id', action.id || \"0\")\n    .attr('data-date', action.date || \"0\")\n    .data('action', action);\n  if (action.type === 'add' && action.attribution) {\n    $action.text(actionSymbols.symbols['copyIn']);\n    if (action.attribution.site) { $action.css(\"background-image\", `url(${wiki.site(action.attribution.site).flag()})`); }\n  }\n  if (action.type === 'remove' && action.removedTo) {\n    $action.text(actionSymbols.symbols['copyOut']);\n  }\n  const controls = $journal.children('.control-buttons');\n  if (controls.length > 0) {\n    $action.insertBefore(controls);\n  } else {\n    $action.appendTo($journal);\n  }\n  if (action.type === 'fork' && action.site) {\n    $action\n      .css(\"background-image\", `url(${wiki.site(action.site).flag()}`)\n      .attr(\"href\", `${wiki.site(action.site).getDirectURL($page.attr('id'))}.html`)\n      .attr(\"target\", `${action.site}`)\n      .data(\"site\", action.site)\n      .data(\"slug\", $page.attr('id'));\n  }\n};\n", "/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n", "import type { RadixTree, Entry, LeafType } from './types'\n\n/** @ignore */\nconst ENTRIES = 'ENTRIES'\n\n/** @ignore */\nconst KEYS = 'KEYS'\n\n/** @ignore */\nconst VALUES = 'VALUES'\n\n/** @ignore */\nconst LEAF = '' as LeafType\n\ninterface Iterators<T> {\n  ENTRIES: Entry<T>\n  KEYS: string\n  VALUES: T\n}\n\ntype Kind<T> = keyof Iterators<T>\ntype Result<T, K extends keyof Iterators<T>> = Iterators<T>[K]\n\ntype IteratorPath<T> = {\n  node: RadixTree<T>,\n  keys: string[]\n}[]\n\nexport type IterableSet<T> = {\n  _tree: RadixTree<T>,\n  _prefix: string\n}\n\n/**\n * @private\n */\nclass TreeIterator<T, K extends Kind<T>> implements Iterator<Result<T, K>> {\n  set: IterableSet<T>\n  _type: K\n  _path: IteratorPath<T>\n\n  constructor (set: IterableSet<T>, type: K) {\n    const node = set._tree\n    const keys = Array.from(node.keys())\n    this.set = set\n    this._type = type\n    this._path = keys.length > 0 ? [{ node, keys }] : []\n  }\n\n  next (): IteratorResult<Result<T, K>> {\n    const value = this.dive()\n    this.backtrack()\n    return value\n  }\n\n  dive (): IteratorResult<Result<T, K>> {\n    if (this._path.length === 0) { return { done: true, value: undefined } }\n    const { node, keys } = last(this._path)!\n    if (last(keys) === LEAF) { return { done: false, value: this.result() } }\n\n    const child = node.get(last(keys)!)!\n    this._path.push({ node: child, keys: Array.from(child.keys()) })\n    return this.dive()\n  }\n\n  backtrack (): void {\n    if (this._path.length === 0) { return }\n    const keys = last(this._path)!.keys\n    keys.pop()\n    if (keys.length > 0) { return }\n    this._path.pop()\n    this.backtrack()\n  }\n\n  key (): string {\n    return this.set._prefix + this._path\n      .map(({ keys }) => last(keys))\n      .filter(key => key !== LEAF)\n      .join('')\n  }\n\n  value (): T {\n    return last(this._path)!.node.get(LEAF)!\n  }\n\n  result (): Result<T, K> {\n    switch (this._type) {\n      case VALUES: return this.value() as Result<T, K>\n      case KEYS: return this.key() as Result<T, K>\n      default: return [this.key(), this.value()] as Result<T, K>\n    }\n  }\n\n  [Symbol.iterator] () {\n    return this\n  }\n}\n\nconst last = <T>(array: T[]): T | undefined => {\n  return array[array.length - 1]\n}\n\nexport { TreeIterator, ENTRIES, KEYS, VALUES, LEAF }\n", "/* eslint-disable no-labels */\nimport { LEAF } from './TreeIterator'\nimport type { RadixTree } from './types'\n\nexport type FuzzyResult<T> = [T, number]\n\nexport type FuzzyResults<T> = Map<string, FuzzyResult<T>>\n\n/**\n * @ignore\n */\nexport const fuzzySearch = <T = any>(node: RadixTree<T>, query: string, maxDistance: number): FuzzyResults<T> => {\n  const results: FuzzyResults<T> = new Map()\n  if (query === undefined) return results\n\n  // Number of columns in the Levenshtein matrix.\n  const n = query.length + 1\n\n  // Matching terms can never be longer than N + maxDistance.\n  const m = n + maxDistance\n\n  // Fill first matrix row and column with numbers: 0 1 2 3 ...\n  const matrix = new Uint8Array(m * n).fill(maxDistance + 1)\n  for (let j = 0; j < n; ++j) matrix[j] = j\n  for (let i = 1; i < m; ++i) matrix[i * n] = i\n\n  recurse(\n    node,\n    query,\n    maxDistance,\n    results,\n    matrix,\n    1,\n    n,\n    ''\n  )\n\n  return results\n}\n\n// Modified version of http://stevehanov.ca/blog/?id=114\n\n// This builds a Levenshtein matrix for a given query and continuously updates\n// it for nodes in the radix tree that fall within the given maximum edit\n// distance. Keeping the same matrix around is beneficial especially for larger\n// edit distances.\n//\n//           k   a   t   e   <-- query\n//       0   1   2   3   4\n//   c   1   1   2   3   4\n//   a   2   2   1   2   3\n//   t   3   3   2   1  [2]  <-- edit distance\n//   ^\n//   ^ term in radix tree, rows are added and removed as needed\n\nconst recurse = <T = any>(\n  node: RadixTree<T>,\n  query: string,\n  maxDistance: number,\n  results: FuzzyResults<T>,\n  matrix: Uint8Array,\n  m: number,\n  n: number,\n  prefix: string\n): void => {\n  const offset = m * n\n\n  key: for (const key of node.keys()) {\n    if (key === LEAF) {\n      // We've reached a leaf node. Check if the edit distance acceptable and\n      // store the result if it is.\n      const distance = matrix[offset - 1]\n      if (distance <= maxDistance) {\n        results.set(prefix, [node.get(key)!, distance])\n      }\n    } else {\n      // Iterate over all characters in the key. Update the Levenshtein matrix\n      // and check if the minimum distance in the last row is still within the\n      // maximum edit distance. If it is, we can recurse over all child nodes.\n      let i = m\n      for (let pos = 0; pos < key.length; ++pos, ++i) {\n        const char = key[pos]\n        const thisRowOffset = n * i\n        const prevRowOffset = thisRowOffset - n\n\n        // Set the first column based on the previous row, and initialize the\n        // minimum distance in the current row.\n        let minDistance = matrix[thisRowOffset]\n\n        const jmin = Math.max(0, i - maxDistance - 1)\n        const jmax = Math.min(n - 1, i + maxDistance)\n\n        // Iterate over remaining columns (characters in the query).\n        for (let j = jmin; j < jmax; ++j) {\n          const different = char !== query[j]\n\n          // It might make sense to only read the matrix positions used for\n          // deletion/insertion if the characters are different. But we want to\n          // avoid conditional reads for performance reasons.\n          const rpl = matrix[prevRowOffset + j] + +different\n          const del = matrix[prevRowOffset + j + 1] + 1\n          const ins = matrix[thisRowOffset + j] + 1\n\n          const dist = matrix[thisRowOffset + j + 1] = Math.min(rpl, del, ins)\n\n          if (dist < minDistance) minDistance = dist\n        }\n\n        // Because distance will never decrease, we can stop. There will be no\n        // matching child nodes.\n        if (minDistance > maxDistance) {\n          continue key\n        }\n      }\n\n      recurse(\n        node.get(key)!,\n        query,\n        maxDistance,\n        results,\n        matrix,\n        i,\n        n,\n        prefix + key\n      )\n    }\n  }\n}\n\nexport default fuzzySearch\n", "/* eslint-disable no-labels */\nimport { TreeIterator, ENTRIES, KEYS, VALUES, LEAF } from './TreeIterator'\nimport fuzzySearch, { type FuzzyResults } from './fuzzySearch'\nimport type { RadixTree, Entry, Path } from './types'\n\n/**\n * A class implementing the same interface as a standard JavaScript\n * [`Map`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)\n * with string keys, but adding support for efficiently searching entries with\n * prefix or fuzzy search. This class is used internally by {@link MiniSearch}\n * as the inverted index data structure. The implementation is a radix tree\n * (compressed prefix tree).\n *\n * Since this class can be of general utility beyond _MiniSearch_, it is\n * exported by the `minisearch` package and can be imported (or required) as\n * `minisearch/SearchableMap`.\n *\n * @typeParam T  The type of the values stored in the map.\n */\nexport default class SearchableMap<T = any> {\n  /**\n   * @internal\n   */\n  _tree: RadixTree<T>\n\n  /**\n   * @internal\n   */\n  _prefix: string\n\n  private _size: number | undefined = undefined\n\n  /**\n   * The constructor is normally called without arguments, creating an empty\n   * map. In order to create a {@link SearchableMap} from an iterable or from an\n   * object, check {@link SearchableMap.from} and {@link\n   * SearchableMap.fromObject}.\n   *\n   * The constructor arguments are for internal use, when creating derived\n   * mutable views of a map at a prefix.\n   */\n  constructor (tree: RadixTree<T> = new Map(), prefix = '') {\n    this._tree = tree\n    this._prefix = prefix\n  }\n\n  /**\n   * Creates and returns a mutable view of this {@link SearchableMap},\n   * containing only entries that share the given prefix.\n   *\n   * ### Usage:\n   *\n   * ```javascript\n   * let map = new SearchableMap()\n   * map.set(\"unicorn\", 1)\n   * map.set(\"universe\", 2)\n   * map.set(\"university\", 3)\n   * map.set(\"unique\", 4)\n   * map.set(\"hello\", 5)\n   *\n   * let uni = map.atPrefix(\"uni\")\n   * uni.get(\"unique\") // => 4\n   * uni.get(\"unicorn\") // => 1\n   * uni.get(\"hello\") // => undefined\n   *\n   * let univer = map.atPrefix(\"univer\")\n   * univer.get(\"unique\") // => undefined\n   * univer.get(\"universe\") // => 2\n   * univer.get(\"university\") // => 3\n   * ```\n   *\n   * @param prefix  The prefix\n   * @return A {@link SearchableMap} representing a mutable view of the original\n   * Map at the given prefix\n   */\n  atPrefix (prefix: string): SearchableMap<T> {\n    if (!prefix.startsWith(this._prefix)) { throw new Error('Mismatched prefix') }\n\n    const [node, path] = trackDown(this._tree, prefix.slice(this._prefix.length))\n\n    if (node === undefined) {\n      const [parentNode, key] = last(path)\n\n      for (const k of parentNode!.keys()) {\n        if (k !== LEAF && k.startsWith(key)) {\n          const node = new Map()\n          node.set(k.slice(key.length), parentNode!.get(k)!)\n          return new SearchableMap(node, prefix)\n        }\n      }\n    }\n\n    return new SearchableMap<T>(node, prefix)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/clear\n   */\n  clear (): void {\n    this._size = undefined\n    this._tree.clear()\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/delete\n   * @param key  Key to delete\n   */\n  delete (key: string): void {\n    this._size = undefined\n    return remove(this._tree, key)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/entries\n   * @return An iterator iterating through `[key, value]` entries.\n   */\n  entries () {\n    return new TreeIterator(this, ENTRIES)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/forEach\n   * @param fn  Iteration function\n   */\n  forEach (fn: (key: string, value: T, map: SearchableMap) => void): void {\n    for (const [key, value] of this) {\n      fn(key, value, this)\n    }\n  }\n\n  /**\n   * Returns a Map of all the entries that have a key within the given edit\n   * distance from the search key. The keys of the returned Map are the matching\n   * keys, while the values are two-element arrays where the first element is\n   * the value associated to the key, and the second is the edit distance of the\n   * key to the search key.\n   *\n   * ### Usage:\n   *\n   * ```javascript\n   * let map = new SearchableMap()\n   * map.set('hello', 'world')\n   * map.set('hell', 'yeah')\n   * map.set('ciao', 'mondo')\n   *\n   * // Get all entries that match the key 'hallo' with a maximum edit distance of 2\n   * map.fuzzyGet('hallo', 2)\n   * // => Map(2) { 'hello' => ['world', 1], 'hell' => ['yeah', 2] }\n   *\n   * // In the example, the \"hello\" key has value \"world\" and edit distance of 1\n   * // (change \"e\" to \"a\"), the key \"hell\" has value \"yeah\" and edit distance of 2\n   * // (change \"e\" to \"a\", delete \"o\")\n   * ```\n   *\n   * @param key  The search key\n   * @param maxEditDistance  The maximum edit distance (Levenshtein)\n   * @return A Map of the matching keys to their value and edit distance\n   */\n  fuzzyGet (key: string, maxEditDistance: number): FuzzyResults<T> {\n    return fuzzySearch<T>(this._tree, key, maxEditDistance)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/get\n   * @param key  Key to get\n   * @return Value associated to the key, or `undefined` if the key is not\n   * found.\n   */\n  get (key: string): T | undefined {\n    const node = lookup<T>(this._tree, key)\n    return node !== undefined ? node.get(LEAF) : undefined\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/has\n   * @param key  Key\n   * @return True if the key is in the map, false otherwise\n   */\n  has (key: string): boolean {\n    const node = lookup(this._tree, key)\n    return node !== undefined && node.has(LEAF)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/keys\n   * @return An `Iterable` iterating through keys\n   */\n  keys () {\n    return new TreeIterator(this, KEYS)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/set\n   * @param key  Key to set\n   * @param value  Value to associate to the key\n   * @return The {@link SearchableMap} itself, to allow chaining\n   */\n  set (key: string, value: T): SearchableMap<T> {\n    if (typeof key !== 'string') { throw new Error('key must be a string') }\n    this._size = undefined\n    const node = createPath(this._tree, key)\n    node.set(LEAF, value)\n    return this\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/size\n   */\n  get size (): number {\n    if (this._size) { return this._size }\n    /** @ignore */\n    this._size = 0\n\n    const iter = this.entries()\n    while (!iter.next().done) this._size! += 1\n\n    return this._size\n  }\n\n  /**\n   * Updates the value at the given key using the provided function. The function\n   * is called with the current value at the key, and its return value is used as\n   * the new value to be set.\n   *\n   * ### Example:\n   *\n   * ```javascript\n   * // Increment the current value by one\n   * searchableMap.update('somekey', (currentValue) => currentValue == null ? 0 : currentValue + 1)\n   * ```\n   *\n   * If the value at the given key is or will be an object, it might not require\n   * re-assignment. In that case it is better to use `fetch()`, because it is\n   * faster.\n   *\n   * @param key  The key to update\n   * @param fn  The function used to compute the new value from the current one\n   * @return The {@link SearchableMap} itself, to allow chaining\n   */\n  update (key: string, fn: (value: T | undefined) => T): SearchableMap<T> {\n    if (typeof key !== 'string') { throw new Error('key must be a string') }\n    this._size = undefined\n    const node = createPath(this._tree, key)\n    node.set(LEAF, fn(node.get(LEAF)))\n    return this\n  }\n\n  /**\n   * Fetches the value of the given key. If the value does not exist, calls the\n   * given function to create a new value, which is inserted at the given key\n   * and subsequently returned.\n   *\n   * ### Example:\n   *\n   * ```javascript\n   * const map = searchableMap.fetch('somekey', () => new Map())\n   * map.set('foo', 'bar')\n   * ```\n   *\n   * @param key  The key to update\n   * @param defaultValue  A function that creates a new value if the key does not exist\n   * @return The existing or new value at the given key\n   */\n  fetch (key: string, initial: () => T): T {\n    if (typeof key !== 'string') { throw new Error('key must be a string') }\n    this._size = undefined\n    const node = createPath(this._tree, key)\n\n    let value = node.get(LEAF)\n    if (value === undefined) {\n      node.set(LEAF, value = initial())\n    }\n\n    return value\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/values\n   * @return An `Iterable` iterating through values.\n   */\n  values () {\n    return new TreeIterator(this, VALUES)\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/@@iterator\n   */\n  [Symbol.iterator] () {\n    return this.entries()\n  }\n\n  /**\n   * Creates a {@link SearchableMap} from an `Iterable` of entries\n   *\n   * @param entries  Entries to be inserted in the {@link SearchableMap}\n   * @return A new {@link SearchableMap} with the given entries\n   */\n  static from<T = any> (entries: Iterable<Entry<T>> | Entry<T>[]) {\n    const tree = new SearchableMap()\n    for (const [key, value] of entries) {\n      tree.set(key, value)\n    }\n    return tree\n  }\n\n  /**\n   * Creates a {@link SearchableMap} from the iterable properties of a JavaScript object\n   *\n   * @param object  Object of entries for the {@link SearchableMap}\n   * @return A new {@link SearchableMap} with the given entries\n   */\n  static fromObject<T = any> (object: { [key: string]: T }) {\n    return SearchableMap.from<T>(Object.entries(object))\n  }\n}\n\nconst trackDown = <T = any>(tree: RadixTree<T> | undefined, key: string, path: Path<T> = []): [RadixTree<T> | undefined, Path<T>] => {\n  if (key.length === 0 || tree == null) { return [tree, path] }\n\n  for (const k of tree.keys()) {\n    if (k !== LEAF && key.startsWith(k)) {\n      path.push([tree, k]) // performance: update in place\n      return trackDown(tree.get(k)!, key.slice(k.length), path)\n    }\n  }\n\n  path.push([tree, key]) // performance: update in place\n  return trackDown(undefined, '', path)\n}\n\nconst lookup = <T = any>(tree: RadixTree<T>, key: string): RadixTree<T> | undefined => {\n  if (key.length === 0 || tree == null) { return tree }\n\n  for (const k of tree.keys()) {\n    if (k !== LEAF && key.startsWith(k)) {\n      return lookup(tree.get(k)!, key.slice(k.length))\n    }\n  }\n}\n\n// Create a path in the radix tree for the given key, and returns the deepest\n// node. This function is in the hot path for indexing. It avoids unnecessary\n// string operations and recursion for performance.\nconst createPath = <T = any>(node: RadixTree<T>, key: string): RadixTree<T> => {\n  const keyLength = key.length\n\n  outer: for (let pos = 0; node && pos < keyLength;) {\n    for (const k of node.keys()) {\n      // Check whether this key is a candidate: the first characters must match.\n      if (k !== LEAF && key[pos] === k[0]) {\n        const len = Math.min(keyLength - pos, k.length)\n\n        // Advance offset to the point where key and k no longer match.\n        let offset = 1\n        while (offset < len && key[pos + offset] === k[offset]) ++offset\n\n        const child = node.get(k)!\n        if (offset === k.length) {\n          // The existing key is shorter than the key we need to create.\n          node = child\n        } else {\n          // Partial match: we need to insert an intermediate node to contain\n          // both the existing subtree and the new node.\n          const intermediate = new Map()\n          intermediate.set(k.slice(offset), child)\n          node.set(key.slice(pos, pos + offset), intermediate)\n          node.delete(k)\n          node = intermediate\n        }\n\n        pos += offset\n        continue outer\n      }\n    }\n\n    // Create a final child node to contain the final suffix of the key.\n    const child = new Map()\n    node.set(key.slice(pos), child)\n    return child\n  }\n\n  return node\n}\n\nconst remove = <T = any>(tree: RadixTree<T>, key: string): void => {\n  const [node, path] = trackDown(tree, key)\n  if (node === undefined) { return }\n  node.delete(LEAF)\n\n  if (node.size === 0) {\n    cleanup(path)\n  } else if (node.size === 1) {\n    const [key, value] = node.entries().next().value\n    merge(path, key, value)\n  }\n}\n\nconst cleanup = <T = any>(path: Path<T>): void => {\n  if (path.length === 0) { return }\n\n  const [node, key] = last(path)\n  node!.delete(key)\n\n  if (node!.size === 0) {\n    cleanup(path.slice(0, -1))\n  } else if (node!.size === 1) {\n    const [key, value] = node!.entries().next().value\n    if (key !== LEAF) {\n      merge(path.slice(0, -1), key, value)\n    }\n  }\n}\n\nconst merge = <T = any>(path: Path<T>, key: string, value: RadixTree<T>): void => {\n  if (path.length === 0) { return }\n\n  const [node, nodeKey] = last(path)\n  node!.set(nodeKey + key, value)\n  node!.delete(nodeKey)\n}\n\nconst last = <T = any>(array: T[]): T => {\n  return array[array.length - 1]\n}\n", "import SearchableMap from './SearchableMap/SearchableMap'\n\nexport type LowercaseCombinationOperator = 'or' | 'and' | 'and_not'\nexport type CombinationOperator = LowercaseCombinationOperator | Uppercase<LowercaseCombinationOperator> | Capitalize<LowercaseCombinationOperator>\n\nconst OR: LowercaseCombinationOperator = 'or'\nconst AND: LowercaseCombinationOperator = 'and'\nconst AND_NOT: LowercaseCombinationOperator = 'and_not'\n\n/**\n * Search options to customize the search behavior.\n */\nexport type SearchOptions = {\n  /**\n   * Names of the fields to search in. If omitted, all fields are searched.\n   */\n  fields?: string[],\n\n  /**\n   * Function used to filter search results, for example on the basis of stored\n   * fields. It takes as argument each search result and should return a boolean\n   * to indicate if the result should be kept or not.\n   */\n  filter?: (result: SearchResult) => boolean,\n\n  /**\n   * Key-value object of field names to boosting values. By default, fields are\n   * assigned a boosting factor of 1. If one assigns to a field a boosting value\n   * of 2, a result that matches the query in that field is assigned a score\n   * twice as high as a result matching the query in another field, all else\n   * being equal.\n   */\n  boost?: { [fieldName: string]: number },\n\n  /**\n   * Function to calculate a boost factor for each term.\n   *\n   * This function, if provided, is called for each query term (as split by\n   * `tokenize` and processed by `processTerm`). The arguments passed to the\n   * function are the query term, the positional index of the term in the query,\n   * and the array of all query terms. It is expected to return a numeric boost\n   * factor for the term. A factor lower than 1 reduces the importance of the\n   * term, a factor greater than 1 increases it. A factor of exactly 1 is\n   * neutral, and does not affect the term's importance.\n   */\n  boostTerm?: (term: string, i: number, terms: string[]) => number,\n\n  /**\n   * Relative weights to assign to prefix search results and fuzzy search\n   * results. Exact matches are assigned a weight of 1.\n   */\n  weights?: { fuzzy: number, prefix: number },\n\n  /**\n   * Function to calculate a boost factor for documents. It takes as arguments\n   * the document ID, and a term that matches the search in that document, and\n   * the value of the stored fields for the document (if any).  It should return\n   * a boosting factor: a number higher than 1 increases the computed score, a\n   * number lower than 1 decreases the score, and a falsy value skips the search\n   * result completely.\n   */\n  boostDocument?: (documentId: any, term: string, storedFields?: Record<string, unknown>) => number,\n\n  /**\n   * Controls whether to perform prefix search. It can be a simple boolean, or a\n   * function.\n   *\n   * If a boolean is passed, prefix search is performed if true.\n   *\n   * If a function is passed, it is called upon search with a search term, the\n   * positional index of that search term in the tokenized search query, and the\n   * tokenized search query. The function should return a boolean to indicate\n   * whether to perform prefix search for that search term.\n   */\n  prefix?: boolean | ((term: string, index: number, terms: string[]) => boolean),\n\n  /**\n   * Controls whether to perform fuzzy search. It can be a simple boolean, or a\n   * number, or a function.\n   *\n   * If a boolean is given, fuzzy search with a default fuzziness parameter is\n   * performed if true.\n   *\n   * If a number higher or equal to 1 is given, fuzzy search is performed, with\n   * a maximum edit distance (Levenshtein) equal to the number.\n   *\n   * If a number between 0 and 1 is given, fuzzy search is performed within a\n   * maximum edit distance corresponding to that fraction of the term length,\n   * approximated to the nearest integer. For example, 0.2 would mean an edit\n   * distance of 20% of the term length, so 1 character in a 5-characters term.\n   * The calculated fuzziness value is limited by the `maxFuzzy` option, to\n   * prevent slowdown for very long queries.\n   *\n   * If a function is passed, the function is called upon search with a search\n   * term, a positional index of that term in the tokenized search query, and\n   * the tokenized search query. It should return a boolean or a number, with\n   * the meaning documented above.\n   */\n  fuzzy?: boolean | number | ((term: string, index: number, terms: string[]) => boolean | number),\n\n  /**\n   * Controls the maximum fuzziness when using a fractional fuzzy value. This is\n   * set to 6 by default. Very high edit distances usually don't produce\n   * meaningful results, but can excessively impact search performance.\n   */\n  maxFuzzy?: number,\n\n  /**\n   * The operand to combine partial results for each term. By default it is\n   * \"OR\", so results matching _any_ of the search terms are returned by a\n   * search. If \"AND\" is given, only results matching _all_ the search terms are\n   * returned by a search.\n   */\n  combineWith?: CombinationOperator,\n\n  /**\n   * Function to tokenize the search query. By default, the same tokenizer used\n   * for indexing is used also for search.\n   *\n   * @remarks This function is called after `extractField` extracts a truthy\n   * value from a field. This function is then expected to split the extracted\n   * `text` document into tokens (more commonly referred to as \"terms\" in this\n   * context). The resulting split might be simple, like for example on word\n   * boundaries, or it might be more complex, taking into account certain\n   * encoding, or parsing needs, or even just special cases. Think about how one\n   * might need to go about indexing the term \"short-term\". You would likely\n   * want to treat this case specially, and return two terms instead, `[\n   * \"short\", \"term\" ]`.\n   *\n   * Or, you could let such a case be handled by the `processTerm` function,\n   * which is designed to turn each token/term into whole terms or sub-terms. In\n   * any case, the purpose of this function is to split apart the provided\n   * `text` document into parts that can be processed by the `processTerm`\n   * function.\n   */\n  tokenize?: (text: string) => string[],\n\n  /**\n   * Function to process or normalize terms in the search query. By default, the\n   * same term processor used for indexing is used also for search.\n   *\n   * @remarks\n   * During the document indexing phase, the first step is to call the\n   * `extractField` function to fetch the requested value/field from the\n   * document. This is then passed off to the `tokenize` function, which will\n   * break apart each value into \"terms\". These terms are then individually\n   * passed through this function to compute each term individually. A term\n   * might for example be something like \"lbs\", in which case one would likely\n   * want to return `[ \"lbs\", \"lb\", \"pound\", \"pounds\" ]`. You may also return\n   * just a single string, or a falsy value if you would like to skip indexing\n   * entirely for a specific term.\n   *\n   * Truthy return value(s) are then fed to the indexer as positive matches for\n   * this document. In our example above, all four of the `[ \"lbs\", \"lb\",\n   * \"pound\", \"pounds\" ]` terms would be added to the indexing engine, matching\n   * against the current document being computed.\n   *\n   * *Note: Whatever values are returned from this function will receive no\n   * further processing before being indexed. This means for example, if you\n   * include whitespace at the beginning or end of a word, it will also be\n   * indexed that way, with the included whitespace.*\n   */\n  processTerm?: (term: string) => string | string[] | null | undefined | false\n\n  /**\n   * BM25+ algorithm parameters. Customizing these is almost never necessary,\n   * and finetuning them requires an understanding of the BM25 scoring model. In\n   * most cases, it is best to omit this option to use defaults, and instead use\n   * boosting to tweak scoring for specific use cases.\n   */\n  bm25?: BM25Params\n}\n\ntype SearchOptionsWithDefaults = SearchOptions & {\n  boost: { [fieldName: string]: number },\n\n  weights: { fuzzy: number, prefix: number },\n\n  prefix: boolean | ((term: string, index: number, terms: string[]) => boolean),\n\n  fuzzy: boolean | number | ((term: string, index: number, terms: string[]) => boolean | number),\n\n  maxFuzzy: number,\n\n  combineWith: CombinationOperator\n\n  bm25: BM25Params\n}\n\n/**\n * Configuration options passed to the {@link MiniSearch} constructor\n *\n * @typeParam T  The type of documents being indexed.\n */\nexport type Options<T = any> = {\n   /**\n    * Names of the document fields to be indexed.\n    */\n  fields: string[],\n\n   /**\n    * Name of the ID field, uniquely identifying a document.\n    */\n  idField?: string,\n\n   /**\n    * Names of fields to store, so that search results would include them. By\n    * default none, so results would only contain the id field.\n    */\n  storeFields?: string[],\n\n   /**\n    * Function used to extract the value of each field in documents. By default,\n    * the documents are assumed to be plain objects with field names as keys,\n    * but by specifying a custom `extractField` function one can completely\n    * customize how the fields are extracted.\n    *\n    * The function takes as arguments the document, and the name of the field to\n    * extract from it. It should return the field value as a string.\n    *\n    * @remarks\n    * The returned string is fed into the `tokenize` function to split it up\n    * into tokens.\n    */\n  extractField?: (document: T, fieldName: string) => string,\n\n   /**\n    * Function used to split a field value into individual terms to be indexed.\n    * The default tokenizer separates terms by space or punctuation, but a\n    * custom tokenizer can be provided for custom logic.\n    *\n    * The function takes as arguments string to tokenize, and the name of the\n    * field it comes from. It should return the terms as an array of strings.\n    * When used for tokenizing a search query instead of a document field, the\n    * `fieldName` is undefined.\n    *\n    * @remarks\n    * This function is called after `extractField` extracts a truthy value from a\n    * field. This function is then expected to split the extracted `text` document\n    * into tokens (more commonly referred to as \"terms\" in this context). The resulting\n    * split might be simple, like for example on word boundaries, or it might be more\n    * complex, taking into account certain encoding, or parsing needs, or even just\n    * special cases. Think about how one might need to go about indexing the term\n    * \"short-term\". You would likely want to treat this case specially, and return two\n    * terms instead, `[ \"short\", \"term\" ]`.\n    *\n    * Or, you could let such a case be handled by the `processTerm` function,\n    * which is designed to turn each token/term into whole terms or sub-terms. In any\n    * case, the purpose of this function is to split apart the provided `text` document\n    * into parts that can be processed by the `processTerm` function.\n    */\n  tokenize?: (text: string, fieldName?: string) => string[],\n\n   /**\n    * Function used to process a term before indexing or search. This can be\n    * used for normalization (such as stemming). By default, terms are\n    * downcased, and otherwise no other normalization is performed.\n    *\n    * The function takes as arguments a term to process, and the name of the\n    * field it comes from. It should return the processed term as a string, or a\n    * falsy value to reject the term entirely.\n    *\n    * It can also return an array of strings, in which case each string in the\n    * returned array is indexed as a separate term.\n    *\n    * @remarks\n    * During the document indexing phase, the first step is to call the `extractField`\n    * function to fetch the requested value/field from the document. This is then\n    * passed off to the `tokenizer`, which will break apart each value into \"terms\".\n    * These terms are then individually passed through the `processTerm` function\n    * to compute each term individually. A term might for example be something\n    * like \"lbs\", in which case one would likely want to return\n    * `[ \"lbs\", \"lb\", \"pound\", \"pounds\" ]`. You may also return a single string value,\n    * or a falsy value if you would like to skip indexing entirely for a specific term.\n    *\n    * Truthy return value(s) are then fed to the indexer as positive matches for this\n    * document. In our example above, all four of the `[ \"lbs\", \"lb\", \"pound\", \"pounds\" ]`\n    * terms would be added to the indexing engine, matching against the current document\n    * being computed.\n    *\n    * *Note: Whatever values are returned from this function will receive no further\n    * processing before being indexed. This means for example, if you include whitespace\n    * at the beginning or end of a word, it will also be indexed that way, with the\n    * included whitespace.*\n    */\n  processTerm?: (term: string, fieldName?: string) => string | string[] | null | undefined | false,\n\n  /**\n   * Function called to log messages. Arguments are a log level ('debug',\n   * 'info', 'warn', or 'error'), a log message, and an optional string code\n   * that identifies the reason for the log.\n   *\n   * The default implementation uses `console`, if defined.\n   */\n  logger?: (level: LogLevel, message: string, code?: string) => void\n\n  /**\n   * If `true` (the default), vacuuming is performed automatically as soon as\n   * {@link MiniSearch#discard} is called a certain number of times, cleaning up\n   * obsolete references from the index. If `false`, no automatic vacuuming is\n   * performed. Custom settings controlling auto vacuuming thresholds, as well\n   * as batching behavior, can be passed as an object (see the {@link\n   * AutoVacuumOptions} type).\n   */\n  autoVacuum?: boolean | AutoVacuumOptions\n\n   /**\n    * Default search options (see the {@link SearchOptions} type and the {@link\n    * MiniSearch#search} method for details)\n    */\n  searchOptions?: SearchOptions,\n\n   /**\n    * Default auto suggest options (see the {@link SearchOptions} type and the\n    * {@link MiniSearch#autoSuggest} method for details)\n    */\n  autoSuggestOptions?: SearchOptions\n}\n\ntype OptionsWithDefaults<T = any> = Options<T> & {\n  storeFields: string[]\n\n  idField: string\n\n  extractField: (document: T, fieldName: string) => string\n\n  tokenize: (text: string, fieldName: string) => string[]\n\n  processTerm: (term: string, fieldName: string) => string | string[] | null | undefined | false\n\n  logger: (level: LogLevel, message: string, code?: string) => void\n\n  autoVacuum: false | AutoVacuumOptions\n\n  searchOptions: SearchOptionsWithDefaults\n\n  autoSuggestOptions: SearchOptions\n}\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error'\n\n/**\n * The type of auto-suggestions\n */\nexport type Suggestion = {\n  /**\n   * The suggestion\n   */\n  suggestion: string,\n\n  /**\n   * Suggestion as an array of terms\n   */\n  terms: string[],\n\n  /**\n   * Score for the suggestion\n   */\n  score: number\n}\n\n/**\n * Match information for a search result. It is a key-value object where keys\n * are terms that matched, and values are the list of fields that the term was\n * found in.\n */\nexport type MatchInfo = {\n  [term: string]: string[]\n}\n\n/**\n * Type of the search results. Each search result indicates the document ID, the\n * terms that matched, the match information, the score, and all the stored\n * fields.\n */\nexport type SearchResult = {\n  /**\n   * The document ID\n   */\n  id: any,\n\n  /**\n   * List of document terms that matched. For example, if a prefix search for\n   * `\"moto\"` matches `\"motorcycle\"`, `terms` will contain `\"motorcycle\"`.\n   */\n  terms: string[],\n\n  /**\n   * List of query terms that matched. For example, if a prefix search for\n   * `\"moto\"` matches `\"motorcycle\"`, `queryTerms` will contain `\"moto\"`.\n   */\n  queryTerms: string[],\n\n  /**\n   * Score of the search results\n   */\n  score: number,\n\n  /**\n   * Match information, see {@link MatchInfo}\n   */\n  match: MatchInfo,\n\n  /**\n   * Stored fields\n   */\n  [key: string]: any\n}\n\n/**\n * @ignore\n */\nexport type AsPlainObject = {\n  documentCount: number,\n  nextId: number,\n  documentIds: { [shortId: string]: any }\n  fieldIds: { [fieldName: string]: number }\n  fieldLength: { [shortId: string]: number[] }\n  averageFieldLength: number[],\n  storedFields: { [shortId: string]: any }\n  dirtCount?: number,\n  index: [string, { [fieldId: string]: SerializedIndexEntry }][]\n  serializationVersion: number\n}\n\nexport type QueryCombination = SearchOptions & { queries: Query[] }\n\n/**\n * Wildcard query, used to match all terms\n */\nexport type Wildcard = typeof MiniSearch.wildcard\n\n/**\n * Search query expression, either a query string or an expression tree\n * combining several queries with a combination of AND or OR.\n */\nexport type Query = QueryCombination | string | Wildcard\n\n/**\n * Options to control vacuuming behavior.\n *\n * Vacuuming cleans up document references made obsolete by {@link\n * MiniSearch.discard} from the index. On large indexes, vacuuming is\n * potentially costly, because it has to traverse the whole inverted index.\n * Therefore, in order to dilute this cost so it does not negatively affects the\n * application, vacuuming is performed in batches, with a delay between each\n * batch. These options are used to configure the batch size and the delay\n * between batches.\n */\nexport type VacuumOptions = {\n  /**\n   * Size of each vacuuming batch (the number of terms in the index that will be\n   * traversed in each batch). Defaults to 1000.\n   */\n  batchSize?: number,\n\n  /**\n   * Wait time between each vacuuming batch in milliseconds. Defaults to 10.\n   */\n  batchWait?: number\n}\n\n/**\n * Sets minimum thresholds for `dirtCount` and `dirtFactor` that trigger an\n * automatic vacuuming.\n */\nexport type VacuumConditions = {\n  /**\n   * Minimum `dirtCount` (number of discarded documents since the last vacuuming)\n   * under which auto vacuum is not triggered. It defaults to 20.\n   */\n  minDirtCount?: number\n\n  /**\n   * Minimum `dirtFactor` (proportion of discarded documents over the total)\n   * under which auto vacuum is not triggered. It defaults to 0.1.\n   */\n  minDirtFactor?: number,\n}\n\n/**\n * Options to control auto vacuum behavior. When discarding a document with\n * {@link MiniSearch#discard}, a vacuuming operation is automatically started if\n * the `dirtCount` and `dirtFactor` are above the `minDirtCount` and\n * `minDirtFactor` thresholds defined by this configuration. See {@link\n * VacuumConditions} for details on these.\n *\n * Also, `batchSize` and `batchWait` can be specified, controlling batching\n * behavior (see {@link VacuumOptions}).\n */\nexport type AutoVacuumOptions = VacuumOptions & VacuumConditions\n\ntype QuerySpec = {\n  prefix: boolean,\n  fuzzy: number | boolean,\n  term: string,\n  termBoost: number\n}\n\ntype DocumentTermFreqs = Map<number, number>\ntype FieldTermData = Map<number, DocumentTermFreqs>\n\ninterface RawResultValue {\n  // Intermediate score, before applying the final score based on number of\n  // matched terms.\n  score: number,\n\n  // Set of all query terms that were matched. They may not be present in the\n  // text exactly in the case of prefix/fuzzy matches. We must check for\n  // uniqueness before adding a new term. This is much faster than using a set,\n  // because the number of elements is relatively small.\n  terms: string[],\n\n  // All terms that were found in the content, including the fields in which\n  // they were present. This object will be provided as part of the final search\n  // results.\n  match: MatchInfo,\n}\n\ntype RawResult = Map<number, RawResultValue>\n\n/**\n * {@link MiniSearch} is the main entrypoint class, implementing a full-text\n * search engine in memory.\n *\n * @typeParam T  The type of the documents being indexed.\n *\n * ### Basic example:\n *\n * ```javascript\n * const documents = [\n *   {\n *     id: 1,\n *     title: 'Moby Dick',\n *     text: 'Call me Ishmael. Some years ago...',\n *     category: 'fiction'\n *   },\n *   {\n *     id: 2,\n *     title: 'Zen and the Art of Motorcycle Maintenance',\n *     text: 'I can see by my watch...',\n *     category: 'fiction'\n *   },\n *   {\n *     id: 3,\n *     title: 'Neuromancer',\n *     text: 'The sky above the port was...',\n *     category: 'fiction'\n *   },\n *   {\n *     id: 4,\n *     title: 'Zen and the Art of Archery',\n *     text: 'At first sight it must seem...',\n *     category: 'non-fiction'\n *   },\n *   // ...and more\n * ]\n *\n * // Create a search engine that indexes the 'title' and 'text' fields for\n * // full-text search. Search results will include 'title' and 'category' (plus the\n * // id field, that is always stored and returned)\n * const miniSearch = new MiniSearch({\n *   fields: ['title', 'text'],\n *   storeFields: ['title', 'category']\n * })\n *\n * // Add documents to the index\n * miniSearch.addAll(documents)\n *\n * // Search for documents:\n * let results = miniSearch.search('zen art motorcycle')\n * // => [\n * //   { id: 2, title: 'Zen and the Art of Motorcycle Maintenance', category: 'fiction', score: 2.77258 },\n * //   { id: 4, title: 'Zen and the Art of Archery', category: 'non-fiction', score: 1.38629 }\n * // ]\n * ```\n */\nexport default class MiniSearch<T = any> {\n  protected _options: OptionsWithDefaults<T>\n  protected _index: SearchableMap<FieldTermData>\n  protected _documentCount: number\n  protected _documentIds: Map<number, any>\n  protected _idToShortId: Map<any, number>\n  protected _fieldIds: { [key: string]: number }\n  protected _fieldLength: Map<number, number[]>\n  protected _avgFieldLength: number[]\n  protected _nextId: number\n  protected _storedFields: Map<number, Record<string, unknown>>\n  protected _dirtCount: number\n  private _currentVacuum: Promise<void> | null\n  private _enqueuedVacuum: Promise<void> | null\n  private _enqueuedVacuumConditions: VacuumConditions | undefined\n\n  /**\n   * The special wildcard symbol that can be passed to {@link MiniSearch#search}\n   * to match all documents\n   */\n  static readonly wildcard: unique symbol = Symbol('*')\n\n  /**\n   * @param options  Configuration options\n   *\n   * ### Examples:\n   *\n   * ```javascript\n   * // Create a search engine that indexes the 'title' and 'text' fields of your\n   * // documents:\n   * const miniSearch = new MiniSearch({ fields: ['title', 'text'] })\n   * ```\n   *\n   * ### ID Field:\n   *\n   * ```javascript\n   * // Your documents are assumed to include a unique 'id' field, but if you want\n   * // to use a different field for document identification, you can set the\n   * // 'idField' option:\n   * const miniSearch = new MiniSearch({ idField: 'key', fields: ['title', 'text'] })\n   * ```\n   *\n   * ### Options and defaults:\n   *\n   * ```javascript\n   * // The full set of options (here with their default value) is:\n   * const miniSearch = new MiniSearch({\n   *   // idField: field that uniquely identifies a document\n   *   idField: 'id',\n   *\n   *   // extractField: function used to get the value of a field in a document.\n   *   // By default, it assumes the document is a flat object with field names as\n   *   // property keys and field values as string property values, but custom logic\n   *   // can be implemented by setting this option to a custom extractor function.\n   *   extractField: (document, fieldName) => document[fieldName],\n   *\n   *   // tokenize: function used to split fields into individual terms. By\n   *   // default, it is also used to tokenize search queries, unless a specific\n   *   // `tokenize` search option is supplied. When tokenizing an indexed field,\n   *   // the field name is passed as the second argument.\n   *   tokenize: (string, _fieldName) => string.split(SPACE_OR_PUNCTUATION),\n   *\n   *   // processTerm: function used to process each tokenized term before\n   *   // indexing. It can be used for stemming and normalization. Return a falsy\n   *   // value in order to discard a term. By default, it is also used to process\n   *   // search queries, unless a specific `processTerm` option is supplied as a\n   *   // search option. When processing a term from a indexed field, the field\n   *   // name is passed as the second argument.\n   *   processTerm: (term, _fieldName) => term.toLowerCase(),\n   *\n   *   // searchOptions: default search options, see the `search` method for\n   *   // details\n   *   searchOptions: undefined,\n   *\n   *   // fields: document fields to be indexed. Mandatory, but not set by default\n   *   fields: undefined\n   *\n   *   // storeFields: document fields to be stored and returned as part of the\n   *   // search results.\n   *   storeFields: []\n   * })\n   * ```\n   */\n  constructor (options: Options<T>) {\n    if (options?.fields == null) {\n      throw new Error('MiniSearch: option \"fields\" must be provided')\n    }\n\n    const autoVacuum = (options.autoVacuum == null || options.autoVacuum === true) ? defaultAutoVacuumOptions : options.autoVacuum\n\n    this._options = {\n      ...defaultOptions,\n      ...options,\n      autoVacuum,\n      searchOptions: { ...defaultSearchOptions, ...(options.searchOptions || {}) },\n      autoSuggestOptions: { ...defaultAutoSuggestOptions, ...(options.autoSuggestOptions || {}) }\n    }\n\n    this._index = new SearchableMap()\n\n    this._documentCount = 0\n\n    this._documentIds = new Map()\n\n    this._idToShortId = new Map()\n\n    // Fields are defined during initialization, don't change, are few in\n    // number, rarely need iterating over, and have string keys. Therefore in\n    // this case an object is a better candidate than a Map to store the mapping\n    // from field key to ID.\n    this._fieldIds = {}\n\n    this._fieldLength = new Map()\n\n    this._avgFieldLength = []\n\n    this._nextId = 0\n\n    this._storedFields = new Map()\n\n    this._dirtCount = 0\n\n    this._currentVacuum = null\n\n    this._enqueuedVacuum = null\n    this._enqueuedVacuumConditions = defaultVacuumConditions\n\n    this.addFields(this._options.fields)\n  }\n\n  /**\n   * Adds a document to the index\n   *\n   * @param document  The document to be indexed\n   */\n  add (document: T): void {\n    const { extractField, tokenize, processTerm, fields, idField } = this._options\n    const id = extractField(document, idField)\n    if (id == null) {\n      throw new Error(`MiniSearch: document does not have ID field \"${idField}\"`)\n    }\n\n    if (this._idToShortId.has(id)) {\n      throw new Error(`MiniSearch: duplicate ID ${id}`)\n    }\n\n    const shortDocumentId = this.addDocumentId(id)\n    this.saveStoredFields(shortDocumentId, document)\n\n    for (const field of fields) {\n      const fieldValue = extractField(document, field)\n      if (fieldValue == null) continue\n\n      const tokens = tokenize(fieldValue.toString(), field)\n      const fieldId = this._fieldIds[field]\n\n      const uniqueTerms = new Set(tokens).size\n      this.addFieldLength(shortDocumentId, fieldId, this._documentCount - 1, uniqueTerms)\n\n      for (const term of tokens) {\n        const processedTerm = processTerm(term, field)\n        if (Array.isArray(processedTerm)) {\n          for (const t of processedTerm) {\n            this.addTerm(fieldId, shortDocumentId, t)\n          }\n        } else if (processedTerm) {\n          this.addTerm(fieldId, shortDocumentId, processedTerm)\n        }\n      }\n    }\n  }\n\n  /**\n   * Adds all the given documents to the index\n   *\n   * @param documents  An array of documents to be indexed\n   */\n  addAll (documents: readonly T[]): void {\n    for (const document of documents) this.add(document)\n  }\n\n  /**\n   * Adds all the given documents to the index asynchronously.\n   *\n   * Returns a promise that resolves (to `undefined`) when the indexing is done.\n   * This method is useful when index many documents, to avoid blocking the main\n   * thread. The indexing is performed asynchronously and in chunks.\n   *\n   * @param documents  An array of documents to be indexed\n   * @param options  Configuration options\n   * @return A promise resolving to `undefined` when the indexing is done\n   */\n  addAllAsync (documents: readonly T[], options: { chunkSize?: number } = {}): Promise<void> {\n    const { chunkSize = 10 } = options\n    const acc: { chunk: T[], promise: Promise<void> } = { chunk: [], promise: Promise.resolve() }\n\n    const { chunk, promise } = documents.reduce(({ chunk, promise }, document: T, i: number) => {\n      chunk.push(document)\n      if ((i + 1) % chunkSize === 0) {\n        return {\n          chunk: [],\n          promise: promise\n            .then(() => new Promise(resolve => setTimeout(resolve, 0)))\n            .then(() => this.addAll(chunk))\n        }\n      } else {\n        return { chunk, promise }\n      }\n    }, acc)\n\n    return promise.then(() => this.addAll(chunk))\n  }\n\n  /**\n   * Removes the given document from the index.\n   *\n   * The document to remove must NOT have changed between indexing and removal,\n   * otherwise the index will be corrupted.\n   *\n   * This method requires passing the full document to be removed (not just the\n   * ID), and immediately removes the document from the inverted index, allowing\n   * memory to be released. A convenient alternative is {@link\n   * MiniSearch#discard}, which needs only the document ID, and has the same\n   * visible effect, but delays cleaning up the index until the next vacuuming.\n   *\n   * @param document  The document to be removed\n   */\n  remove (document: T): void {\n    const { tokenize, processTerm, extractField, fields, idField } = this._options\n    const id = extractField(document, idField)\n\n    if (id == null) {\n      throw new Error(`MiniSearch: document does not have ID field \"${idField}\"`)\n    }\n\n    const shortId = this._idToShortId.get(id)\n\n    if (shortId == null) {\n      throw new Error(`MiniSearch: cannot remove document with ID ${id}: it is not in the index`)\n    }\n\n    for (const field of fields) {\n      const fieldValue = extractField(document, field)\n      if (fieldValue == null) continue\n\n      const tokens = tokenize(fieldValue.toString(), field)\n      const fieldId = this._fieldIds[field]\n\n      const uniqueTerms = new Set(tokens).size\n      this.removeFieldLength(shortId, fieldId, this._documentCount, uniqueTerms)\n\n      for (const term of tokens) {\n        const processedTerm = processTerm(term, field)\n        if (Array.isArray(processedTerm)) {\n          for (const t of processedTerm) {\n            this.removeTerm(fieldId, shortId, t)\n          }\n        } else if (processedTerm) {\n          this.removeTerm(fieldId, shortId, processedTerm)\n        }\n      }\n    }\n\n    this._storedFields.delete(shortId)\n    this._documentIds.delete(shortId)\n    this._idToShortId.delete(id)\n    this._fieldLength.delete(shortId)\n    this._documentCount -= 1\n  }\n\n  /**\n   * Removes all the given documents from the index. If called with no arguments,\n   * it removes _all_ documents from the index.\n   *\n   * @param documents  The documents to be removed. If this argument is omitted,\n   * all documents are removed. Note that, for removing all documents, it is\n   * more efficient to call this method with no arguments than to pass all\n   * documents.\n   */\n  removeAll (documents?: readonly T[]): void {\n    if (documents) {\n      for (const document of documents) this.remove(document)\n    } else if (arguments.length > 0) {\n      throw new Error('Expected documents to be present. Omit the argument to remove all documents.')\n    } else {\n      this._index = new SearchableMap()\n      this._documentCount = 0\n      this._documentIds = new Map()\n      this._idToShortId = new Map()\n      this._fieldLength = new Map()\n      this._avgFieldLength = []\n      this._storedFields = new Map()\n      this._nextId = 0\n    }\n  }\n\n  /**\n   * Discards the document with the given ID, so it won't appear in search results\n   *\n   * It has the same visible effect of {@link MiniSearch.remove} (both cause the\n   * document to stop appearing in searches), but a different effect on the\n   * internal data structures:\n   *\n   *   - {@link MiniSearch#remove} requires passing the full document to be\n   *   removed as argument, and removes it from the inverted index immediately.\n   *\n   *   - {@link MiniSearch#discard} instead only needs the document ID, and\n   *   works by marking the current version of the document as discarded, so it\n   *   is immediately ignored by searches. This is faster and more convenient\n   *   than {@link MiniSearch#remove}, but the index is not immediately\n   *   modified. To take care of that, vacuuming is performed after a certain\n   *   number of documents are discarded, cleaning up the index and allowing\n   *   memory to be released.\n   *\n   * After discarding a document, it is possible to re-add a new version, and\n   * only the new version will appear in searches. In other words, discarding\n   * and re-adding a document works exactly like removing and re-adding it. The\n   * {@link MiniSearch.replace} method can also be used to replace a document\n   * with a new version.\n   *\n   * #### Details about vacuuming\n   *\n   * Repetite calls to this method would leave obsolete document references in\n   * the index, invisible to searches. Two mechanisms take care of cleaning up:\n   * clean up during search, and vacuuming.\n   *\n   *   - Upon search, whenever a discarded ID is found (and ignored for the\n   *   results), references to the discarded document are removed from the\n   *   inverted index entries for the search terms. This ensures that subsequent\n   *   searches for the same terms do not need to skip these obsolete references\n   *   again.\n   *\n   *   - In addition, vacuuming is performed automatically by default (see the\n   *   `autoVacuum` field in {@link Options}) after a certain number of\n   *   documents are discarded. Vacuuming traverses all terms in the index,\n   *   cleaning up all references to discarded documents. Vacuuming can also be\n   *   triggered manually by calling {@link MiniSearch#vacuum}.\n   *\n   * @param id  The ID of the document to be discarded\n   */\n  discard (id: any): void {\n    const shortId = this._idToShortId.get(id)\n\n    if (shortId == null) {\n      throw new Error(`MiniSearch: cannot discard document with ID ${id}: it is not in the index`)\n    }\n\n    this._idToShortId.delete(id)\n    this._documentIds.delete(shortId)\n    this._storedFields.delete(shortId)\n\n    ;(this._fieldLength.get(shortId) || []).forEach((fieldLength, fieldId) => {\n      this.removeFieldLength(shortId, fieldId, this._documentCount, fieldLength)\n    })\n\n    this._fieldLength.delete(shortId)\n\n    this._documentCount -= 1\n    this._dirtCount += 1\n\n    this.maybeAutoVacuum()\n  }\n\n  private maybeAutoVacuum (): void {\n    if (this._options.autoVacuum === false) { return }\n\n    const { minDirtFactor, minDirtCount, batchSize, batchWait } = this._options.autoVacuum\n    this.conditionalVacuum({ batchSize, batchWait }, { minDirtCount, minDirtFactor })\n  }\n\n  /**\n   * Discards the documents with the given IDs, so they won't appear in search\n   * results\n   *\n   * It is equivalent to calling {@link MiniSearch#discard} for all the given\n   * IDs, but with the optimization of triggering at most one automatic\n   * vacuuming at the end.\n   *\n   * Note: to remove all documents from the index, it is faster and more\n   * convenient to call {@link MiniSearch.removeAll} with no argument, instead\n   * of passing all IDs to this method.\n   */\n  discardAll (ids: readonly any[]): void {\n    const autoVacuum = this._options.autoVacuum\n\n    try {\n      this._options.autoVacuum = false\n\n      for (const id of ids) {\n        this.discard(id)\n      }\n    } finally {\n      this._options.autoVacuum = autoVacuum\n    }\n\n    this.maybeAutoVacuum()\n  }\n\n  /**\n   * It replaces an existing document with the given updated version\n   *\n   * It works by discarding the current version and adding the updated one, so\n   * it is functionally equivalent to calling {@link MiniSearch#discard}\n   * followed by {@link MiniSearch#add}. The ID of the updated document should\n   * be the same as the original one.\n   *\n   * Since it uses {@link MiniSearch#discard} internally, this method relies on\n   * vacuuming to clean up obsolete document references from the index, allowing\n   * memory to be released (see {@link MiniSearch#discard}).\n   *\n   * @param updatedDocument  The updated document to replace the old version\n   * with\n   */\n  replace (updatedDocument: T): void {\n    const { idField, extractField } = this._options\n    const id = extractField(updatedDocument, idField)\n\n    this.discard(id)\n    this.add(updatedDocument)\n  }\n\n  /**\n   * Triggers a manual vacuuming, cleaning up references to discarded documents\n   * from the inverted index\n   *\n   * Vacuuming is only useful for applications that use the {@link\n   * MiniSearch#discard} or {@link MiniSearch#replace} methods.\n   *\n   * By default, vacuuming is performed automatically when needed (controlled by\n   * the `autoVacuum` field in {@link Options}), so there is usually no need to\n   * call this method, unless one wants to make sure to perform vacuuming at a\n   * specific moment.\n   *\n   * Vacuuming traverses all terms in the inverted index in batches, and cleans\n   * up references to discarded documents from the posting list, allowing memory\n   * to be released.\n   *\n   * The method takes an optional object as argument with the following keys:\n   *\n   *   - `batchSize`: the size of each batch (1000 by default)\n   *\n   *   - `batchWait`: the number of milliseconds to wait between batches (10 by\n   *   default)\n   *\n   * On large indexes, vacuuming could have a non-negligible cost: batching\n   * avoids blocking the thread for long, diluting this cost so that it is not\n   * negatively affecting the application. Nonetheless, this method should only\n   * be called when necessary, and relying on automatic vacuuming is usually\n   * better.\n   *\n   * It returns a promise that resolves (to undefined) when the clean up is\n   * completed. If vacuuming is already ongoing at the time this method is\n   * called, a new one is enqueued immediately after the ongoing one, and a\n   * corresponding promise is returned. However, no more than one vacuuming is\n   * enqueued on top of the ongoing one, even if this method is called more\n   * times (enqueuing multiple ones would be useless).\n   *\n   * @param options  Configuration options for the batch size and delay. See\n   * {@link VacuumOptions}.\n   */\n  vacuum (options: VacuumOptions = {}): Promise<void> {\n    return this.conditionalVacuum(options)\n  }\n\n  private conditionalVacuum (options: VacuumOptions, conditions?: VacuumConditions): Promise<void> {\n    // If a vacuum is already ongoing, schedule another as soon as it finishes,\n    // unless there's already one enqueued. If one was already enqueued, do not\n    // enqueue another on top, but make sure that the conditions are the\n    // broadest.\n    if (this._currentVacuum) {\n      this._enqueuedVacuumConditions = this._enqueuedVacuumConditions && conditions\n      if (this._enqueuedVacuum != null) { return this._enqueuedVacuum }\n\n      this._enqueuedVacuum = this._currentVacuum.then(() => {\n        const conditions = this._enqueuedVacuumConditions\n        this._enqueuedVacuumConditions = defaultVacuumConditions\n        return this.performVacuuming(options, conditions)\n      })\n      return this._enqueuedVacuum\n    }\n\n    if (this.vacuumConditionsMet(conditions) === false) { return Promise.resolve() }\n\n    this._currentVacuum = this.performVacuuming(options)\n    return this._currentVacuum\n  }\n\n  private async performVacuuming (options: VacuumOptions, conditions?: VacuumConditions): Promise<void> {\n    const initialDirtCount = this._dirtCount\n\n    if (this.vacuumConditionsMet(conditions)) {\n      const batchSize = options.batchSize || defaultVacuumOptions.batchSize\n      const batchWait = options.batchWait || defaultVacuumOptions.batchWait\n      let i = 1\n\n      for (const [term, fieldsData] of this._index) {\n        for (const [fieldId, fieldIndex] of fieldsData) {\n          for (const [shortId] of fieldIndex) {\n            if (this._documentIds.has(shortId)) { continue }\n\n            if (fieldIndex.size <= 1) {\n              fieldsData.delete(fieldId)\n            } else {\n              fieldIndex.delete(shortId)\n            }\n          }\n        }\n\n        if (this._index.get(term)!.size === 0) {\n          this._index.delete(term)\n        }\n\n        if (i % batchSize === 0) {\n          await new Promise((resolve) => setTimeout(resolve, batchWait))\n        }\n\n        i += 1\n      }\n\n      this._dirtCount -= initialDirtCount\n    }\n\n    // Make the next lines always async, so they execute after this function returns\n    await null\n\n    this._currentVacuum = this._enqueuedVacuum\n    this._enqueuedVacuum = null\n  }\n\n  private vacuumConditionsMet (conditions?: VacuumConditions) {\n    if (conditions == null) { return true }\n\n    let { minDirtCount, minDirtFactor } = conditions\n    minDirtCount = minDirtCount || defaultAutoVacuumOptions.minDirtCount\n    minDirtFactor = minDirtFactor || defaultAutoVacuumOptions.minDirtFactor\n\n    return this.dirtCount >= minDirtCount && this.dirtFactor >= minDirtFactor\n  }\n\n  /**\n   * Is `true` if a vacuuming operation is ongoing, `false` otherwise\n   */\n  get isVacuuming (): boolean {\n    return this._currentVacuum != null\n  }\n\n  /**\n   * The number of documents discarded since the most recent vacuuming\n   */\n  get dirtCount (): number {\n    return this._dirtCount\n  }\n\n  /**\n   * A number between 0 and 1 giving an indication about the proportion of\n   * documents that are discarded, and can therefore be cleaned up by vacuuming.\n   * A value close to 0 means that the index is relatively clean, while a higher\n   * value means that the index is relatively dirty, and vacuuming could release\n   * memory.\n   */\n  get dirtFactor (): number {\n    return this._dirtCount / (1 + this._documentCount + this._dirtCount)\n  }\n\n  /**\n   * Returns `true` if a document with the given ID is present in the index and\n   * available for search, `false` otherwise\n   *\n   * @param id  The document ID\n   */\n  has (id: any): boolean {\n    return this._idToShortId.has(id)\n  }\n\n  /**\n   * Returns the stored fields (as configured in the `storeFields` constructor\n   * option) for the given document ID. Returns `undefined` if the document is\n   * not present in the index.\n   *\n   * @param id  The document ID\n   */\n  getStoredFields (id: any): Record<string, unknown> | undefined {\n    const shortId = this._idToShortId.get(id)\n\n    if (shortId == null) { return undefined }\n\n    return this._storedFields.get(shortId)\n  }\n\n  /**\n   * Search for documents matching the given search query.\n   *\n   * The result is a list of scored document IDs matching the query, sorted by\n   * descending score, and each including data about which terms were matched and\n   * in which fields.\n   *\n   * ### Basic usage:\n   *\n   * ```javascript\n   * // Search for \"zen art motorcycle\" with default options: terms have to match\n   * // exactly, and individual terms are joined with OR\n   * miniSearch.search('zen art motorcycle')\n   * // => [ { id: 2, score: 2.77258, match: { ... } }, { id: 4, score: 1.38629, match: { ... } } ]\n   * ```\n   *\n   * ### Restrict search to specific fields:\n   *\n   * ```javascript\n   * // Search only in the 'title' field\n   * miniSearch.search('zen', { fields: ['title'] })\n   * ```\n   *\n   * ### Field boosting:\n   *\n   * ```javascript\n   * // Boost a field\n   * miniSearch.search('zen', { boost: { title: 2 } })\n   * ```\n   *\n   * ### Prefix search:\n   *\n   * ```javascript\n   * // Search for \"moto\" with prefix search (it will match documents\n   * // containing terms that start with \"moto\" or \"neuro\")\n   * miniSearch.search('moto neuro', { prefix: true })\n   * ```\n   *\n   * ### Fuzzy search:\n   *\n   * ```javascript\n   * // Search for \"ismael\" with fuzzy search (it will match documents containing\n   * // terms similar to \"ismael\", with a maximum edit distance of 0.2 term.length\n   * // (rounded to nearest integer)\n   * miniSearch.search('ismael', { fuzzy: 0.2 })\n   * ```\n   *\n   * ### Combining strategies:\n   *\n   * ```javascript\n   * // Mix of exact match, prefix search, and fuzzy search\n   * miniSearch.search('ismael mob', {\n   *  prefix: true,\n   *  fuzzy: 0.2\n   * })\n   * ```\n   *\n   * ### Advanced prefix and fuzzy search:\n   *\n   * ```javascript\n   * // Perform fuzzy and prefix search depending on the search term. Here\n   * // performing prefix and fuzzy search only on terms longer than 3 characters\n   * miniSearch.search('ismael mob', {\n   *  prefix: term => term.length > 3\n   *  fuzzy: term => term.length > 3 ? 0.2 : null\n   * })\n   * ```\n   *\n   * ### Combine with AND:\n   *\n   * ```javascript\n   * // Combine search terms with AND (to match only documents that contain both\n   * // \"motorcycle\" and \"art\")\n   * miniSearch.search('motorcycle art', { combineWith: 'AND' })\n   * ```\n   *\n   * ### Combine with AND_NOT:\n   *\n   * There is also an AND_NOT combinator, that finds documents that match the\n   * first term, but do not match any of the other terms. This combinator is\n   * rarely useful with simple queries, and is meant to be used with advanced\n   * query combinations (see later for more details).\n   *\n   * ### Filtering results:\n   *\n   * ```javascript\n   * // Filter only results in the 'fiction' category (assuming that 'category'\n   * // is a stored field)\n   * miniSearch.search('motorcycle art', {\n   *   filter: (result) => result.category === 'fiction'\n   * })\n   * ```\n   *\n   * ### Wildcard query\n   *\n   * Searching for an empty string (assuming the default tokenizer) returns no\n   * results. Sometimes though, one needs to match all documents, like in a\n   * \"wildcard\" search. This is possible by passing the special value\n   * {@link MiniSearch.wildcard} as the query:\n   *\n   * ```javascript\n   * // Return search results for all documents\n   * miniSearch.search(MiniSearch.wildcard)\n   * ```\n   *\n   * Note that search options such as `filter` and `boostDocument` are still\n   * applied, influencing which results are returned, and their order:\n   *\n   * ```javascript\n   * // Return search results for all documents in the 'fiction' category\n   * miniSearch.search(MiniSearch.wildcard, {\n   *   filter: (result) => result.category === 'fiction'\n   * })\n   * ```\n   *\n   * ### Advanced combination of queries:\n   *\n   * It is possible to combine different subqueries with OR, AND, and AND_NOT,\n   * and even with different search options, by passing a query expression\n   * tree object as the first argument, instead of a string.\n   *\n   * ```javascript\n   * // Search for documents that contain \"zen\" and (\"motorcycle\" or \"archery\")\n   * miniSearch.search({\n   *   combineWith: 'AND',\n   *   queries: [\n   *     'zen',\n   *     {\n   *       combineWith: 'OR',\n   *       queries: ['motorcycle', 'archery']\n   *     }\n   *   ]\n   * })\n   *\n   * // Search for documents that contain (\"apple\" or \"pear\") but not \"juice\" and\n   * // not \"tree\"\n   * miniSearch.search({\n   *   combineWith: 'AND_NOT',\n   *   queries: [\n   *     {\n   *       combineWith: 'OR',\n   *       queries: ['apple', 'pear']\n   *     },\n   *     'juice',\n   *     'tree'\n   *   ]\n   * })\n   * ```\n   *\n   * Each node in the expression tree can be either a string, or an object that\n   * supports all {@link SearchOptions} fields, plus a `queries` array field for\n   * subqueries.\n   *\n   * Note that, while this can become complicated to do by hand for complex or\n   * deeply nested queries, it provides a formalized expression tree API for\n   * external libraries that implement a parser for custom query languages.\n   *\n   * @param query  Search query\n   * @param options  Search options. Each option, if not given, defaults to the corresponding value of `searchOptions` given to the constructor, or to the library default.\n   */\n  search (query: Query, searchOptions: SearchOptions = {}): SearchResult[] {\n    const rawResults = this.executeQuery(query, searchOptions)\n    const results = []\n\n    for (const [docId, { score, terms, match }] of rawResults) {\n      // terms are the matched query terms, which will be returned to the user\n      // as queryTerms. The quality is calculated based on them, as opposed to\n      // the matched terms in the document (which can be different due to\n      // prefix and fuzzy match)\n      const quality = terms.length || 1\n\n      const result = {\n        id: this._documentIds.get(docId),\n        score: score * quality,\n        terms: Object.keys(match),\n        queryTerms: terms,\n        match\n      }\n\n      Object.assign(result, this._storedFields.get(docId))\n      if (searchOptions.filter == null || searchOptions.filter(result)) {\n        results.push(result)\n      }\n    }\n\n    // If it's a wildcard query, and no document boost is applied, skip sorting\n    // the results, as all results have the same score of 1\n    if (query === MiniSearch.wildcard &&\n      searchOptions.boostDocument == null &&\n      this._options.searchOptions.boostDocument == null) {\n      return results\n    }\n\n    results.sort(byScore)\n    return results\n  }\n\n  /**\n   * Provide suggestions for the given search query\n   *\n   * The result is a list of suggested modified search queries, derived from the\n   * given search query, each with a relevance score, sorted by descending score.\n   *\n   * By default, it uses the same options used for search, except that by\n   * default it performs prefix search on the last term of the query, and\n   * combine terms with `'AND'` (requiring all query terms to match). Custom\n   * options can be passed as a second argument. Defaults can be changed upon\n   * calling the {@link MiniSearch} constructor, by passing a\n   * `autoSuggestOptions` option.\n   *\n   * ### Basic usage:\n   *\n   * ```javascript\n   * // Get suggestions for 'neuro':\n   * miniSearch.autoSuggest('neuro')\n   * // => [ { suggestion: 'neuromancer', terms: [ 'neuromancer' ], score: 0.46240 } ]\n   * ```\n   *\n   * ### Multiple words:\n   *\n   * ```javascript\n   * // Get suggestions for 'zen ar':\n   * miniSearch.autoSuggest('zen ar')\n   * // => [\n   * //  { suggestion: 'zen archery art', terms: [ 'zen', 'archery', 'art' ], score: 1.73332 },\n   * //  { suggestion: 'zen art', terms: [ 'zen', 'art' ], score: 1.21313 }\n   * // ]\n   * ```\n   *\n   * ### Fuzzy suggestions:\n   *\n   * ```javascript\n   * // Correct spelling mistakes using fuzzy search:\n   * miniSearch.autoSuggest('neromancer', { fuzzy: 0.2 })\n   * // => [ { suggestion: 'neuromancer', terms: [ 'neuromancer' ], score: 1.03998 } ]\n   * ```\n   *\n   * ### Filtering:\n   *\n   * ```javascript\n   * // Get suggestions for 'zen ar', but only within the 'fiction' category\n   * // (assuming that 'category' is a stored field):\n   * miniSearch.autoSuggest('zen ar', {\n   *   filter: (result) => result.category === 'fiction'\n   * })\n   * // => [\n   * //  { suggestion: 'zen archery art', terms: [ 'zen', 'archery', 'art' ], score: 1.73332 },\n   * //  { suggestion: 'zen art', terms: [ 'zen', 'art' ], score: 1.21313 }\n   * // ]\n   * ```\n   *\n   * @param queryString  Query string to be expanded into suggestions\n   * @param options  Search options. The supported options and default values\n   * are the same as for the {@link MiniSearch#search} method, except that by\n   * default prefix search is performed on the last term in the query, and terms\n   * are combined with `'AND'`.\n   * @return  A sorted array of suggestions sorted by relevance score.\n   */\n  autoSuggest (queryString: string, options: SearchOptions = {}): Suggestion[] {\n    options = { ...this._options.autoSuggestOptions, ...options }\n\n    const suggestions: Map<string, Omit<Suggestion, 'suggestion'> & { count: number }> = new Map()\n\n    for (const { score, terms } of this.search(queryString, options)) {\n      const phrase = terms.join(' ')\n      const suggestion = suggestions.get(phrase)\n      if (suggestion != null) {\n        suggestion.score += score\n        suggestion.count += 1\n      } else {\n        suggestions.set(phrase, { score, terms, count: 1 })\n      }\n    }\n\n    const results = []\n    for (const [suggestion, { score, terms, count }] of suggestions) {\n      results.push({ suggestion, terms, score: score / count })\n    }\n\n    results.sort(byScore)\n    return results\n  }\n\n  /**\n   * Total number of documents available to search\n   */\n  get documentCount (): number {\n    return this._documentCount\n  }\n\n  /**\n   * Number of terms in the index\n   */\n  get termCount (): number {\n    return this._index.size\n  }\n\n  /**\n   * Deserializes a JSON index (serialized with `JSON.stringify(miniSearch)`)\n   * and instantiates a MiniSearch instance. It should be given the same options\n   * originally used when serializing the index.\n   *\n   * ### Usage:\n   *\n   * ```javascript\n   * // If the index was serialized with:\n   * let miniSearch = new MiniSearch({ fields: ['title', 'text'] })\n   * miniSearch.addAll(documents)\n   *\n   * const json = JSON.stringify(miniSearch)\n   * // It can later be deserialized like this:\n   * miniSearch = MiniSearch.loadJSON(json, { fields: ['title', 'text'] })\n   * ```\n   *\n   * @param json  JSON-serialized index\n   * @param options  configuration options, same as the constructor\n   * @return An instance of MiniSearch deserialized from the given JSON.\n   */\n  static loadJSON<T = any> (json: string, options: Options<T>): MiniSearch<T> {\n    if (options == null) {\n      throw new Error('MiniSearch: loadJSON should be given the same options used when serializing the index')\n    }\n    return this.loadJS(JSON.parse(json), options)\n  }\n\n  /**\n   * Async equivalent of {@link MiniSearch.loadJSON}\n   *\n   * This function is an alternative to {@link MiniSearch.loadJSON} that returns\n   * a promise, and loads the index in batches, leaving pauses between them to avoid\n   * blocking the main thread. It tends to be slower than the synchronous\n   * version, but does not block the main thread, so it can be a better choice\n   * when deserializing very large indexes.\n   *\n   * @param json  JSON-serialized index\n   * @param options  configuration options, same as the constructor\n   * @return A Promise that will resolve to an instance of MiniSearch deserialized from the given JSON.\n   */\n  static async loadJSONAsync<T = any> (json: string, options: Options<T>): Promise<MiniSearch<T>> {\n    if (options == null) {\n      throw new Error('MiniSearch: loadJSON should be given the same options used when serializing the index')\n    }\n    return this.loadJSAsync(JSON.parse(json), options)\n  }\n\n  /**\n   * Returns the default value of an option. It will throw an error if no option\n   * with the given name exists.\n   *\n   * @param optionName  Name of the option\n   * @return The default value of the given option\n   *\n   * ### Usage:\n   *\n   * ```javascript\n   * // Get default tokenizer\n   * MiniSearch.getDefault('tokenize')\n   *\n   * // Get default term processor\n   * MiniSearch.getDefault('processTerm')\n   *\n   * // Unknown options will throw an error\n   * MiniSearch.getDefault('notExisting')\n   * // => throws 'MiniSearch: unknown option \"notExisting\"'\n   * ```\n   */\n  static getDefault (optionName: string): any {\n    if (defaultOptions.hasOwnProperty(optionName)) {\n      return getOwnProperty(defaultOptions, optionName)\n    } else {\n      throw new Error(`MiniSearch: unknown option \"${optionName}\"`)\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  static loadJS<T = any> (js: AsPlainObject, options: Options<T>): MiniSearch<T> {\n    const {\n      index,\n      documentIds,\n      fieldLength,\n      storedFields,\n      serializationVersion\n    } = js\n\n    const miniSearch = this.instantiateMiniSearch(js, options)\n\n    miniSearch._documentIds = objectToNumericMap(documentIds)\n    miniSearch._fieldLength = objectToNumericMap(fieldLength)\n    miniSearch._storedFields = objectToNumericMap(storedFields)\n\n    for (const [shortId, id] of miniSearch._documentIds) {\n      miniSearch._idToShortId.set(id, shortId)\n    }\n\n    for (const [term, data] of index) {\n      const dataMap = new Map() as FieldTermData\n\n      for (const fieldId of Object.keys(data)) {\n        let indexEntry = data[fieldId]\n\n        // Version 1 used to nest the index entry inside a field called ds\n        if (serializationVersion === 1) {\n          indexEntry = indexEntry.ds as unknown as SerializedIndexEntry\n        }\n\n        dataMap.set(parseInt(fieldId, 10), objectToNumericMap(indexEntry) as DocumentTermFreqs)\n      }\n\n      miniSearch._index.set(term, dataMap)\n    }\n\n    return miniSearch\n  }\n\n  /**\n   * @ignore\n   */\n  static async loadJSAsync<T = any> (js: AsPlainObject, options: Options<T>): Promise<MiniSearch<T>> {\n    const {\n      index,\n      documentIds,\n      fieldLength,\n      storedFields,\n      serializationVersion\n    } = js\n\n    const miniSearch = this.instantiateMiniSearch(js, options)\n\n    miniSearch._documentIds = await objectToNumericMapAsync(documentIds)\n    miniSearch._fieldLength = await objectToNumericMapAsync(fieldLength)\n    miniSearch._storedFields = await objectToNumericMapAsync(storedFields)\n\n    for (const [shortId, id] of miniSearch._documentIds) {\n      miniSearch._idToShortId.set(id, shortId)\n    }\n\n    let count = 0\n    for (const [term, data] of index) {\n      const dataMap = new Map() as FieldTermData\n\n      for (const fieldId of Object.keys(data)) {\n        let indexEntry = data[fieldId]\n\n        // Version 1 used to nest the index entry inside a field called ds\n        if (serializationVersion === 1) {\n          indexEntry = indexEntry.ds as unknown as SerializedIndexEntry\n        }\n\n        dataMap.set(parseInt(fieldId, 10), await objectToNumericMapAsync(indexEntry) as DocumentTermFreqs)\n      }\n\n      if (++count % 1000 === 0) await wait(0)\n      miniSearch._index.set(term, dataMap)\n    }\n\n    return miniSearch\n  }\n\n  /**\n   * @ignore\n   */\n  private static instantiateMiniSearch<T = any> (js: AsPlainObject, options: Options<T>): MiniSearch<T> {\n    const {\n      documentCount,\n      nextId,\n      fieldIds,\n      averageFieldLength,\n      dirtCount,\n      serializationVersion\n    } = js\n\n    if (serializationVersion !== 1 && serializationVersion !== 2) {\n      throw new Error('MiniSearch: cannot deserialize an index created with an incompatible version')\n    }\n\n    const miniSearch = new MiniSearch(options)\n\n    miniSearch._documentCount = documentCount\n    miniSearch._nextId = nextId\n    miniSearch._idToShortId = new Map<any, number>()\n    miniSearch._fieldIds = fieldIds\n    miniSearch._avgFieldLength = averageFieldLength\n    miniSearch._dirtCount = dirtCount || 0\n    miniSearch._index = new SearchableMap()\n\n    return miniSearch\n  }\n\n  /**\n   * @ignore\n   */\n  private executeQuery (query: Query, searchOptions: SearchOptions = {}): RawResult {\n    if (query === MiniSearch.wildcard) {\n      return this.executeWildcardQuery(searchOptions)\n    }\n\n    if (typeof query !== 'string') {\n      const options = { ...searchOptions, ...query, queries: undefined }\n      const results = query.queries.map((subquery) => this.executeQuery(subquery, options))\n      return this.combineResults(results, options.combineWith)\n    }\n\n    const { tokenize, processTerm, searchOptions: globalSearchOptions } = this._options\n    const options = { tokenize, processTerm, ...globalSearchOptions, ...searchOptions }\n    const { tokenize: searchTokenize, processTerm: searchProcessTerm } = options\n    const terms = searchTokenize(query)\n      .flatMap((term: string) => searchProcessTerm(term))\n      .filter((term) => !!term) as string[]\n    const queries: QuerySpec[] = terms.map(termToQuerySpec(options))\n    const results = queries.map(query => this.executeQuerySpec(query, options))\n\n    return this.combineResults(results, options.combineWith)\n  }\n\n  /**\n   * @ignore\n   */\n  private executeQuerySpec (query: QuerySpec, searchOptions: SearchOptions): RawResult {\n    const options: SearchOptionsWithDefaults = { ...this._options.searchOptions, ...searchOptions }\n\n    const boosts = (options.fields || this._options.fields).reduce((boosts, field) =>\n      ({ ...boosts, [field]: getOwnProperty(options.boost, field) || 1 }), {})\n\n    const {\n      boostDocument,\n      weights,\n      maxFuzzy,\n      bm25: bm25params\n    } = options\n\n    const { fuzzy: fuzzyWeight, prefix: prefixWeight } = { ...defaultSearchOptions.weights, ...weights }\n\n    const data = this._index.get(query.term)\n    const results = this.termResults(query.term, query.term, 1, query.termBoost, data, boosts, boostDocument, bm25params)\n\n    let prefixMatches\n    let fuzzyMatches\n\n    if (query.prefix) {\n      prefixMatches = this._index.atPrefix(query.term)\n    }\n\n    if (query.fuzzy) {\n      const fuzzy = (query.fuzzy === true) ? 0.2 : query.fuzzy\n      const maxDistance = fuzzy < 1 ? Math.min(maxFuzzy, Math.round(query.term.length * fuzzy)) : fuzzy\n      if (maxDistance) fuzzyMatches = this._index.fuzzyGet(query.term, maxDistance)\n    }\n\n    if (prefixMatches) {\n      for (const [term, data] of prefixMatches) {\n        const distance = term.length - query.term.length\n        if (!distance) { continue } // Skip exact match.\n\n        // Delete the term from fuzzy results (if present) if it is also a\n        // prefix result. This entry will always be scored as a prefix result.\n        fuzzyMatches?.delete(term)\n\n        // Weight gradually approaches 0 as distance goes to infinity, with the\n        // weight for the hypothetical distance 0 being equal to prefixWeight.\n        // The rate of change is much lower than that of fuzzy matches to\n        // account for the fact that prefix matches stay more relevant than\n        // fuzzy matches for longer distances.\n        const weight = prefixWeight * term.length / (term.length + 0.3 * distance)\n        this.termResults(query.term, term, weight, query.termBoost, data, boosts, boostDocument, bm25params, results)\n      }\n    }\n\n    if (fuzzyMatches) {\n      for (const term of fuzzyMatches.keys()) {\n        const [data, distance] = fuzzyMatches.get(term)!\n        if (!distance) { continue } // Skip exact match.\n\n        // Weight gradually approaches 0 as distance goes to infinity, with the\n        // weight for the hypothetical distance 0 being equal to fuzzyWeight.\n        const weight = fuzzyWeight * term.length / (term.length + distance)\n        this.termResults(query.term, term, weight, query.termBoost, data, boosts, boostDocument, bm25params, results)\n      }\n    }\n\n    return results\n  }\n\n  /**\n   * @ignore\n   */\n  private executeWildcardQuery (searchOptions: SearchOptions): RawResult {\n    const results = new Map() as RawResult\n    const options: SearchOptionsWithDefaults = { ...this._options.searchOptions, ...searchOptions }\n\n    for (const [shortId, id] of this._documentIds) {\n      const score = options.boostDocument ? options.boostDocument(id, '', this._storedFields.get(shortId)) : 1\n      results.set(shortId, {\n        score,\n        terms: [],\n        match: {}\n      })\n    }\n\n    return results\n  }\n\n  /**\n   * @ignore\n   */\n  private combineResults (results: RawResult[], combineWith: CombinationOperator = OR): RawResult {\n    if (results.length === 0) { return new Map() }\n    const operator = combineWith.toLowerCase()\n    const combinator = (combinators as Record<string, CombinatorFunction>)[operator]\n\n    if (!combinator) {\n      throw new Error(`Invalid combination operator: ${combineWith}`)\n    }\n\n    return results.reduce(combinator) || new Map()\n  }\n\n  /**\n   * Allows serialization of the index to JSON, to possibly store it and later\n   * deserialize it with {@link MiniSearch.loadJSON}.\n   *\n   * Normally one does not directly call this method, but rather call the\n   * standard JavaScript `JSON.stringify()` passing the {@link MiniSearch}\n   * instance, and JavaScript will internally call this method. Upon\n   * deserialization, one must pass to {@link MiniSearch.loadJSON} the same\n   * options used to create the original instance that was serialized.\n   *\n   * ### Usage:\n   *\n   * ```javascript\n   * // Serialize the index:\n   * let miniSearch = new MiniSearch({ fields: ['title', 'text'] })\n   * miniSearch.addAll(documents)\n   * const json = JSON.stringify(miniSearch)\n   *\n   * // Later, to deserialize it:\n   * miniSearch = MiniSearch.loadJSON(json, { fields: ['title', 'text'] })\n   * ```\n   *\n   * @return A plain-object serializable representation of the search index.\n   */\n  toJSON (): AsPlainObject {\n    const index: [string, { [key: string]: SerializedIndexEntry }][] = []\n\n    for (const [term, fieldIndex] of this._index) {\n      const data: { [key: string]: SerializedIndexEntry } = {}\n\n      for (const [fieldId, freqs] of fieldIndex) {\n        data[fieldId] = Object.fromEntries(freqs)\n      }\n\n      index.push([term, data])\n    }\n\n    return {\n      documentCount: this._documentCount,\n      nextId: this._nextId,\n      documentIds: Object.fromEntries(this._documentIds),\n      fieldIds: this._fieldIds,\n      fieldLength: Object.fromEntries(this._fieldLength),\n      averageFieldLength: this._avgFieldLength,\n      storedFields: Object.fromEntries(this._storedFields),\n      dirtCount: this._dirtCount,\n      index,\n      serializationVersion: 2\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  private termResults (\n    sourceTerm: string,\n    derivedTerm: string,\n    termWeight: number,\n    termBoost: number,\n    fieldTermData: FieldTermData | undefined,\n    fieldBoosts: { [field: string]: number },\n    boostDocumentFn: ((id: any, term: string, storedFields?: Record<string, unknown>) => number) | undefined,\n    bm25params: BM25Params,\n    results: RawResult = new Map()\n  ): RawResult {\n    if (fieldTermData == null) return results\n\n    for (const field of Object.keys(fieldBoosts)) {\n      const fieldBoost = fieldBoosts[field]\n      const fieldId = this._fieldIds[field]\n\n      const fieldTermFreqs = fieldTermData.get(fieldId)\n      if (fieldTermFreqs == null) continue\n\n      let matchingFields = fieldTermFreqs.size\n      const avgFieldLength = this._avgFieldLength[fieldId]\n\n      for (const docId of fieldTermFreqs.keys()) {\n        if (!this._documentIds.has(docId)) {\n          this.removeTerm(fieldId, docId, derivedTerm)\n          matchingFields -= 1\n          continue\n        }\n\n        const docBoost = boostDocumentFn ? boostDocumentFn(this._documentIds.get(docId), derivedTerm, this._storedFields.get(docId)) : 1\n        if (!docBoost) continue\n\n        const termFreq = fieldTermFreqs.get(docId)!\n        const fieldLength = this._fieldLength.get(docId)![fieldId]\n\n        // NOTE: The total number of fields is set to the number of documents\n        // `this._documentCount`. It could also make sense to use the number of\n        // documents where the current field is non-blank as a normalization\n        // factor. This will make a difference in scoring if the field is rarely\n        // present. This is currently not supported, and may require further\n        // analysis to see if it is a valid use case.\n        const rawScore = calcBM25Score(termFreq, matchingFields, this._documentCount, fieldLength, avgFieldLength, bm25params)\n        const weightedScore = termWeight * termBoost * fieldBoost * docBoost * rawScore\n\n        const result = results.get(docId)\n        if (result) {\n          result.score += weightedScore\n          assignUniqueTerm(result.terms, sourceTerm)\n          const match = getOwnProperty(result.match, derivedTerm)\n          if (match) {\n            match.push(field)\n          } else {\n            result.match[derivedTerm] = [field]\n          }\n        } else {\n          results.set(docId, {\n            score: weightedScore,\n            terms: [sourceTerm],\n            match: { [derivedTerm]: [field] }\n          })\n        }\n      }\n    }\n\n    return results\n  }\n\n  /**\n   * @ignore\n   */\n  private addTerm (fieldId: number, documentId: number, term: string): void {\n    const indexData = this._index.fetch(term, createMap)\n\n    let fieldIndex = indexData.get(fieldId)\n    if (fieldIndex == null) {\n      fieldIndex = new Map()\n      fieldIndex.set(documentId, 1)\n      indexData.set(fieldId, fieldIndex)\n    } else {\n      const docs = fieldIndex.get(documentId)\n      fieldIndex.set(documentId, (docs || 0) + 1)\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  private removeTerm (fieldId: number, documentId: number, term: string): void {\n    if (!this._index.has(term)) {\n      this.warnDocumentChanged(documentId, fieldId, term)\n      return\n    }\n\n    const indexData = this._index.fetch(term, createMap)\n\n    const fieldIndex = indexData.get(fieldId)\n    if (fieldIndex == null || fieldIndex.get(documentId) == null) {\n      this.warnDocumentChanged(documentId, fieldId, term)\n    } else if (fieldIndex.get(documentId)! <= 1) {\n      if (fieldIndex.size <= 1) {\n        indexData.delete(fieldId)\n      } else {\n        fieldIndex.delete(documentId)\n      }\n    } else {\n      fieldIndex.set(documentId, fieldIndex.get(documentId)! - 1)\n    }\n\n    if (this._index.get(term)!.size === 0) {\n      this._index.delete(term)\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  private warnDocumentChanged (shortDocumentId: number, fieldId: number, term: string): void {\n    for (const fieldName of Object.keys(this._fieldIds)) {\n      if (this._fieldIds[fieldName] === fieldId) {\n        this._options.logger('warn', `MiniSearch: document with ID ${this._documentIds.get(shortDocumentId)} has changed before removal: term \"${term}\" was not present in field \"${fieldName}\". Removing a document after it has changed can corrupt the index!`, 'version_conflict')\n        return\n      }\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  private addDocumentId (documentId: any): number {\n    const shortDocumentId = this._nextId\n    this._idToShortId.set(documentId, shortDocumentId)\n    this._documentIds.set(shortDocumentId, documentId)\n    this._documentCount += 1\n    this._nextId += 1\n    return shortDocumentId\n  }\n\n  /**\n   * @ignore\n   */\n  private addFields (fields: string[]): void {\n    for (let i = 0; i < fields.length; i++) {\n      this._fieldIds[fields[i]] = i\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  private addFieldLength (documentId: number, fieldId: number, count: number, length: number): void {\n    let fieldLengths = this._fieldLength.get(documentId)\n    if (fieldLengths == null) this._fieldLength.set(documentId, fieldLengths = [])\n    fieldLengths[fieldId] = length\n\n    const averageFieldLength = this._avgFieldLength[fieldId] || 0\n    const totalFieldLength = (averageFieldLength * count) + length\n    this._avgFieldLength[fieldId] = totalFieldLength / (count + 1)\n  }\n\n  /**\n   * @ignore\n   */\n  private removeFieldLength (documentId: number, fieldId: number, count: number, length: number): void {\n    if (count === 1) {\n      this._avgFieldLength[fieldId] = 0\n      return\n    }\n    const totalFieldLength = (this._avgFieldLength[fieldId] * count) - length\n    this._avgFieldLength[fieldId] = totalFieldLength / (count - 1)\n  }\n\n  /**\n   * @ignore\n   */\n  private saveStoredFields (documentId: number, doc: T): void {\n    const { storeFields, extractField } = this._options\n    if (storeFields == null || storeFields.length === 0) { return }\n\n    let documentFields = this._storedFields.get(documentId)\n    if (documentFields == null) this._storedFields.set(documentId, documentFields = {})\n\n    for (const fieldName of storeFields) {\n      const fieldValue = extractField(doc, fieldName)\n      if (fieldValue !== undefined) documentFields[fieldName] = fieldValue\n    }\n  }\n}\n\nconst getOwnProperty = (object: any, property: string) =>\n  Object.prototype.hasOwnProperty.call(object, property) ? object[property] : undefined\n\ntype CombinatorFunction = (a: RawResult, b: RawResult) => RawResult\n\nconst combinators: Record<LowercaseCombinationOperator, CombinatorFunction> = {\n  [OR]: (a: RawResult, b: RawResult) => {\n    for (const docId of b.keys()) {\n      const existing = a.get(docId)\n      if (existing == null) {\n        a.set(docId, b.get(docId)!)\n      } else {\n        const { score, terms, match } = b.get(docId)!\n        existing.score = existing.score + score\n        existing.match = Object.assign(existing.match, match)\n        assignUniqueTerms(existing.terms, terms)\n      }\n    }\n\n    return a\n  },\n  [AND]: (a: RawResult, b: RawResult) => {\n    const combined = new Map()\n\n    for (const docId of b.keys()) {\n      const existing = a.get(docId)\n      if (existing == null) continue\n\n      const { score, terms, match } = b.get(docId)!\n      assignUniqueTerms(existing.terms, terms)\n      combined.set(docId, {\n        score: existing.score + score,\n        terms: existing.terms,\n        match: Object.assign(existing.match, match)\n      })\n    }\n\n    return combined\n  },\n  [AND_NOT]: (a: RawResult, b: RawResult) => {\n    for (const docId of b.keys()) a.delete(docId)\n    return a\n  }\n}\n\n/**\n * Parameters of the BM25+ scoring algorithm. Customizing these is almost never\n * necessary, and finetuning them requires an understanding of the BM25 scoring\n * model.\n *\n * Some information about BM25 (and BM25+) can be found at these links:\n *\n *   - https://en.wikipedia.org/wiki/Okapi_BM25\n *   - https://opensourceconnections.com/blog/2015/10/16/bm25-the-next-generation-of-lucene-relevation/\n */\nexport type BM25Params = {\n  /** Term frequency saturation point.\n   *\n   * Recommended values are between `1.2` and `2`. Higher values increase the\n   * difference in score between documents with higher and lower term\n   * frequencies. Setting this to `0` or a negative value is invalid. Defaults\n   * to `1.2`\n   */\n  k: number,\n\n  /**\n   * Length normalization impact.\n   *\n   * Recommended values are around `0.75`. Higher values increase the weight\n   * that field length has on scoring. Setting this to `0` (not recommended)\n   * means that the field length has no effect on scoring. Negative values are\n   * invalid. Defaults to `0.7`.\n   */\n  b: number,\n\n  /**\n   * BM25+ frequency normalization lower bound (usually called \u03B4).\n   *\n   * Recommended values are between `0.5` and `1`. Increasing this parameter\n   * increases the minimum relevance of one occurrence of a search term\n   * regardless of its (possibly very long) field length. Negative values are\n   * invalid. Defaults to `0.5`.\n   */\n  d: number\n}\n\nconst defaultBM25params: BM25Params = { k: 1.2, b: 0.7, d: 0.5 }\n\nconst calcBM25Score = (\n  termFreq: number,\n  matchingCount: number,\n  totalCount: number,\n  fieldLength: number,\n  avgFieldLength: number,\n  bm25params: BM25Params\n): number => {\n  const { k, b, d } = bm25params\n  const invDocFreq = Math.log(1 + (totalCount - matchingCount + 0.5) / (matchingCount + 0.5))\n  return invDocFreq * (d + termFreq * (k + 1) / (termFreq + k * (1 - b + b * fieldLength / avgFieldLength)))\n}\n\nconst termToQuerySpec = (options: SearchOptions) => (term: string, i: number, terms: string[]): QuerySpec => {\n  const fuzzy = (typeof options.fuzzy === 'function')\n    ? options.fuzzy(term, i, terms)\n    : (options.fuzzy || false)\n  const prefix = (typeof options.prefix === 'function')\n    ? options.prefix(term, i, terms)\n    : (options.prefix === true)\n  const termBoost = (typeof options.boostTerm === 'function')\n    ? options.boostTerm(term, i, terms)\n    : 1\n  return { term, fuzzy, prefix, termBoost }\n}\n\nconst defaultOptions = {\n  idField: 'id',\n  extractField: (document: any, fieldName: string) => document[fieldName],\n  tokenize: (text: string) => text.split(SPACE_OR_PUNCTUATION),\n  processTerm: (term: string) => term.toLowerCase(),\n  fields: undefined,\n  searchOptions: undefined,\n  storeFields: [],\n  logger: (level: LogLevel, message: string): void => {\n    if (typeof console?.[level] === 'function') console[level](message)\n  },\n  autoVacuum: true\n}\n\nconst defaultSearchOptions = {\n  combineWith: OR,\n  prefix: false,\n  fuzzy: false,\n  maxFuzzy: 6,\n  boost: {},\n  weights: { fuzzy: 0.45, prefix: 0.375 },\n  bm25: defaultBM25params\n}\n\nconst defaultAutoSuggestOptions = {\n  combineWith: AND,\n  prefix: (term: string, i: number, terms: string[]): boolean =>\n    i === terms.length - 1\n}\n\nconst defaultVacuumOptions = { batchSize: 1000, batchWait: 10 }\nconst defaultVacuumConditions = { minDirtFactor: 0.1, minDirtCount: 20 }\n\nconst defaultAutoVacuumOptions = { ...defaultVacuumOptions, ...defaultVacuumConditions }\n\nconst assignUniqueTerm = (target: string[], term: string): void => {\n  // Avoid adding duplicate terms.\n  if (!target.includes(term)) target.push(term)\n}\n\nconst assignUniqueTerms = (target: string[], source: readonly string[]): void => {\n  for (const term of source) {\n    // Avoid adding duplicate terms.\n    if (!target.includes(term)) target.push(term)\n  }\n}\n\ntype Scored = { score: number }\nconst byScore = ({ score: a }: Scored, { score: b }: Scored) => b - a\n\nconst createMap = () => new Map()\n\ninterface SerializedIndexEntry {\n  [key: string]: number\n}\n\nconst objectToNumericMap = <T>(object: { [key: string]: T }): Map<number, T> => {\n  const map = new Map()\n\n  for (const key of Object.keys(object)) {\n    map.set(parseInt(key, 10), object[key])\n  }\n\n  return map\n}\n\nconst objectToNumericMapAsync = async <T>(object: { [key: string]: T }): Promise<Map<number, T>> => {\n  const map = new Map()\n\n  let count = 0\n  for (const key of Object.keys(object)) {\n    map.set(parseInt(key, 10), object[key])\n    if (++count % 1000 === 0) {\n      await wait(0)\n    }\n  }\n\n  return map\n}\n\nconst wait = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms))\n\n// This regular expression matches any Unicode space, newline, or punctuation\n// character\nconst SPACE_OR_PUNCTUATION = /[\\n\\r\\p{Z}\\p{P}]+/u\n", "// The neighborhood provides a cache of site maps read from\n// various federated wiki sites. It is careful to fetch maps\n// slowly and keeps track of get requests in flight.\n\nlet neighborhood;\nconst miniSearch = require('minisearch');\n\nmodule.exports = (neighborhood = {});\n\nneighborhood.sites = {};\nlet nextAvailableFetch = 0;\nconst nextFetchInterval = 500;\n\nconst delay = ms => new Promise(resolve => setTimeout(resolve, ms));\n\nconst populateSiteInfoFor = function(site,neighborInfo){\n  if (neighborInfo.sitemapRequestInflight) { return; }\n  neighborInfo.sitemapRequestInflight = true;\n\n  const transition = (site, from, to) => $(`.neighbor[data-site=\"${site}\"]`)\n    .find('div')\n    .removeClass(from)\n    .addClass(to);\n\n  const boundedDelay = function(ms) {\n    const minDelay = 60000;      // 1 minute\n    const maxDelay = 43200000;   // 12 hours\n\n    if (ms > maxDelay) {\n      return maxDelay;\n    }\n\n    if (ms < minDelay) {\n      return minDelay;\n    }\n\n    return ms;\n  };\n\n  var refreshMap = function(site, neighborInfo) {\n    neighborInfo.sitemapRequestInflight = true;\n\n    return wiki.site(site).get('system/sitemap.json', function(err, gotData) {\n      neighborInfo.sitemapRequestInflight = false;\n      if (err) {\n        transition(site, 'fetch', 'fail');\n        wiki.site(site).refresh(function() {});\n          // empty function\n        //throw new Error('Unable to fetch sitemap');\n        console.warn(`Unable to fetch sitemap for ${site}`)\n        return\n      }\n\n      let { data, lastModified } = gotData;\n\n      if (isNaN(lastModified)) {\n        lastModified = 0;\n      }\n\n      if (lastModified > neighborInfo.lastModified) {\n        neighborInfo.sitemap = data;\n        neighborInfo.lastModified = lastModified;\n        $('body').trigger('new-neighbor-done', site);\n        refreshIndex(site, neighborInfo);\n      }\n\n      const updateDelay = boundedDelay(Math.floor((Date.now() - lastModified) / 4 ));\n      neighborInfo.nextCheck = Date.now() + updateDelay;\n      console.log('delay for ', site, (updateDelay / 60000));\n      transition(site, 'fetch', 'done');\n\n      return delay(updateDelay)\n        .then(function() {\n          transition(site, 'done', 'fetch');\n          return refreshMap(site, neighborInfo);\n      });\n    });\n  };\n\n  var refreshIndex = (site, neighborInfo) => // we use `wiki.site(site).getIndex` as we want the serialized index as a string.\n  wiki.site(site).getIndex('system/site-index.json', function(err, data) {\n    if (!err) {\n      try {\n        neighborInfo.siteIndex = miniSearch.loadJSON(data, {\n          fields: ['title', 'content']\n        });\n        console.log(site, 'index loaded');\n      } catch (error) {\n        console.log('error loading index - not a valid index', site);\n      }\n    } else {\n      console.log('error loading index', site, err);\n    }\n  });\n\n\n  const fetchMap = function() {\n    transition(site, 'wait', 'fetch');\n    neighborInfo.lastModified = 0;\n    return refreshMap(site, neighborInfo);\n  };\n\n  const now = Date.now();\n  if (now > nextAvailableFetch) {\n    nextAvailableFetch = now + nextFetchInterval;\n    setTimeout(fetchMap, 100);\n  } else {\n    setTimeout(fetchMap, nextAvailableFetch - now);\n    nextAvailableFetch += nextFetchInterval;\n  }\n};\n\nneighborhood.retryNeighbor = function(site){\n  console.log('retrying neighbor');\n  const neighborInfo = {};\n  neighborhood.sites[site] = neighborInfo;\n  populateSiteInfoFor(site, neighborInfo);\n};\n\nneighborhood.registerNeighbor = function(site){\n  if (neighborhood.sites[site]) { return; }\n  const neighborInfo = {};\n  neighborhood.sites[site] = neighborInfo;\n  populateSiteInfoFor( site, neighborInfo );\n  $('body').trigger('new-neighbor', site);\n};\n\nneighborhood.updateSitemap = function(pageObject){\n  let neighborInfo;\n  const site = location.host;\n  if (!(neighborInfo = neighborhood.sites[site])) { return; }\n  if (neighborInfo.sitemapRequestInflight) { return; }\n  const slug = pageObject.getSlug();\n  const date = pageObject.getDate();\n  const title = pageObject.getTitle();\n  const synopsis = pageObject.getSynopsis();\n  const links = pageObject.getLinks();\n  const entry = {slug, date, title, synopsis, links};\n  const {\n    sitemap\n  } = neighborInfo;\n  const index = sitemap.findIndex(slot => slot.slug === slug);\n  if (index >= 0) {\n    sitemap[index] = entry;\n  } else {\n    sitemap.push(entry);\n  }\n  $('body').trigger('new-neighbor-done', site);\n};\n\nneighborhood.deleteFromSitemap = function(pageObject){\n  let neighborInfo;\n  const site = location.host;\n  if (!(neighborInfo = neighborhood.sites[site])) { return; }\n  if (neighborInfo.sitemapRequestInflight) { return; }\n  const slug = pageObject.getSlug();\n  const {\n    sitemap\n  } = neighborInfo;\n  const index = sitemap.findIndex(slot => slot.slug === slug);\n  if (!(index >= 0)) { return; }\n  sitemap.splice(index);\n  $('body').trigger('delete-neighbor-done', site);\n};\n\nneighborhood.listNeighbors = () => Object.keys(neighborhood.sites);\n\n// Page Search\n\nconst extractItemText = text => text.replace(/\\[([^\\]]*?)\\][\\[\\(].*?[\\]\\)]/g, \" $1 \")\n  .replace(/\\[{2}|\\[(?:[\\S]+)|\\]{1,2}/g, ' ')\n  .replace(/\\n/g, ' ')\n  .replace(/<style.*?<\\/style>/g, ' ')\n  .replace(/<(?:\"[^\"]*\"['\"]*|'[^']*'['\"]*|[^'\">])+>/g, ' ')\n  .replace(/<(?:[^>])+>/g, ' ')\n  .replace(/(https?.*?)(?=\\p{White_Space}|\\p{Quotation_Mark}|$)/gu, function(match) {\n    const myUrl = new URL(match);\n    return myUrl.hostname + myUrl.pathname;\n})\n  .replace(/[\\p{P}\\p{Emoji}\\p{Symbol}}]+/gu, ' ')\n  .replace(/[\\p{White_Space}\\n\\t]+/gu, ' ');\n\n\nconst extractPageText = function(pageText, currentItem, currentIndex) {\n  try {\n    if (currentItem.text) {\n      switch (currentItem.type) {\n        case 'paragraph': case 'markdown': case 'html': case 'reference': case 'image': case 'pagefold': case 'math': case 'mathjax': case 'code':\n          pageText += extractItemText(currentItem.text);\n          break;\n        case 'audio': case 'video': case 'frame':\n          pageText += extractItemText(currentItem.text.split(/\\r\\n?|\\n/)\n            .map(function(line) {\n              const firstWord = line.split(/\\p{White_Space}/u)[0];\n              if (firstWord.startsWith('http') || (firstWord.toUpperCase() === firstWord) || firstWord.startsWith('//')) {\n                // line is markup\n                return '';\n              } else {\n                return line;\n              }\n            }).join(' '));\n          break;\n      }\n    }\n  } catch (err) {\n    throw new Error(`Error extracting text from ${currentIndex}, ${JSON.stringify(currentItem)} ${err}, ${err.stack}`);\n  }\n  return pageText;\n};\n\n\nneighborhood.updateIndex = function(pageObject) {\n  let neighborInfo;\n  console.log(`updating ${pageObject.getSlug()} in index`);\n  const site = location.host;\n  if (!(neighborInfo = neighborhood.sites[site])) { return; }\n\n  const slug = pageObject.getSlug();\n  const title = pageObject.getTitle();\n  const rawStory = pageObject.getRawPage().story;\n  const newText = rawStory.reduce( extractPageText, '');\n\n  if (neighborInfo.siteIndex.has(slug)) {\n    return neighborInfo.siteIndex.replace({\n      'id': slug,\n      'title': title,\n      'content': newText\n    });\n  } else {\n    return neighborInfo.siteIndex.add({\n      'id': slug,\n      'title': title,\n      'content': newText\n    });\n  }\n};\n\nneighborhood.deleteFromIndex = function(pageObject) {\n  let neighborInfo;\n  const site = location.host;\n  if (!(neighborInfo = neighborhood.sites[site])) { return; }\n\n  const slug = pageObject.getSlug();\n  try {\n    neighborInfo.siteIndex.discard(slug);\n  } catch (err) {\n    // swallow error, if the page was not in index\n    if (!err.message.includes('not in the index')) { console.log(`removing ${slug} from index failed`, err); }\n  }\n};\n\n\nneighborhood.search = function(searchQuery){\n  let neighborInfo, neighborSite;\n  const finds = [];\n  const tally = {};\n\n  const tick = function(key) {\n    if (tally[key]) { return tally[key]++; } else { return tally[key] = 1; }\n  };\n\n\n\n  const indexSite = function(site, siteInfo) {\n    const timeLabel = `indexing sitemap ( ${site} )`;\n    console.time(timeLabel);\n    console.log('indexing sitemap:', site);\n    const siteIndex = new miniSearch({\n      fields: ['title', 'content']\n    });\n    neighborInfo.sitemap.forEach((function(page) {\n      siteIndex.add({\n        'id': page.slug,\n        'title': page.title,\n        'content': page.synopsis\n      });\n    })\n    );\n    console.timeEnd(timeLabel);\n    return siteIndex;\n  };\n\n  const start = Date.now();\n  // load, or create (from sitemap), site index\n  for (neighborSite of Object.keys(neighborhood.sites)) {\n    neighborInfo = neighborhood.sites[neighborSite];\n    if (neighborInfo.sitemap) {\n      // do we already have an index?\n      if (!neighborInfo.siteIndex) {\n        // create an index using sitemap\n        neighborInfo.siteIndex = indexSite(neighborSite, neighborInfo);\n      }\n    }\n  }\n\n  const origin = location.host;\n  for (neighborSite of Object.keys(neighborhood.sites)) {\n    neighborInfo = neighborhood.sites[neighborSite];\n    if (neighborInfo.siteIndex) {\n      var contentBoost, error, searchResult, titleBoost;\n      tick('sites');\n      try {\n        if (tally['pages']) {\n          tally['pages'] += neighborInfo.sitemap.length;\n        } else {\n          tally['pages'] = neighborInfo.sitemap.length;\n        }\n      } catch (error1) {\n        error = error1;\n        console.info('+++ sitemap not valid for ', neighborSite);\n        neighborInfo.sitemap = [];\n      }\n      if (neighborSite === origin) {\n        titleBoost = 20;\n        contentBoost = 2;\n      } else {\n        titleBoost = 10;\n        contentBoost = 1;\n      }\n      try {\n        searchResult = neighborInfo.siteIndex.search(searchQuery, {\n          boost: {\n            title: titleBoost,\n            content: contentBoost\n          },\n          prefix: true,\n          combineWith: 'AND'\n        }\n        );\n      } catch (error2) {\n        error = error2;\n        console.error('search index error', neighborSite, searchQuery, error);\n        searchResult = [];\n      }\n      searchResult.forEach(function(result) {\n        tick('finds');\n        finds.push({\n          page: neighborInfo.sitemap.find(({slug}) => slug === result.id),\n          site: neighborSite,\n          rank: result.score\n        });\n      });\n    }\n  }\n\n  // sort the finds by rank\n  finds.sort((a, b) => b.rank - a.rank);\n\n  tally['msec'] = Date.now() - start;\n  return { finds, tally };\n};\n\nneighborhood.backLinks = function(slug) {\n\n  const finds = [];\n\n  for (var neighborSite of Object.keys(neighborhood.sites)) {\n    var neighborInfo = neighborhood.sites[neighborSite];\n    if (neighborInfo.sitemap) {\n      neighborInfo.sitemap.forEach(function(sitemapData, pageSlug) {\n        if (sitemapData.links && (Object.keys(sitemapData.links).length > 0) && Object.keys(sitemapData.links).includes(slug)) {\n          finds.push({\n            slug: sitemapData.slug,\n            title: sitemapData.title,\n            site: neighborSite,\n            itemId: sitemapData.links[slug],\n            date: sitemapData.date\n          });\n        }\n      });\n    }\n  }\n  const results = {};\n\n  finds.forEach(function(find) {\n\n    slug = find['slug'];\n\n    results[slug] = results[slug] || {};\n    results[slug]['title'] = find['title'];\n    results[slug]['sites'] = results[slug]['sites'] || [];\n    results[slug]['sites'].push({\n      site: find['site'],\n      date: find['date'],\n      itemId: find['itemId']});});\n  return results;\n};\n", "// The pageHandler bundles fetching and storing json pages\n// from origin, remote and browser local storage. It handles\n// incremental updates and implicit forks when pages are edited.\n\nlet pageHandler;\n\nconst state = require('./state');\nconst revision = require('./revision');\nconst addToJournal = require('./addToJournal');\nconst {\n  newPage\n} = require('./page');\nconst random = require('./random');\nconst lineup = require('./lineup');\nconst neighborhood = require('./neighborhood');\n\nmodule.exports = (pageHandler = {});\n\nconst deepCopy = object => JSON.parse(JSON.stringify(object));\n\npageHandler.useLocalStorage = () => $(\".login\").length > 0;\n\nconst pageFromLocalStorage = function(slug){\n  let json;\n  if ((json = localStorage.getItem(slug))) {\n    return JSON.parse(json);\n  } else {\n    return undefined;\n  }\n};\n\nvar recursiveGet = function({pageInformation, whenGotten, whenNotGotten, localContext}) {\n  let {slug,rev,site} = pageInformation;\n\n  const localBeforeOrigin = {\n    get(slug, done) {\n      wiki.local.get(slug, function(err, page) {\n        // console.log [err, page]\n        if (err) {\n          wiki.origin.get(slug, done);\n        } else {\n          site = 'local';\n          done(null, page);\n        }\n      });\n    }\n  };\n\n  if (site) {\n    localContext = [];\n  } else {\n    site = localContext.shift();\n  }\n\n  if (site === window.location.host) { site = 'origin'; }\n  if (site === null) { site = 'view'; }\n\n  // suggest by Claude Sonnet as an alternative to using switch.\n  const adapter = {\n    'local': wiki.local,\n    'origin': wiki.origin,\n    'recycler': wiki.recycler,\n    'view': localBeforeOrigin\n  }[site] ?? wiki.site(site);\n\n  adapter.get(`${slug}.json`, function(err, page) {\n    if (!err) {\n      // console.log 'got', site, page\n      if (rev) { page = revision.create(rev, page); }\n      whenGotten(newPage(page, site));\n    } else {\n      if (([403, 404].includes(err.xhr.status) ) || (err.xhr.status === 0)) {\n        if (localContext.length > 0) {\n          recursiveGet( {pageInformation, whenGotten, whenNotGotten, localContext} );\n        } else {\n          whenNotGotten();\n        }\n      } else {\n        const url = adapter.getDirectURL(pageInformation.slug);\n        const text = `\\\nThe page handler has run into problems with this request.\n<pre class=error>${JSON.stringify(pageInformation)}</pre>\nThe requested url.\n<pre class=error>${url}</pre>\nThe server reported status.\n<pre class=error>${err.xhr?.status}</pre>\nThe error message.\n<pre class=error>${err.msg}</pre>\nThese problems are rarely solved by reporting issues.\nThere could be additional information reported in the browser's console.log.\nMore information might be accessible by fetching the page outside of wiki.\n<a href=\"${url}\" target=\"_blank\">try-now</a>\\\n`;\n        const trouble = newPage({title: \"Trouble: Can't Get Page\"}, null);\n        trouble.addItem({type:'html', text});\n        whenGotten(trouble);\n      }\n    }\n  });\n};\n\n\npageHandler.get = function({whenGotten,whenNotGotten,pageInformation}  ) {\n\n  if (!pageInformation.site) {\n    let localPage;\n    if (localPage = pageFromLocalStorage(pageInformation.slug)) {\n      if (pageInformation.rev) { localPage = revision.create(pageInformation.rev, localPage); }\n      whenGotten(newPage( localPage, 'local' ));\n      return;\n    }\n  }\n\n  if (!pageHandler.context.length) { pageHandler.context = ['view']; }\n\n  recursiveGet({\n    pageInformation,\n    whenGotten,\n    whenNotGotten,\n    localContext: pageHandler.context.slice()\n  });\n};\n\n\npageHandler.context = [];\n\nconst pushToLocal = function($page, pagePutInfo, action) {\n  let page;\n  if (action.type === 'create') {\n    page = {title: action.item.title, story:[], journal:[]};\n  } else {\n    let site;\n    page = pageFromLocalStorage(pagePutInfo.slug);\n    if (!page) { page = lineup.atKey($page.data('key')).getRawPage(); }\n    page.journal ||= [];\n    if (site=action['fork']) {\n      page.journal = page.journal.concat({'type':'fork','site':site,'date':(new Date()).getTime()});\n      delete action['fork'];\n    }\n  }\n  revision.apply(page, action);\n  wiki.local.put(pagePutInfo.slug, page, function() {\n    addToJournal($page.find('.journal'), action);\n    $page.addClass(\"local\");\n  });\n};\n\nconst pushToServer = function($page, pagePutInfo, action) {\n\n  // bundle rawPage which server will strip out\n  const bundle = deepCopy(action);\n  const pageObject = lineup.atKey($page.data('key'));\n  if (action.fork || (action.type === 'fork')) {\n    bundle.forkPage = deepCopy(pageObject.getRawPage());\n  }\n\n  wiki.origin.put(pagePutInfo.slug, bundle, function(err) {\n    if (err) {\n      action.error = { type: err.type, msg: err.msg, response: err.xhr.responseText};\n      pushToLocal($page, pagePutInfo, action);\n    } else {\n      if (pageObject?.apply) { pageObject.apply(action); }\n      neighborhood.updateSitemap(pageObject);\n      neighborhood.updateIndex(pageObject);\n      addToJournal($page.find('.journal'), action);\n      if (action.type === 'fork') {\n        wiki.local.delete($page.attr('id'));\n      }\n      if ((action.type !== 'fork') && action.fork) {\n        // implicit fork, probably only affects image plugin\n        if (action.item.type === 'image') {\n          const index = $page.find('.item').index($page.find('#' + action.item.id).context);\n          wiki.renderFrom(index);\n        }\n      }\n    }\n  });\n};\n\n\npageHandler.put = function($page, action) {\n\n  const checkedSite = function() {\n    let site;\n    switch ((site = $page.data('site'))) {\n      case 'origin': case 'local': case 'view': return null;\n      case location.host: return null;\n      default: return site;\n    }\n  };\n\n  // about the page we have\n  const pagePutInfo = {\n    slug: $page.attr('id').split('_rev')[0],\n    rev: $page.attr('id').split('_rev')[1],\n    site: checkedSite(),\n    local: $page.hasClass('local')\n  };\n  let forkFrom = pagePutInfo.site;\n  // console.log 'pageHandler.put', action, pagePutInfo\n\n  // detect when fork to local storage\n  if (pageHandler.useLocalStorage()) {\n    if (pagePutInfo.site) {\n      // console.log 'remote => local'\n    } else if (!pagePutInfo.local) {\n      // console.log 'origin => local'\n      action.site = (forkFrom = location.host);\n    }\n  }\n    // else if !pageFromLocalStorage(pagePutInfo.slug)\n    //   console.log ''\n    //   action.site = forkFrom = pagePutInfo.site\n    //   console.log 'local storage first time', action, 'forkFrom', forkFrom\n\n  // tweek action before saving\n  action.date = (new Date()).getTime();\n  if (action.site === 'origin') { delete action.site; }\n\n  // update dom when forking\n  $page.removeClass('plugin');\n  if (forkFrom) {\n    // pull remote site closer to us\n    $page.find('h1').prop('title',location.host);\n    $page.find('h1 img').attr('src', '/favicon.png');\n    $page.find('h1 a').attr('href', `/view/welcome-visitors/view/${pagePutInfo.slug}`).attr('target',location.host);\n    $page.data('site', null);\n    $page.removeClass('remote');\n    //STATE -- update url when site changes\n    state.setUrl();\n    if (action.type !== 'fork') {\n      // bundle implicit fork with next action\n      action.fork = forkFrom;\n      addToJournal($page.find('.journal'), {\n        type: 'fork',\n        site: forkFrom,\n        date: action.date\n      }\n      );\n    }\n  }\n\n  // store as appropriate\n  if (pageHandler.useLocalStorage() || (pagePutInfo.site === 'local')) {\n    pushToLocal($page, pagePutInfo, action);\n  } else {\n    pushToServer($page, pagePutInfo, action);\n  }\n};\n\npageHandler.delete = function(pageObject, $page, done) {\n  // console.log 'delete server-side'\n  // console.log 'pageObject:', pageObject\n  if (pageObject.isRecycler()) {\n    wiki.recycler.delete(`${pageObject.getSlug()}.json`, function(err) {\n      const more = () => done(err);\n      setTimeout(more, 300);\n    });\n  } else {\n    wiki.origin.delete(`${pageObject.getSlug()}.json`, function(err) {\n      const more = function() {\n        if (!err) {\n          neighborhood.deleteFromSitemap(pageObject);\n          neighborhood.deleteFromIndex(pageObject);\n        }\n        done(err);\n      };\n      setTimeout(more, 300);\n    }); // simulate server turnaround\n  }\n};\n", "// The plugin module manages the dynamic retrieval of plugin\n// javascript including additional scripts that may be requested.\n\n// forward = require './forward'\n\nlet plugin;\nmodule.exports = (plugin = {});\n\nconst escape = s => (''+s)\n  .replace(/&/g, '&amp;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;')\n  .replace(/\"/g, '&quot;')\n  .replace(/'/g, '&#x27;')\n  .replace(/\\//g,'&#x2F;');\n\n// define loadScript that allows fetching a script.\n// see example in http://api.jquery.com/jQuery.getScript/\n\nconst loadScript = function(url) {\n  console.log(\"loading url:\", url);\n  return import(url)\n};\n\nconst scripts = [];\nconst loadingScripts = {};\nconst getScript = (plugin.getScript = async function (url, callback = () => {}) {\n  if (scripts.includes(url)) {\n    callback();\n  } else {\n\n    try {\n      await loadScript(url)\n    } catch (err) {\n      console.log('getScript: Failed to load:', url, err);\n    }\n\n    scripts.push(url);\n    callback();\n  }\n});\n\nplugin.renderFrom = async function(notifIndex) {\n  const $items = $(\".item\").slice(notifIndex);\n\n  // console.log \"notifIndex\", notifIndex, \"about to render\", $items.toArray()\n\n  for (const itemElem of $items.toArray()) {\n    const $item = $(itemElem);\n    if (!$item.hasClass('textEditing')) {\n      const item = $item.data('item');\n      try {\n        $item.off();\n        await plugin.emit($item.empty(), item)\n      } catch (e) {\n        console.error(e)\n      }\n    }\n  }\n\n  // Binds must be called sequentially in order to store the promises used to order bind operations.\n  // Note: The bind promises used here are for ordering \"bind creation\".\n  // The ordering of \"bind results\" is done within the plugin.bind wrapper.\n  for (const itemElem of $items.toArray()) {\n    const $item = $(itemElem);\n    const item = $item.data('item');\n    try {\n      const p = await plugin.get(item.type)\n      if (p && p.bind) {\n        await p.bind($item, item);\n      }\n    } catch (e) {\n      console.error(e)\n    }\n  }\n}\n\n\nconst emit = function(pluginEmit) {\n  const fn = function($item, item) {\n    $item.addClass('emit');\n    return pluginEmit($item, item);\n  };\n  return fn;\n};\n\nconst bind = function(name, pluginBind) {\n  const fn = async function($item, item, oldIndex) {\n    // Clear out any list of consumed items.\n    $item[0].consuming = [];\n    const index = $('.item').index($item);\n    const {\n      consumes\n    } = window.plugins[name];\n\n    // Wait for all items in the lineup that produce what we consume\n    // before calling our bind method.\n    if (consumes) {\n      const deps = [];\n      consumes.forEach(function(consuming) {\n        const producers = $(`.item:lt(${index})`).filter(consuming);\n        // console.log(name, \"consumes\", consuming)\n        // console.log(producers, \"produce\", consuming)\n        if (!producers || (producers.length === 0)) {\n          console.log('warn: no items in lineup that produces', consuming);\n        }\n        // console.log(\"there are #{producers.length} instances of #{consuming}\")\n        producers.each(function(_i, el) {\n          const page_key = $(el).parents('.page').data('key');\n          const item_id = $(el).attr('data-id');\n          $item[0].consuming.push(`${page_key}/${item_id}`);\n          deps.push(el.promise);\n        });\n      });\n      await Promise.all(deps);\n    }\n\n    try {\n\n      $item.removeClass('emit');\n      let bindPromise = $item[0].promise = (async function () {\n        return pluginBind($item, item);\n      })()\n\n      await bindPromise\n\n      // If the plugin has the needed callback, subscribe to server side events\n      // for the current page\n      if (window.plugins[name].processServerEvent) {\n        console.log('listening for server events', $item, item);\n        forward.init($item, item, window.plugins[name].processServerEvent);\n      }\n    } catch (e) {\n      console.log('plugin emit: unexpected error', e)\n    }\n  }\n  return fn;\n};\n\nplugin.wrap = wrap\nfunction wrap (name, p) {\n  p.emit = emit(p.emit);\n  p.bind = bind(name, p.bind);\n  return p;\n};\n\nplugin.get = (plugin.getPlugin = async function(name, callback = () => {}) {\n  if (window.pluginSuccessor[name]) {\n    wiki.log('plugin successor', name, window.pluginSuccessor[name]);\n    name = window.pluginSuccessor[name];\n  }\n  if (window.plugins[name]) {\n    callback(window.plugins[name])\n    return window.plugins[name]\n  }\n  if (!loadingScripts[name]) {\n    loadingScripts[name] = (async function() {\n      if (window.plugins[name]) { return window.plugins[name]; }\n      await getScript(`/plugins/${name}/${name}.js`)\n      if (!window.plugins[name]) {\n        await getScript(`/plugins/${name}.js`)\n      }\n      const p = window.plugins[name];\n      if (p) {\n        wrap(name, p);\n      }\n      return p;\n    })();\n  }\n  const p = await loadingScripts[name]\n  delete loadingScripts[name];\n  if (!p) {\n    console.log(\"Could not find plugin \", name)\n  }\n  callback(p)\n  return p\n});\n\n\nplugin.do = (plugin.doPlugin = async function ($item, item, done = () => {}) {\n  $item.data('item', item);\n  await plugin.renderFrom($('.item').index($item));\n  return done()\n});\n\nplugin.emit = async function(div, item, done = () => {}) {\n  const error = function(ex, script) {\n    div.append(`\\\n<div class=\"error\">\n  ${escape(item.text || \"\")}\n  <button>help</button><br>\n</div>\\\n`\n    );\n    if (item.text) {\n      div.find('.error').on('dblclick', e => wiki.textEditor(div, item));\n    }\n    div.find('button').on('click', function() {\n      // only append dialog if not already done.\n      if (!div[0].querySelector('dialog')) {\n        div.append(`\\\n<dialog>\n  <h3>${ex.toString()}</h3>\n  <p> This \"${item.type}\" plugin won't show.</p>\n  <ul>\n    <li> Is it available on this server?\n    <li> Is its markup correct?\n    <li> Can it find necessary data?\n    <li> Has network access been interrupted?\n    <li> Has its code been tested?\n  </ul>\n  <p> Developers may open debugging tools and retry the plugin.</p>\n  <button class=\"retry\">retry</button>  <button class=\"close\">close</button>\n  <p> Learn more\n    <a class=\"external\" target=\"_blank\" rel=\"nofollow\"\n    href=\"http://plugins.fed.wiki.org/about-plugins.html\"\n    title=\"http://plugins.fed.wiki.org/about-plugins.html\">\n      About Plugins\n      <img src=\"/images/external-link-ltr-icon.png\">\n    </a>\n  </p>\n\n</dialog>\\\n`\n        );\n      }\n      const dialog = div[0].querySelector('dialog');\n      dialog.addEventListener('click', function(evt) {\n        if (evt.target === dialog) {\n          dialog.close();\n        }\n      });\n      dialog.showModal();\n      $('.close').on('click', () => dialog.close());\n      $('.retry').on('click', function() {\n        if (script.emit.length > 2) {\n          script.emit(div, item, () => done());\n        } else {\n          script.emit(div, item);\n          done();\n        }\n      });\n    });\n  };\n\n  div.data('pageElement', div.parents(\".page\"));\n  div.data('item', item);\n  const script = await plugin.get(item.type)\n  try {\n    if (script == null) { throw TypeError(`Can't find plugin for '${item.type}'`); }\n    if (script.emit.length > 2) {\n      await new Promise(function(resolve, reject) {\n        script.emit(div, item, function() {\n          if (script.bind) { script.bind(div, item); }\n          resolve();\n        });\n      })\n    } else {\n      script.emit(div, item);\n    }\n  } catch (err) {\n    console.log('plugin error', err);\n    error(err, script);\n  }\n  done();\n};\n\nplugin.registerPlugin = (pluginName, pluginFn) => window.plugins[pluginName] = pluginFn($);\n", "// The itemz module understands how we have been keeping track of\n// story items and their corresponding divs. It offers utility\n// functions used elsewere. We anticipate a more proper model eventually.\n\nconst pageHandler = require('./pageHandler');\nconst plugin = require('./plugin');\nconst random = require('./random');\n\n\nconst sleep = (time, done) => setTimeout(done, time);\n\nconst getItem = function($item) {\n  if ($($item).length > 0) { return $($item).data(\"item\") || $($item).data('staticItem'); }\n};\n\nconst removeItem = function($item, item) {\n  pageHandler.put($item.parents('.page:first'), {type: 'remove', id: item.id});\n  $item.remove();\n};\n\nconst createItem = function($page, $before, item) {\n  if (!$page) { $page = $before.parents('.page'); }\n  item.id = random.itemId();\n  const $item = $(`\\\n<div class=\"item ${item.type}\" data-id=\"\"</div>\\\n`\n  );\n  $item\n    .data('item', item)\n    .data('pageElement', $page);\n  if ($before) {\n    $before.after($item);\n  } else {\n    $page.find('.story').append($item);\n  }\n  plugin.do($item, item);\n  const before = getItem($before);\n  // TODO: can we remove this sleep with better synchronization?\n  sleep(500, () => pageHandler.put($page, {item, id: item.id, type: 'add', after: before?.id}));\n  return $item;\n};\n\nconst replaceItem = function($item, type, item) {\n  const newItem = $.extend({}, item);\n  $item.empty().off();\n  $item.removeClass(type).addClass(newItem.type);\n  const $page = $item.parents('.page:first');\n  try {\n    $item.data('pageElement', $page);\n    $item.data('item', newItem);\n    plugin.getPlugin(item.type, function(plugin) {\n      plugin.emit($item, newItem);\n      plugin.bind($item, newItem);\n    });\n  } catch (err) {\n    $item.append(`<p class='error'>${err}</p>`);\n  }\n  return pageHandler.put($page, {type: 'edit', id: newItem.id, item: newItem});\n};\n\nmodule.exports = {createItem, removeItem, getItem, replaceItem};\n", "// Dialog manages a single popup window that is used to present a\n// dialog used for detail display, usually on double click.\n\nconst open = function(title, html) {\n  let body = html;\n  if (typeof html === 'object') {\n    body = html[0].outerHTML;\n  }\n\n  const dialogWindow = window.open('/dialog/#', 'dialog', 'popup,height=600,width=800');\n\n  if (dialogWindow.location.pathname !== '/dialog/') {\n    // this will only happen when popup is first opened.\n    dialogWindow.addEventListener('load', event => dialogWindow.postMessage({ title, body }, window.origin));\n  } else {\n    dialogWindow.postMessage({ title, body }, window.origin);\n  }\n};\n\nmodule.exports = { open };\n", "// The function resolveLinks converts link markup to html syntax.\n// The html will have a search path (the resolutionContext) encoded\n// into the title of <a> tags it generates.\n\nlet escape, resolve;\nconst {\n  asSlug\n} = require('./page');\n\nmodule.exports = (resolve = {});\n\nresolve.resolutionContext = [];\n\nresolve.escape = (escape = string => (string||'')\n  .replace(/&/g, '&amp;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;'));\n\nresolve.resolveFrom = function(addition, callback) {\n  resolve.resolutionContext.push(addition);\n  try {\n    callback();\n  } finally {\n    resolve.resolutionContext.pop();\n  }\n};\n\n// resolveLinks takes a second argument which is a substitute text sanitizer.\n// Plugins that do their own markup should insert themselves here but they\n// must escape html as part of their processing. Sanitizers must pass markers\u301612\u3017.\n\nresolve.resolveLinks = function(string, sanitize=escape) {\n  const stashed = [];\n\n  const stash = function(text) {\n    const here = stashed.length;\n    stashed.push(text);\n    return `\u3016${here}\u3017`;\n  };\n\n  const unstash = (match, digits) => stashed[+digits];\n\n  const internal = function(match, name) {\n    const slug = asSlug(name);\n    const styling = name === name.trim() ? 'internal' : 'internal spaced';\n    if (slug.length) {\n      return stash(`<a class=\"${styling}\" href=\"/${slug}.html\" data-page-name=\"${slug}\" title=\"${resolve.resolutionContext.join(' => ')}\">${escape(name)}</a>`);\n    } else {\n      return match;\n    }\n  };\n\n  const external = (match, href, protocol, rest) => stash(`<a class=\"external\" target=\"_blank\" href=\"${href}\" title=\"${href}\" rel=\"nofollow\">${escape(rest)} <img src=\"/images/external-link-ltr-icon.png\"></a>`);\n\n  // markup conversion happens in four phases:\n  //   - unexpected markers are adulterated\n  //   - links are found, converted, and stashed away properly escaped\n  //   - remaining text is sanitized and/or escaped\n  //   - unique markers are replaced with unstashed links\n\n  string = (string||'')\n    .replace(/\u3016(\\d+)\u3017/g, \"\u3016 $1 \u3017\")\n    .replace(/\\[\\[([^\\]]+)\\]\\]/gi, internal)\n    .replace(/\\[((http|https|ftp):.*?) (.*?)\\]/gi, external);\n  return sanitize(string)\n    .replace(/\u3016(\\d+)\u3017/g, unstash);\n};\n", "// Refresh will fetch a page and use it to fill a dom\n// element that has been ready made to hold it.\n//\n// cycle: have a div, $(this), with id = slug\n// whenGotten: have a pageObject we just fetched\n// buildPage: have a pageObject from somewhere\n// rebuildPage: have a key from saving pageObject in lineup\n// renderPageIntoPageElement: have $page annotated from pageObject\n// pageObject.seqItems: get back each item sequentially\n// plugin.do: have $item in dom for item\n//\n// The various calling conventions are due to async\n// requirements and the work of many hands.\n\nconst pageHandler = require('./pageHandler');\nconst plugin = require('./plugin');\nconst state = require('./state');\nconst neighborhood = require('./neighborhood');\nconst addToJournal = require('./addToJournal');\nconst actionSymbols = require('./actionSymbols');\nconst lineup = require('./lineup');\nconst resolve = require('./resolve');\nconst random = require('./random');\n\nconst pageModule = require('./page');\nconst {\n  newPage\n} = pageModule;\nconst {\n  asSlug\n} = pageModule;\nconst {\n  pageEmitter\n} = pageModule;\n\n\nconst getItem = function($item) {\n  if ($($item).length > 0) { return $($item).data(\"item\") || $($item).data('staticItem'); }\n};\n\nconst aliasItem = function($page, $item, oldItem) {\n  const item = $.extend({}, oldItem);\n  $item.data('item', item);\n  const pageObject = lineup.atKey($page.data('key'));\n  if (pageObject.getItem(item.id) != null) {\n    if (!item.alias) { item.alias = item.id; }\n    item.id = random.itemId();\n    $item.attr('data-id', item.id);\n    $item.data('id', item.id);\n    $item.data('item').id = item.id;\n  } else if (item.alias != null) {\n    if (pageObject.getItem(item.alias) == null) {\n      item.id = item.alias;\n      delete item.alias;\n      $item.attr('data-id', item.id);\n    }\n  }\n  return item;\n};\n\nconst equals = (a, b) => a && b && (a.get(0) === b.get(0));\nconst getStoryItemOrder = $story => $story.children().map((_, value) => $(value).attr('data-id')).get();\n\nconst handleDrop = function(evt, ui, originalIndex, originalOrder) {\n  let dragAttribution, index;\n  const $item = ui.item;\n\n  let item = getItem($item);\n  const $sourcePage = $item.data('pageElement');\n  const sourceIsReadOnly = $sourcePage.hasClass('ghost') || $sourcePage.hasClass('remote');\n\n  if (!$sourcePage.hasClass('ghost')) {\n    dragAttribution = {\n      page: $sourcePage.data().data['title']\n    };\n    if ($sourcePage.data().site != null) {\n      dragAttribution['site'] = $sourcePage.data().site;\n    }\n  }\n\n  const $destinationPage = $item.parents('.page:first');\n  const destinationIsGhost = $destinationPage.hasClass('ghost');\n\n  const moveWithinPage = equals($sourcePage, $destinationPage);\n  const moveBetweenDuplicatePages = !moveWithinPage &&\n    !evt.shiftKey &&\n    ($sourcePage.attr('id') === $destinationPage.attr('id'));\n\n  const removedTo = {\n    page: $destinationPage.data().data['title']\n  };\n\n  if (destinationIsGhost || moveBetweenDuplicatePages) {\n    $(evt.target).sortable('cancel');\n    return;\n  }\n\n  if (moveWithinPage) {\n    const order = getStoryItemOrder($item.parents('.story:first'));\n    if (JSON.stringify(order) !==  JSON.stringify(originalOrder)) {\n      $('.shadow-copy').remove();\n      $item.empty();\n      index = $(\".item\").index($item);\n      if (originalIndex < index) { index = originalIndex; }\n      plugin.renderFrom(index);\n      pageHandler.put($destinationPage, {id: item.id, type: 'move', order});\n    }\n    return;\n  }\n  const copying = sourceIsReadOnly || evt.shiftKey;\n  if (copying) {\n    // If making a copy, update the temp clone so it becomes a true copy.\n    $('.shadow-copy').removeClass('shadow-copy')\n      .data($item.data()).attr({'data-id': $item.attr('data-id')});\n  } else {\n    pageHandler.put($sourcePage, {id: item.id, type: 'remove', removedTo});\n  }\n  // Either way, record the add to the new page\n  $item.data('pageElement', $destinationPage);\n  const $before = $item.prev('.item');\n  const before = getItem($before);\n  item = aliasItem($destinationPage, $item, item);\n  pageHandler.put($destinationPage,\n                  {id: item.id, type: 'add', item, after: before?.id, attribution: dragAttribution });\n  $('.shadow-copy').remove();\n  $item.empty();\n  $before.after($item);\n  index = $(\".item\").index($item);\n  if (originalIndex < index) { index = originalIndex; }\n  plugin.renderFrom(index);\n};\n\nconst changeMouseCursor = function(e, ui) {\n  const $sourcePage = ui.item.data('pageElement');\n  const sourceIsReadOnly = $sourcePage.hasClass('ghost') || $sourcePage.hasClass('remote');\n  const $destinationPage = ui.placeholder.parents('.page:first');\n  const destinationIsGhost = $destinationPage.hasClass('ghost');\n  const moveWithinPage = equals($sourcePage, $destinationPage);\n  const moveBetweenDuplicatePages = !moveWithinPage &&\n    ($sourcePage.attr('id') === $destinationPage.attr('id'));\n  const copying = sourceIsReadOnly || (e.shiftKey && !moveWithinPage);\n  if (destinationIsGhost || (moveBetweenDuplicatePages && !e.shiftKey)) {\n    $('body').css('cursor', 'no-drop');\n    return $('.shadow-copy').hide();\n  } else if (copying) {\n    $('body').css('cursor', 'copy');\n    return $('.shadow-copy').show();\n  } else {\n    $('body').css('cursor', 'move');\n    return $('.shadow-copy').hide();\n  }\n};\n\nconst initDragging = function($page) {\n  const origCursor = $('body').css('cursor');\n  const options = {\n    connectWith: '.page .story',\n    placeholder: 'item-placeholder',\n    forcePlaceholderSize: true,\n    delay: 150\n  };\n  const $story = $page.find('.story');\n  let originalOrder = null;\n  let originalIndex = null;\n  let dragCancelled = null;\n  const cancelDrag = function(e) {\n    if (e.which === 27) {\n      dragCancelled = true;\n      return $story.sortable('cancel');\n    }\n  };\n  return $story.sortable(options)\n    .on('sortstart', function(e, ui) {\n      const $item = ui.item;\n      originalOrder = getStoryItemOrder($story);\n      originalIndex = $('.item').index($item);\n      dragCancelled = false;\n      $('body').on('keydown', cancelDrag);\n      // Create a copy that we control since sortable removes theirs too early.\n      // Insert after the placeholder to prevent adding history when item not moved.\n      // Clear out the styling they add. Updates to jquery ui can affect this.\n      return $item.clone().insertAfter(ui.placeholder).hide().addClass(\"shadow-copy\")\n        .css({\n          width: '',\n          height: '',\n          position: '',\n          zIndex: ''\n        }).removeAttr('data-id');\n  }).on('sort', changeMouseCursor)\n    .on('sortstop', function(e, ui) {\n      $('body').css('cursor', origCursor).off('keydown', cancelDrag);\n      if (!dragCancelled) { handleDrop(e, ui, originalIndex, originalOrder); }\n      return $('.shadow-copy').remove();\n  });\n};\n\nconst getPageObject = function($journal) {\n  const $page = $($journal).parents('.page:first');\n  return lineup.atKey($page.data('key'));\n};\n\nconst handleMerging = function(event, ui) {\n  const drag = getPageObject(ui.draggable);\n  const drop = getPageObject(event.target);\n  pageEmitter.dispatchEvent(new CustomEvent('show', { detail: drop.merge(drag)} ));\n};\n\nconst initMerging = function($page) {\n  const $journal = $page.find('.journal');\n  $journal.draggable({\n    revert: true,\n    appendTo: '.main',\n    scroll: false,\n    helper: 'clone'\n  });\n  $journal.droppable({\n    hoverClass: \"ui-state-hover\",\n    drop: handleMerging,\n    accept: '.journal'\n  });\n};\n\nconst initAddButton = $page => $page.find(\".add-factory\").on(\"click\", function(evt) {\n  if ($page.hasClass('ghost')) { return; }\n  evt.preventDefault();\n  createFactory($page);\n});\n\nvar createFactory = function($page) {\n  const item = {\n    type: \"factory\",\n    id: random.itemId()\n  };\n  const $item = $(\"<div />\", {class: \"item factory\"}).data('item',item).attr('data-id', item.id);\n  $item.data('pageElement', $page);\n  $page.find(\".story\").append($item);\n  plugin.do($item, item);\n  const $before = $item.prev('.item');\n  const before = getItem($before);\n  pageHandler.put($page, {item, id: item.id, type: \"add\", after: before?.id});\n};\n\nconst handleHeaderClick = function(e) {\n    e.preventDefault();\n    lineup.debugSelfCheck((Array.from($('.page')).map((each) => $(each).data('key'))));\n    const $page = $(e.target).parents('.page:first');\n    const crumbs = lineup.crumbs($page.data('key'), location.host);\n    const target = crumbs[0];\n    let prefix= wiki.site(target).getDirectURL('').split('/')[0];\n    if (prefix === '') {\n      prefix = window.location.protocol;\n    }\n    const newWindow = window.open(`${prefix}//${crumbs.join('/')}`, target);\n    newWindow.focus();\n  };\n\n\nconst emitHeader = function($header, $page, pageObject) {\n  let remote;\n  if (pageObject.isRecycler()) {\n    remote = 'recycler';\n  } else {\n    remote = pageObject.getRemoteSite(location.host);\n  }\n  const tooltip = pageObject.getRemoteSiteDetails(location.host);\n  $header.append(`\\\n<h1 title=\"${tooltip}\">\n  <span>\n    <a href=\"${pageObject.siteLineup()}\" target=\"${remote}\">\n      <img src=\"${wiki.site(remote).flag()}\" height=\"32px\" class=\"favicon\"></a>\n    ${resolve.escape(pageObject.getTitle())}\n  </span>\n</h1>\\\n`\n  );\n  $header.find('a').on('click', handleHeaderClick);\n};\n\nconst emitTimestamp = function($header, $page, pageObject) {\n  if ($page.attr('id').match(/_rev/)) {\n    $page.addClass('ghost');\n    $page.data('rev', pageObject.getRevision());\n    $header.append($(`\\\n<h2 class=\"revision\">\n  <span>\n    ${pageObject.getTimestamp()}\n  </span>\n</h2>\\\n`\n    )\n    );\n  }\n};\n\nconst emitControls = $journal => $journal.append(`\\\n<div class=\"control-buttons\">\n<a href=\"#\" class=\"button fork-page\" title=\"fork this page\">${actionSymbols.fork}</a>\n<a href=\"#\" class=\"button add-factory\" title=\"add paragraph\">${actionSymbols.add}</a>\n</div>\\\n`\n);\n\nconst emitBacklinks = function($backlinks, pageObject) {\n  const slug = pageObject.getSlug();\n  const backlinks = neighborhood.backLinks(slug);\n  if (Object.keys(backlinks).length > 0) {\n    const links = [];\n\n    for (var linkSlug in backlinks) {\n      var backlink = backlinks[linkSlug];\n      backlink.sites.sort((a, b) => (a.date || 0) < (b.date || 0));\n      var flags = [];\n      for (var i = 0; i < backlink.sites.length; i++) {\n        var site = backlink.sites[i];\n        if (i < 10) {\n          var joint = backlink.sites[i-1]?.date === site.date ? \"\" : \" \";\n          flags.unshift(joint);\n          flags.unshift(`\\\n<img class=\"remote\"\n    src=\"${wiki.site(site.site).flag()}\"\n    data-slug=\"${linkSlug}\"\n    data-site=\"${site.site}\"\n    data-id=\"${site.itemId}\"\n    title=\"${site.site}\\n${wiki.util.formatElapsedTime(site.date)}\">\\\n`\n          );\n        } else if (i === 10) {\n          flags.unshift(' \u22EF ');\n        }\n      }\n\n      var linkBack = resolve.resolveLinks(`[[${backlink.title}]]`);\n      links.push(`\\\n<div style=\"clear: both;\">\n  <div style=\"float: left;\">${linkBack}</div>\n  <div style=\"text-align: right;\"> ${flags.join('')} </div>\n</div>\\\n`\n      );\n    }\n\n    if (links) {\n      $backlinks.append(`\\\n<details>\n  <summary>${links.length} pages link here:</summary>\n  ${links.join(\"\\n\")}\n</details>\\\n`\n      );\n    }\n  }\n};\n\nconst emitFooter = function($footer, pageObject) {\n  const host = pageObject.getRemoteSite(location.host);\n  const slug = pageObject.getSlug();\n  $footer.append(`\\\n<a class=\"show-page-license\" href=\"https://creativecommons.org/licenses/by-sa/4.0/\" target=\"_blank\">CC BY-SA 4.0</a> .\n<a class=\"show-page-source\" href=\"${wiki.site(host).getDirectURL(slug)}.json\" title=\"source\">JSON</a> .\n<a href= \"${wiki.site(host).getDirectURL(slug)}.html\" date-slug=\"${slug}\" target=\"${host}\">${host} </a> .\n<a href= \"#\" class=search>search</a>\\\n`\n  );\n};\n\nconst editDate = function(journal) {\n  const iterable = journal || [];\n  for (let i = iterable.length - 1; i >= 0; i--) {\n    var action = iterable[i];\n    if (action.date && (action.type !== 'fork')) { return action.date; }\n  }\n  return undefined;\n};\n\nconst emitTwins = function($page) {\n  let viewing;\n  let remoteSite, item;\n  const page = $page.data('data');\n  if (!page) { return; }\n  let site = $page.data('site') || window.location.host;\n  if (['view', 'origin'].includes(site)) { site = window.location.host; }\n  const slug = asSlug(page.title);\n  if (viewing = editDate(page.journal)) {\n    let bin;\n    const bins = {newer:[], same:[], older:[]};\n    // {fed.wiki.org: [{slug: \"happenings\", title: \"Happenings\", date: 1358975303000, synopsis: \"Changes here ...\"}]}\n    for (remoteSite in neighborhood.sites) {\n      var info = neighborhood.sites[remoteSite];\n      if ((remoteSite !== site) && (info.sitemap != null)) {\n        for (item of info.sitemap) {\n          if (item.slug === slug) {\n            bin = item.date > viewing ? bins.newer\n            : item.date < viewing ? bins.older\n            : bins.same;\n            bin.push({remoteSite, item});\n          }\n        }\n      }\n    }\n    const twins = [];\n    // {newer:[remoteSite: \"fed.wiki.org\", item: {slug: ..., date: ...}, ...]}\n    for (var legend in bins) {\n      bin = bins[legend];\n      if (!bin.length) { continue; }\n      bin.sort((a, b) => a.item.date < b.item.date);\n      const flags = [];\n      for (let i = 0; i < bin.length; i++) {\n        ({remoteSite, item} = bin[i]);\n        if (i >= 8) { break; }\n        flags.push(`<img class=\"remote\"\nsrc=\"${wiki.site(remoteSite).flag()}\"\ndata-slug=\"${slug}\"\ndata-site=\"${remoteSite}\"\ntitle=\"${remoteSite}\">\\\n`);\n      }\n      twins.push(`${flags.join('&nbsp;')} ${legend}`);\n    }\n    if (twins) { $page.find('.twins').html(`<p><span>${twins.join(\", \")}</span></p>`); }\n  }\n};\n\nconst renderPageIntoPageElement = function(pageObject, $page) {\n  $page.data(\"data\", pageObject.getRawPage());\n  if (pageObject.isRemote()) { $page.data(\"site\", pageObject.getRemoteSite()); }\n\n  // console.log '.page keys ', ($(each).data('key') for each in $('.page'))\n  // console.log 'lineup keys', lineup.debugKeys()\n\n  resolve.resolutionContext = pageObject.getContext();\n\n  $page.empty();\n  const $paper = $(\"<div class='paper' />\");\n  $page.append($paper);\n  // TODO - simplify loop\n  const [$handleParent, $twins, $header, $story, $backlinks, $journal, $footer] = ['handle-parent', 'twins', 'header', 'story', 'backlinks', 'journal', 'footer'].map(function(className) {\n    if ((className !== 'journal') || $('.editEnable').is(':visible')) { return $('<div />').addClass(className).appendTo($paper); }\n  });\n  const $pagehandle = $('<div />').addClass('page-handle').appendTo($handleParent);\n\n  emitHeader($header, $page, pageObject);\n  emitTimestamp($header, $page, pageObject);\n\n  let promise = pageObject.seqItems(function(item, done) {\n      const $item = $(`<div class=\"item ${item.type}\" data-id=\"${item.id}\">`);\n      $story.append($item);\n      $item.data('item', item);\n      return done();\n  });\n  promise = promise.then(function() {\n    const index = $(\".page\").index($page[0]);\n    const itemIndex = $('.item').index($($('.page')[index]).find('.item'));\n    return plugin.renderFrom(itemIndex);}).then(() => $page);\n\n  if ($('.editEnable').is(':visible')) {\n    pageObject.seqActions(function(each, done) {\n      if (each.separator) { addToJournal($journal, each.separator); }\n      addToJournal($journal, each.action);\n      return done();\n    });\n  }\n\n  emitTwins($page);\n  emitBacklinks($backlinks, pageObject);\n  if ($('.editEnable').is(':visible')) { emitControls($journal); }\n  emitFooter($footer, pageObject);\n  $pagehandle.css({\n    height: `${$story.position().top-$handleParent.position().top-5}px`\n  });\n  return promise;\n};\n\n\nconst createMissingFlag = function($page, pageObject) {\n  if (!pageObject.isRemote()) {\n    $('img.favicon',$page).on('error', () => plugin.get('favicon', favicon => favicon.create()));\n  }\n};\n\nconst rebuildPage = function(pageObject, $page) {\n  if (pageObject.isLocal()) { $page.addClass('local'); }\n  if (pageObject.isRecycler()) { $page.addClass('recycler'); }\n  if (pageObject.isRemote()) { $page.addClass('remote'); }\n  if (pageObject.isPlugin()) { $page.addClass('plugin'); }\n\n  const promise = renderPageIntoPageElement(pageObject, $page);\n  createMissingFlag($page, pageObject);\n\n  //STATE -- update url when adding new page, removing others\n  state.setUrl();\n\n  if ($('.editEnable').is(':visible')) {\n    initDragging($page);\n    initMerging($page);\n    initAddButton($page);\n  }\n  return promise;\n};\n\nconst buildPage = function(pageObject, $page) {\n  const pageKey =lineup.addPage(pageObject);\n  $page.data('key', pageKey);\n  $page.get(0).dataset.key = pageKey;\n  return rebuildPage(pageObject, $page);\n};\n\nconst newFuturePage = function(title, create) {\n  const slug = asSlug(title);\n  const pageObject = newPage();\n  pageObject.setTitle(title);\n  const hits = [];\n  for (var site in neighborhood.sites) {\n    var info = neighborhood.sites[site];\n    if (info.sitemap != null) {\n      var result = info.sitemap.find(each => each.slug === slug);\n      if (result != null) {\n        hits.push({\n          \"type\": \"reference\",\n          \"site\": site,\n          \"slug\": slug,\n          \"title\": result.title || slug,\n          \"text\": result.synopsis || ''\n        });\n      }\n    }\n  }\n  if (hits.length > 0) {\n    pageObject.addItem({\n      'type': 'future',\n      'text': 'We could not find this page where it was expected.',\n      'title': title,\n      'create': create,\n      'context': pageHandler.context.filter(c => !['view', 'origin', 'local'].includes(c))\n    });\n    pageObject.addItem({\n      'type': 'paragraph',\n      'text': \"We did find possible duplicate in the current neighborhood.\"\n    });\n    for (var hit of hits) { pageObject.addItem(hit); }\n  } else {\n    pageObject.addItem({\n      'type': 'future',\n      'text': 'We could not find this page.',\n      'title': title,\n      'create': create,\n      'context': pageHandler.context.filter(c => !['view', 'origin', 'local'].includes(c))\n    });\n  }\n  return pageObject;\n};\n\nconst cycle = function($page) {\n  var promise = new Promise(function(resolve, _reject) {\n    const [slug, rev] = $page.attr('id').split('_rev');\n    let title = $page.find('.header h1').text().trim();\n    const pageInformation = {\n      slug,\n      rev,\n      site: $page.data('site')\n    };\n\n    const whenNotGotten = function() {\n      const link = $(`a.internal[href=\"/${slug}.html\"]:last`);\n      title = title || link.text() || slug;\n      const key = link.parents('.page').data('key');\n      const create = lineup.atKey(key)?.getCreate();\n      const pageObject = newFuturePage(title);\n      promise = buildPage( pageObject, $page);\n      promise\n        .then($page => $page.addClass('ghost'));\n      return resolve(promise);\n    };\n\n    const whenGotten = function(pageObject) {\n      promise = buildPage( pageObject, $page);\n      for (var site of pageObject.getNeighbors(location.host)) {\n        neighborhood.registerNeighbor(site);\n      }\n      return resolve(promise);\n    };\n\n    return pageHandler.get({\n      whenGotten,\n      whenNotGotten,\n      pageInformation\n    });\n  });\n  return promise;\n};\n\nmodule.exports = {cycle, emitTwins, buildPage, rebuildPage, newFuturePage};\n", "// Here is where we attach federated semantics to internal\n// links. Call doInternalLink to add a new page to the display\n// given a page name, a place to put it an an optional site\n// to retrieve it from.\n\nconst lineup = require('./lineup');\nconst active = require('./active');\nconst refresh = require('./refresh');\nconst {asTitle, asSlug, pageEmitter} = require('./page');\n\nconst createPage = function(name, loc, title=null) {\n  let site;\n  if (loc && (loc !== 'view')) { site = loc; }\n  if (!title) { title = asTitle(name); }\n  const $page = $(`\\\n<div class=\"page\" id=\"${name}\" tabindex=\"-1\">\n  <div class=\"paper\">\n    <div class=\"twins\"> <p> </p> </div>\n    <div class=\"header\">\n      <h1> <img class=\"favicon\" src=\"${wiki.site(site).flag()}\" height=\"32px\"> ${title} </h1>\n    </div>\n  </div>\n</div>\\\n`\n  );\n  if (site) { $page.data('site', site); }\n  return $page;\n};\n\nconst showPage = (name, loc, title=null) => createPage(name, loc, title).appendTo('.main').each((_i, e) => refresh.cycle($(e)));\n\nconst doInternalLink = function(title, $page, site=null) {\n  const slug = asSlug(title);\n  if ($page) { $($page).nextAll().remove(); }\n  if ($page) { lineup.removeAllAfterKey($($page).data('key')); }\n  showPage(slug, site, title);\n  active.set($('.page').last());\n};\n\nconst showResult = function(pageObject, options={}) {\n  if (options.$page) { $(options.$page).nextAll().remove(); }\n  if (options.$page) { lineup.removeAllAfterKey($(options.$page).data('key')); }\n  let slug = pageObject.getSlug();\n  if (options.rev != null) { slug += `_rev${options.rev}`; }\n  const $page = createPage(slug).addClass('ghost');\n  $page.appendTo($('.main'));\n  refresh.buildPage( pageObject, $page );\n  active.set($('.page').last());\n};\n\npageEmitter.addEventListener('show', (event) => {\n  // console.log('pageEmitter handling', page)\n  showResult(event.detail)\n});\n\nmodule.exports = {createPage, doInternalLink, showPage, showResult};\n", "// Editor provides a small textarea for editing wiki markup.\n// It can split and join paragraphs markup but leaves other\n// types alone assuming they will interpret multiple lines.\n\nconst plugin = require('./plugin');\nconst itemz = require('./itemz');\nconst pageHandler = require('./pageHandler');\nconst link = require('./link');\nconst random = require('./random');\n\n\n// Editor takes a div and an item that goes in it.\n// Options manage state during splits and joins.\n// Options are available to plugins but rarely used.\n//\n//   caret: position -- sets the cursor at the point of join\n//   append: true -- sets the cursor to end and scrolls there\n//   after: id -- new item to be added after id\n//   sufix: text -- editor opens with unsaved suffix appended\n//   field: 'text' -- editor operates on this field of the item\n\nconst escape = string => string\n  .replace(/&/g, '&amp;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n\nvar textEditor = function($item, item, option) {\n  // console.log 'textEditor', item.id, option\n  let enterCount;\n  if (option == null) { option = {}; }\n  if (item.type === 'markdown') { enterCount = 0; }\n  if (!$('.editEnable').is(':visible')) { return; }\n\n  const keydownHandler = function(e) {\n\n    if (e.which === 27) { //esc for save\n      e.preventDefault();\n      $textarea.trigger('focusout');\n      return false;\n    }\n\n    if ((e.ctrlKey || e.metaKey) && (e.which === 83)) { //ctrl-s for save\n      e.preventDefault();\n      $textarea.trigger('focusout');\n      return false;\n    }\n\n    if ((e.ctrlKey || e.metaKey) && (e.which === 73)) { //ctrl-i for information\n      let page;\n      e.preventDefault();\n      if (!e.shiftKey) { page = $(e.target).parents('.page'); }\n      link.doInternalLink(`about ${item.type} plugin`, page);\n      return false;\n    }\n\n    if ((e.ctrlKey || e.metaKey) && (e.which === 77)) { //ctrl-m for menu\n      e.preventDefault();\n      $item.removeClass(item.type).addClass(item.type = 'factory');\n      $textarea.trigger('focusout');\n      return false;\n    }\n\n    // provides automatic new paragraphs on enter and concatenation on backspace\n    if ((item.type === 'paragraph') || (item.type === 'markdown')) {\n      let suffix;\n      const sel = getSelectionPos($textarea); // position of caret or selected text coords\n\n      if ((e.which === $.ui.keyCode.BACKSPACE) && (sel.start === 0) && (sel.start === sel.end)) {\n        const $previous = $item.prev();\n        const previous = itemz.getItem($previous);\n        if (previous.type !== item.type) { return false; }\n        const caret = previous[option.field||'text'].length;\n        suffix = $textarea.val();\n        $textarea.val(''); // Need current text area to be empty. Item then gets deleted.\n        textEditor($previous, previous, {caret, suffix});\n        return false;\n      }\n\n      if (e.which === $.ui.keyCode.ENTER) {\n        // console.log \"Type: #{item.type}, enterCount: #{enterCount}\"\n        if (!sel) { return false; }\n        if (item.type === 'markdown') {\n          enterCount++;\n        }\n        // console.log \"Type: #{item.type}, enterCount: #{enterCount}\"\n        if ((item.type === 'paragraph') || ((item.type === 'markdown') && (enterCount === 2))) {\n          const $page = $item.parents('.page');\n          const text = $textarea.val();\n          const prefix = text.substring(0, sel.start).trim();\n          suffix = text.substring(sel.end).trim();\n          if (prefix === '') {\n            $textarea.val(suffix);\n            $textarea.trigger('focusout');\n            spawnEditor($page, $item.prev(), item.type, prefix);\n          } else {\n            $textarea.val(prefix);\n            $textarea.trigger('focusout');\n            spawnEditor($page, $item, item.type, suffix);\n          }\n          return false;\n        }\n      } else {\n        if (item.type === 'markdown') { enterCount = 0; }\n      }\n    }\n  };\n\n  const focusoutHandler = function() {\n    $item.removeClass('textEditing');\n    $textarea.off();\n    const $page = $item.parents('.page:first');\n    if (item[option.field||'text'] = $textarea.val()) {\n      // Remove output and source styling as type may have changed.\n      $item.removeClass(\"output-item\");\n      $item.removeClass((_index, className) => (className.match(/\\S+-source/) || []).join(\" \"));\n      plugin.do($item.empty(), item);\n      if (option.after) {\n        if (item[option.field||'text'] === '') { return; }\n        pageHandler.put($page, {type: 'add', id: item.id, item, after: option.after});\n      } else {\n        if (item[option.field||'text'] === original) { return; }\n        pageHandler.put($page, {type: 'edit', id: item.id, item});\n      }\n    } else {\n      if (!option.after) {\n        pageHandler.put($page, {type: 'remove', id: item.id});\n      }\n      const index = $(\".item\").index($item);\n      $item.remove();\n      plugin.renderFrom(index);\n    }\n  };\n\n  if ($item.hasClass('textEditing')) { return; }\n  $item.addClass('textEditing');\n  $item.off();\n  var original = item[option.field||'text'] || '';\n  var $textarea = $(`<textarea>${escape(original)}${escape(option.suffix || '')}</textarea>`)\n    .on('focusout', focusoutHandler)\n    .on('keydown', keydownHandler);\n  $item.html($textarea);\n  if (option.caret) {\n    setCaretPosition($textarea, option.caret);\n  } else if (option.append) { // we want the caret to be at the end\n    setCaretPosition($textarea, $textarea.val().length);\n    //scrolls to bottom of text area\n    $textarea.scrollTop($textarea[0].scrollHeight - $textarea.height());\n  } else {\n    $textarea.trigger('focus');\n  }\n};\n\nvar spawnEditor = function($page, $before, type, text) {\n  const item = {\n    type,\n    id: random.itemId(),\n    text\n  };\n  const $item = $(`<div class=\"item ${item.type}\" data-id=${item.id}></div>`);\n  $item\n    .data('item', item)\n    .data('pageElement', $page);\n  $before.after($item);\n  const before = itemz.getItem($before);\n  textEditor($item, item, {after: before?.id});\n};\n\n\n// If the selection start and selection end are both the same,\n// then you have the caret position. If there is selected text,\n// the browser will not tell you where the caret is, but it will\n// either be at the beginning or the end of the selection\n// (depending on the direction of the selection).\n\nvar getSelectionPos = function($textarea) {\n  const el = $textarea.get(0); // gets DOM Node from from jQuery wrapper\n  if (document.selection) { // IE\n    el.focus();\n    const sel = document.selection.createRange();\n    sel.moveStart('character', -el.value.length);\n    const iePos = sel.text.length;\n    return {start: iePos, end: iePos};\n  } else {\n    return {start: el.selectionStart, end: el.selectionEnd};\n  }\n};\n\nvar setCaretPosition = function($textarea, caretPos) {\n  const el = $textarea.get(0);\n  if (el) {\n    if (el.createTextRange) { // IE\n      const range = el.createTextRange();\n      range.move(\"character\", caretPos);\n      range.select();\n    } else { // rest of the world\n      el.setSelectionRange(caretPos, caretPos);\n    }\n    el.focus();\n  }\n};\n\n// # may want special processing on paste eventually\n// textarea.bind 'paste', (e) ->\n//   console.log 'textedit paste', e\n//   console.log e.originalEvent.clipboardData.getData('text')\n\nmodule.exports = {textEditor};\n", "/*\n * Uses of plugin getScript to load the security plugin's client code\n */\n\nlet security;\nmodule.exports = (security = {});\n\nconst plugin = require('./plugin');\n\nmodule.exports = user => plugin.getScript(\"/security/security.js\", () => window.plugins.security.setup(user));\n", "// We have exposed many parts of the core javascript to dynamically\n// loaded plugins through bindings in the global \"wiki\". We expect\n// to deprecate many of these as the plugin api matures. We once used\n// the global to communicate between core modules but have now\n// moved all of that responsibility onto browserify.\n\n// We have canvased plugin repos in github.com/fedwiki to find\n// the known uses of wiki globals. We notice that most entry\n// points are used. We mark unused entries with ##.\n\nconst wiki = {};\n\n// known use: (eventually all server directed xhr and some tags)\n\nconst siteAdapter = require('./siteAdapter');\nwiki.local = siteAdapter.local;\nwiki.origin = siteAdapter.origin;\nwiki.recycler = siteAdapter.recycler;\nwiki.site = siteAdapter.site;\n\n// known use: wiki.asSlug wiki-plugin-reduce/client/reduce.coffee:\n\nwiki.asSlug = require('./page').asSlug;\nwiki.newPage = require('./page').newPage;\n\n// known use: wiki.createItem wiki-plugin-parse/client/parse.coffee:\n// known use: wiki.removeItem wiki-plugin-parse/client/parse.coffee:\n// known use: wiki.getItem  wiki-plugin-changes/client/changes.coffee:\n\nconst itemz = require('./itemz');\nwiki.removeItem = itemz.removeItem;\nwiki.createItem = itemz.createItem;\nwiki.getItem = itemz.getItem;\n\n// known use: wiki.dialog wiki-plugin-changes/client/changes.coffee:\n// known use: wiki.dialog wiki-plugin-chart/client/chart.coffee:\n// known use: wiki.dialog wiki-plugin-data/client/data.coffee:\n// known use: wiki.dialog wiki-plugin-efficiency/client/efficiency.coffee:\n// known use: wiki.dialog wiki-plugin-linkmap/client/linkmap.coffee:\n// known use: wiki.dialog wiki-plugin-method/client/method.coffee:\n// known use: wiki.dialog wiki-plugin-radar/client/radar.coffee:\n// known use: wiki.dialog wiki-plugin-reduce/client/reduce.coffee:\n// known use: wiki.dialog wiki-plugin-txtzyme/client/txtzyme.coffee:\n\nconst dialog = require('./dialog');\nwiki.dialog = dialog.open;\n\n// known use: wiki.doInternalLink wiki-plugin-force/client/force.coffee:\n// known use: wiki.doInternalLink wiki-plugin-radar/client/radar.coffee:\n\nconst link = require('./link');\nwiki.createPage = link.createPage; //#\nwiki.doInternalLink = link.doInternalLink;\nwiki.showResult = link.showResult;\n\n// known use: wiki.getScript  wiki-plugin-bars/client/bars.coffee:\n// known use: wiki.getScript  wiki-plugin-code/client/code.coffee:\n// known use: wiki.getScript  wiki-plugin-force/client/force.coffee:\n// known use: wiki.getScript  wiki-plugin-line/client/line.coffee:\n// known use: wiki.getScript  wiki-plugin-map/client/map.coffee:\n// known use: wiki.getScript  wiki-plugin-mathjax/client/mathjax.coffee:\n// known use: wiki.getScript  wiki-plugin-pushpin/client/pushpin.coffee:\n// known use: wiki.getScript  wiki-plugin-radar/client/radar.coffee:\n// known use: wiki.getPlugin  wiki-plugin-reduce/client/reduce.coffee:\n// known use: wiki.doPlugin wiki-plugin-changes/client/changes.coffee:\n// known use: wiki.registerPlugin wiki-plugin-changes/client/changes.coffee:\n\nconst plugin = require('./plugin');\nwiki.getScript = plugin.getScript;\nwiki.getPlugin = plugin.getPlugin;\nwiki.doPlugin = plugin.doPlugin;\nwiki.registerPlugin = plugin.registerPlugin;\nwiki.renderFrom = plugin.renderFrom;\n\n// known use: wiki.getData  wiki-plugin-bars/client/bars.coffee:\n// known use: wiki.getData  wiki-plugin-calculator/client/calculator.coffee:\n// known use: wiki.getData  wiki-plugin-force/client/force.coffee:\n// known use: wiki.getData  wiki-plugin-line/client/line.coffee:\n\nwiki.getData = function(vis) {\n  let who;\n  if (vis) {\n    const idx = $('.item').index(vis);\n    who = $(`.item:lt(${idx})`).filter('.chart,.data,.calculator').last();\n    if (who) { return who.data('item').data; } else { return {}; }\n  } else {\n    who = $('.chart,.data,.calculator').last();\n    if (who) { return who.data('item').data; } else { return {}; }\n  }\n};\n\n// known use: wiki.getDataNodes wiki-plugin-metabolism/client/metabolism.coffee:\n// known use: wiki.getDataNodes wiki-plugin-method/client/method.coffee:\n\nwiki.getDataNodes = function(vis) {\n  let who;\n  if (vis) {\n    const idx = $('.item').index(vis);\n    who = $(`.item:lt(${idx})`).filter('.chart,.data,.calculator').toArray().reverse();\n    return $(who);\n  } else {\n    who = $('.chart,.data,.calculator').toArray().reverse();\n    return $(who);\n  }\n};\n\n// known use: wiki.log  wiki-plugin-calculator/client/calculator.coffee:\n// known use: wiki.log  wiki-plugin-calendar/client/calendar.coffee:\n// known use: wiki.log  wiki-plugin-changes/client/changes.coffee:\n// known use: wiki.log  wiki-plugin-efficiency/client/efficiency.coffee:\n// known use: wiki.log  wiki-plugin-parse/client/parse.coffee:\n// known use: wiki.log  wiki-plugin-radar/client/radar.coffee:\n// known use: wiki.log  wiki-plugin-txtzyme/client/txtzyme.coffee:\n\nwiki.log = function(...things) {\n  if (console?.log) { console.log(...(things || [])); }\n};\n\n// known use: wiki.neighborhood wiki-plugin-activity/client/activity.coffee:\n// known use: wiki.neighborhoodObject  wiki-plugin-activity/client/activity.coffee:\n// known use: wiki.neighborhoodObject  wiki-plugin-roster/client/roster.coffee:\n\n\nconst neighborhood = require('./neighborhood');\nwiki.neighborhood = neighborhood.sites;\nwiki.neighborhoodObject = neighborhood;\n\n// known use: wiki.pageHandler  wiki-plugin-changes/client/changes.coffee:\n// known use: wiki.pageHandler  wiki-plugin-map/client/map.coffee:\n\nconst pageHandler = require('./pageHandler');\nwiki.pageHandler = pageHandler;\nwiki.useLocalStorage = pageHandler.useLocalStorage; //#\n\n// known use: wiki.resolveFrom  wiki-plugin-federatedwiki/client/federatedWiki.coffee:\n// known use: wiki.resolveLinks wiki-plugin-chart/client/chart.coffee:\n// known use: wiki.resolveLinks wiki-plugin-data/client/data.coffee:\n// known use: wiki.resolveLinks wiki-plugin-efficiency/client/efficiency.coffee:\n// known use: wiki.resolveLinks wiki-plugin-federatedwiki/client/federatedWiki.coffee:\n// known use: wiki.resolveLinks wiki-plugin-logwatch/client/logwatch.coffee:\n// known use: wiki.resolveLinks wiki-plugin-mathjax/client/mathjax.coffee:\n\nconst resolve = require('./resolve');\nwiki.resolveFrom = resolve.resolveFrom;\nwiki.resolveLinks = resolve.resolveLinks;\nwiki.resolutionContext = resolve.resolutionContext; //#\n\n// known use: wiki.textEditor wiki-plugin-bytebeat/client/bytebeat.coffee:\n// known use: wiki.textEditor wiki-plugin-calculator/client/calculator.coffee:\n// known use: wiki.textEditor wiki-plugin-calendar/client/calendar.coffee:\n// known use: wiki.textEditor wiki-plugin-code/client/code.coffee:\n// known use: wiki.textEditor wiki-plugin-data/client/data.coffee:\n// known use: wiki.textEditor wiki-plugin-efficiency/client/efficiency.coffee:\n// known use: wiki.textEditor wiki-plugin-federatedwiki/client/federatedWiki.coffee:\n// known use: wiki.textEditor wiki-plugin-mathjax/client/mathjax.coffee:\n// known use: wiki.textEditor wiki-plugin-metabolism/client/metabolism.coffee:\n// known use: wiki.textEditor wiki-plugin-method/client/method.coffee:\n// known use: wiki.textEditor wiki-plugin-pagefold/client/pagefold.coffee:\n// known use: wiki.textEditor wiki-plugin-parse/client/parse.coffee:\n// known use: wiki.textEditor wiki-plugin-radar/client/radar.coffee:\n// known use: wiki.textEditor wiki-plugin-reduce/client/reduce.coffee:\n// known use: wiki.textEditor wiki-plugin-txtzyme/client/txtzyme.coffee:\n\nconst editor = require('./editor');\nwiki.textEditor = editor.textEditor;\n\n// known use: wiki.util wiki-plugin-activity/client/activity.coffee:\n\nwiki.util = require('./util');\n\n// known use: wiki.security views/static.html\nwiki.security = require('./security');\n\n\n// known use: require wiki-clint/lib/synopsis wiki-node-server/lib/page.coffee\n// known use: require wiki-clint/lib/synopsis wiki-node-server/lib/leveldb.js\n// known use: require wiki-clint/lib/synopsis wiki-node-server/lib/mongodb.js\n// known use: require wiki-clint/lib/synopsis wiki-node-server/lib/redis.js\n\nwiki.createSynopsis = require('./synopsis'); //#\n\n// known uses: (none yet)\nwiki.lineup = require('./lineup');\n\nmodule.exports = wiki;\n", "// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n/*\n * decaffeinate suggestions:\n * DS207: Consider shorter variations of null checks (further review after merge of PR324)\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\n */\n// handle drops of wiki pages or thing that go on wiki pages\n// (we'll move decoding logic out of factory)\n\nconst isFile = function(event) {\n  let dt;\n  if ((dt = event.originalEvent.dataTransfer) != null) {\n    if (dt.types.includes('Files')) {\n      return dt.files[0];\n    }\n  }\n  return null;\n};\n\nconst isUrl = function(event) {\n  let dt;\n  if ((dt = event.originalEvent.dataTransfer) != null) {\n    if ((dt.types != null) && (dt.types.includes('text/uri-list') || dt.types.includes('text/x-moz-url'))) {\n      const url = dt.getData('URL');\n      if (url != null ? url.length : undefined) { return url; }\n    }\n  }\n  return null;\n};\n\nconst isPage = function(url) {\n  let found;\n  if (found = url.match(/^https?:\\/\\/([a-zA-Z0-9:.-]+)(\\/([a-zA-Z0-9:.-]+)\\/([a-z0-9-]+(_rev\\d+)?))+$/)) {\n    let origin;\n    const item = {};\n    [, origin, , item.site, item.slug, ] = found;\n    if (['view','local','origin'].includes(item.site)) { item.site = origin; }\n    return item;\n  }\n  return null;\n};\n\nconst isImage = function(url) {\n  const parsedURL = new URL(url);\n  if (parsedURL.pathname.match(/\\.(jpg|jpeg|png)$/i)) {\n    return url;\n  }\n  return null;\n};\n\nconst isSvg = function(url) {\n  const parsedURL = new URL(url);\n  if (parsedURL.pathname.match(/\\.(svg)$/i)) {\n    return url;\n  }\n  return null;\n};\n\nconst isVideo = function(url) {\n  let parsedURL = new URL(url);\n  // check if video dragged from search (Google)\n  try {\n    if (parsedURL.searchParams.get('source') === 'video') {\n      parsedURL = new URL(parsedURL.searchParams.get('url'));\n    }\n  } catch (error) {}\n\n\n  switch (parsedURL.hostname) {\n    case \"www.youtube.com\":\n      if (parsedURL.searchParams.get('list') != null) {\n        return {text: `YOUTUBE PLAYLIST ${parsedURL.searchParams.get('list')}`};\n      } else {\n        return {text: `YOUTUBE ${parsedURL.searchParams.get('v')}`};\n      }\n    case \"youtu.be\":  // should redirect to www.youtube.com, but...\n      if (parsedURL.searchParams.get('list') != null) {\n        return {text: `YOUTUBE PLAYLIST ${parsedURL.searchParams.get('list')}`};\n      } else {\n        return {text: `YOUTUBE ${parsedURL.pathname.substring(1)}`};\n      }\n    case \"vimeo.com\":\n      return {text: `VIMEO ${parsedURL.pathname.substring(1)}`};\n    case \"archive.org\":\n      return {text: `ARCHIVE ${parsedURL.pathname.substring(parsedURL.pathname.lastIndexOf('/') + 1)}`};\n    case \"tedxtalks.ted.com\":\n      return {text: `TEDX ${parsedURL.pathname.substring(parsedURL.pathname.lastIndexOf('/') + 1)}`};\n    case \"www.ted.com\":\n      return {text: `TED ${parsedURL.pathname.substring(parsedURL.pathname.lastIndexOf('/') + 1)}`};\n    default:\n      return null;\n  }\n};\n\n\nconst dispatch = handlers => (function(event) {\n  let file, handle, punt, url;\n  const stop = function(ignored) {\n    event.preventDefault();\n    event.stopPropagation();\n  };\n  if (url = isUrl(event)) {\n    let image, page, svg, video;\n    if (page = isPage(url)) {\n      if (handle = handlers.page) {\n        return stop(handle(page));\n      }\n    }\n    if (video = isVideo(url)) {\n      if (handle = handlers.video) {\n        return stop(handle(video));\n      }\n    }\n    if (image = isImage(url)) {\n      if (handle = handlers.image) {\n        return stop(handle(image));\n      }\n    }\n    if (svg = isSvg(url)) {\n      if (handle = handlers.svg) {\n        return stop(handle(svg));\n      }\n    }\n    punt = {url};\n  }\n  if (file = isFile(event)) {\n    if (handle = handlers.file) {\n      return stop(handle(file));\n    }\n    punt = {file};\n  }\n  if (handle = handlers.punt) {\n    if (!punt) { punt = {dt:event.dataTransfer, types:(event.dataTransfer != null ? event.dataTransfer.types : undefined)}; }\n    return stop(handle(punt));\n  }\n});\n\n\nmodule.exports = {dispatch};\n", "// Target handles hovers over items and actions. Other visible\n// items and actions with the same id will highlight. In some cases\n// an event is generated inviting other pages to scroll the item\n// into view. Target tracks hovering even when not requested so\n// that highlighting can be immediate when requested.\n\nlet targeting = false;\nlet $item = null;\nlet item = null;\nlet itemElem = null;\nlet action = null;\nlet consumed = null;\n\n\n\nconst bind = function() {\n  $(document)\n    .on('keydown', function(e) { if (e.keyCode === 16) { startTargeting(e); } })\n    .on('keyup', function(e) { if (e.keyCode === 16) { stopTargeting(e); } });\n  $('.main')\n    .on('mouseenter', '.item', enterItem)\n    .on('mouseleave', '.item', leaveItem)\n    .on('mouseenter', '.action', enterAction)\n    .on('mouseleave', '.action', leaveAction)\n    .on('align-item', '.page', alignItem)\n    .on('mouseenter', '.backlinks .remote', enterBacklink)\n    .on('mouseleave', '.backlinks .remote', leaveBacklink);\n};\n\n\nvar startTargeting = function(e) {\n  targeting = e.shiftKey;\n  if (targeting && $item) {\n    let id;\n    $('.emit').addClass('highlight');\n    if (id = item || action) {\n      let $page;\n      $(`[data-id=${id}]`).addClass('target');\n      const key = ($page = $(this).parents('.page:first')).data('key');\n      const place = $item.offset().top;\n      $('.page').trigger('align-item', {key, id:item, place});\n    }\n    if (itemElem) {\n      consumed = itemElem.consuming;\n      if (consumed) {\n        consumed.forEach(i => itemFor(i).addClass('consumed'));\n      }\n    }\n  }\n};\n\n\n\nvar stopTargeting = function(e) {\n  targeting = e.shiftKey;\n  if (!targeting) {\n    $('.emit').removeClass('highlight');\n    $('.item, .action').removeClass('target');\n    $('.item').removeClass('consumed');\n  }\n};\n\nconst pageFor = function(pageKey) {\n  const $page = $('.page').filter((_i, page) => $(page).data('key') === pageKey);\n  if ($page.length === 0) { return null; }\n  if ($page.length > 1) { console.log('warning: more than one page found for', key, $page); }\n  return $page;\n};\n\nvar itemFor = function(pageItem) {\n  const [pageKey, _item] = pageItem.split('/');\n  const $page = pageFor(pageKey);\n  if (!$page) { return null; }\n  $item = $page.find(`.item[data-id=${_item}]`);\n  if ($item.length === 0) { return null; }\n  if ($item.length > 1) { console.log('warning: more than one item found for', pageItem, $item); }\n  return $item;\n};\n\nvar enterItem = function(e) {\n  item = ($item = $(this)).attr('data-id');\n  itemElem = $item[0];\n  if (targeting) {\n    let $page;\n    $(`[data-id=${item}]`).addClass('target');\n    const key = ($page = $(this).parents('.page:first')).data('key');\n    const place = $item.offset().top;\n    $('.page').trigger('align-item', {key, id:item, place});\n    consumed = itemElem.consuming;\n    if (consumed) {\n      consumed.forEach(i => itemFor(i).addClass('consumed'));\n    }\n  }\n};\n\n\nvar leaveItem = function(e) {\n  if (targeting) {\n    $('.item, .action').removeClass('target');\n    $('.item').removeClass('consumed');\n  }\n  item = null;\n  $item = null;\n  itemElem = null;\n};\n\n\n\nvar enterAction = function(e) {\n  action = $(this).data('id');\n  if (targeting) {\n    $(`[data-id=${action}]`).addClass('target');\n    const key = $(this).parents('.page:first').data('key');\n    $('.page').trigger('align-item', {key, id:action});\n  }\n};\n\nvar leaveAction = function(e) {\n  if (targeting) {\n    $(`[data-id=${action}]`).removeClass('target');\n  }\n  action = null;\n};\n\n\nvar enterBacklink = function(e) {\n  item = ($item = $(this)).attr('data-id');\n  itemElem = $item[0];\n  if (targeting) {\n    let $page;\n    $(`[data-id=${item}]`).addClass('target');\n    const key = ($page = $(this).parents('.page:first')).data('key');\n    const place = $item.offset().top;\n    $('.page').trigger('align-item', {key, id: item, place});\n  }\n};\n\nvar leaveBacklink = function(e) {\n  if (targeting) {\n    $('.item, .action').removeClass('target');\n  }\n  item = null;\n  itemElem = null;\n};\n\nvar alignItem = function(e, align) {\n  const $page = $(this);\n  if ($page.data('key') === align.key) { return; }\n  $item = $page.find(`.item[data-id=${align.id}]`);\n  if (!$item.length) { return; }\n  const place = align.place || ($page.height()/2);\n  const offset = ($item.offset().top + $page.scrollTop()) - place;\n  $page.stop().animate({scrollTop: offset}, 'slow');\n};\n\n\n\nmodule.exports = {bind};\n", "// The license module explains federated wiki license terms\n// including the proper attribution of collaborators.\n\nconst resolve = require('./resolve');\nconst lineup = require('./lineup');\n\nconst cc = () => `\\\n<p>\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\">\n<img alt=\"Creative Commons License\" style=\"border-width:0\" src=\"https://i.creativecommons.org/l/by-sa/4.0/88x31.png\" /></a>\n</p><p>\nThis work is licensed under a\n<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\">\n  Creative Commons Attribution-ShareAlike 4.0 International License\n</a>.\n</p><p>\nThis license applies uniformly to all contributions\nby all authors. Where authors quote other sources\nthey do so within the terms of fair use or other\ncompatiable terms.\n</p>\\\n`;\n\nconst authors = function(page, site) {\n  if (!page.journal) { return \"\"; }\n  const done = {};\n  const list = [];\n  for (var action of page.journal.slice(0).reverse()) {\n    if (action.site) { site = action.site; }\n    if (action.attribution?.site) { site = action.attribution.site; }\n    if ((action.type !== 'fork') && !done[site]) {\n      var siteURL = wiki.site(site).getDirectURL(\"\");\n      var siteFlag = wiki.site(site).flag();\n      list.push(`<a href=\"${siteURL}\" target=\"_blank\"><img class=\"remote\" title=\"${site}\" src=\"${siteFlag}\"> ${site}</a>`);\n      done[site] = true;\n    }\n  }\n  if (!(list.length > 0)) { return \"\"; }\n  return `\\\n<p>\n  Author's Sites:\n</p><p>\n  ${list.join(\"<br>\")}\n</p>\\\n`;\n};\n\nconst provenance = function(action) {\n  if (!action?.provenance) { return \"\"; }\n  return `\\\n<p>\n  Created From:\n</p><p>\n  ${resolve.resolveLinks(action.provenance)}\n</p>\\\n`;\n};\n\nconst info = function($page) {\n  const pageObject = lineup.atKey($page.data('key'));\n  const page = pageObject.getRawPage();\n  const site = pageObject.getRemoteSite(location.hostname);\n  return cc() +\n  authors(page, site) +\n  provenance(page.journal[0]);\n};\n\n\nmodule.exports = {info};\n", "// The legacy module is what is left of the single javascript\n// file that once was Smallest Federated Wiki. Execution still\n// starts here and many event dispatchers are set up before\n// the user takes control.\n\nconst pageHandler = require('./pageHandler');\nconst state = require('./state');\nconst active = require('./active');\nconst refresh = require('./refresh');\nconst lineup = require('./lineup');\nconst drop = require('./drop');\nconst dialog = require('./dialog');\nconst link = require('./link');\nconst target = require('./target');\nconst license = require('./license');\nconst plugin = require('./plugin');\nconst util = require('./util');\n\nconst {\n  asSlug\n} = require('./page');\nconst {\n  newPage\n} = require('./page');\n\nconst preLoadEditors = catalog => catalog\n  .filter(entry => entry.editor)\n  .forEach(function(entry) {\n    console.log(`${entry.name} Plugin declares an editor, so pre-loading the plugin`);\n    wiki.getPlugin(entry.name.toLowerCase(), function(plugin) {\n        if (!plugin.editor || (typeof plugin.editor !== 'function')) {\n          console.log(`${entry.name} Plugin ERROR.\nCannot find \\`editor\\` function in plugin. Set \\`\"editor\": false\\` in factory.json or\nCorrect the plugin to include all three of \\`{emit, bind, editor}\\`\\\n`);\n        }\n      });\n  });\n\nwiki.origin.get('system/factories.json', function(error, data) {\n  if (Array.isArray(data)) {\n    window.catalog = data;\n    preLoadEditors(data);\n  }\n});\n\n$(function() {\n\n// FUNCTIONS used by plugins and elsewhere\n\n\n  const LEFTARROW = 37;\n  const RIGHTARROW = 39;\n\n  $(document).on(\"keydown\", function(event) {\n    const direction = event.which == LEFTARROW ? -1 : event.which == RIGHTARROW ? 1 : null\n    if (direction && !$(event.target).is(\":input\")) {\n      const pages = $('.page');\n      const newIndex = pages.index($('.active')) + direction;\n      if (0 <= newIndex && newIndex < pages.length) {\n        active.set(pages.eq(newIndex));\n      }\n    }\n    if ((event.ctrlKey || event.metaKey) && (event.which === 83)) { //ctrl-s for search\n      event.preventDefault();\n      $('input.search').trigger('focus');\n    }\n  });\n\n// HANDLERS for jQuery events\n\n  //STATE -- reconfigure state based on url\n  $(window).on('popstate', state.show);\n\n  $(document)\n    .ajaxError(function(event, request, settings) {\n      if ((request.status === 0) || (request.status === 404)) { return; }\n      console.log('ajax error', event, request, settings);\n  });\n\n  const commas = number => `${number}`.replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, \"$1,\");\n\n  const readFile = function(file) {\n    if (file?.type === 'application/json') {\n      const reader = new FileReader();\n      reader.onload = function(e) {\n        const {\n          result\n        } = e.target;\n        let pages = JSON.parse(result);\n        const resultPage = newPage();\n        resultPage.setTitle(`Import from ${file.name}`);\n        if (pages.title && pages.story && pages.journal) {\n          const slug = asSlug(pages.title);\n          const page = pages;\n          pages = {};\n          pages[slug] = page;\n          resultPage.addParagraph(`\\\nImport of one page\n(${commas(file.size)} bytes)\nfrom a page-json file dated ${file.lastModifiedDate}.\\\n`\n          );\n        } else {\n          resultPage.addParagraph(`\\\nImport of ${Object.keys(pages).length} pages\n(${commas(file.size)} bytes)\nfrom an export file dated ${file.lastModifiedDate}.\\\n`\n          );\n        }\n        resultPage.addItem({type: 'importer', pages});\n        link.showResult(resultPage);\n      };\n      reader.readAsText(file);\n    }\n  };\n\n  const deletePage = (pageObject, $page) => // console.log 'fork to delete'\n  pageHandler.delete(pageObject, $page, function(err) {\n    if (err) { return; }\n    // console.log 'server delete successful'\n    if (pageObject.isRecycler()) {\n      // make recycler page into a ghost\n      $page.addClass('ghost');\n    } else {\n      const futurePage = refresh.newFuturePage(pageObject.getTitle(), pageObject.getCreate());\n      pageObject.become(futurePage);\n      $page.attr('id', futurePage.getSlug());\n      refresh.rebuildPage(pageObject, $page);\n      $page.addClass('ghost');\n    }\n  });\n\n  const getTemplate = function(slug, done) {\n    if (!slug) { return done(null); }\n    console.log('getTemplate', slug);\n    pageHandler.get({\n      whenGotten(pageObject,siteFound) { done(pageObject); },\n      whenNotGotten() { done(null); },\n      pageInformation: {slug}});\n  };\n\n  const finishClick = function(e, name) {\n    let page;\n    e.preventDefault();\n    if (!e.shiftKey) { page = $(e.target).parents('.page'); }\n    link.doInternalLink(name, page, $(e.target).data('site'));\n    return false;\n  };\n\n  let originalPageIndex = null;\n  $('.main')\n    .sortable({handle: '.page-handle', cursor: 'grabbing'})\n      .on('sortstart', function(evt, ui) {\n        if (!ui.item.hasClass('page')) { return; }\n        const noScroll = true;\n        active.set(ui.item, noScroll);\n        originalPageIndex = $(\".page\").index(ui.item[0]);\n      })\n      .on('sort', function(evt, ui) {\n        if (!ui.item.hasClass('page')) { return; }\n        const $page = ui.item;\n        // Only mark for removal if there's more than one page (+placeholder) left\n        if ((evt.pageY < 0) && ($(\".page\").length > 2)) {\n          $page.addClass('pending-remove');\n        } else {\n          $page.removeClass('pending-remove');\n        }\n      })\n      .on('sortstop', function(evt, ui) {\n        if (!ui.item.hasClass('page')) { return; }\n        const $page = ui.item;\n        const $pages = $('.page');\n        let index = $pages.index($('.active'));\n        let firstItemIndex = $('.item').index($page.find('.item')[0]);\n        if ($page.hasClass('pending-remove')) {\n          if ($pages.length === 1) { return; }\n          lineup.removeKey($page.data('key'));\n          $page.remove();\n          active.set($('.page')[index]);\n        } else {\n          lineup.changePageIndex($page.data('key'), index);\n          active.set($('.active'));\n          if (originalPageIndex < index) {\n            index = originalPageIndex;\n            firstItemIndex = $('.item').index($($('.page')[index]).find('.item')[0]);\n          }\n        }\n        plugin.renderFrom(firstItemIndex);\n        state.setUrl();\n        if (window.debug) { state.debugStates(); }\n      })\n      .on('click', '.show-page-license', function(e) {\n        e.preventDefault();\n        const $page = $(this).parents('.page');\n        const title = $page.find('h1').text().trim();\n        dialog.open(`License for ${title}`, license.info($page));\n      })\n      .on('click', '.show-page-source', function(e) {\n        e.preventDefault();\n        const $page = $(this).parents('.page');\n        const page = lineup.atKey($page.data('key')).getRawPage();\n        dialog.open(`JSON for ${page.title}`,  $('<pre/>').text(JSON.stringify(page, null, 2)));\n      })\n      .on('click', '.page', function(e) {\n        if (!$(e.target).is(\"a\")) { return active.set(this); }\n      })\n      .on('click', '.internal', function(e) {\n        const $link = $(e.target);\n        let title = $link.text() || $link.data('pageName');\n        // ensure that name is a string (using string interpolation)\n        title = `${title}`;\n        pageHandler.context = $(e.target).attr('title').split(' => ');\n        return finishClick(e, title);\n      })\n      .on('click', 'img.remote', function(e) {\n        // expand to handle click on temporary flag\n        if ($(e.target).attr('src').startsWith('data:image/png')) {\n          e.preventDefault();\n          const site = $(e.target).data('site');\n          wiki.site(site).refresh(function() {});\n            // empty function...\n        } else {\n          const name = $(e.target).data('slug');\n          pageHandler.context = [$(e.target).data('site')];\n          return finishClick(e, name);\n        }\n      })\n      .on('dblclick', '.revision', function(e) {\n        e.preventDefault();\n        const $page = $(this).parents('.page');\n        const page = lineup.atKey($page.data('key')).getRawPage();\n        const rev = page.journal.length-1;\n        const action = page.journal[rev];\n        const json = JSON.stringify(action, null, 2);\n        dialog.open(`Revision ${rev}, ${action.type} action`, $('<pre/>').text(json));\n      })\n      .on('click', '.action', function(e) {\n        e.preventDefault();\n        const $action = $(e.target);\n        let name = $action.data('slug');\n        if ($action.is('.fork') && name) {\n          pageHandler.context = [$action.data('site')];\n          return finishClick(e, (name.split('_'))[0]);\n        } else {\n          const $page = $(this).parents('.page');\n          const key = $page.data('key');\n          const slug = lineup.atKey(key).getSlug();\n          const rev = $(this).parent().children().not('.separator').index($action);\n          if (rev < 0) { return; }\n          if (!e.shiftKey) { $page.nextAll().remove(); }\n          if (!e.shiftKey) { lineup.removeAllAfterKey(key); }\n          link.createPage(`${slug}_rev${rev}`, $page.data('site'))\n            .appendTo($('.main'))\n            .each((_i, e) => refresh.cycle($(e)));\n          active.set($('.page').last());\n        }\n      })\n      .on('mouseenter', '.action', function(e) {\n        const $action = $(e.target);\n        const { action } = $action.data();\n        $action.attr('title',util.formatActionTitle(action));\n      })\n      .on('click', '.fork-page', function(e) {\n        const $page = $(e.target).parents('.page');\n        if ($page.find('.future').length) { return; }\n        const pageObject = lineup.atKey($page.data('key'));\n        if ($page.attr('id').match(/_rev0$/)) {\n          deletePage(pageObject, $page);\n        } else {\n          const action = {type: 'fork'};\n          if ($page.hasClass('local')) {\n            if (pageHandler.useLocalStorage()) { return; }\n            $page.removeClass('local');\n          } else if (pageObject.isRecycler()) {\n            $page.removeClass('recycler');\n          } else if (pageObject.isRemote()) {\n            action.site = pageObject.getRemoteSite();\n          }\n          if ($page.data('rev') != null) {\n            $page.find('.revision').remove();\n          }\n          $page.removeClass('ghost');\n          $page.attr('id', $page.attr('id').replace(/_rev\\d+$/,''));\n          state.setUrl();\n          const iterable = $('.page');\n          for (let i = 0; i < iterable.length; i++) {\n            var p = iterable[i];\n            var needle = $(p).data('site');\n            if (($(p).data('key') !== $page.data('key')) &&\n               ($(p).attr('id') === $page.attr('id')) &&\n               ([undefined, null, 'view', 'origin', 'local', 'recycler', location.host].includes(needle))) {\n              $(p).addClass('ghost');\n            }\n          }\n          pageHandler.put($page, action);\n        }\n      })\n      .on('click', 'button.create', e => getTemplate($(e.target).data('slug'), function(template) {\n        const $page = $(e.target).parents('.page:first');\n        $page.removeClass('ghost');\n        const pageObject = lineup.atKey($page.data('key'));\n        pageObject.become(template);\n        const page = pageObject.getRawPage();\n        refresh.rebuildPage(pageObject, $page.empty());\n        pageHandler.put($page, {type: 'create', id: page.id, item: {title:page.title, story:page.story}});\n      }))\n\n    .on('mouseenter mouseleave', '.score', function(e) {\n      console.log(\"in .score...\");\n      $('.main').trigger('thumb', $(e.target).data('thumb'));\n  }).on('click', 'a.search', function(e) {\n      const $page = $(e.target).parents('.page');\n      const key = $page.data('key');\n      const pageObject = lineup.atKey(key);\n      const resultPage = newPage();\n      resultPage.setTitle(`Search from '${pageObject.getTitle()}'`);\n      resultPage.addParagraph(\n`Search for pages related to '${pageObject.getTitle()}'.\nEach search on this page will find pages related in a different way.\nChoose the search of interest. Be patient.`\n      );\n      resultPage.addParagraph(\"Find pages with links to this title.\");\n      resultPage.addItem({\n        type: 'search',\n        text: `SEARCH LINKS ${pageObject.getSlug()}`\n      });\n      resultPage.addParagraph(\"Find pages with titles similar to this title.\");\n      resultPage.addItem({\n        type: 'search',\n        text: `SEARCH SLUGS ${pageObject.getSlug()}`\n      });\n      resultPage.addParagraph(\"Find pages neighboring  this site.\");\n      resultPage.addItem({\n        type: 'search',\n        text: `SEARCH SITES ${pageObject.getRemoteSite(location.host)}`\n      });\n      resultPage.addParagraph(\"Find pages sharing any of these items.\");\n      resultPage.addItem({\n        type: 'search',\n        text: `SEARCH ANY ITEMS ${(pageObject.getRawPage().story.map((item) => item.id)).join(' ')}`\n      });\n      if (!e.shiftKey) { $page.nextAll().remove(); }\n      if (!e.shiftKey) { lineup.removeAllAfterKey(key); }\n      link.showResult(resultPage);\n    }).on('dragenter', evt => evt.preventDefault())\n    .on('dragover', evt => evt.preventDefault())\n    .on(\"drop\", drop.dispatch({\n      page: (item) => { link.doInternalLink(item.slug, null, item.site); },\n      file: (file) => { readFile(file); }\n    })\n  );\n\n  $(\".provider input\").on('click', function() {\n    $(\"footer input:first\").val($(this).attr('data-provider'));\n    $(\"footer form\").submit();\n  });\n\n  $('body').on('new-neighbor-done', (e, neighbor) => $('.page').each((index, element) => refresh.emitTwins($(element))));\n      // refresh backlinks??\n\n  const getPluginReference = title => new Promise(function(resolve, reject) {\n    const slug = asSlug(title);\n    wiki.origin.get(`${slug}.json`, (error, data) => resolve({\n      title,\n      slug,\n      type: \"reference\",\n      text: (error ? error.msg : data?.story[0].text) || \"\"\n    }));\n    });\n\n  $(\"<span>&nbsp; \u2630 </span>\")\n    .css({\"cursor\":\"pointer\"})\n    .appendTo('footer')\n    .on('click', function() {\n      const resultPage = newPage();\n      resultPage.setTitle(\"Selected Plugin Pages\");\n      resultPage.addParagraph(`\\\nInstalled plugins offer these utility pages:\\\n`\n      );\n      if (!window.catalog) { return; }\n\n      const titles = [];\n      for (var info of window.catalog) {\n        if (info.pages) {\n          for (var title of info.pages) {\n            titles.push(title);\n          }\n        }\n      }\n\n      Promise.all(titles.map(getPluginReference)).then(function(items) {\n        items.forEach(item => resultPage.addItem(item));\n        link.showResult(resultPage);\n      });\n  });\n\n  // $('.editEnable').is(':visible')\n  $(\"<span>&nbsp; wiki <span class=editEnable>\u2714\uFE0E</span> &nbsp; </span>\")\n    .css({\"cursor\":\"pointer\"})\n    .appendTo('footer')\n    .on('click', function() {\n      $('.editEnable').toggle();\n      $('.page').each(function() {\n        const $page = $(this);\n        const pageObject = lineup.atKey($page.data('key'));\n        refresh.rebuildPage(pageObject, $page.empty());\n      });\n  });\n  if (!isAuthenticated) { $('.editEnable').toggle(); }\n\n  target.bind();\n\n  $(function() {\n    state.first();\n    const pages = $('.page').toArray();\n    // Render pages in order\n    // Emits and \"bind creations\" for the previous page must be complete before we start\n    // rendering the next page or plugin bind ordering will not work\n    var renderNextPage = function(pages) {\n      if (pages.length === 0) {\n        active.set($('.page').last());\n        return;\n      }\n      const $page = $(pages.shift());\n      refresh.cycle($page).then(() => renderNextPage(pages));\n    };\n    renderNextPage(pages);\n  });\n});\n", "// This module manages the display of site flags representing\n// fetched sitemaps stored in the neighborhood. It progresses\n// through a series of states which, when attached to the flags,\n// cause them to animate as an indication of work in progress.\n\nconst link = require('./link');\nconst wiki = require('./wiki');\nconst neighborhood = require('./neighborhood');\nconst util = require('./util');\n\nlet sites = null;\nlet totalPages = 0;\n\nconst hasLinks = element => element.hasOwnProperty('links');\n\n\nconst flag = site => // status class progression: .wait, .fetch, .fail or .done\n`\\\n<span class=\"neighbor\" data-site=\"${site}\">\n<div class=\"wait\">\n  <img src=\"${wiki.site(site).flag()}\" title=\"${site}\">\n</div>\n</span>\\\n`;\n\nconst inject = neighborhood => sites = neighborhood.sites;\n\nconst formatNeighborTitle = function(site) {\n  let error, pageCount;\n  let title = '';\n  title += `${site}\\n`;\n  try {\n    pageCount = sites[site].sitemap.length;\n  } catch (error1) {\n    error = error1;\n    pageCount = 0;\n  }\n  try {\n    if (sites[site].sitemap.some(hasLinks)) {\n      title += `${pageCount} pages with 2-way links\\n`;\n    } else {\n      title += `${pageCount} pages\\n`;\n    }\n  } catch (error2) {\n    error = error2;\n    console.info('+++ sitemap not valid for ', site);\n  }\n  if (sites[site].lastModified !== 0) {\n    title += `Updated ${util.formatElapsedTime(sites[site].lastModified)}`;\n    if ((sites[site].nextCheck - Date.now()) > 0) { title += `, next refresh ${util.formatDelay(sites[site].nextCheck)}`; }\n  }\n  return title;\n};\n\n\nconst bind = function() {\n  const $neighborhood = $('.neighborhood');\n  $('body')\n    .on('new-neighbor', (e, site) => $neighborhood.append(flag(site))).on('new-neighbor-done', function(e, site) {\n      let pageCount;\n      try {\n        pageCount = sites[site].sitemap.length;\n      } catch (error1) {\n        const error = error1;\n        pageCount = 0;\n      }\n      totalPages = Object.values(neighborhood.sites).reduce((function(sum, site) {\n        try {\n          if (site.sitemapRequestInflight) {\n            return sum;\n          } else {\n            return sum + site.sitemap.length;\n          }\n        } catch (error) {\n          return sum;\n        }\n        }), 0);\n      $('.searchbox .pages').text(`${totalPages} pages`);\n    })\n    .on('mouseenter', '.neighbor', function(e) {\n      const $neighbor = $(e.currentTarget);\n      const {\n        site\n      } = $neighbor.data();\n      $neighbor.find('img:first').attr('title', formatNeighborTitle(site));\n    }).on('click', '.neighbor img', function(e) {\n      // add handling refreshing neighbor that has failed\n      if ($(e.target).parent().hasClass('fail')) {\n        $(e.target).parent().removeClass('fail').addClass('wait');\n        const site = $(e.target).attr('title').split('\\n')[0];\n        wiki.site(site).refresh(function() {\n          console.log('about to retry neighbor');\n          neighborhood.retryNeighbor(site);\n        });\n      } else {\n        link.doInternalLink('welcome-visitors', null, this.title.split(\"\\n\")[0]);\n      }\n    });\n};\n\nmodule.exports = {inject, bind};\n", "// The search module invokes neighborhood's query function,\n// formats the results as story items, and then opens a\n// page to present them.\n\nconst pageHandler = require('./pageHandler');\nconst random = require('./random');\nconst link = require('./link');\nconst active = require('./active');\nconst {\n  newPage\n} = require('./page');\nconst resolve = require('./resolve');\nlet page = require('./page');\n\n// from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\nconst escapeRegExp = string => string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\nconst deepCopy = object => JSON.parse(JSON.stringify(object));\n\n// From reference.coffee\nconst emit = function($item, item) {\n  let slug = item.slug;\n  if (item.title) { slug ||= page.asSlug(item.title); }\n  slug ||= 'welcome-visitors';\n  const site = item.site;\n  resolve.resolveFrom(site, () => $item.append(`\\\n<p>\n<img class='remote'\n  src='${wiki.site(site).flag()}'\n  title='${site}'\n  data-site=\"${site}\"\n  data-slug=\"${slug}\"\n>\n${resolve.resolveLinks(`[[${item.title || slug}]]`)}\n\u2014\n${resolve.resolveLinks(item.text)}\n</p>\\\n`\n  ));\n};\nconst finishClick = function(e, name) {\n  e.preventDefault();\n  if (!e.shiftKey) { page = $(e.target).parents('.page'); }\n  link.doInternalLink(name, page, $(e.target).data('site'));\n  return false;\n};\n\nconst createSearch = function({neighborhood}){\n  const incrementalSearch = function(searchQuery){\n    if (searchQuery.length < 2) {\n      $('.incremental-search').remove();\n      return;\n    }\n    if ($('.incremental-search').length === 0) {\n      const offset = $('.searchbox').position();\n      $('<div/>')\n        .css('left', `${offset.left}px`)\n        .css('bottom', `${offset.top + $('.searchbox').height()}px`)\n        .addClass('incremental-search')\n        .on('click', '.internal', function(e) {\n          if (e.target.nodeName === 'SPAN') { e.target = $(e.target).parent()[0]; }\n          let name = $(e.target).data('pageName');\n          // ensure that name is a string (using string interpolation)\n          name = `${name}`;\n          pageHandler.context = $(e.target).attr('title').split(' => ');\n          return finishClick(e, name);\n        })\n        .on('click', 'img.remote', function(e) {\n          // expand to handle click on temporary flag\n          if ($(e.target).attr('src').startsWith('data:image/png')) {\n            e.preventDefault();\n            const site = $(e.target).data('site');\n            wiki.site(site).refresh(function() {});\n          } else {\n            const name = $(e.target).data('slug');\n            pageHandler.context = [$(e.target).data('site')];\n            return finishClick(e, name);\n          }\n          return false;\n        }).appendTo($('.searchbox'));\n    }\n\n    const searchResults = neighborhood.search(searchQuery);\n    const searchTerms = searchQuery.split(' ')\n            .map(t => t.toLowerCase()).filter(String);\n    const searchHighlightRegExp = new RegExp(\"\\\\b(\" + searchQuery.split(' ')\n            .map(t => t.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')).filter(String)\n            .join('|') + \")\", 'i');\n    const highlightText = text => text.split(searchHighlightRegExp)\n      .map(function(p) {\n        if (searchTerms.includes(p.toLowerCase())) {\n          return `{{${p}}}`;\n        } else { return p; }}).join('');\n    const $search = $('.incremental-search').empty();\n    if (!searchResults.finds || (searchResults.finds.length === 0)) {\n      $('<div/>').text('No results found').addClass('no-results').appendTo($search);\n    }\n    let count = 0;\n    const max_results = 100;\n    for (const result of searchResults.finds) {\n      count++;\n      if (count === max_results + 1) {\n        $('<div/>')\n          .text(`${searchResults.finds.length - max_results} results omitted`)\n          .addClass('omitted-results')\n          .appendTo($search);\n      }\n      if (count > max_results) {\n        continue;\n      }\n      const $item = $('<div/>').appendTo($search);\n      const item = {\n        id: random.itemId(),\n        type: \"reference\",\n        site: result.site,\n        slug: result.page.slug,\n        title: highlightText(result.page.title),\n        text: highlightText(result.page.synopsis)\n      };\n      emit($item, item);\n      $item.html($item.html()\n        .split(new RegExp(\"(\\{\\{.*?\\}\\})\", 'i'))\n        .map((p) => {\n          if (p.indexOf('{{') === 0) {\n            return `<span class='search-term'>${p.substring(2, p.length - 2)}</span>`;\n          } else {\n            return p;\n          }\n        })\n        .join('')\n      );\n    }\n  };\n\n  const performSearch = function(searchQuery){\n    const searchResults = neighborhood.search(searchQuery);\n    if (searchResults.finds && (searchResults.finds.length === 1)) {\n      $('.incremental-search').find('.internal').trigger('click');\n      $('.incremental-search').remove();\n      return;\n    }\n    $('.incremental-search').remove();\n    const {\n      tally\n    } = searchResults;\n    const resultPage = {};\n    resultPage.title = `Search for '${searchQuery}'`;\n    resultPage.story = [];\n    resultPage.story.push({\n      'type': 'paragraph',\n      'id': random.itemId(),\n      'text': `\\\nString '${searchQuery}' found on ${tally.finds||'none'} of ${tally.pages||'no'} pages from ${tally.sites||'no'} sites.\nText matched on ${tally.title||'no'} titles, ${tally.text||'no'} paragraphs, and ${tally.slug||'no'} slugs.\nElapsed time ${tally.msec} milliseconds.\\\n` });\n    for (var result of searchResults.finds) {\n      resultPage.story.push({\n        \"id\": random.itemId(),\n        \"type\": \"reference\",\n        \"site\": result.site,\n        \"slug\": result.page.slug,\n        \"title\": result.page.title,\n        \"text\": result.page.synopsis || ''\n      });\n    }\n\n    resultPage.journal = [{\n      \"type\": \"create\",\n      \"item\": {\n        \"title\": resultPage.title,\n        \"story\": deepCopy(resultPage.story)\n      },\n      \"date\": Date.now()\n    }];\n    const pageObject = newPage(resultPage);\n    link.showResult(pageObject);\n  };\n\n\n  return {\n    incrementalSearch,\n    performSearch\n  };\n};\nmodule.exports = createSearch;\n", "// Handle input events from the search box. There is machinery\n// here that supports incremental search.\n// We use dependency injection to break dependency loops.\n\nconst createSearch = require('./search');\n\nlet search = null;\n\nconst inject = neighborhood => search = createSearch({neighborhood});\n\nconst bind = function() {\n  $('input.search').attr('autocomplete', 'off');\n  $('input.search').on('keydown', function(e){\n    if (e.keyCode === 27) {\n      $('.incremental-search').remove();\n    }\n  });\n  $('input.search').on('keypress', function(e){\n    if (e.keyCode !== 13) { return; } // 13 == return\n    const searchQuery = $(this).val();\n    search.performSearch( searchQuery );\n    $(this).val(\"\");\n  });\n\n  $('input.search').on('focus', function(e){\n    const searchQuery = $(this).val();\n    search.incrementalSearch( searchQuery );\n  });\n\n  return $('input.search').on('input', function(e){\n    const searchQuery = $(this).val();\n    search.incrementalSearch( searchQuery );\n  });\n};\n\nmodule.exports = {inject, bind};\n", "// Bind connects the searchbox and the neighbors, both views,\n// to the neighborhood, the model that they use. This breaks\n// a dependency loop that will probably dissapear when views\n// are more event oriented.\n\n// Similarly state depends on injection rather than requiring\n// link and thereby breaks another dependency loop.\n\nconst neighborhood = require('./neighborhood');\nconst neighbors = require('./neighbors');\nconst searchbox = require('./searchbox');\n\nconst state = require('./state');\nconst link = require('./link');\n\n$(function() {\n\n  searchbox.inject(neighborhood);\n  searchbox.bind();\n\n  neighbors.inject(neighborhood);\n  neighbors.bind();\n\n  if (window.seedNeighbors) {\n    seedNeighbors.split(',').forEach(site => neighborhood.registerNeighbor(site.trim()));\n  }\n\n  state.inject(link);\n});\n", "// The Reference plugin holds a site and page name to be\n// found on that site. Search, for example, produces a page of\n// references. Double click will edit the body of a reference\n// but not the name and site.\n\nconst editor = require('./editor');\nconst resolve = require('./resolve');\nconst page = require('./page');\n\n// see http://fed.wiki.org/about-reference-plugin.html\n\nconst emit = function($item, item) {\n  let slug = item.slug;\n  if (!slug && item.title) { slug = page.asSlug(item.title);}\n  if (!slug) { slug = 'welcome-visitors'; }\n  const site = item.site;\n  resolve.resolveFrom(site, () => $item.append(`\n<p>\n<img class='remote'\n  src='${wiki.site(site).flag()}'\n  title='${site}'\n  data-site=\"${site}\"\n  data-slug=\"${slug}\"\n>\n${resolve.resolveLinks(`[[${item.title || slug}]]`)}\n\u2014\n${resolve.resolveLinks(item.text)}\n</p>`)\n  );\n};\nconst bind = ($item, item) => $item.on('dblclick', () => editor.textEditor($item, item));\n\nmodule.exports = {emit, bind};\n", "// A Factory plugin provides a drop zone for desktop content\n// destined to be one or another kind of item. Double click\n// will turn it into a normal paragraph.\n\nconst neighborhood = require('./neighborhood');\nconst plugin = require('./plugin');\nconst resolve = require('./resolve');\nconst pageHandler = require('./pageHandler');\nconst editor = require('./editor');\nconst synopsis = require('./synopsis');\nconst drop = require('./drop');\nconst active = require('./active');\n\nconst escape = line => line\n  .replace(/&/g, '&amp;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;')\n  .replace(/\\n/g, '<br>');\n\n\nconst emit = function($item, item) {\n  $item.append('<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>');\n\n  const showMenu = function() {\n    const menu = $item.find('p').append(`\\\n<br>Or Choose a Plugin\n<center>\n<table style=\"text-align:left;\">\n<tr><td><ul id=format><td><ul id=data><td><ul id=other>\\\n`\n    );\n    for (var info of window.catalog) {\n      if (info && info.category) {\n        var column = info.category;\n        if (!['format', 'data'].includes(column)) { column = 'other'; }\n        menu.find('#'+column).append(`\\\n<li><a class=\"menu\" href=\"#\" title=\"${info.title}\">${info.name}</a></li>\\\n`\n        );\n      }\n    }\n    menu.find('a.menu').on('click', function(evt){\n      const pluginName = evt.target.text;\n      const pluginType = pluginName.toLowerCase();\n      $item.removeClass('factory').addClass(item.type=pluginType);\n      $item.off();\n      evt.preventDefault();\n      active.set($item.parents(\".page\"));\n      const catalogEntry = window.catalog.find(entry => pluginName === entry.name);\n      if (catalogEntry.editor) {\n        try {\n          window.plugins[pluginType].editor($item, item);\n        } catch (error) {\n          console.log(`${pluginName} Plugin editor failed: ${error}. Falling back to textEditor`);\n          editor.textEditor($item, item);\n        }\n      } else {\n        editor.textEditor($item, item);\n      }\n    });\n  };\n\n  const showPrompt = () => $item.append(`<p>${resolve.resolveLinks(item.prompt, escape)}</b>`);\n\n  if (item.prompt) {\n    showPrompt();\n  } else if (window.catalog) {\n    showMenu();\n  } else {\n    wiki.origin.get('system/factories.json', function(error, data) {\n      // console.log 'factory', data\n      window.catalog = data;\n      showMenu();\n    });\n  }\n};\n\nconst bind = function($item, item) {\n\n  const syncEditAction = function() {\n    $item.empty().off();\n    $item.removeClass(\"factory\").addClass(item.type);\n    const $page = $item.parents('.page:first');\n    try {\n      $item.data('pageElement', $page);\n      $item.data('item', item);\n      plugin.getPlugin(item.type, function(plugin) {\n        plugin.emit($item, item);\n        plugin.bind($item, item);\n      });\n    } catch (err) {\n      $item.append(`<p class='error'>${err}</p>`);\n    }\n    pageHandler.put($page, {type: 'edit', id: item.id, item});\n  };\n\n  const punt = function(data) {\n    item.prompt = \"Unexpected Item\\nWe can't make sense of the drop.\\nTry something else or see [[About Factory Plugin]].\";\n    data.userAgent = navigator.userAgent;\n    item.punt = data;\n    syncEditAction();\n  };\n\n  const addReference = data => wiki.site(data.site).get(`${data.slug}.json`, function(err, remote) {\n    if (!err) {\n      item.type = 'reference';\n      item.site = data.site;\n      item.slug = data.slug;\n      item.title = remote.title || data.slug;\n      item.text = synopsis(remote);\n      syncEditAction();\n      if (item.site) { neighborhood.registerNeighbor(item.site); }\n    }\n  });\n\n  const addVideo = function(video) {\n    item.type = 'video';\n    item.text = `${video.text}\\n(double-click to edit caption)\\n`;\n    syncEditAction();\n  };\n\n  const addRemoteImage = function(url) {\n    // give some feedback, in case this is going to take a while...\n    document.documentElement.style.cursor = 'wait';\n\n    fetch(url)\n      .then(function(response) {\n        if (response.ok) {\n          return response.blob();\n        }\n        throw new Error('Unable to fetch image'); })\n      .then(function(imageBlob) {\n        const imageFileName = url.split('/').pop().split('#')[0].split('?')[0];\n        // not sure if converting to file gives anything!\n        // imageFile = new File([imageBlob], imageFileName, { type: imageBlob.type })\n        const reader = new FileReader();\n        reader.readAsDataURL(imageBlob);\n        reader.onload = function(loadEvent) {\n          const imageDataURL = loadEvent.target.result;\n          window.plugins['image'].editor({ imageDataURL, filename: imageFileName, imageSourceURL: url, imageCaption: `Remote image [${url} source]`, $item, item });\n        };\n    });\n  };\n\n\n  const addRemoteSvg = function(url) {\n    document.documentElement.style.cursor = 'wait';\n    fetch(url)\n      .then(function(response) {\n        if (response.ok) {\n          return response;\n        }\n        throw new Error('Unable to fetch svg');})\n      .then(response => response.text())\n      .then(function(svgText) {\n        document.documentElement.style.cursor = 'default';\n        item.type = 'html';\n        item.source = url;\n        item.text = svgText + `<p>[${url} Source]</p>`;\n        syncEditAction();\n      });\n  };\n\n\n\n  const readFile = function(file) {\n    if (file != null) {\n      const [majorType, minorType] = file.type.split(\"/\");\n      const reader = new FileReader();\n      if (majorType === \"image\") {\n        // svg -> html plugin\n        if (minorType.startsWith('svg')) {\n          reader.onload = function(loadEvent) {\n            const {\n              result\n            } = loadEvent.target;\n            item.type = 'html';\n            item.text = result;\n            syncEditAction();\n          };\n          reader.readAsText(file);\n        } else {\n          reader.onload = function(loadEvent) {\n            // console.log('upload file', file)\n            const imageDataURL = loadEvent.target.result;\n            window.plugins['image'].editor({ imageDataURL, filename: file.name, imageCaption: \"Uploaded image\" , $item, item});\n          };\n          reader.readAsDataURL(file);\n        }\n      } else if (majorType === \"text\") {\n        reader.onload = function(loadEvent) {\n          const {\n            result\n          } = loadEvent.target;\n          if (minorType === 'csv') {\n            let array;\n            item.type = 'data';\n            item.columns = (array = csvToArray(result))[0];\n            item.data = arrayToJson(array);\n            item.text = file.fileName;\n          } else {\n            item.type = 'paragraph';\n            item.text = result;\n          }\n          syncEditAction();\n        };\n        reader.readAsText(file);\n      } else {\n        punt({\n          name: file.name,\n          type: file.type,\n          size: file.size,\n          fileName: file.fileName,\n          lastModified: file.lastModified\n        });\n      }\n    }\n  };\n\n  $item.on('dblclick', function(e) {\n\n    if (!$('.editEnable').is(':visible')) { return; }\n\n    if (e.shiftKey) {\n      return editor.textEditor($item, item, {field: 'prompt'});\n    } else {\n      $item.removeClass('factory').addClass(item.type = 'paragraph');\n      $item.off();\n      return editor.textEditor($item, item);\n    }\n  });\n\n  $item.on('dragenter', evt => evt.preventDefault());\n  $item.on('dragover', evt => evt.preventDefault());\n  $item.on(\"drop\", drop.dispatch({\n    page: addReference,\n    file: readFile,\n    video: addVideo,\n    image: addRemoteImage,\n    svg: addRemoteSvg,\n    punt\n  })\n  );\n};\n\n// from http://www.bennadel.com/blog/1504-Ask-Ben-Parsing-CSV-Strings-With-Javascript-Exec-Regular-Expression-Command.htm\n// via http://stackoverflow.com/questions/1293147/javascript-code-to-parse-csv-data\n\nvar csvToArray = function(strData, strDelimiter) {\n  strDelimiter = (strDelimiter || \",\");\n  const objPattern = new RegExp((\"(\\\\\" + strDelimiter + \"|\\\\r?\\\\n|\\\\r|^)\" + \"(?:\\\"([^\\\"]*(?:\\\"\\\"[^\\\"]*)*)\\\"|\" + \"([^\\\"\\\\\" + strDelimiter + \"\\\\r\\\\n]*))\"), \"gi\");\n  const arrData = [ [] ];\n  let arrMatches = null;\n  while ((arrMatches = objPattern.exec(strData))) {\n    var strMatchedValue;\n    var strMatchedDelimiter = arrMatches[1];\n    if (strMatchedDelimiter.length && (strMatchedDelimiter !== strDelimiter)) { arrData.push([]); }\n    if (arrMatches[2]) {\n      strMatchedValue = arrMatches[2].replace(new RegExp(\"\\\"\\\"\", \"g\"), \"\\\"\");\n    } else {\n      strMatchedValue = arrMatches[3];\n    }\n    arrData[arrData.length - 1].push(strMatchedValue);\n  }\n  return arrData;\n};\n\nvar arrayToJson = function(array) {\n  const cols = array.shift();\n  const rowToObject = function(row) {\n    const obj = {};\n    row.forEach(function (v, idx) {\n      let k = cols[idx]\n      if ((v != null) && (v.match(/\\S/)) && (v !== 'NULL')) { obj[k] = v; }\n    })\n    return obj;\n  };\n  const result = [];\n  for (var row of array) {\n    result.push(rowToObject(row));\n  }\n  return result;\n};\n\n\nmodule.exports = {emit, bind};\n", "// The Paragraph plugin holds text that can be edited and rendered\n// with hyperlinks. It will eventually escape html tags but for the\n// moment we live dangerously.\n\nconst editor = require('./editor');\nconst resolve = require('./resolve');\nconst itemz = require('./itemz');\n\nconst type = function(text) {\n  if (text.match(/<(i|b|p|a|h\\d|hr|br|li|img|div|span|table|blockquote)\\b.*?>/i)) {\n    return 'html';\n  } else {\n    return 'markdown';\n  }\n};\n\nconst emit = ($item, item) => {\n  for (var text of item.text.split(/\\n\\n+/)) {\n    if (text.match(/\\S/)) {\n      $item.append(`<p>${resolve.resolveLinks(text)}</p>`)\n    }\n  }\n}\n\nconst bind = ($item, item) => $item.on('dblclick', function(e) {\n  if (e.shiftKey) {\n    item.type = type(item.text);\n    return itemz.replaceItem($item, 'paragraph', item);\n  } else {\n    return editor.textEditor($item, item, {'append': true});\n  }\n});\n\nmodule.exports = {emit, bind};", "// A Future plugin represents a page that hasn't been written\n// or wasn't found where expected. It recognizes template pages\n// and offers to clone them or make a blank page.\n\nconst resolve = require('./resolve');\nconst neighborhood = require('./neighborhood');\n\nconst lineup = require('./lineup');\nconst refresh = require('./refresh');\n\nconst emit = function($item, item) {\n\n  let info, transport;\n  $item.append(`${item.text}`);\n  const proposedSlug = $item.parents('.page:first')[0].id;\n  if (wiki.asSlug(item.title) !== proposedSlug) {\n    $item.append(\"<p style='font-weight: 500;'>Page titles with leading/trailing spaces cannot be used to create a new page.</p>\");\n  } else {\n    $item.append(\"<br><br><button class=\\\"create\\\">create</button> new blank page\");\n  }\n\n  if (transport = item.create?.source?.transport) {\n    $item.append(`<br><button class=\"transport\" data-slug=${item.slug}>create</button> transport from ${transport}`);\n    $item.append(\"<p class=caption> unavailable</p>\");\n    $.get('//localhost:4020', () => $item.find('.caption').text('ready'));\n  }\n\n  if ((info = neighborhood.sites[location.host]) && info.sitemap) {\n    for (var localPage of info.sitemap) {\n      if (localPage.slug.match(/-template$/)) {\n        $item.append(`<br><button class=\"create\" data-slug=${localPage.slug}>create</button> from ${resolve.resolveLinks(`[[${localPage.title}]]`)}`);\n      }\n    }\n  }\n\n  if (item.context?.length > 0 || (isSecureContext && !location.hostname.endsWith('localhost'))) {\n    $item.append(`\\\n<p>Some possible places to look for this page, if it exists.</p>\\\n`\n    );\n  }\n\n  let offerAltLineup = true;\n\n  if (item.context?.length > 0) {\n    const offerPages = [];\n    item.context.forEach((c) => {\n      if (wiki.neighborhood[c].lastModified === 0) {\n        const slug = wiki.asSlug(item.title);\n        offerPages.push(`\\\n<p>\n  <img class='remote'\n    src='${wiki.site(c).flag()}'\n    title=\"${c}\">\n  <a class='internal'\n    href='http://${c}/${slug}.html'\n    target='_blank'>${c}</a>\n</p>\\\n`\n        );\n      }\n    });\n    if (offerPages.length > 0) {\n      $item.append(`\\\n<div>\n  <p>Try on remote wiki where it was expected to be found, opens in a new tab.</p>\n  ${offerPages.join('\\n')}\n</div>\\\n`\n      );\n    } else {\n      offerAltLineup = false;\n      $item.append(`\\\n<div>\n  <p>None of the expected places were unreachable.</p>\n</div>\\\n`\n      );\n    }\n  } else {\n    offerAltLineup = false;\n  }\n\n  if (isSecureContext && offerAltLineup && !location.hostname.endsWith('localhost')) {\n    const altContext = document.URL.replace(/^https/, 'http').replace(/\\/\\w+\\/[\\w-]+$/, '');\n    const altLinkText = altContext.length > 55 ? altContext.substring(0,55)+'...' : altContext;\n    $item.append(`\\\n<div>\n  <p>Try opening lineup using http, opens in a new tab.</p>\n  <p><a href=\"${altContext}\" target=\"_blank\"><img class='remote' src='/favicon.png' title='${location.host}'> ${altLinkText}</a>.</p>\n</div>\n<div>\n  <p>\n</div>\\\n`\n    );\n  }\n};\n\nconst bind = ($item, item) => $item.find('button.transport').on('click', function(e) {\n  $item.find('.caption').text('waiting');\n\n  // duplicatingTransport and Templage logic\n\n  const params = {\n    title: $item.parents('.page').data('data').title,\n    create: item.create\n  };\n\n  const req = {\n    type: \"POST\",\n    url: item.create.source.transport,\n    dataType: 'json',\n    contentType: \"application/json\",\n    data: JSON.stringify(params)\n  };\n\n  $.ajax(req).done(function(page) {\n    $item.find('.caption').text('ready');\n    const resultPage = wiki.newPage(page);\n    const $page = $item.parents('.page');\n    const pageObject = lineup.atKey($page.data('key'));\n    pageObject.become(resultPage,resultPage);\n    page = pageObject.getRawPage();\n    refresh.rebuildPage(pageObject, $page.empty());\n  });\n});\n\n\nmodule.exports = {emit, bind};\n", "// An Importer plugin completes the ghost page created upon drop of a site export file.\n\nconst util = require('./util');\nconst link = require('./link');\nconst {\n  newPage\n} = require('./page');\n\nconst escape = text => text\n  .replace(/&/g, '&amp;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;');\n\nconst emit = function($item, item) {\n\n  const render = function(pages) {\n    const result = [];\n    for (var slug in pages) {\n      var page = pages[slug];\n      var line = `<a href=${slug}>${ escape(page.title) || slug }</a>`;\n      if (page.journal) {\n        var date;\n        if (date = page.journal[page.journal.length - 1].date) {\n          line += ` &nbsp; from ${util.formatElapsedTime(date)}`;\n        } else {\n          line += ` &nbsp; from revision ${page.journal.length - 1}`;\n        }\n      }\n      result.push(line);\n    }\n    return result.join('<br>');\n  };\n\n  return $item.append(`\\\n<p style=\"background-color:#eee;padding:15px;\">\n  ${render(item.pages)}\n</p>\\\n`\n  );\n};\n\nconst bind = ($item, item) => $item.find('a').on('click', function(e) {\n  let $page;\n  const slug = $(e.target).attr('href');\n  if (!e.shiftKey) { $page = $(e.target).parents('.page'); }\n  const pageObject = newPage(item.pages[slug]);\n  link.showResult(pageObject, {$page});\n});\n\nmodule.exports = {emit, bind};\n", "// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\n// This module preloads the plugins directory with a few\n// plugins that we can't live without. They will be\n// browserified along with the rest of the core javascript.\nconst plugin = require('./plugin');\n\nwindow.plugins = {\n  reference: plugin.wrap('reference', require('./reference')),\n  factory: plugin.wrap('factory', require('./factory')),\n  paragraph: plugin.wrap('paragraph', require('./paragraph')),\n  //image: plugin.wrap('image', require './image')\n  future: plugin.wrap('future', require('./future')),\n  importer: plugin.wrap('importer', require('./importer'))\n};\n\n// mapping between old plugins and their successor\nwindow.pluginSuccessor = {\n  federatedWiki: 'reference',\n  mathjax: 'math'\n};\n", "// TODO: This file was created by bulk-decaffeinate.\n// Sanity-check the conversion and remove this comment.\nwindow.name = window.location.host;\n\nwindow.wiki = require('./lib/wiki');\nrequire('./lib/legacy');\nrequire('./lib/bind');\nrequire('./lib/plugins');\n"],
  "mappings": "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",
  "names": ["require_onlyOnce", "__commonJSMin", "exports", "module", "onlyOnce", "fn", "args", "callFn", "require_setImmediate", "__commonJSMin", "exports", "fallback", "wrap", "hasQueueMicrotask", "hasSetImmediate", "hasNextTick", "fn", "defer", "args", "_defer", "require_DoublyLinkedList", "__commonJSMin", "exports", "module", "DLL", "node", "newNode", "setInitial", "cur", "testFn", "curr", "next", "dll", "require_initialParams", "__commonJSMin", "exports", "module", "fn", "args", "callback", "require_asyncify", "__commonJSMin", "exports", "module", "asyncify", "_initialParams", "_initialParams2", "_interopRequireDefault", "_setImmediate", "_setImmediate2", "_wrapAsync", "obj", "func", "args", "callback", "promise", "handlePromise", "result", "e", "value", "invokeCallback", "err", "error", "require_wrapAsync", "__commonJSMin", "exports", "_asyncify", "_asyncify2", "_interopRequireDefault", "obj", "isAsync", "fn", "isAsyncGenerator", "isAsyncIterable", "wrapAsync", "asyncFn", "require_queue", "__commonJSMin", "exports", "module", "queue", "_onlyOnce", "_onlyOnce2", "_interopRequireDefault", "_setImmediate", "_setImmediate2", "_DoublyLinkedList", "_DoublyLinkedList2", "_wrapAsync", "_wrapAsync2", "obj", "worker", "concurrency", "payload", "_worker", "numRunning", "workersList", "events", "on", "event", "handler", "once", "handleAndRemove", "args", "off", "ev", "trigger", "processingScheduled", "_insert", "data", "insertAtFront", "rejectOnError", "callback", "q", "res", "rej", "promiseCallback", "err", "item", "resolve", "reject", "_createCB", "tasks", "i", "l", "task", "index", "_maybeDrain", "eventMethod", "name", "isProcessing", "datum", "testFn", "node", "cb", "require_queue", "__commonJSMin", "exports", "module", "worker", "concurrency", "_worker", "_wrapAsync2", "_queue2", "items", "cb", "_queue", "_interopRequireDefault", "_wrapAsync", "obj", "require_localforage", "__commonJSMin", "exports", "module", "f", "g", "define", "e", "t", "n", "r", "s", "o", "u", "a", "__require", "i", "l", "_dereq_", "global", "Mutation", "scheduleDrain", "called", "observer", "nextTick", "element", "channel", "scriptEl", "draining", "queue", "oldQueue", "len", "immediate", "task", "INTERNAL", "handlers", "REJECTED", "FULFILLED", "PENDING", "Promise", "resolver", "safelyResolveThenable", "onRejected", "onFulfilled", "promise", "unwrap", "QueueItem", "value", "func", "returnValue", "self", "result", "tryCatch", "getThen", "thenable", "error", "obj", "then", "onError", "onSuccess", "tryToUnwrap", "out", "resolve", "reject", "reason", "all", "iterable", "values", "resolved", "allResolver", "resolveFromAll", "outValue", "race", "response", "_typeof", "_classCallCheck", "instance", "Constructor", "getIDB", "idb", "isIndexedDBValid", "isSafari", "hasFetch", "createBlob", "parts", "properties", "Builder", "builder", "Promise$1", "executeCallback", "callback", "executeTwoCallbacks", "errorCallback", "normalizeKey", "key", "getCallback", "DETECT_BLOB_SUPPORT_STORE", "supportsBlobs", "dbContexts", "toString", "READ_ONLY", "READ_WRITE", "_binStringToArrayBuffer", "bin", "length", "buf", "arr", "_checkBlobSupportWithoutCaching", "txn", "blob", "matchedChrome", "matchedEdge", "_checkBlobSupport", "_deferReadiness", "dbInfo", "dbContext", "deferredOperation", "_advanceReadiness", "_rejectReadiness", "err", "_getConnection", "upgradeNeeded", "createDbContext", "dbArgs", "openreq", "db", "ex", "_getOriginalConnection", "_getUpgradedConnection", "_isUpgradeNeeded", "defaultVersion", "isNewStore", "isDowngrade", "isUpgrade", "incVersion", "_encodeBlob", "reader", "base64", "_decodeBlob", "encodedBlob", "arrayBuff", "_isEncodedBlob", "_fullyReady", "_tryReconnect", "forages", "forage", "createTransaction", "mode", "retries", "tx", "_initStorage", "options", "initPromises", "ignoreErrors", "j", "k", "getItem", "transaction", "store", "req", "iterate", "iterator", "iterationNumber", "cursor", "setItem", "blobSupport", "removeItem", "clear", "advanced", "keys", "dropInstance", "currentConfig", "isCurrentDb", "dbPromise", "newVersion", "dropObjectPromise", "_forage2", "dropDBPromise", "_forage", "asyncStorage", "isWebSQLValid", "BASE_CHARS", "BLOB_TYPE_PREFIX", "BLOB_TYPE_PREFIX_REGEX", "SERIALIZED_MARKER", "SERIALIZED_MARKER_LENGTH", "TYPE_ARRAYBUFFER", "TYPE_BLOB", "TYPE_INT8ARRAY", "TYPE_UINT8ARRAY", "TYPE_UINT8CLAMPEDARRAY", "TYPE_INT16ARRAY", "TYPE_INT32ARRAY", "TYPE_UINT16ARRAY", "TYPE_UINT32ARRAY", "TYPE_FLOAT32ARRAY", "TYPE_FLOAT64ARRAY", "TYPE_SERIALIZED_MARKER_LENGTH", "toString$1", "stringToBuffer", "serializedString", "bufferLength", "p", "encoded1", "encoded2", "encoded3", "encoded4", "buffer", "bytes", "bufferToString", "base64String", "serialize", "valueType", "marker", "fileReader", "str", "deserialize", "type", "blobType", "matcher", "localforageSerializer", "createDbTable", "_initStorage$1", "dbInfoPromise", "tryExecuteSql", "sqlStatement", "args", "results", "getItem$1", "iterate$1", "rows", "item", "_setItem", "retriesLeft", "originalValue", "sqlError", "setItem$1", "removeItem$1", "clear$1", "length$1", "key$1", "keys$1", "getAllStoreNames", "storeNames", "dropInstance$1", "operationInfo", "dropTable", "storeName", "operations", "webSQLStorage", "isLocalStorageValid", "_getKeyPrefix", "defaultConfig", "keyPrefix", "checkIfLocalStorageThrows", "localStorageTestKey", "_isLocalStorageUsable", "_initStorage$2", "clear$2", "getItem$2", "iterate$2", "keyPrefixLength", "key$2", "keys$2", "itemKey", "length$2", "removeItem$2", "setItem$2", "dropInstance$2", "localStorageWrapper", "sameValue", "x", "y", "includes", "array", "searchElement", "isArray", "arg", "DefinedDrivers", "DriverSupport", "DefaultDrivers", "DefaultDriverOrder", "OptionalDriverMethods", "LibraryMethods", "DefaultConfig", "callWhenReady", "localForageInstance", "libraryMethod", "_args", "extend", "_key", "LocalForage", "driverTypeKey", "driver", "driverName", "driverObject", "complianceError", "driverMethods", "driverMethodName", "isRequired", "configureMissingMethods", "methodNotImplementedFactory", "methodName", "_i", "_len", "optionalDriverMethod", "setDriverSupport", "support", "getDriverPromise", "serializerPromise", "drivers", "supportedDrivers", "setDriverToConfig", "extendSelfWithDriver", "initDriver", "currentDriverIndex", "driverPromiseLoop", "oldDriverSetDone", "libraryMethodsAndProperties", "localforage_js", "require_siteAdapter", "__commonJSMin", "exports", "module", "siteAdapter", "queue", "localForage", "sitePrefix", "credentialsNeeded", "tempFlags", "fetchTimeoutMS", "findQueueWorkers", "routeStore", "value", "key", "iterationNumber", "err", "withCredsStore", "testWikiSite", "url", "good", "bad", "testRace", "fetchTimeout", "resolve", "reject", "id", "fetchURL", "findAdapterQ", "task", "done", "testURL", "site", "findAdapter", "prefix", "route", "callback", "page", "parsedPage", "errMsg", "data", "code", "xhr", "type", "msg", "createTempFlag", "myCanvas", "ctx", "x1", "y1", "y2", "x2", "c1", "c2", "color1", "color2", "gradient", "tempFlag", "realFlag", "thisPrefix", "thisSite", "getContent", "useCredentials", "require_util", "__commonJSMin", "exports", "module", "util", "time", "d", "mo", "h", "am", "mi", "msSinceEpoch", "wk", "day", "yr", "sec", "action", "title", "days", "hrs", "mins", "months", "secs", "weeks", "years", "msecs", "require_random", "__commonJSMin", "exports", "module", "randomByte", "randomBytes", "n", "i", "itemId", "require_revision", "__commonJSMin", "exports", "module", "apply", "page", "action", "index", "order", "item", "add", "after", "remove", "create", "revIndex", "data", "revJournal", "revPage", "require_synopsis", "__commonJSMin", "exports", "module", "page", "synopsis", "p1", "p2", "require_page", "__commonJSMin", "exports", "module", "formatDate", "random", "revision", "synopsis", "pageEmitter", "asSlug", "name", "asTitle", "slug", "nowSections", "now", "newPage", "json", "site", "page", "getRawPage", "getContext", "context", "isRemote", "addContext", "action", "isPlugin", "isLocal", "isRecycler", "getRemoteSite", "host", "getRemoteSiteDetails", "result", "getSlug", "getNeighbors", "neighbors", "item", "getTitle", "setTitle", "title", "getRevision", "getDate", "getTimestamp", "getSynopsis", "getLinks", "pageLinks", "pageLinksMap", "extractPageLinks", "collaborativeLinks", "currentItem", "currentIndex", "array", "linkRe", "match", "err", "error", "addItem", "getItem", "id", "seqItems", "each", "resolve", "_reject", "emitItem", "i", "addParagraph", "text", "seqActions", "smaller", "sections", "emitAction", "bigger", "separator", "section", "become", "story", "journal", "siteLineup", "path", "notDuplicate", "update", "merged", "isCreate", "require_active", "__commonJSMin", "exports", "module", "active", "findScrollContainer", "scrolled", "scrollTo", "$page", "scrollTarget", "bodyWidth", "minX", "maxX", "target", "width", "contentWidth", "noScroll", "require_lineup", "__commonJSMin", "exports", "module", "random", "pageByKey", "keyByIndex", "addPage", "pageObject", "key", "changePageIndex", "newIndex", "oldIndex", "removeKey", "each", "removeAllAfterKey", "result", "unwanted", "atKey", "titleAtKey", "bestTitle", "debugKeys", "debugReset", "debugSelfCheck", "keys", "have", "keysByIndex", "want", "leftKey", "pos", "crumbs", "location", "left", "slug", "page", "host", "adjacent", "require_state", "__commonJSMin", "exports", "module", "state", "active", "lineup", "link", "link_", "el", "index", "_", "locs", "url", "page", "idx", "each", "e", "oldPages", "newPages", "oldLocs", "newLocs", "matching", "name", "old", "firstUrlPages", "firstUrlLocs", "urlPage", "require_actionSymbols", "__commonJSMin", "exports", "module", "symbols", "fork", "add", "require_addToJournal", "__commonJSMin", "exports", "module", "util", "actionSymbols", "$journal", "action", "$page", "$action", "controls", "__awaiter", "thisArg", "_arguments", "P", "generator", "adopt", "value", "resolve", "reject", "fulfilled", "step", "e", "rejected", "result", "ENTRIES", "KEYS", "VALUES", "LEAF", "TreeIterator", "set", "type", "node", "keys", "last", "child", "key", "array", "fuzzySearch", "query", "maxDistance", "results", "n", "m", "matrix", "j", "i", "recurse", "prefix", "offset", "distance", "pos", "char", "thisRowOffset", "prevRowOffset", "minDistance", "jmin", "jmax", "different", "rpl", "del", "ins", "dist", "SearchableMap", "_SearchableMap", "tree", "path", "trackDown", "parentNode", "k", "remove", "fn", "maxEditDistance", "lookup", "createPath", "iter", "initial", "entries", "object", "keyLength", "outer", "len", "intermediate", "cleanup", "merge", "nodeKey", "OR", "AND", "AND_NOT", "MiniSearch", "_MiniSearch", "options", "autoVacuum", "defaultAutoVacuumOptions", "defaultOptions", "defaultSearchOptions", "defaultAutoSuggestOptions", "defaultVacuumConditions", "document", "extractField", "tokenize", "processTerm", "fields", "idField", "id", "shortDocumentId", "field", "fieldValue", "tokens", "fieldId", "uniqueTerms", "term", "processedTerm", "t", "documents", "chunkSize", "acc", "chunk", "promise", "shortId", "fieldLength", "minDirtFactor", "minDirtCount", "batchSize", "batchWait", "ids", "updatedDocument", "conditions", "initialDirtCount", "defaultVacuumOptions", "fieldsData", "fieldIndex", "searchOptions", "rawResults", "docId", "score", "terms", "match", "quality", "byScore", "queryString", "suggestions", "phrase", "suggestion", "count", "json", "optionName", "getOwnProperty", "js", "index", "documentIds", "storedFields", "serializationVersion", "miniSearch", "objectToNumericMap", "data", "dataMap", "indexEntry", "objectToNumericMapAsync", "wait", "documentCount", "nextId", "fieldIds", "averageFieldLength", "dirtCount", "subquery", "globalSearchOptions", "searchTokenize", "searchProcessTerm", "termToQuerySpec", "boosts", "boostDocument", "weights", "maxFuzzy", "bm25params", "fuzzyWeight", "prefixWeight", "prefixMatches", "fuzzyMatches", "fuzzy", "weight", "combineWith", "operator", "combinator", "combinators", "freqs", "sourceTerm", "derivedTerm", "termWeight", "termBoost", "fieldTermData", "fieldBoosts", "boostDocumentFn", "fieldBoost", "fieldTermFreqs", "matchingFields", "avgFieldLength", "docBoost", "termFreq", "rawScore", "calcBM25Score", "weightedScore", "assignUniqueTerm", "documentId", "indexData", "createMap", "docs", "fieldName", "length", "fieldLengths", "totalFieldLength", "doc", "storeFields", "documentFields", "property", "a", "b", "existing", "assignUniqueTerms", "combined", "defaultBM25params", "matchingCount", "totalCount", "d", "text", "SPACE_OR_PUNCTUATION", "level", "message", "target", "source", "map", "ms", "require_neighborhood", "__commonJSMin", "exports", "module", "neighborhood", "miniSearch", "nextAvailableFetch", "nextFetchInterval", "delay", "ms", "resolve", "populateSiteInfoFor", "site", "neighborInfo", "transition", "from", "to", "boundedDelay", "refreshMap", "err", "gotData", "data", "lastModified", "refreshIndex", "updateDelay", "fetchMap", "now", "pageObject", "slug", "date", "title", "synopsis", "links", "entry", "sitemap", "index", "slot", "extractItemText", "text", "match", "myUrl", "extractPageText", "pageText", "currentItem", "currentIndex", "line", "firstWord", "newText", "searchQuery", "neighborSite", "finds", "tally", "tick", "key", "indexSite", "siteInfo", "timeLabel", "siteIndex", "page", "start", "origin", "contentBoost", "error", "searchResult", "titleBoost", "error1", "error2", "result", "a", "b", "sitemapData", "pageSlug", "results", "find", "require_pageHandler", "__commonJSMin", "exports", "module", "pageHandler", "state", "revision", "addToJournal", "newPage", "random", "lineup", "neighborhood", "deepCopy", "object", "pageFromLocalStorage", "slug", "json", "recursiveGet", "pageInformation", "whenGotten", "whenNotGotten", "localContext", "rev", "site", "localBeforeOrigin", "done", "err", "page", "adapter", "url", "text", "trouble", "localPage", "pushToLocal", "$page", "pagePutInfo", "action", "pushToServer", "bundle", "pageObject", "index", "checkedSite", "forkFrom", "require_plugin", "__commonJSMin", "exports", "module", "plugin", "escape", "s", "loadScript", "url", "scripts", "loadingScripts", "getScript", "callback", "err", "notifIndex", "$items", "itemElem", "$item", "item", "e", "p", "emit", "pluginEmit", "bind", "name", "pluginBind", "oldIndex", "index", "consumes", "deps", "consuming", "producers", "_i", "el", "page_key", "item_id", "wrap", "done", "div", "error", "ex", "script", "dialog", "evt", "resolve", "reject", "pluginName", "pluginFn", "require_itemz", "__commonJSMin", "exports", "module", "pageHandler", "plugin", "random", "sleep", "time", "done", "getItem", "$item", "removeItem", "item", "createItem", "$page", "$before", "before", "replaceItem", "type", "newItem", "err", "require_dialog", "__commonJSMin", "exports", "module", "open", "title", "html", "body", "dialogWindow", "event", "require_resolve", "__commonJSMin", "exports", "module", "escape", "resolve", "asSlug", "string", "addition", "callback", "sanitize", "stashed", "stash", "text", "here", "unstash", "match", "digits", "internal", "name", "slug", "styling", "external", "href", "protocol", "rest", "require_refresh", "__commonJSMin", "exports", "module", "pageHandler", "plugin", "state", "neighborhood", "addToJournal", "actionSymbols", "lineup", "resolve", "random", "pageModule", "newPage", "asSlug", "pageEmitter", "getItem", "$item", "aliasItem", "$page", "oldItem", "item", "pageObject", "equals", "a", "b", "getStoryItemOrder", "$story", "_", "value", "handleDrop", "evt", "ui", "originalIndex", "originalOrder", "dragAttribution", "index", "$sourcePage", "sourceIsReadOnly", "$destinationPage", "destinationIsGhost", "moveWithinPage", "moveBetweenDuplicatePages", "removedTo", "order", "$before", "before", "changeMouseCursor", "e", "copying", "initDragging", "origCursor", "options", "dragCancelled", "cancelDrag", "getPageObject", "$journal", "handleMerging", "event", "drag", "drop", "initMerging", "initAddButton", "createFactory", "handleHeaderClick", "each", "crumbs", "target", "prefix", "emitHeader", "$header", "remote", "tooltip", "emitTimestamp", "emitControls", "emitBacklinks", "$backlinks", "slug", "backlinks", "links", "linkSlug", "backlink", "flags", "i", "site", "joint", "linkBack", "emitFooter", "$footer", "host", "editDate", "journal", "iterable", "action", "emitTwins", "viewing", "remoteSite", "page", "bin", "bins", "info", "twins", "legend", "renderPageIntoPageElement", "$paper", "$handleParent", "$twins", "className", "$pagehandle", "promise", "done", "itemIndex", "createMissingFlag", "favicon", "rebuildPage", "buildPage", "pageKey", "newFuturePage", "title", "create", "hits", "result", "c", "hit", "cycle", "_reject", "rev", "pageInformation", "whenNotGotten", "link", "key", "whenGotten", "require_link", "__commonJSMin", "exports", "module", "lineup", "active", "refresh", "asTitle", "asSlug", "pageEmitter", "createPage", "name", "loc", "title", "site", "$page", "showPage", "_i", "e", "doInternalLink", "slug", "showResult", "pageObject", "options", "event", "require_editor", "__commonJSMin", "exports", "module", "plugin", "itemz", "pageHandler", "link", "random", "escape", "string", "textEditor", "$item", "item", "option", "enterCount", "keydownHandler", "e", "$textarea", "page", "suffix", "sel", "getSelectionPos", "$previous", "previous", "caret", "$page", "text", "prefix", "spawnEditor", "focusoutHandler", "_index", "className", "original", "index", "setCaretPosition", "$before", "type", "before", "el", "iePos", "caretPos", "range", "require_security", "__commonJSMin", "exports", "module", "security", "plugin", "user", "require_wiki", "__commonJSMin", "exports", "module", "wiki", "siteAdapter", "itemz", "dialog", "link", "plugin", "vis", "who", "idx", "things", "neighborhood", "pageHandler", "resolve", "editor", "require_drop", "__commonJSMin", "exports", "module", "isFile", "event", "dt", "isUrl", "url", "isPage", "found", "origin", "item", "isImage", "isSvg", "isVideo", "parsedURL", "dispatch", "handlers", "file", "handle", "punt", "stop", "ignored", "image", "page", "svg", "video", "require_target", "__commonJSMin", "exports", "module", "targeting", "$item", "item", "itemElem", "action", "consumed", "bind", "e", "startTargeting", "stopTargeting", "enterItem", "leaveItem", "enterAction", "leaveAction", "alignItem", "enterBacklink", "leaveBacklink", "id", "$page", "key", "place", "i", "itemFor", "pageFor", "pageKey", "_i", "page", "pageItem", "_item", "align", "offset", "require_license", "__commonJSMin", "exports", "module", "resolve", "lineup", "cc", "authors", "page", "site", "done", "list", "action", "siteURL", "siteFlag", "provenance", "info", "$page", "pageObject", "require_legacy", "__commonJSMin", "pageHandler", "state", "active", "refresh", "lineup", "drop", "dialog", "link", "target", "license", "plugin", "util", "asSlug", "newPage", "preLoadEditors", "catalog", "entry", "error", "data", "event", "direction", "pages", "newIndex", "request", "settings", "commas", "number", "readFile", "file", "reader", "e", "result", "resultPage", "slug", "page", "deletePage", "pageObject", "$page", "err", "futurePage", "getTemplate", "done", "siteFound", "finishClick", "name", "originalPageIndex", "evt", "ui", "$pages", "index", "firstItemIndex", "title", "$link", "site", "rev", "action", "json", "$action", "key", "_i", "iterable", "i", "p", "needle", "template", "item", "neighbor", "element", "getPluginReference", "resolve", "reject", "titles", "info", "items", "renderNextPage", "require_neighbors", "__commonJSMin", "exports", "module", "link", "wiki", "neighborhood", "util", "sites", "totalPages", "hasLinks", "element", "flag", "site", "inject", "formatNeighborTitle", "error", "pageCount", "title", "error1", "error2", "bind", "$neighborhood", "sum", "$neighbor", "require_search", "__commonJSMin", "exports", "module", "pageHandler", "random", "link", "active", "newPage", "resolve", "page", "deepCopy", "object", "emit", "$item", "item", "slug", "site", "finishClick", "e", "name", "createSearch", "neighborhood", "searchQuery", "offset", "searchResults", "searchTerms", "t", "searchHighlightRegExp", "highlightText", "text", "p", "$search", "count", "max_results", "result", "tally", "resultPage", "pageObject", "require_searchbox", "__commonJSMin", "exports", "module", "createSearch", "search", "inject", "neighborhood", "bind", "e", "searchQuery", "require_bind", "__commonJSMin", "neighborhood", "neighbors", "searchbox", "state", "link", "site", "require_reference", "__commonJSMin", "exports", "module", "editor", "resolve", "page", "emit", "$item", "item", "slug", "site", "bind", "require_factory", "__commonJSMin", "exports", "module", "neighborhood", "plugin", "resolve", "pageHandler", "editor", "synopsis", "drop", "active", "escape", "line", "emit", "$item", "item", "showMenu", "menu", "info", "column", "evt", "pluginName", "pluginType", "entry", "error", "showPrompt", "data", "bind", "syncEditAction", "$page", "err", "punt", "addReference", "remote", "addVideo", "video", "addRemoteImage", "url", "response", "imageBlob", "imageFileName", "reader", "loadEvent", "imageDataURL", "addRemoteSvg", "svgText", "readFile", "file", "majorType", "minorType", "result", "array", "csvToArray", "arrayToJson", "e", "strData", "strDelimiter", "objPattern", "arrData", "arrMatches", "strMatchedValue", "strMatchedDelimiter", "cols", "rowToObject", "row", "obj", "v", "idx", "k", "require_paragraph", "__commonJSMin", "exports", "module", "editor", "resolve", "itemz", "type", "text", "emit", "$item", "item", "bind", "e", "require_future", "__commonJSMin", "exports", "module", "resolve", "neighborhood", "lineup", "refresh", "emit", "$item", "item", "info", "transport", "proposedSlug", "localPage", "offerAltLineup", "offerPages", "c", "slug", "altContext", "altLinkText", "bind", "e", "params", "req", "page", "resultPage", "$page", "pageObject", "require_importer", "__commonJSMin", "exports", "module", "util", "link", "newPage", "escape", "text", "emit", "$item", "item", "render", "pages", "result", "slug", "page", "line", "date", "bind", "e", "$page", "pageObject", "require_plugins", "__commonJSMin", "plugin"]
}
